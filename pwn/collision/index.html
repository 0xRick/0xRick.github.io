<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          pwnable.kr - collision - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="pwnable-kr-collision"><a href="#pwnable-kr-collision" class="headerlink" title="pwnable.kr - collision"></a>pwnable.kr - collision</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Hey guys this is my write-up for a challenge called <code>collision</code> from <a href="http://pwnable.kr/" target="_blank" rel="noopener">pwnable.kr</a>. It’s a very simple challenge, we need a password to make the program read the flag, the function that validates the given password is vulnerable to hash collision so we will exploit it.<br>Challenge Description : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Daddy told me about cool MD5 hash collision today.</span><br><span class="line">I wanna do something like that too!</span><br><span class="line"></span><br><span class="line">ssh col@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>
<p><img src="/images/pwn/collision/0.png" alt=""></p>
<h2 id="Code-Analysis-Tests"><a href="#Code-Analysis-Tests" class="headerlink" title="Code Analysis, Tests"></a>Code Analysis, Tests</h2><p><code>col.c</code> :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> hashcode = <span class="number">0x21DD09EC</span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">check_password</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span>* ip = (<span class="keyword">int</span>*)p;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">		res += ip[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"usage : %s [passcode]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strlen</span>(argv[<span class="number">1</span>]) != <span class="number">20</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"passcode length should be 20 bytes\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(hashcode == check_password( argv[<span class="number">1</span>] ))&#123;</span><br><span class="line">		system(<span class="string">"/bin/cat flag"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"wrong passcode.\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>main()</code> :</p>
<p>Starting by the main function it checks if we have given the program an input and it checks if our input’s length is exactly 20 bytes. Then it checks if the return value of <code>check_password(our input)</code> is equal to <code>hashcode</code>, if we pass that check it will read the flag, otherwise it will print <code>wrong passcode.</code> and exit.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"usage : %s [passcode]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strlen</span>(argv[<span class="number">1</span>]) != <span class="number">20</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"passcode length should be 20 bytes\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(hashcode == check_password( argv[<span class="number">1</span>] ))&#123;</span><br><span class="line">		system(<span class="string">"/bin/cat flag"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"wrong passcode.\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Looking up, we can see the declaration of the variable <code>hashcode</code>  :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> hashcode = <span class="number">0x21DD09EC</span>;</span><br></pre></td></tr></table></figure>
<p>That’s a hex value, let’s convert it to decimal with python :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x21DD09EC</span></span><br><span class="line"><span class="number">568134124</span></span><br></pre></td></tr></table></figure>
<p>So we need our input to be 20 bytes length and we also need to make the function <code>check_password</code> return <code>568134124</code> when our input is given to it.<br>Let’s quickly try to simulate that in <code>gdb</code>.<br>I ran the program and set a breakpoint at main :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">gef➤  <span class="keyword">break</span> main                                                                                                                                                                                         </span><br><span class="line">Breakpoint <span class="number">1</span> at <span class="number">0x11b3</span>                                                                                                                                                                                   </span><br><span class="line">gef➤  r <span class="string">"AAAAAAAAAAAAAAAAAAAA"</span></span><br><span class="line">Starting program: /root/Desktop/pwnable.kr/collision/col <span class="string">"AAAAAAAAAAAAAAAAAAAA"</span></span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">1</span>, <span class="number">0x00005555555551b3</span> <span class="function">in <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line">[ Legend: Modified register | Code | Heap | Stack | String ]</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$rax   : <span class="number">0x00005555555551af</span>  →  &lt;main+<span class="number">0</span>&gt; push rbp</span><br><span class="line">$rbx   : <span class="number">0x0</span> </span><br><span class="line">$rcx   : <span class="number">0x00007ffff7fa9718</span>  →  <span class="number">0x00007ffff7faad80</span>  →  <span class="number">0x0000000000000000</span></span><br><span class="line">$rdx   : <span class="number">0x00007fffffffe160</span>  →  <span class="number">0x00007fffffffe48b</span>  →  <span class="string">"SHELL=/bin/bash"</span></span><br><span class="line">$rsp   : <span class="number">0x00007fffffffe060</span>  →  <span class="number">0x0000555555555260</span>  →  &lt;__libc_csu_init+<span class="number">0</span>&gt; push r15</span><br><span class="line">$rbp   : <span class="number">0x00007fffffffe060</span>  →  <span class="number">0x0000555555555260</span>  →  &lt;__libc_csu_init+<span class="number">0</span>&gt; push r15</span><br><span class="line">$rsi   : <span class="number">0x00007fffffffe148</span>  →  <span class="number">0x00007fffffffe44f</span>  →  <span class="string">"/root/Desktop/pwnable.kr/collision/col"</span></span><br><span class="line">$rdi   : <span class="number">0x2</span>                                                                                                           </span><br><span class="line">$rip   : <span class="number">0x00005555555551b3</span>  →  &lt;main+<span class="number">4</span>&gt; sub rsp, <span class="number">0x10</span></span><br><span class="line">$r8    : <span class="number">0x00007ffff7faad80</span>  →  <span class="number">0x0000000000000000</span></span><br><span class="line">$r9    : <span class="number">0x00007ffff7faad80</span>  →  <span class="number">0x0000000000000000</span></span><br><span class="line">$r10   : <span class="number">0x0</span></span><br><span class="line">$r11   : <span class="number">0x00007ffff7f6b1b0</span>  →  <span class="number">0x0000800003400468</span></span><br><span class="line">$r12   : <span class="number">0x0000555555555080</span>  →  &lt;_start+<span class="number">0</span>&gt; <span class="keyword">xor</span> ebp, ebp</span><br><span class="line">$r13   : <span class="number">0x00007fffffffe140</span>  →  <span class="number">0x0000000000000002</span></span><br><span class="line">$r14   : <span class="number">0x0</span></span><br><span class="line">$r15   : <span class="number">0x0</span></span><br><span class="line">$eflags: [ZERO carry PARITY adjust sign trap INTERRUPT direction <span class="built_in">overflow</span> resume virtualx86 identification]</span><br><span class="line">$cs: <span class="number">0x0033</span> $ss: <span class="number">0x002b</span> $ds: <span class="number">0x0000</span> $es: <span class="number">0x0000</span> $fs: <span class="number">0x0000</span> $gs: <span class="number">0x0000</span></span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── <span class="built_in">stack</span> ────</span><br><span class="line"><span class="number">0x00007fffffffe060</span>│+<span class="number">0x0000</span>: <span class="number">0x0000555555555260</span>  →  &lt;__libc_csu_init+<span class="number">0</span>&gt; push r15  ← $rsp, $rbp</span><br><span class="line"><span class="number">0x00007fffffffe068</span>│+<span class="number">0x0008</span>: <span class="number">0x00007ffff7e1209b</span>  →  &lt;__libc_start_main+<span class="number">235</span>&gt; mov edi, eax</span><br><span class="line"><span class="number">0x00007fffffffe070</span>│+<span class="number">0x0010</span>: <span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x00007fffffffe078</span>│+<span class="number">0x0018</span>: <span class="number">0x00007fffffffe148</span>  →  <span class="number">0x00007fffffffe44f</span>  →  <span class="string">"/root/Desktop/pwnable.kr/collision/col"</span></span><br><span class="line"><span class="number">0x00007fffffffe080</span>│+<span class="number">0x0020</span>: <span class="number">0x0000000200040000</span></span><br><span class="line"><span class="number">0x00007fffffffe088</span>│+<span class="number">0x0028</span>: <span class="number">0x00005555555551af</span>  →  &lt;main+<span class="number">0</span>&gt; push rbp</span><br><span class="line"><span class="number">0x00007fffffffe090</span>│+<span class="number">0x0030</span>: <span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x00007fffffffe098</span>│+<span class="number">0x0038</span>: <span class="number">0xf6e7f80b45a87e3d</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:<span class="number">64</span> ────</span><br><span class="line">   <span class="number">0x5555555551ae</span> &lt;check_password+<span class="number">73</span>&gt; ret</span><br><span class="line">   <span class="number">0x5555555551af</span> &lt;main+<span class="number">0</span>&gt;         push   rbp</span><br><span class="line">   <span class="number">0x5555555551b0</span> &lt;main+<span class="number">1</span>&gt;         mov    rbp, rsp</span><br><span class="line"> → <span class="number">0x5555555551b3</span> &lt;main+<span class="number">4</span>&gt;         sub    rsp, <span class="number">0x10</span></span><br><span class="line">   <span class="number">0x5555555551b7</span> &lt;main+<span class="number">8</span>&gt;         mov    DWORD PTR [rbp<span class="number">-0x4</span>], edi</span><br><span class="line">   <span class="number">0x5555555551ba</span> &lt;main+<span class="number">11</span>&gt;        mov    QWORD PTR [rbp<span class="number">-0x10</span>], rsi</span><br><span class="line">   <span class="number">0x5555555551be</span> &lt;main+<span class="number">15</span>&gt;        cmp    DWORD PTR [rbp<span class="number">-0x4</span>], <span class="number">0x1</span></span><br><span class="line">   <span class="number">0x5555555551c2</span> &lt;main+<span class="number">19</span>&gt;        jg     <span class="number">0x5555555551e6</span> &lt;main+<span class="number">55</span>&gt;</span><br><span class="line">   <span class="number">0x5555555551c4</span> &lt;main+<span class="number">21</span>&gt;        mov    rax, QWORD PTR [rbp<span class="number">-0x10</span>]</span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────</span><br><span class="line">[#<span class="number">0</span>] Id <span class="number">1</span>, Name: <span class="string">"col"</span>, stopped, reason: BREAKPOINT</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────</span><br><span class="line">[#<span class="number">0</span>] <span class="number">0x5555555551b3</span> → main()</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">gef➤</span><br></pre></td></tr></table></figure>
<p>Then I set a breakpoint before the return instruction in <code>check_password()</code> and continued the execution :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disas check_password</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function check_password:</span><br><span class="line">   <span class="number">0x0000555555555165</span> &lt;+<span class="number">0</span>&gt;:     push   rbp</span><br><span class="line">   <span class="number">0x0000555555555166</span> &lt;+<span class="number">1</span>&gt;:     mov    rbp,rsp</span><br><span class="line">   <span class="number">0x0000555555555169</span> &lt;+<span class="number">4</span>&gt;:     mov    QWORD PTR [rbp<span class="number">-0x18</span>],rdi</span><br><span class="line">   <span class="number">0x000055555555516d</span> &lt;+<span class="number">8</span>&gt;:     mov    rax,QWORD PTR [rbp<span class="number">-0x18</span>]</span><br><span class="line">   <span class="number">0x0000555555555171</span> &lt;+<span class="number">12</span>&gt;:    mov    QWORD PTR [rbp<span class="number">-0x10</span>],rax</span><br><span class="line">   <span class="number">0x0000555555555175</span> &lt;+<span class="number">16</span>&gt;:    mov    DWORD PTR [rbp<span class="number">-0x8</span>],<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x000055555555517c</span> &lt;+<span class="number">23</span>&gt;:    mov    DWORD PTR [rbp<span class="number">-0x4</span>],<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x0000555555555183</span> &lt;+<span class="number">30</span>&gt;:    jmp    <span class="number">0x5555555551a2</span> &lt;check_password+<span class="number">61</span>&gt;</span><br><span class="line">   <span class="number">0x0000555555555185</span> &lt;+<span class="number">32</span>&gt;:    mov    eax,DWORD PTR [rbp<span class="number">-0x4</span>]</span><br><span class="line">   <span class="number">0x0000555555555188</span> &lt;+<span class="number">35</span>&gt;:    cdqe</span><br><span class="line">   <span class="number">0x000055555555518a</span> &lt;+<span class="number">37</span>&gt;:    lea    rdx,[rax*<span class="number">4</span>+<span class="number">0x0</span>]</span><br><span class="line">   <span class="number">0x0000555555555192</span> &lt;+<span class="number">45</span>&gt;:    mov    rax,QWORD PTR [rbp<span class="number">-0x10</span>]</span><br><span class="line">   <span class="number">0x0000555555555196</span> &lt;+<span class="number">49</span>&gt;:    add    rax,rdx</span><br><span class="line">   <span class="number">0x0000555555555199</span> &lt;+<span class="number">52</span>&gt;:    mov    eax,DWORD PTR [rax]</span><br><span class="line">   <span class="number">0x000055555555519b</span> &lt;+<span class="number">54</span>&gt;:    add    DWORD PTR [rbp<span class="number">-0x8</span>],eax</span><br><span class="line">   <span class="number">0x000055555555519e</span> &lt;+<span class="number">57</span>&gt;:    add    DWORD PTR [rbp<span class="number">-0x4</span>],<span class="number">0x1</span></span><br><span class="line">   <span class="number">0x00005555555551a2</span> &lt;+<span class="number">61</span>&gt;:    cmp    DWORD PTR [rbp<span class="number">-0x4</span>],<span class="number">0x4</span></span><br><span class="line">   <span class="number">0x00005555555551a6</span> &lt;+<span class="number">65</span>&gt;:    jle    <span class="number">0x555555555185</span> &lt;check_password+<span class="number">32</span>&gt;</span><br><span class="line">   <span class="number">0x00005555555551a8</span> &lt;+<span class="number">67</span>&gt;:    mov    eax,DWORD PTR [rbp<span class="number">-0x8</span>]</span><br><span class="line">   <span class="number">0x00005555555551ab</span> &lt;+<span class="number">70</span>&gt;:    cdqe</span><br><span class="line">   <span class="number">0x00005555555551ad</span> &lt;+<span class="number">72</span>&gt;:    pop    rbp</span><br><span class="line">   <span class="number">0x00005555555551ae</span> &lt;+<span class="number">73</span>&gt;:    ret</span><br><span class="line">End of assembler dump.</span><br><span class="line">gef➤  <span class="keyword">break</span> *<span class="number">0x00005555555551ae</span></span><br><span class="line">Breakpoint <span class="number">2</span> at <span class="number">0x5555555551ae</span></span><br><span class="line">gef➤  c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint <span class="number">2</span>, <span class="number">0x00005555555551ae</span> <span class="function">in <span class="title">check_password</span> <span class="params">()</span></span></span><br><span class="line">[ Legend: Modified register | Code | Heap | Stack | String ]</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$rax   : <span class="number">0x46464645</span></span><br><span class="line">$rbx   : <span class="number">0x0</span></span><br><span class="line">$rcx   : <span class="number">0x6</span></span><br><span class="line">$rdx   : <span class="number">0x10</span></span><br><span class="line">$rsp   : <span class="number">0x00007fffffffe048</span>  →  <span class="number">0x0000555555555225</span>  →  &lt;main+<span class="number">118</span>&gt; mov rdx, rax</span><br><span class="line">$rbp   : <span class="number">0x00007fffffffe060</span>  →  <span class="number">0x0000555555555260</span>  →  &lt;__libc_csu_init+<span class="number">0</span>&gt; push r15</span><br><span class="line">$rsi   : <span class="number">0x00007fffffffe148</span>  →  <span class="number">0x00007fffffffe44f</span>  →  <span class="string">"/root/Desktop/pwnable.kr/collision/col"</span></span><br><span class="line">$rdi   : <span class="number">0x00007fffffffe476</span>  →  <span class="string">"AAAAAAAAAAAAAAAAAAAA"</span></span><br><span class="line">$rip   : <span class="number">0x00005555555551ae</span>  →  &lt;check_password+<span class="number">73</span>&gt; ret </span><br><span class="line">$r8    : <span class="number">0x400</span></span><br><span class="line">$r9    : <span class="number">0x00007ffff7faad80</span>  →  <span class="number">0x0000000000000000</span></span><br><span class="line">$r10   : <span class="number">0xfffffffffffff479</span></span><br><span class="line">$r11   : <span class="number">0x00007ffff7e861e0</span>  →  &lt;__strlen_sse2+<span class="number">0</span>&gt; pxor xmm0, xmm0</span><br><span class="line">$r12   : <span class="number">0x0000555555555080</span>  →  &lt;_start+<span class="number">0</span>&gt; <span class="keyword">xor</span> ebp, ebp</span><br><span class="line">$r13   : <span class="number">0x00007fffffffe140</span>  →  <span class="number">0x0000000000000002</span></span><br><span class="line">$r14   : <span class="number">0x0</span></span><br><span class="line">$r15   : <span class="number">0x0</span></span><br><span class="line">$eflags: [zero carry parity adjust sign trap INTERRUPT direction <span class="built_in">overflow</span> resume virtualx86 identification]</span><br><span class="line">$cs: <span class="number">0x0033</span> $ss: <span class="number">0x002b</span> $ds: <span class="number">0x0000</span> $es: <span class="number">0x0000</span> $fs: <span class="number">0x0000</span> $gs: <span class="number">0x0000</span></span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── <span class="built_in">stack</span> ────</span><br><span class="line"><span class="number">0x00007fffffffe048</span>│+<span class="number">0x0000</span>: <span class="number">0x0000555555555225</span>  →  &lt;main+<span class="number">118</span>&gt; mov rdx, rax       ← $rsp</span><br><span class="line"><span class="number">0x00007fffffffe050</span>│+<span class="number">0x0008</span>: <span class="number">0x00007fffffffe148</span>  →  <span class="number">0x00007fffffffe44f</span>  →  <span class="string">"/root/Desktop/pwnable.kr/collision/col"</span></span><br><span class="line"><span class="number">0x00007fffffffe058</span>│+<span class="number">0x0010</span>: <span class="number">0x0000000200000000</span></span><br><span class="line"><span class="number">0x00007fffffffe060</span>│+<span class="number">0x0018</span>: <span class="number">0x0000555555555260</span>  →  &lt;__libc_csu_init+<span class="number">0</span>&gt; push r15  ← $rbp</span><br><span class="line"><span class="number">0x00007fffffffe068</span>│+<span class="number">0x0020</span>: <span class="number">0x00007ffff7e1209b</span>  →  &lt;__libc_start_main+<span class="number">235</span>&gt; mov edi, eax</span><br><span class="line"><span class="number">0x00007fffffffe070</span>│+<span class="number">0x0028</span>: <span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x00007fffffffe078</span>│+<span class="number">0x0030</span>: <span class="number">0x00007fffffffe148</span>  →  <span class="number">0x00007fffffffe44f</span>  →  <span class="string">"/root/Desktop/pwnable.kr/collision/col"</span></span><br><span class="line"><span class="number">0x00007fffffffe080</span>│+<span class="number">0x0038</span>: <span class="number">0x0000000200040000</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:<span class="number">64</span> ────</span><br><span class="line">   <span class="number">0x5555555551a1</span> &lt;check_password+<span class="number">60</span>&gt; add    DWORD PTR [rbx+<span class="number">0x7e04fc7d</span>], eax</span><br><span class="line">   <span class="number">0x5555555551a7</span> &lt;check_password+<span class="number">66</span>&gt; fisttp QWORD PTR [rbx<span class="number">-0x67b707bb</span>]</span><br><span class="line">   <span class="number">0x5555555551ad</span> &lt;check_password+<span class="number">72</span>&gt; pop    rbp</span><br><span class="line"> → <span class="number">0x5555555551ae</span> &lt;check_password+<span class="number">73</span>&gt; ret    </span><br><span class="line">   ↳  <span class="number">0x555555555225</span> &lt;main+<span class="number">118</span>&gt;       mov    rdx, rax</span><br><span class="line">      <span class="number">0x555555555228</span> &lt;main+<span class="number">121</span>&gt;       mov    rax, QWORD PTR [rip+<span class="number">0x2e19</span>]        # <span class="number">0x555555558048</span> &lt;hashcode&gt;</span><br><span class="line">      <span class="number">0x55555555522f</span> &lt;main+<span class="number">128</span>&gt;       cmp    rdx, rax</span><br><span class="line">      <span class="number">0x555555555232</span> &lt;main+<span class="number">131</span>&gt;       jne    <span class="number">0x55555555524c</span> &lt;main+<span class="number">157</span>&gt;</span><br><span class="line">      <span class="number">0x555555555234</span> &lt;main+<span class="number">133</span>&gt;       lea    rdi, [rip+<span class="number">0xe08</span>]        # <span class="number">0x555555556043</span></span><br><span class="line">      <span class="number">0x55555555523b</span> &lt;main+<span class="number">140</span>&gt;       mov    eax, <span class="number">0x0</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────</span><br><span class="line">[#<span class="number">0</span>] Id <span class="number">1</span>, Name: <span class="string">"col"</span>, stopped, reason: BREAKPOINT</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────</span><br><span class="line">[#<span class="number">0</span>] <span class="number">0x5555555551ae</span> → check_password()</span><br><span class="line">[#<span class="number">1</span>] <span class="number">0x555555555225</span> → main()</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">gef➤</span><br></pre></td></tr></table></figure>
<p>The return value of <code>check_password()</code> is saved in <code>EAX</code> we need it to be <code>568134124</code> :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  <span class="built_in">print</span> $eax</span><br><span class="line">$<span class="number">1</span> = <span class="number">0x46464645</span></span><br><span class="line">gef➤  <span class="built_in">set</span> $eax=<span class="number">568134124</span></span><br></pre></td></tr></table></figure>
<p>Now if we continue execution it should attempt to execute <code>/bin/cat flag</code> :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef➤  c</span><br><span class="line">Continuing.</span><br><span class="line">[Detaching after fork from child <span class="built_in">process</span> <span class="number">3166</span>]</span><br><span class="line">/bin/cat: flag: No such file <span class="keyword">or</span> directory</span><br><span class="line">[Inferior <span class="number">1</span> (<span class="built_in">process</span> <span class="number">3101</span>) exited normally]</span><br><span class="line">gef➤</span><br></pre></td></tr></table></figure>
<p>Great, now we need to find out how to make <code>check_password()</code> return that value, let’s look at the code.<br><code>check_password()</code> :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">check_password</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span>* ip = (<span class="keyword">int</span>*)p;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">		res += ip[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This function casts the given passcode (<code>p</code>) into integer, declares <code>ip</code> which is an <a href="https://www.tutorialspoint.com/cprogramming/c_array_of_pointers.htm" target="_blank" rel="noopener">array of pointers</a> starting with the pointer to <code>p</code>, and declares an <code>int</code> variable called <code>res</code> and gives it a value of <code>0</code> then it loops 5 times through <code>ip</code> (because length of <code>passcode</code> is 20, <code>20/4 == 5</code>) and adds each value to <code>res</code>, finally it returns <code>res</code>.<br>In case you’re confused, simply what happens is that it takes the given passcode which is 20 bytes length and divides it to 5 pieces (each piece 4 bytes) then it sums the decimal value of the 5 pieces and returns that value. For example the result of giving <code>check_password()</code> “AAAAAAAAAAAAAAAAAAAA” will be like this :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"AAAA"</span> + <span class="string">"AAAA"</span> + <span class="string">"AAAA"</span> + <span class="string">"AAAA"</span> + <span class="string">"AAAA"</span></span><br><span class="line"><span class="number">0x41414141</span> + <span class="number">0x41414141</span> + <span class="number">0x41414141</span> + <span class="number">0x41414141</span> + <span class="number">0x41414141</span></span><br><span class="line"><span class="number">1094795585</span> + <span class="number">1094795585</span> + <span class="number">1094795585</span> + <span class="number">1094795585</span> + <span class="number">1094795585</span></span><br><span class="line">res = <span class="number">5473977925</span></span><br></pre></td></tr></table></figure>
<p>To verify that I took the main code and added some <code>printf</code> statements, test code looks like this :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> hashcode = <span class="number">0x21DD09EC</span>;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">check_password</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span>* ip = (<span class="keyword">int</span>*)p;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">		res += ip[i];</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n--------------------------\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"loop :  %i\n"</span>, i);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"piece value : %i\n"</span>,ip[i] );</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"usage : %s [passcode]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strlen</span>(argv[<span class="number">1</span>]) != <span class="number">20</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"passcode length should be 20 bytes\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"hashcode : %i\n"</span>, hashcode);</span><br><span class="line">	<span class="keyword">if</span>(hashcode == check_password( argv[<span class="number">1</span>] ))&#123;</span><br><span class="line">		system(<span class="string">"/bin/cat flag"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"wrong passcode.\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let’s give it 20 A’s :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;pwnable.kr&#x2F;collision&#x2F;test# .&#x2F;test &quot;AAAAAAAAAAAAAAAAAAAA&quot;</span><br><span class="line">hashcode : 568134124</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  0</span><br><span class="line">piece value : 1094795585</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  1</span><br><span class="line">piece value : 1094795585</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  2</span><br><span class="line">piece value : 1094795585</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  3</span><br><span class="line">piece value : 1094795585</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  4</span><br><span class="line">piece value : 1094795585</span><br><span class="line"></span><br><span class="line">wrong passcode.</span><br></pre></td></tr></table></figure>
<p>You can see that the 5 pieces are of the same value which is the value of <code>0x41414141</code> (4 A’s) :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x41414141</span></span><br><span class="line"><span class="number">1094795585</span></span><br></pre></td></tr></table></figure>
<p>And if we give it <code>AAAABBBBCCCCDDDDEEEE</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;pwnable.kr&#x2F;collision&#x2F;test# .&#x2F;test &quot;AAAABBBBCCCCDDDDEEEE&quot;         </span><br><span class="line">hashcode : 568134124</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  0</span><br><span class="line">piece value : 1094795585</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  1</span><br><span class="line">piece value : 1111638594</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  2</span><br><span class="line">piece value : 1128481603</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  3</span><br><span class="line">piece value : 1145324612</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  4</span><br><span class="line">piece value : 1162167621</span><br><span class="line"></span><br><span class="line">wrong passcode.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x41414141</span></span><br><span class="line"><span class="number">1094795585</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x42424242</span></span><br><span class="line"><span class="number">1111638594</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x43434343</span></span><br><span class="line"><span class="number">1128481603</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x44444444</span></span><br><span class="line"><span class="number">1145324612</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x45454545</span></span><br><span class="line"><span class="number">1162167621</span></span><br></pre></td></tr></table></figure>


<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><p>We need to come up with 5 pieces that add up to 568134124.<br>We can divide the original value by 5 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">568134124</span>/<span class="number">5</span></span><br><span class="line"><span class="number">113626824</span></span><br></pre></td></tr></table></figure>
<p>But 568134124 isn’t divisible by 5 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">568134124</span>%<span class="number">5</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>We can use 113626824 as the first 4 pieces, to get the last piece we will multiply 113626824 by 4 and subtract the result from 568134124 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">113626824</span> * <span class="number">4</span></span><br><span class="line"><span class="number">454507296</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">568134124</span> - <span class="number">454507296</span></span><br><span class="line"><span class="number">113626828</span></span><br></pre></td></tr></table></figure>
<p>What’s left is to convert them to hex :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hex(<span class="number">113626824</span>)</span><br><span class="line"><span class="string">'0x6c5cec8'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hex(<span class="number">113626828</span>)</span><br><span class="line"><span class="string">'0x6c5cecc'</span></span><br></pre></td></tr></table></figure>
<p>And because it’s little endian we will reverse the order, final payload will be :</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c 'print "\xc8\xce\xc5\x06" * 4 + "\xcc\xce\xc5\x06"'</span><br></pre></td></tr></table></figure>
<p>Let’s test it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;pwnable.kr&#x2F;collision&#x2F;test# .&#x2F;test &#96;python -c &#39;print &quot;\xc8\xce\xc5\x06&quot; * 4 + &quot;\xcc\xce\xc5\x06&quot;&#39;&#96;                                                                 </span><br><span class="line">ip : 1329747125</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  0</span><br><span class="line">piece value : 113626824</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  1</span><br><span class="line">piece value : 113626824</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  2</span><br><span class="line">piece value : 113626824</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  3</span><br><span class="line">piece value : 113626824</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">loop :  4</span><br><span class="line">piece value : 113626828</span><br><span class="line"></span><br><span class="line">&#x2F;bin&#x2F;cat: flag: No such file or directory</span><br></pre></td></tr></table></figure>
<p>It works.<br><img src="/images/pwn/collision/1.png" alt=""><br>And by the way what we did now is a <a href="https://learncryptography.com/hash-functions/hash-collision-attack" target="_blank" rel="noopener">hash collision</a>, we made a hash function produce the same output for different inputs.<br>I also wrote small python script using <code>pwntools</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = p32(<span class="number">0x6c5cec8</span>) * <span class="number">4</span> + p32(<span class="number">0x6c5cecc</span>)</span><br><span class="line"></span><br><span class="line">r = ssh(<span class="string">'col'</span> ,<span class="string">'pwnable.kr'</span> ,password=<span class="string">'guest'</span>, port=<span class="number">2222</span>)</span><br><span class="line">p = r.process(executable=<span class="string">'./col'</span>, argv=[<span class="string">'col'</span>,payload])</span><br><span class="line">flag = p.recv()</span><br><span class="line">log.success(<span class="string">"Flag: "</span> + flag)</span><br><span class="line">p.close()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<p><img src="/images/pwn/collision/2.png" alt=""><br>pwned !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">other write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.<br>Previous pwn write-up : <a href="/pwn/bof/">pwnable.kr - bof</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-08-28</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/pwn/">pwn</a>

      <a class="tag-link" href="/tags/binary-exploitation/" rel="tag">#binary-exploitation</a> <a class="tag-link" href="/tags/c/" rel="tag">#c</a> <a class="tag-link" href="/tags/code-analysis/" rel="tag">#code-analysis</a> <a class="tag-link" href="/tags/exploit-development/" rel="tag">#exploit-development</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/python/" rel="tag">#python</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
