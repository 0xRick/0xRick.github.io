<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Active - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Active from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Active">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/active/">


  <meta property="og:description" content="My write-up / walkthrough for Active from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Active">
  <meta name="twitter:description" content="My write-up / walkthrough for Active from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/active/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2018-12-08T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/active/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Active">
    <meta itemprop="description" content="Hack The Box - ActiveQuick SummaryActive was a great box and very realistic , Kinda easy if you’re familiar with windows active directory security. But if you’re not … then this box will teach you something. It’s a windows box and its ip is 10.10.10.100 so let’s jump right in .NmapAs Always we will start with nmap to scan for TCP ports and Servicesnmap -sV -sT 10.10.10.100And we see many ports open but we will focus on the important ports only.Kerberos on 88 , netbios-ssn on 139 , ldap on 389 and 3268.SMB EnumerationSince we have netbios-ssn open on port 139 let’s run smbmap and see what we get.If you’re not on kali you can get smbmap from heresmbmap -H 10.10.10.100And we see that we can only access the share Replication anonymouslysmbclient //10.10.10.100/ReplicationAfter we access the share we will find a file called Groups.xml in \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\By looking at the file we will find a username and an encrypted password.Decrypting GPPSo if you don’t know what’s that cpassword … it’s called gpp (Group Policy Password) And I won’t talk about it in the write-up. If you’re interested here’s a great resource to read about itTo decrypt it there’s a tool called gpp-decrypt. If you’re not on kali get it from hereAnd we got the password GPPstillStandingStrong2k18.UserNow we have the credentials SVC_TGS:GPPstillStandingStrong2k18 and we can own usersmbclient //10.10.10.100/Users -U SVC_TGSKerberoastingNow if we return to our nmap scan.We will see that we have kerberos running on port 88 and we have owned a user on the box so we will go for kerberoasting and if you don’t know what kerberoasting technique is you can read this great series about it :Part 1Part 2Part 3First we will add 10.10.10.100 to our /etc/hostsThen We will use GetUserSPNs.py from impacket to get administrator  Kerberos ticket./GetUserSPNs.py -request active.htb/SVC_TGSAnd we got the ticket in john format so it’s ready for cracking.We will just add the option -outputfile to save the ticket in a file and we’re ready to go.Cracking The TicketWe will use john to crack the ticket with rockyou.txtAnd one of the problems that I faced when I was trying to crack the ticket is that john wasn’t recognizing the format so make sure you’re using an updated version of both impacket and john because impacket also had problems with the hash format output. For me the problem was with john so I solved it by using jumbo version of john../john admin.txt --wordlist=/usr/share/wordlists/rockyou.txtAnd we got the administrator password : Ticketmaster1968RootNow we can easily get a root shell using psexec.py from impacket./psexec.py administrator@active.htbThat’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - HawkNext Hack The Box write-up : Hack The Box - Waldo">
    <meta itemprop="datePublished" content="2018-12-08T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/active/" class="u-url" itemprop="url">Hack The Box - Active
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2018-12-08T07:00:00+02:00">December 8, 2018</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---active">Hack The Box - Active</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#smb-enumeration">SMB Enumeration</a></li>
<li><a href="#decrypting-gpp">Decrypting GPP</a></li>
<li><a href="#user">User</a></li>
<li><a href="#kerberoasting">Kerberoasting</a></li>
<li><a href="#cracking-the-ticket">Cracking The Ticket</a></li>
<li><a href="#root">Root</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---active">Hack The Box - Active</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Active was a great box and very realistic , Kinda easy if you’re familiar with windows active directory security. But if you’re not … then this box will teach you something. It’s a windows box and its ip is 10.10.10.100 so let’s jump right in .<br>
<br><img src="/images/hackthebox/active/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As Always we will start with nmap to scan for TCP ports and Services
<code class="language-plaintext highlighter-rouge">nmap -sV -sT 10.10.10.100</code>
<br><img src="/images/hackthebox/active/1.png" alt="" class="align-center"><br><br>
And we see many ports open but we will focus on the important ports only.<br>
Kerberos on 88 , netbios-ssn on 139 , ldap on 389 and 3268.<br></p>

<h2 id="smb-enumeration">SMB Enumeration</h2>
<p>Since we have netbios-ssn open on port 139 let’s run smbmap and see what we get.<br>
If you’re not on kali you can get smbmap from <a href="https://github.com/ShawnDEvans/smbmap" target="_blank" rel="noopener noreferrer">here</a>
<br><code class="language-plaintext highlighter-rouge">smbmap -H 10.10.10.100</code>
<br><img src="/images/hackthebox/active/2.png" alt="" class="align-center"><br><br>
And we see that we can only access the share <em>Replication</em> anonymously
<br><code class="language-plaintext highlighter-rouge">smbclient //10.10.10.100/Replication</code>
<br><img src="/images/hackthebox/active/3.png" alt="" class="align-center"><br><br>
After we access the share we will find a file called <em>Groups.xml</em> in <code class="language-plaintext highlighter-rouge">\active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\</code>
<br>By looking at the file we will find a username and an encrypted password.<br>
<br><img src="/images/hackthebox/active/4.png" alt="" class="align-center"><br><br></p>

<h2 id="decrypting-gpp">Decrypting GPP</h2>
<p>So if you don’t know what’s that cpassword … it’s called gpp (Group Policy Password) And I won’t talk about it in the write-up. If you’re interested <a href="https://adsecurity.org/?p=2288" target="_blank" rel="noopener noreferrer">here’s a great resource to read about it</a>
<br>To decrypt it there’s a tool called gpp-decrypt. If you’re not on kali get it from <a href="https://github.com/BustedSec/gpp-decrypt" target="_blank" rel="noopener noreferrer">here</a>
<br><img src="/images/hackthebox/active/5.png" alt="" class="align-center"><br><br>
And we got the password <code class="language-plaintext highlighter-rouge">GPPstillStandingStrong2k18</code>.<br></p>

<h2 id="user">User</h2>
<p>Now we have the credentials SVC_TGS:GPPstillStandingStrong2k18 and we can own user
<br><code class="language-plaintext highlighter-rouge">smbclient //10.10.10.100/Users -U SVC_TGS</code>
<br><img src="/images/hackthebox/active/6.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/active/7.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/active/8.png" alt="" class="align-center"><br><br></p>

<h2 id="kerberoasting">Kerberoasting</h2>
<p>Now if we return to our nmap scan.<br>
<br><img src="/images/hackthebox/active/1.png" alt="" class="align-center"><br><br>
We will see that we have kerberos running on port 88 and we have owned a user on the box so we will go for kerberoasting and if you don’t know what kerberoasting technique is you can read this great series about it :</p>

<p><br><a href="https://room362.com/post/2016/kerberoast-pt1/" target="_blank" rel="noopener noreferrer">Part 1</a>
<br><a href="https://room362.com/post/2016/kerberoast-pt2/" target="_blank" rel="noopener noreferrer">Part 2</a>
<br><a href="https://room362.com/post/2016/kerberoast-pt3/" target="_blank" rel="noopener noreferrer">Part 3</a></p>

<p><br>First we will add 10.10.10.100 to our /etc/hosts
<br>Then We will use GetUserSPNs.py from <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">impacket</a> to get administrator  Kerberos ticket
<code class="language-plaintext highlighter-rouge">./GetUserSPNs.py -request active.htb/SVC_TGS</code>
<br><img src="/images/hackthebox/active/9.png" alt="" class="align-center"><br><br>
And we got the ticket in john format so it’s ready for cracking.<br>
We will just add the option <code class="language-plaintext highlighter-rouge">-outputfile</code> to save the ticket in a file and we’re ready to go.<br>
<br><img src="/images/hackthebox/active/10.png" alt="" class="align-center"><br><br></p>

<h2 id="cracking-the-ticket">Cracking The Ticket</h2>
<p>We will use john to crack the ticket with rockyou.txt
<br>And one of the problems that I faced when I was trying to crack the ticket is that john wasn’t recognizing the format so make sure you’re using an updated version of both impacket and john because impacket also had problems with the hash format output. For me the problem was with john so I solved it by using <a href="https://github.com/magnumripper/JohnTheRipper" target="_blank" rel="noopener noreferrer">jumbo version of john</a>.<br>
<code class="language-plaintext highlighter-rouge">./john admin.txt --wordlist=/usr/share/wordlists/rockyou.txt</code>
<br><img src="/images/hackthebox/active/11.png" alt="" class="align-center"><br><br>
And we got the administrator password : Ticketmaster1968</p>

<h2 id="root">Root</h2>
<p>Now we can easily get a root shell using psexec.py from <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">impacket</a>
<br><code class="language-plaintext highlighter-rouge">./psexec.py administrator@active.htb</code>
<br><img src="/images/hackthebox/active/12.png" alt="" class="align-center"><br><br></p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/hawk/">Hack The Box - Hawk</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/waldo/">Hack The Box - Waldo</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-12-08T07:00:00+02:00">December 8, 2018</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/hawk/" class="pagination--pager" title="Hack The Box - Hawk
">Previous</a>
    
    
      <a href="/hack-the-box/waldo/" class="pagination--pager" title="Hack The Box - Waldo
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
