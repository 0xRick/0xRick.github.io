<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Hack The Box - Waldo - 0xRick’s Blog</title>
<meta name="description" content="My write-up / walkthrough for Waldo from Hack The Box.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Hack The Box - Waldo">
<meta property="og:url" content="https://0xrick.github.io/hack-the-box/waldo/">


  <meta property="og:description" content="My write-up / walkthrough for Waldo from Hack The Box.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Hack The Box - Waldo">
  <meta name="twitter:description" content="My write-up / walkthrough for Waldo from Hack The Box.">
  <meta name="twitter:url" content="https://0xrick.github.io/hack-the-box/waldo/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2018-12-15T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/hack-the-box/waldo/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box - Waldo">
    <meta itemprop="description" content="Hack The Box - WaldoQuick SummaryWaldo was a great box and what makes it special is its unique way in getting the root flag. Every step with this box was very fun and I liked this box too much.It’s a linux box and its ip is 10.10.10.87 so let’s jump right inNmapStarting with nmap to scan for open TCP ports and services.nmap -sV -sT 10.10.10.87 We only see http on port 80 and ssh on port 22.On port 80 there’s a web application called List Manager.Path TraversalWe will intercept the traffic with Burp then we will start to perform actions on the application like creating a list , editing it , deleteing it etc..By looking at the requests we will find two interesting requests.The POST request to fileRead.php and the POST request to dirRead.php.Let’s send them to the repeater and play with them.We will notice that dirRead.php lists the contents of a directory by giving the path in a POST request so we might have a path traversal vulnerability here.If we tried to go up one directory it worksBut going up 2 directories doesn’t work so there might be a filter that prevents that.We can try to bypass the filter by adding another ../. And it workedSSH key for monitorThen after enumerating in home directory we will find out that we can read the ssh key of a user called nobody /home/nobody/.ssh but the ssh key  is called .monitor But we can only read directories with dirRead.php.If we check fileRead.php we will find a path traversal there too.Now we have the key but it’s json decoded. We can use any online json decoder.SSH as nobodyNow will change permissions to 600 then try ssh with nobody. If we try monitor it will give us permission denied.chmod 600 monitor.keyssh -i monitor.key nobody@10.10.10.87And we got user !Privilege Escalation to monitorAfter we login as nobody we need to elevate to a higher privileged user.Since we couldn’t ssh as monitor before let’s try again but this time locally.And We’re in as monitor .But we are in a restricted shell and can’t run commands.We can try some commands and ls will work.We see two directories app-dev and bin.Let’s ls bin and see what commands can we run.We can run ls, most, red, rnano rnano and red are restricted versions of the text editors nano and edEscaping the restricted shellWe can use red to escape.We will run it first .redThen we will execute sh from the editor.!'/bin/sh'And we cd to /bin and execute bash.And we escaped the shell !Exploiting Capabilities and getting root.txtThis is where the awesome part comes. For me it was the first time to deal with linux capabilities.If we look at the bins in /sbin we will see getcap.So If we run getcap on the bin folders.We will find under /usr/bin that a binary named tac has the cap_dac read_search+ei capability.This allows it to read files as root.And tac does exactly the same as cat but the name is reversed.We can simply read root.txt tac /root/root.txtThat’s it , Feedback is appreciated !Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Previous Hack The Box write-up : Hack The Box - ActiveNext Hack The Box write-up : Hack The Box - Oz">
    <meta itemprop="datePublished" content="2018-12-15T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/hack-the-box/waldo/" class="u-url" itemprop="url">Hack The Box - Waldo
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2018-12-15T07:00:00+02:00">December 15, 2018</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#hack-the-box---waldo">Hack The Box - Waldo</a><ul>
<li><a href="#quick-summary">Quick Summary</a></li>
<li><a href="#nmap">Nmap</a></li>
<li><a href="#path-traversal">Path Traversal</a></li>
<li><a href="#ssh-key-for-monitor">SSH key for monitor</a></li>
<li><a href="#ssh-as-nobody">SSH as nobody</a></li>
<li><a href="#privilege-escalation-to-monitor">Privilege Escalation to monitor</a></li>
<li><a href="#escaping-the-restricted-shell">Escaping the restricted shell</a></li>
<li><a href="#exploiting-capabilities-and-getting-roottxt">Exploiting Capabilities and getting root.txt</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="hack-the-box---waldo">Hack The Box - Waldo</h1>

<h2 id="quick-summary">Quick Summary</h2>
<p>Waldo was a great box and what makes it special is its unique way in getting the root flag. Every step with this box was very fun and I liked this box too much.<br>
It’s a linux box and its ip is 10.10.10.87 so let’s jump right in
<br><img src="/images/hackthebox/waldo/0.png" alt="" class="align-center"><br><br></p>

<h2 id="nmap">Nmap</h2>
<p>Starting with nmap to scan for open TCP ports and services.<br>
<code class="language-plaintext highlighter-rouge">nmap -sV -sT 10.10.10.87 </code>
<br><img src="/images/hackthebox/waldo/1.png" alt="" class="align-center"><br><br>
We only see http on port 80 and ssh on port 22.<br>
On port 80 there’s a web application called List Manager.<br>
<br><img src="/images/hackthebox/waldo/2.png" alt="" class="align-center"><br><br></p>

<h2 id="path-traversal">Path Traversal</h2>
<p>We will intercept the traffic with Burp then we will start to perform actions on the application like creating a list , editing it , deleteing it etc..<br>
<br><img src="/images/hackthebox/waldo/3.png" alt="" class="align-center"><br><br>
By looking at the requests we will find two interesting requests.<br>
The POST request to fileRead.php and the POST request to dirRead.php.<br></p>

<p>Let’s send them to the repeater and play with them.<br>
We will notice that dirRead.php lists the contents of a directory by giving the path in a POST request so we might have a path traversal vulnerability here.<br></p>

<p>If we tried to go up one directory it works
<br><img src="/images/hackthebox/waldo/4.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/5.png" alt="" class="align-center"><br><br>
But going up 2 directories doesn’t work so there might be a filter that prevents that.<br>
We can try to bypass the filter by adding another <code class="language-plaintext highlighter-rouge">../</code>. And it worked
<br><img src="/images/hackthebox/waldo/6.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/7.png" alt="" class="align-center"><br><br></p>

<h2 id="ssh-key-for-monitor">SSH key for monitor</h2>
<p>Then after enumerating in home directory we will find out that we can read the ssh key of a user called nobody <code class="language-plaintext highlighter-rouge">/home/nobody/.ssh</code> but the ssh key  is called <code class="language-plaintext highlighter-rouge">.monitor</code> 
<br><img src="/images/hackthebox/waldo/8.png" alt="" class="align-center"><br><br></p>

<p>But we can only read directories with dirRead.php.<br>
If we check fileRead.php we will find a path traversal there too.<br>
<br><img src="/images/hackthebox/waldo/9.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/10.png" alt="" class="align-center"><br><br></p>

<p>Now we have the key but it’s json decoded. We can use any online json decoder.<br>
<br><img src="/images/hackthebox/waldo/11.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/12.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/13.png" alt="" class="align-center"><br><br></p>

<h2 id="ssh-as-nobody">SSH as nobody</h2>
<p>Now will change permissions to 600 then try ssh with nobody. If we try monitor it will give us permission denied.<br>
<code class="language-plaintext highlighter-rouge">chmod 600 monitor.key</code>
<code class="language-plaintext highlighter-rouge">ssh -i monitor.key nobody@10.10.10.87</code>
<br><img src="/images/hackthebox/waldo/14.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/15.png" alt="" class="align-center"><br><br>
And we got user !</p>

<h2 id="privilege-escalation-to-monitor">Privilege Escalation to monitor</h2>

<p>After we login as nobody we need to elevate to a higher privileged user.<br>
Since we couldn’t ssh as monitor before let’s try again but this time locally.<br>
<br><img src="/images/hackthebox/waldo/16.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/17.png" alt="" class="align-center"><br><br>
And We’re in as monitor .<br>
But we are in a restricted shell and can’t run commands.<br>
<br><img src="/images/hackthebox/waldo/18.png" alt="" class="align-center"><br><br></p>

<p>We can try some commands and ls will work.<br>
<br><img src="/images/hackthebox/waldo/19.png" alt="" class="align-center"><br><br></p>

<p>We see two directories app-dev and bin.<br>
Let’s ls bin and see what commands can we run.<br>
<br><img src="/images/hackthebox/waldo/20.png" alt="" class="align-center"><br><br>
We can run <code class="language-plaintext highlighter-rouge">ls</code>, <code class="language-plaintext highlighter-rouge">most</code>, <code class="language-plaintext highlighter-rouge">red</code>, <code class="language-plaintext highlighter-rouge">rnano</code> 
rnano and red are restricted versions of the text editors nano and ed</p>

<h2 id="escaping-the-restricted-shell">Escaping the restricted shell</h2>
<p>We can use <code class="language-plaintext highlighter-rouge">red</code> to escape.<br>
We will run it first .<br>
<code class="language-plaintext highlighter-rouge">red</code>
Then we will execute sh from the editor.<br>
<code class="language-plaintext highlighter-rouge">!'/bin/sh'</code>
And we cd to <code class="language-plaintext highlighter-rouge">/bin</code> and execute <code class="language-plaintext highlighter-rouge">bash</code>.<br>
And we escaped the shell !
<br><img src="/images/hackthebox/waldo/21.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/22.png" alt="" class="align-center"><br><br></p>

<h2 id="exploiting-capabilities-and-getting-roottxt">Exploiting Capabilities and getting root.txt</h2>

<p>This is where the awesome part comes. For me it was the first time to deal with linux capabilities.<br>
If we look at the bins in <code class="language-plaintext highlighter-rouge">/sbin</code> we will see <code class="language-plaintext highlighter-rouge">getcap</code>.<br>
<br><img src="/images/hackthebox/waldo/23.png" alt="" class="align-center"><br><br>
So If we run getcap on the bin folders.<br>
<br><img src="/images/hackthebox/waldo/24.png" alt="" class="align-center"><br>
<img src="/images/hackthebox/waldo/25.png" alt="" class="align-center"><br><br>
We will find under <code class="language-plaintext highlighter-rouge">/usr/bin</code> that a binary named tac has the <code class="language-plaintext highlighter-rouge">cap_dac read_search+ei</code> capability.<br>
This allows it to read files as root.<br>
And tac does exactly the same as cat but the name is reversed.<br>
We can simply read root.txt 
<code class="language-plaintext highlighter-rouge">tac /root/root.txt</code>
<br><img src="/images/hackthebox/waldo/26.png" alt="" class="align-center"><br><br></p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p>Previous Hack The Box write-up : <a href="/hack-the-box/active/">Hack The Box - Active</a>
<br>Next Hack The Box write-up : <a href="/hack-the-box/oz/">Hack The Box - Oz</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-12-15T07:00:00+02:00">December 15, 2018</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/active/" class="pagination--pager" title="Hack The Box - Active
">Previous</a>
    
    
      <a href="/binary-exploitation/bof1/" class="pagination--pager" title="Binary Exploitation - Buffer Overflow Explained in Detail
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
