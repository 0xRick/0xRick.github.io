<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Binary Exploitation - Buffer Overflow Explained in Detail - 0xRick’s Blog</title>
<meta name="description" content="First binary exploitation post where I explain simple basics needed to understand buffer overflow.">


  <meta name="author" content="0xRick">
  
  <meta property="article:author" content="0xRick">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="0xRick's Blog">
<meta property="og:title" content="Binary Exploitation - Buffer Overflow Explained in Detail">
<meta property="og:url" content="https://0xrick.github.io/binary-exploitation/bof1/">


  <meta property="og:description" content="First binary exploitation post where I explain simple basics needed to understand buffer overflow.">





  <meta name="twitter:site" content="@ahm3d_h3sham">
  <meta name="twitter:title" content="Binary Exploitation - Buffer Overflow Explained in Detail">
  <meta name="twitter:description" content="First binary exploitation post where I explain simple basics needed to understand buffer overflow.">
  <meta name="twitter:url" content="https://0xrick.github.io/binary-exploitation/bof1/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2018-12-19T07:00:00+02:00">






<link rel="canonical" href="https://0xrick.github.io/binary-exploitation/bof1/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "0xRick",
      "url": "https://0xrick.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0xRick's Blog
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/avatar.jpg" alt="0xRick" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">0xRick</h3>
    
    
      <div class="author__bio" itemprop="description">
        

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere between 1's and 0's</span>
        </li>
      

      
        
          
            <li><a href="/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-home" aria-hidden="true"></i><span class="label">Home Page</span></a></li>
          
        
          
            <li><a href="https://twitter.com/ahm3d_h3sham" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/0xRick" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">Github</span></a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/VGEfcAqvn" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">buymeacoffee</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
  
  </div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Binary Exploitation - Buffer Overflow Explained in Detail">
    <meta itemprop="description" content="Binary Exploitation - Buffer Overflow Explained in DetailIntroductionFirst of all I’m writing this to help anyone who wants to learn about buffer overflow attacks, the basics to understand this can be confusing and it took me some time to understand it myself so I’ll be covering some basics in this article, what I’m going to talk about is what is a buffer , what is a stack and what are the memory addresses and we will take a look at the application memory structure , what is a buffer overflow and why does it happen then I’ll show a really basic and simple example for a buffer overflow (protostar stack0)BufferSo what’s a buffer ? Simply a buffer is a memory place or location which is used by a running program. This memory location is used to store some temporary data that is being used by the program. So for example if we have a simple program that asks the user to enter his name and stores it in a variable called username then it prints “Hello username “ . For example if we run the program and enter username as “Rick”. The word “Rick” is stored in the buffer until the program executes the print command and it retrieves the given username “Rick” from the buffer to output the result : “Hello Rick”Our example written in c will be like this#include &lt;stdio.h&gt;int main () {   char username[20];   printf(&quot;Enter your name: &quot;);   scanf(&quot;%s&quot;, username);   printf(&quot;Hello %s\n&quot;, username);      return(0);}Break Down :int main() This defines the main functionchar username[20] This is where we specify the variable name but the most important thing about this line is char .... [20] this is where we specify the buffer for that variable , and i assigned it as 20 charsThe rest of the code takes the user input then prints it.printf(&quot;Enter your name: &quot;); scanf(&quot;%s&quot;, username);printf(&quot;Hello %s\n, username&quot;);So when we compile and run this program we get the output as expected right ?Now before we talk about the buffer overflow we need to understand how the application memory worksApplication Memory , Stack and Memory AddressesSo how does the application memory look like and what’s a stack ? A stack is a memory buffer that is used to store the functions of the program and local variables. To demonstrate this, we will take a look at this image.First We have the code and this is the source code of the program. This has the main instructions of the program.After that we have the buffer where the global variables are stored,The difference between a local variable and a global variable is that a local variable is limited to a certain function. It’s defined in that function and can be only called in that function but a global variable is either defined in the main function or defined outside a function and this type of variables can be called anywhere.Then we have the Stack and this is the important part of the memory for us because this is where the buffer overflow happens. This is the place where local variable and function calls are stored.Last thing is Heap and this is a dynamic memory allocation.Now we know what does the application memory look like and what is the stack but what are memory addresses ?Basically when a program is compiled and executed , All the instructions of the program take place in the application memory and an address is assigned to them , This address is usually in the format of hexadecimal bytes.So if you disassemble a program and look at it you’ll find the memory addresses , something like this :Why Do Buffer Overflows Happen ?Now we know what is a buffer and we took a deeper look on the memory construction. Now you might already figured out why and when does a buffer overflow happen. A buffer overflow happens when the length of the data entered exceeds the buffer limit and this causes the program to write data outside the allocated buffer area and may overwrite some parts of the memory that were used to hold data used by the program which makes it unavailable and causes the program to crash. To demonstrate this we will go back to our first example.#include &lt;stdio.h&gt;int main () {   char username[20];   printf(&quot;Enter your name: &quot;);   scanf(&quot;%s&quot;, username);   printf(&quot;Hello %s\n&quot;, username);   printf(&quot;Program exited normally&quot;);   return(0);}We will add a last line to print the sentence “program exited noramlly” just for demonstration purposesNow the program should ask us for username then print “Hello username” then print “program exited normally” and exits. The buffer for holding the username value is set to 20 chars , it’s good as long as the username length is less than 20 chars. But if the entered data is more than 20 chars length the program will crash because some data will be overwritten outside the buffer causing some parts of the program to be corrupted. in our case this will be the part which prints “program exited normally”First let’s run the program and enter the name as RickThe program exits normally.Now let’s run it again and enter the name as 30 A’s We get “Hello AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA” printed then we don’t see “program exited normally” and we get a segmentation fault error. That happened because we entered 10 extra chars, The program only expected 20 or less. Those extra “AAAAAAAAAA” exceeded the 20 chars buffer and overwrited other data (The print instruction which prints “program exited normally”) which caused a segmentation fault because the program is corrupted.Examining Buffer Overflows with gdbLet’s take a deeper look at how this is happening with gdb (gnu debugger).We will write another program that creates a variable called “whatever” then it copies what we give it and put it in that variable. And we will assign the buffer for that variable to be 20#include &lt;stdio.h&gt;#include &lt;string.h&gt;int main(int argc, char** argv){	char whatever[20];	strcpy(whatever, argv[1]);	return 0;}Breakdown :int main(int argc, char** argv) This defines the main function and it’s argumentschar whatever[20]; This creates the variable and gives it the name “whatever” and assigns its buffer to 20 strcpy(whatever, argv[1]); This copies our input and puts it into our variable “whatever”Now let’s run the program inside gdb and test it.The input was aaaaa which is less than 20 chars so the program exited normally and everything is good Now let’s throw an input more that 20 chars.We get a segmentation fault because our return address is overwritten and the program couldn’t continue.To show how are these addresses overwritten let’s input any hex value , something like \x12 for 50 times. Then let’s look at the registers.We see that most of the memory addresses are overwritten with 12Why Are Buffer Overflows Dangerous ?Now you might ask yourself , How will that be harmful ?A buffer overflow is dangerous when the vulnerable binary or program is a setuid binary , If you don’t know what setuid binaries are, read the provided link, but in general They are programs that run with capabilities of another user (usually root) , But when that program is vulnerable to a buffer overflow it’s not a good thing anymore. Since we can pass the buffer and overwrite the program then we can overwrite it with a payload that executes a system call and spawns a root shellI will do more write ups about buffer overflows and other binary exploitation techniques, for now I will start with protostar.There are also some cool boxes on Hack The box that required buffer overflows and binary exploitation to gain root privileges but they’re active right now so I’ll publish my write ups about these boxes as soon as they retire of course. In the meantime, you can read my other Hack The Box write-ups !Protostar Stack0Now let’s do a simple practical example.You can download protostar from hereI will solve the first level which is stack0 for this article then I will solve the rest of the levels in other write-ups.We’re given the source code of the program :#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;int main(int argc, char **argv){ volatile int modified; char buffer[64]; modified = 0; gets(buffer); if(modified != 0) {  printf(&quot;you have changed the 'modified' variable\n&quot;); } else {  printf(&quot;Try again?\n&quot;); }}From the code we can understand that the program has a variable called “buffer” and assigns a buffer of 64 chars to it. Then there’s another variable called modified and it’s value is 0. gets(buffer) allows us to input the value of “buffer” variable.Then there’s an if statement that checks if the value of “modified” variable is not equal to 0. If it’s not equal to zero it will print “you have changed the ‘modified’ variable” but if it’s still equal to 0 it will print “Try again?”. So our mission is to change the value of that variable called “modified”As long as the entered data is less than 64 chars everything will run as intended. But if the input exceeds the buffer it will overwrite the value of “modified” variable.We already know that the buffer is 64 chars so we just need to input 65 chars or more and the variable value will change. Let’s test that out.We execute the stack0 bin and we see the output “try again?”Let’s throw 65 “A”s and see the output.python -c &quot;print ('A' * 65)&quot; | ./stack0 And we have successfuly overwritten the variable’s value ! :DThat’s it , Feedback is appreciated !Don’t forget to read the previous articles , Tweet about the article if you liked it , follow on twitter @Ahm3d_H3shamThanks for reading.Next Binary Exploitation article : Buffer Overflow Examples, Overwriting a variable value on the stack - Protostar Stack1 , Stack2">
    <meta itemprop="datePublished" content="2018-12-19T07:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://0xrick.github.io/binary-exploitation/bof1/" class="u-url" itemprop="url">Binary Exploitation - Buffer Overflow Explained in Detail
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2018-12-19T07:00:00+02:00">December 19, 2018</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        <div>
          <style>
              #carbonads {
                border: 1px solid black;
                border-radius: 7px;
                border-spacing: 7px;
                display: block;
                overflow: hidden;
                padding: 1em;
                line-height: 1.5;
              }
              #carbonads span {
                position: relative;
                display: block;
                overflow: hidden;
              }
              .carbon-img img {
                display: block;
                float: left;
              }
              .carbon-text {
                display: block;
                font-size: .9em;
                text-align: end;
              }
              .carbon-poweredby {
                display: block;
                font-size: .8em;
                float: right;
                line-height: 1;
                letter-spacing: 1px;
                }
                </style>
                <br>   
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&amp;placement=0xrickgithubio" id="_carbonads_js"></script> 
                <br>
        </div>
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu"><li>
<a href="#binary-exploitation---buffer-overflow-explained-in-detail">Binary Exploitation - Buffer Overflow Explained in Detail</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#buffer">Buffer</a></li>
<li><a href="#application-memory--stack-and-memory-addresses">Application Memory , Stack and Memory Addresses</a></li>
<li><a href="#why-do-buffer-overflows-happen-">Why Do Buffer Overflows Happen ?</a></li>
<li><a href="#examining-buffer-overflows-with-gdb">Examining Buffer Overflows with gdb</a></li>
<li><a href="#why-are-buffer-overflows-dangerous-">Why Are Buffer Overflows Dangerous ?</a></li>
<li><a href="#protostar-stack0">Protostar Stack0</a></li>
</ul>
</li></ul>

            </nav>
          </aside>
        
        <h1 id="binary-exploitation---buffer-overflow-explained-in-detail">Binary Exploitation - Buffer Overflow Explained in Detail</h1>

<h2 id="introduction">Introduction</h2>
<p>First of all I’m writing this to help anyone who wants to learn about buffer overflow attacks, the basics to understand this can be confusing and it took me some time to understand it myself so I’ll be covering some basics in this article, what I’m going to talk about is what is a buffer , what is a stack and what are the memory addresses and we will take a look at the application memory structure , what is a buffer overflow and why does it happen then I’ll show a really basic and simple example for a buffer overflow (protostar stack0)
<br><img src="/images/binary-exploitation/BOF/0.png" alt="" class="align-center"><br><br></p>

<h2 id="buffer">Buffer</h2>
<p>So what’s a buffer ? Simply a buffer is a memory place or location which is used by a running program. This memory location is used to store some temporary data that is being used by the program. So for example if we have a simple program that asks the user to enter his name and stores it in a variable called <em>username</em> then it prints “Hello <em>username</em> “ . For example if we run the program and enter username as “Rick”. The word “Rick” is stored in the buffer until the program executes the print command and it retrieves the given username “Rick” from the buffer to output the result : “Hello Rick”</p>

<p>Our example written in c will be like this</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="n">username</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your name: "</span><span class="p">);</span>
   <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">"Hello %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>
   
   <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Break Down :
<br><code class="language-plaintext highlighter-rouge">int main()</code> This defines the main function
<br><code class="language-plaintext highlighter-rouge">char username[20]</code> This is where we specify the variable name but the most important thing about this line is <code class="language-plaintext highlighter-rouge">char .... [20]</code> this is where we specify the buffer for that variable , and i assigned it as 20 chars
<br>The rest of the code takes the user input then prints it.<br>
<code class="language-plaintext highlighter-rouge">printf("Enter your name: ");</code> 
<br><code class="language-plaintext highlighter-rouge">scanf("%s", username);</code>
<br><code class="language-plaintext highlighter-rouge">printf("Hello %s\n, username");</code></p>

<p>So when we compile and run this program we get the output as expected right ?</p>

<p><br><img src="/images/binary-exploitation/BOF/1.png" alt="" class="align-center"><br><br>
Now before we talk about the buffer overflow we need to understand how the application memory works</p>

<h2 id="application-memory--stack-and-memory-addresses">Application Memory , Stack and Memory Addresses</h2>
<p>So how does the application memory look like and what’s a stack ? A stack is a memory buffer that is used to store the functions of the program and local variables. To demonstrate this, we will take a look at this image.<br>
<br><img src="/images/binary-exploitation/BOF/2.png" alt="" class="align-center"><br><br>
First We have the code and this is the source code of the program. This has the main instructions of the program.<br>
After that we have the buffer where the global variables are stored,
<br><em>The difference between a local variable and a global variable is that a local variable is limited to a certain function. It’s defined in that function and can be only called in that function but a global variable is either defined in the main function or defined outside a function and this type of variables can be called anywhere</em>.<br>
Then we have the Stack and this is the important part of the memory for us because this is where the buffer overflow happens. This is the place where local variable and function calls are stored.<br>
Last thing is Heap and this is a dynamic memory allocation.<br>
Now we know what does the application memory look like and what is the stack but what are memory addresses ?
<br>Basically when a program is compiled and executed , All the instructions of the program take place in the application memory and an address is assigned to them , This address is usually in the format of hexadecimal bytes.<br>
So if you disassemble a program and look at it you’ll find the memory addresses , something like this :
<br><img src="/images/binary-exploitation/BOF/3.png" alt="" class="align-center"><br><br></p>

<h2 id="why-do-buffer-overflows-happen-">Why Do Buffer Overflows Happen ?</h2>
<p>Now we know what is a buffer and we took a deeper look on the memory construction. Now you might already figured out why and when does a buffer overflow happen. A buffer overflow happens when the length of the data entered exceeds the buffer limit and this causes the program to write data outside the allocated buffer area and may overwrite some parts of the memory that were used to hold data used by the program which makes it unavailable and causes the program to crash. To demonstrate this we will go back to our first example.<br></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="n">username</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your name: "</span><span class="p">);</span>
   <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">"Hello %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"Program exited normally"</span><span class="p">);</span>
   <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>We will add a last line to print the sentence “program exited noramlly” just for demonstration purposes
<br>Now the program should ask us for username then print “Hello <em>username</em>” then print “program exited normally” and exits. The buffer for holding the username value is set to 20 chars , it’s good as long as the username length is less than 20 chars. But if the entered data is more than 20 chars length the program will crash because some data will be overwritten outside the buffer causing some parts of the program to be corrupted. in our case this will be the part which prints “program exited normally”
<br>First let’s run the program and enter the name as Rick
<br><img src="/images/binary-exploitation/BOF/4.png" alt="" class="align-center"><br><br>
The program exits normally.<br>
Now let’s run it again and enter the name as 30 A’s 
<br><img src="/images/binary-exploitation/BOF/5.png" alt="" class="align-center"><br><br>
We get “Hello AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA” printed then we don’t see “program exited normally” and we get a segmentation fault error. That happened because we entered 10 extra chars, The program only expected 20 or less. Those extra “AAAAAAAAAA” exceeded the 20 chars buffer and overwrited other data (The print instruction which prints “program exited normally”) which caused a segmentation fault because the program is corrupted.<br></p>

<h2 id="examining-buffer-overflows-with-gdb">Examining Buffer Overflows with gdb</h2>
<p>Let’s take a deeper look at how this is happening with gdb (gnu debugger).<br>
We will write another program that creates a variable called “whatever” then it copies what we give it and put it in that variable. And we will assign the buffer for that variable to be 20</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">whatever</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">whatever</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Breakdown :
<br><code class="language-plaintext highlighter-rouge">int main(int argc, char** argv)</code> This defines the main function and it’s arguments
<br><code class="language-plaintext highlighter-rouge">char whatever[20];</code> This creates the variable and gives it the name “whatever” and assigns its buffer to 20 
<br><code class="language-plaintext highlighter-rouge">strcpy(whatever, argv[1]);</code> This copies our input and puts it into our variable “whatever”</p>

<p>Now let’s run the program inside gdb and test it.<br>
<br><img src="/images/binary-exploitation/BOF/6.png" alt="" class="align-center"><br><br>
The input was aaaaa which is less than 20 chars so the program exited normally and everything is good 
<br>Now let’s throw an input more that 20 chars.<br>
<br><img src="/images/binary-exploitation/BOF/7.png" alt="" class="align-center"><br><br>
We get a segmentation fault because our return address is overwritten and the program couldn’t continue.<br>
To show how are these addresses overwritten let’s input any hex value , something like \x12 for 50 times. Then let’s look at the registers.<br>
<br><img src="/images/binary-exploitation/BOF/8.png" alt="" class="align-center"><br><br>
We see that most of the memory addresses are overwritten with 12</p>

<h2 id="why-are-buffer-overflows-dangerous-">Why Are Buffer Overflows Dangerous ?</h2>
<p>Now you might ask yourself , How will that be harmful ?
<br>A buffer overflow is dangerous when the vulnerable binary or program is a <a href="https://en.wikipedia.org/wiki/Setuid" target="_blank" rel="noopener noreferrer">setuid</a> binary , If you don’t know what setuid binaries are, read the provided link, but in general They are programs that run with capabilities of another user (usually root) , But when that program is vulnerable to a buffer overflow it’s not a good thing anymore. Since we can pass the buffer and overwrite the program then we can overwrite it with a payload that executes a system call and spawns a root shell</p>

<p>I will do more write ups about buffer overflows and other binary exploitation techniques, for now I will start with protostar.<br>
There are also some cool boxes on Hack The box that required buffer overflows and binary exploitation to gain root privileges but they’re active right now so I’ll publish my write ups about these boxes as soon as they retire of course. In the meantime, you can read my other <a href="https://0xrick.github.io">Hack The Box write-ups</a> !</p>

<h2 id="protostar-stack0">Protostar Stack0</h2>
<p>Now let’s do a simple practical example.<br>
You can download protostar from <a href="https://www.vulnhub.com/entry/exploit-exercises-protostar-v2,32/" target="_blank" rel="noopener noreferrer">here</a>
<br>I will solve the first level which is stack0 for this article then I will solve the rest of the levels in other write-ups.<br>
We’re given the source code of the program :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
 <span class="k">volatile</span> <span class="kt">int</span> <span class="n">modified</span><span class="p">;</span>
 <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

 <span class="n">modified</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

 <span class="k">if</span><span class="p">(</span><span class="n">modified</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"you have changed the 'modified' variable</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Try again?</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>From the code we can understand that the program has a variable called “buffer” and assigns a buffer of 64 chars to it. Then there’s another variable called modified and it’s value is 0. gets(buffer) allows us to input the value of “buffer” variable.Then there’s an if statement that checks if the value of “modified” variable is not equal to 0. If it’s not equal to zero it will print “you have changed the ‘modified’ variable” but if it’s still equal to 0 it will print “Try again?”. So our mission is to change the value of that variable called “modified”
<br>As long as the entered data is less than 64 chars everything will run as intended. But if the input exceeds the buffer it will overwrite the value of “modified” variable.<br>
We already know that the buffer is 64 chars so we just need to input 65 chars or more and the variable value will change. Let’s test that out.<br>
We execute the stack0 bin and we see the output “try again?”
<br><img src="/images/binary-exploitation/BOF/9.png" alt="" class="align-center"><br><br>
Let’s throw 65 “A”s and see the output.<br>
<code class="language-plaintext highlighter-rouge">python -c "print ('A' * 65)" | ./stack0</code> 
<br><img src="/images/binary-exploitation/BOF/10.png" alt="" class="align-center"><br><br>
And we have successfuly overwritten the variable’s value ! :D</p>

<p><br>That’s it , Feedback is appreciated !
<br>Don’t forget to read the <a href="/categories">previous articles</a> , Tweet about the article if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener noreferrer">@Ahm3d_H3sham</a>
<br>Thanks for reading.<br></p>

<p><br>Next Binary Exploitation article : <a href="/binary-exploitation/bof2/">Buffer Overflow Examples, Overwriting a variable value on the stack - Protostar Stack1 , Stack2</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-12-19T07:00:00+02:00">December 19, 2018</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/hack-the-box/waldo/" class="pagination--pager" title="Hack The Box - Waldo
">Previous</a>
    
    
      <a href="/binary-exploitation/bof2/" class="pagination--pager" title="Buffer Overflow Examples, Overwriting a variable value on the stack - Protostar Stack1 , Stack2
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
      
  
      
  
      
    </ul>
  </div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-97164925-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-97164925-2', { 'anonymize_ip': false});
</script>









  </body>
</html>
